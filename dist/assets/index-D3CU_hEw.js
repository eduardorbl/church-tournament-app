import{r as _t,b as Nt,a as wt,c as d,u as Vs,N as vt,L as K,R as ze,d as zs,e as me,f as St,h as $t,i as ee,B as Ct}from"./vendor-vbeBnipd.js";import{c as At}from"./supabase-BfEApigK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function a(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(i){if(i.ep)return;i.ep=!0;const c=a(i);fetch(i.href,c)}})();var He={exports:{}},ke={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ms;function kt(){if(ms)return ke;ms=1;var s=_t(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function r(o,u,v){var x,E={},A=null,$=null;v!==void 0&&(A=""+v),u.key!==void 0&&(A=""+u.key),u.ref!==void 0&&($=u.ref);for(x in u)l.call(u,x)&&!c.hasOwnProperty(x)&&(E[x]=u[x]);if(o&&o.defaultProps)for(x in u=o.defaultProps,u)E[x]===void 0&&(E[x]=u[x]);return{$$typeof:t,type:o,key:A,ref:$,props:E,_owner:i.current}}return ke.Fragment=a,ke.jsx=r,ke.jsxs=r,ke}var us;function Et(){return us||(us=1,He.exports=kt()),He.exports}var e=Et(),Re={},gs;function Tt(){if(gs)return Re;gs=1;var s=Nt();return Re.createRoot=s.createRoot,Re.hydrateRoot=s.hydrateRoot,Re}var Pt=Tt();const Ft=wt(Pt),Rt="https://cifdtjfrekucrmapewoj.supabase.co",Mt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpZmR0amZyZWt1Y3JtYXBld29qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTM2OTAsImV4cCI6MjA3MzU2OTY5MH0.h4cP9OeroEa4XEQsOrdgy8L-fewT--DC2AtUk9ipJAA",g=At(Rt,Mt),Us=d.createContext({session:null,isAdmin:!1,needsPasswordSetup:!1,ready:!1,loading:!1,signIn:async()=>({data:null,error:null}),signOut:async()=>({error:null}),updatePassword:async()=>({data:null,error:null}),refreshAuth:async()=>{}});function ds(){return d.useContext(Us)}function qt({children:s}){const[t,a]=d.useState(null),[l,i]=d.useState(!1),[c,r]=d.useState(!1),[o,u]=d.useState(!1),[v,x]=d.useState(!0),E=d.useRef(!0),A=d.useRef(0);d.useEffect(()=>{E.current=!0,(async()=>{try{x(!0);const{data:L,error:G}=await g.auth.getSession();if(G)throw G;const C=L?.session??null;if(!E.current)return;a(C),u(!0),x(!1),C?.user?.id?$(C):(i(!1),r(!1))}catch(L){if(console.error("Auth init error:",L),!E.current)return;a(null),i(!1),r(!1),u(!0),x(!1)}})();const{data:I}=g.auth.onAuthStateChange(async(L,G)=>{E.current&&(a(G??null),G?.user?.id?$(G):(i(!1),r(!1)))});return()=>{E.current=!1,I?.subscription?.unsubscribe?.()}},[]);const $=async I=>{const L=++A.current;try{const G=I?.user?.id;if(!G){E.current&&L===A.current&&(i(!1),r(!1));return}const[C,y]=await Promise.allSettled([g.rpc("is_admin"),g.from("user_profiles").select("needs_password_setup").eq("user_id",G).maybeSingle()]);let h=!1;C.status==="fulfilled"?h=!!C.value?.data:console.warn("is_admin RPC falhou:",C.reason);let j=!1;y.status==="fulfilled"?j=!!y.value?.data?.needs_password_setup:console.warn("Leitura de user_profiles falhou (ignorado):",y.reason),E.current&&L===A.current&&(i(h),r(j))}catch(G){console.error("checkAdminAndFlags error:",G),E.current&&L===A.current&&(i(!1),r(!1))}},B={session:t,isAdmin:l,needsPasswordSetup:c,ready:o,loading:v,signIn:async(I,L)=>{const G=await g.auth.signInWithPassword({email:I,password:L});return G.data?.session?.user?.id&&!G.error&&(a(G.data.session),$(G.data.session)),G},signOut:async()=>{const{error:I}=await g.auth.signOut();return I||(a(null),i(!1),r(!1)),{error:I}},updatePassword:async I=>{const{data:L,error:G}=await g.auth.updateUser({password:I});if(!G&&t?.user?.id)try{await g.from("user_profiles").upsert({user_id:t.user.id,needs_password_setup:!1}),r(!1)}catch(C){console.warn("updatePassword: upsert user_profiles falhou (ignorado):",C)}return{data:L,error:G}},refreshAuth:async()=>{const{data:I}=await g.auth.getSession(),L=I?.session??null;a(L),L?.user?.id?$(L):(i(!1),r(!1))}};return e.jsx(Us.Provider,{value:B,children:s})}function ue({children:s}){const{ready:t,session:a,isAdmin:l}=ds(),i=Vs();if(!t)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Verificando permissões..."})]})});if(!a||!l){const c=encodeURIComponent(i.pathname+i.search);return e.jsx(vt,{to:`/login?redirect=${c}&reason=forbidden`,replace:!0})}return s}function se({team:s={},size:t=24,className:a=""}){const[l,i]=d.useState(!1),c=d.useMemo(()=>{const u=s?.logo_url;return typeof u=="string"&&u.trim()&&!l?u:null},[s?.logo_url,l]),r=d.useMemo(()=>{const u=String(s?.name??"").trim();if(!u)return"•";const v=u.match(new RegExp("\\p{L}","u"));return(v?v[0]:u[0]).toUpperCase()},[s?.name]),o={width:t,height:t};return e.jsx("span",{className:`inline-flex items-center justify-center rounded border border-gray-200 bg-white overflow-hidden ${a}`,style:o,title:s?.name,children:c?e.jsx("img",{src:c,alt:s?.name||"Logo",className:"w-full h-full object-cover",onError:()=>i(!0),draggable:!1}):e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-gray-600 select-none",children:r})})}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ot=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,a,l)=>l?l.toUpperCase():a.toLowerCase()),hs=s=>{const t=Ot(s);return t.charAt(0).toUpperCase()+t.slice(1)},Js=(...s)=>s.filter((t,a,l)=>!!t&&t.trim()!==""&&l.indexOf(t)===a).join(" ").trim(),Gt=s=>{for(const t in s)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Lt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=d.forwardRef(({color:s="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:l,className:i="",children:c,iconNode:r,...o},u)=>d.createElement("svg",{ref:u,...Lt,width:t,height:t,stroke:s,strokeWidth:l?Number(a)*24/Number(t):a,className:Js("lucide",i),...!c&&!Gt(o)&&{"aria-hidden":"true"},...o},[...r.map(([v,x])=>d.createElement(v,x)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=(s,t)=>{const a=d.forwardRef(({className:l,...i},c)=>d.createElement(Dt,{ref:c,iconNode:t,className:Js(`lucide-${It(hs(s))}`,`lucide-${s}`,l),...i}));return a.displayName=hs(s),a};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Hs=te("chevron-right",Bt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],zt=te("chevrons-right",Vt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ks=te("circle-play",Ut);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Xs=te("circle-question-mark",Jt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["path",{d:"M12 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 12 18z",key:"b19h5q"}],["path",{d:"M2 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 2 18z",key:"h7h5ge"}]],Kt=te("fast-forward",Ht);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],Zt=te("list-checks",Xt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Yt=te("loader-circle",Qt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],ea=te("megaphone",Wt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ta=te("refresh-cw",sa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],ra=te("rotate-cw",aa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ps=te("settings",na);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],ia=te("shield-alert",oa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ca=te("trash-2",la);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],Zs=te("trophy",da),xs=[{name:"Volei",label:"Vôlei",key:"volei",callText:"⚠️ Compareçam à quadra de Vôlei:"},{name:"Futsal",label:"Futsal",key:"futsal",callText:"⚠️ Compareçam à quadra de Futsal:"},{name:"Pebolim",label:"Pebolim",key:"pebolim",callText:"⚠️ Compareçam à mesa de pebolim:"},{name:"FIFA",label:"FIFA",key:"fifa",callText:"⚠️ Compareçam à área do console:"}],ma={r32:"PRÉ-OITAVAS",grupos:"GRUPOS",oitavas:"OITAVAS",quartas:"QUARTAS",semi:"SEMI",final:"FINAL","3lugar":"3º LUGAR"};function ua(s){return s?ma[s]||String(s).toUpperCase():null}const ga="team-logos";function Qs(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function ha(s){return typeof s=="string"&&!Qs(s)&&s.trim()!==""}function pa(s){if(!s)return null;if(Qs(s))return s;if(ha(s)){const{data:t}=g.storage.from(ga).getPublicUrl(s);return t?.publicUrl||null}return null}function xa(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const c=Math.floor(i/1e3),r=Math.floor(c/60),o=c%60;return`${r}:${o.toString().padStart(2,"0")}`}function fs(s,t){const a=s?.meta||{};return Math.max(0,Number(a[t==="home"?"home_sets":"away_sets"]||0))}function fa({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",l=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${l} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function ya(){const[s,t]=d.useState({}),[a,l]=d.useState(!0),[i,c]=d.useState(null),[r,o]=d.useState(Date.now()),u=d.useRef(!0),v=d.useRef(!1),x=async()=>{if(!v.current){v.current=!0,l(!0),c(null);try{const{data:A,error:$}=await g.from("sports").select("id,name");if($)throw $;const k=new Map((A||[]).map(T=>[T.name,T.id])),N=xs.filter(T=>k.has(T.name)).map(T=>({...T,sportId:k.get(T.name)})),M=await Promise.all(N.map(async T=>{const{data:B,error:I}=await g.from("v_queue_slots").select("slot, order_idx, match_id, stage, group_name").eq("sport_id",T.sportId);if(I)throw I;const L=Object.fromEntries((B||[]).map(b=>[b.slot,b])),G=(B||[]).map(b=>b.match_id).filter(Boolean);let C={};if(G.length){const{data:b}=await g.from("matches").select(`
                id, order_idx, stage, group_name, status, starts_at, updated_at, venue, meta,
                home_score, away_score,
                home:home_team_id ( id, name, logo_url, color ),
                away:away_team_id ( id, name, logo_url, color ),
                sport:sport_id ( id, name )
              `).in("id",G),R=(b||[]).map(m=>{const n=m.home&&typeof m.home=="object"?{...m.home,logo_url:ye(m.home.logo_url)}:m.home,f=m.away&&typeof m.away=="object"?{...m.away,logo_url:ye(m.away.logo_url)}:m.away;return{...m,home:n,away:f}});C=Object.fromEntries(R.map(m=>[m.id,m]))}if(!L?.live?.match_id){const{data:b,error:R}=await g.from("matches").select(`
                id, order_idx, stage, group_name, status, starts_at, updated_at, venue, meta,
                home_score, away_score,
                home:home_team_id ( id, name, logo_url, color ),
                away:away_team_id ( id, name, logo_url, color ),
                sport:sport_id ( id, name )
              `).eq("sport_id",T.sportId).in("status",["ongoing","paused"]).limit(6);if(!R&&b?.length){const m=b.slice().sort((F,P)=>{const w=X=>X==="ongoing"?1:X==="paused"?2:9,q=w(F.status)-w(P.status);return q!==0?q:new Date(P.updated_at||P.starts_at||0)-new Date(F.updated_at||F.starts_at||0)})[0],n=m.home&&typeof m.home=="object"?{...m.home,logo_url:ye(m.home.logo_url)}:m.home,f=m.away&&typeof m.away=="object"?{...m.away,logo_url:ye(m.away.logo_url)}:m.away,_={...m,home:n,away:f};C[_.id]=_,L.live={slot:"live",match_id:_.id,order_idx:_.order_idx,stage:_.stage,group_name:_.group_name}}}const y=[L.call?.match_id,L.next?.match_id].filter(Boolean),{data:h}=await g.from("matches").select(`
              id, order_idx, stage, group_name, status,
              home:home_team_id ( id, name, logo_url, color ),
              away:away_team_id ( id, name, logo_url, color )
            `).eq("sport_id",T.sportId).eq("status","scheduled").not("order_idx","is",null).order("order_idx",{ascending:!0}).limit(10),j=(h||[]).filter(b=>!y.includes(b.id)).slice(0,6).map(b=>({id:b.id,order_idx:b.order_idx,stage:b.stage,group_name:b.group_name,home:b.home?{...b.home,logo_url:ye(b.home.logo_url)}:null,away:b.away?{...b.away,logo_url:ye(b.away.logo_url)}:null}));return[T.key,{...T,slots:L,details:C,compactUpcoming:j}]}));t(Object.fromEntries(M))}catch(A){c(`Falha ao carregar a Home: ${A.message||A}`)}finally{l(!1),v.current=!1}}};d.useEffect(()=>{u.current=!0,x();const A=setInterval(()=>o(Date.now()),1e3),$=g.channel("home-central").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>u.current&&x()).on("postgres_changes",{event:"*",schema:"public",table:"match_events"},()=>u.current&&x()).subscribe();return()=>{u.current=!1,clearInterval(A),g.removeChannel($)}},[]);const E=d.useMemo(()=>xs.map(A=>A.key).filter(A=>s[A]),[s]);return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Central do Evento"})]}),e.jsxs("button",{onClick:x,className:"inline-flex items-center gap-2 rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Recarregar agora",children:[e.jsx(ta,{className:"h-4 w-4"}),"Atualizar"]})]}),i&&e.jsx("div",{className:"mb-5 rounded-xl border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-800",children:i}),a?e.jsx(_a,{}):e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:E.map(A=>e.jsx(ja,{block:s[A],now:r},A))}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function ja({block:s,now:t}){const{label:a,callText:l,slots:i,details:c,compactUpcoming:r}=s||{},o=i?.live?.match_id?c?.[i.live.match_id]:null,u=i?.call?.match_id?c?.[i.call.match_id]:null,v=i?.next?.match_id?c?.[i.next.match_id]:null;return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between gap-3 p-4 sm:p-5",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-lg font-semibold",children:a})})}),e.jsx("div",{className:"px-4 sm:px-5",children:e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-red-800",children:[e.jsx(Ks,{className:"h-4 w-4"}),o?e.jsxs(K,{to:`/match/${o.id}`,className:"hover:underline",children:[o.status==="paused"?"Pausado":"Ao vivo"," — Jogo ",o.order_idx,o.group_name?` • Grupo ${o.group_name}`:""]}):e.jsx("span",{children:"Ao vivo"})]}),o?.stage?e.jsx(ss,{stage:o.stage}):e.jsx("span",{className:"text-xs text-red-700/70",children:"Aguardando…"})]}),o?e.jsx(ba,{match:o,now:t}):e.jsx("div",{className:"text-sm text-gray-600",children:"Nenhuma partida ao vivo no momento."})]})}),e.jsx("div",{className:"px-4 pb-4 sm:px-5 sm:pb-5",children:e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(ys,{tone:"amber",icon:e.jsx(ea,{className:"h-4 w-4"}),title:"Próxima partida",subtitle:l,match:u}),e.jsx(ys,{tone:"emerald",icon:e.jsx(zt,{className:"h-4 w-4"}),title:"Jogo seguinte",subtitle:"Na sequência:",match:v})]})}),r?.length?e.jsxs("div",{className:"border-t px-4 py-3 sm:px-5",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-gray-800",children:"Agendados (próximos)"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:r.map(x=>e.jsxs(K,{to:`/match/${x.id}`,className:"flex items-center justify-between rounded-lg border bg-gray-50 px-3 py-2 hover:bg-gray-100",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"truncate text-sm font-medium text-gray-900",children:["Jogo ",x.order_idx,x.group_name?` • Grupo ${x.group_name}`:""]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-gray-700",children:[e.jsx(Ve,{team:x.home,size:20,allowLink:!1}),e.jsx("span",{className:"text-gray-400",children:"x"}),e.jsx(Ve,{team:x.away,size:20,align:"right",allowLink:!1})]})]}),e.jsx("div",{className:"ml-3 shrink-0",children:e.jsx(ss,{stage:x.stage})})]},x.id))})]}):null]})}function ss({stage:s}){const t=ua(s);return t?e.jsx("span",{className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-semibold tracking-wide text-gray-700",children:t}):null}function ba({match:s,now:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),l=s.status!=="scheduled",i=Number(s?.home_score??0),c=Number(s?.away_score??0),r=a?fs(s,"home"):0,o=a?fs(s,"away"):0;return e.jsxs(K,{to:`/match/${s.id}`,className:"block rounded-xl bg-white p-3 shadow-sm hover:bg-gray-50 relative overflow-hidden",children:[e.jsx(fa,{status:s.status}),e.jsxs("div",{className:"mb-2 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.group_name?e.jsxs("span",{children:["Grupo ",s.group_name]}):e.jsx("span",{}),s.venue?e.jsxs("span",{className:"text-gray-400",children:["• ",s.venue]}):null]}),(s.status==="ongoing"||s.status==="paused")&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",xa(s,t)]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(js,{team:s.home,align:"left"}),e.jsxs("div",{className:"shrink-0 text-center",children:[a&&e.jsxs("div",{className:"text-[11px] font-semibold text-gray-600 tabular-nums",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"sets"})," ",o]}),l?e.jsxs("div",{className:"text-xl font-bold tabular-nums",children:[i," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",c]}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"})]}),e.jsx(js,{team:s.away,align:"right"})]})]})}function ys({tone:s,icon:t,title:a,subtitle:l,match:i}){const c=s==="amber"?"border-amber-200 bg-amber-50":s==="emerald"?"border-emerald-200 bg-emerald-50":"border-gray-200 bg-gray-50";return e.jsxs("div",{className:`rounded-xl border ${c} p-3 sm:p-4`,children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[t,e.jsx("span",{children:a})]}),i?.stage?e.jsx(ss,{stage:i.stage}):null]}),e.jsx("div",{className:"text-xs text-gray-600",children:l}),e.jsx("div",{className:"mt-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.jsxs(K,{to:`/match/${i.id}`,className:"hover:underline",children:["Jogo ",i.order_idx,i.group_name?` • Grupo ${i.group_name}`:""]})}),e.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[e.jsx(Ve,{team:i.home}),e.jsx("span",{className:"px-1 text-gray-400",children:"x"}),e.jsx(Ve,{team:i.away,align:"right"})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-gray-500 flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:i.venue||""}),e.jsxs(K,{to:`/match/${i.id}`,className:"inline-flex items-center gap-1 text-blue-600 hover:underline",children:["Ver partida ",e.jsx(Hs,{className:"h-3.5 w-3.5"})]})]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Aguardando…"})})]})}function Ve({team:s,size:t=24,align:a="left",allowLink:l=!0}){const i=e.jsxs(e.Fragment,{children:[e.jsx(se,{team:s||{name:"A definir"},size:t}),e.jsx("span",{className:`truncate text-sm ${a==="right"?"text-right":""}`,children:s?.name||"A definir"})]});return!l||!s?.id?e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${a==="right"?"justify-end":""}`,children:i}):e.jsx(K,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 ${a==="right"?"justify-end":""} hover:underline`,title:s?.name,onClick:c=>c.stopPropagation(),children:i})}function js({team:s,align:t="left"}){return e.jsxs("div",{className:`flex items-center ${t==="right"?"justify-end":""} gap-2 min-w-0 flex-1`,children:[t!=="right"&&e.jsx(se,{team:s||{name:"A definir"},size:36}),s?.id?e.jsx(K,{to:`/team/${s.id}`,className:`truncate text-sm font-medium hover:underline ${t==="right"?"text-right":"text-left"}`,title:s?.name,onClick:a=>a.stopPropagation(),children:s?.name||"A definir"}):e.jsx("span",{className:`truncate text-sm ${t==="right"?"text-right text-gray-400":"text-gray-400"}`,children:"A definir"}),t==="right"&&e.jsx(se,{team:s||{name:"A definir"},size:36})]})}function _a(){return e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:Array.from({length:4}).map((s,t)=>e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("div",{className:"mb-3 h-6 w-40 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"mb-3 h-24 animate-pulse rounded bg-red-100/60"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsx("div",{className:"h-20 animate-pulse rounded bg-amber-100/60"}),e.jsx("div",{className:"h-20 animate-pulse rounded bg-emerald-100/60"})]}),e.jsx("div",{className:"mt-3 h-16 animate-pulse rounded bg-gray-100"})]},t))})}function ye(s){const t=pa(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null}const Na="Futsal",wa="⚽",va="team-logos",Sa="America/Sao_Paulo",$a={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Ys=s=>s?$a[s]||s:"";function Ws(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function ts(s){const t=Ws(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:Sa,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const Me=s=>{const t=Ws(s);return t?t.getTime():Number.POSITIVE_INFINITY},et=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Ca=s=>typeof s=="string"&&!et(s)&&s.trim()!=="";function Aa(s){if(!s)return null;if(et(s))return s;if(Ca(s)){const{data:t}=g.storage.from(va).getPublicUrl(s);return t?.publicUrl||null}return null}const je=s=>{const t=Aa(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};let ka=class extends ze.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Futsal ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}};function st({order_idx:s,stage:t,group_name:a}){const l=[];return s!=null&&String(s).length&&l.push(`Jogo ${s}`),a?l.push(`Grupo ${a}`):t&&l.push(Ys(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:l.join(" • ")||"—"})}function as({team:s,align:t="left",badge:a=28}){const l=(()=>{const o=s?.name;if(typeof o=="string")return o;if(o&&typeof o=="object"&&"name"in o)return String(o.name);try{return String(o??"A definir")}catch{return"A definir"}})(),i=!!s?.id,c=!i&&l==="A definir",r=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:l},size:a}),e.jsxs("span",{className:`block truncate text-base sm:text-lg font-semibold ${i?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:l,children:[l,c?e.jsx(Xs,{className:"inline-block ml-1 w-4 h-4 text-gray-400"}):null]}),t==="right"?e.jsx(se,{team:{...s||{},name:l},size:a}):null]});return i?e.jsx(K,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:o=>o.stopPropagation(),title:l,children:r}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:r})}function be({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),l=s?.away||(t?.away?{name:t.away}:null),i=a?.id?a:{name:a?.name||"A definir"},c=l?.id?l:{name:l?.name||"A definir"},r=s?.status&&s.status!=="scheduled",o=Number(s?.home_score??0),u=Number(s?.away_score??0),v=({value:A})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:r?A:"-"})]}),x=({team:A,align:$,score:k})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${$==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(as,{team:A,align:$})}),e.jsx(v,{value:k})]}),E=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(st,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(x,{team:i,align:"left",score:o}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(x,{team:c,align:"right",score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ts(s.starts_at):s?.venue||""}),r?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[o," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",u]}):null]})]});return s?.id?e.jsx(K,{to:`/match/${s.id}`,className:"block",children:E}):e.jsx("div",{className:"block",children:E})}function bs({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),l=Number(s?.away_score??0);return e.jsxs(K,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(st,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(as,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs("span",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",l]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(as,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ts(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",ts(s.updated_at)]}):null]})]})}function Ea(s,t){const a=Number(s.points??0),l=Number(t.points??0);if(l!==a)return l-a;const i=Number(s.wins??0),c=Number(t.wins??0);if(c!==i)return c-i;const r=Number(s.goal_difference??Number(s.goals_for??0)-Number(s.goals_against??0)),o=Number(t.goal_difference??Number(t.goals_for??0)-Number(t.goals_against??0));if(o!==r)return o-r;const u=Number(s.goals_for??0),v=Number(t.goals_for??0);return v!==u?v-u:String(s.team_id).localeCompare(String(t.team_id))}function qe(s,t){return(t.points??0)-(s.points??0)||(t.wins??0)-(s.wins??0)||(t.goal_difference??0)-(s.goal_difference??0)||(t.goals_for??0)-(s.goals_for??0)||String(s.team_id).localeCompare(String(t.team_id))}function Ta(s,t={}){if(!Array.isArray(s)||s.length===0)return[];const a=o=>{const u=t[o.team_id];return u?{id:o.team_id,name:String(u.name??o.team_name??"—"),color:u.color,logo_url:u.logo_url}:{id:o.team_id,name:String(o.team_name??"—")}},l=new Map;for(const o of s){const u=o.group_name||"-";l.has(u)||l.set(u,[]),l.get(u).push(o)}for(const o of l.keys())l.get(o).sort(qe);const i=[],c=[];for(const[o,u]of l)u[0]&&i.push({group:o,row:u[0]}),u[1]&&c.push({group:o,row:u[1]});i.sort((o,u)=>qe(o.row,u.row)),c.sort((o,u)=>qe(o.row,u.row));const r=i.length;if(r>=4){const o=i.slice(0,4);return[{stage:"semi",home:a(o[0].row),away:a(o[3].row)},{stage:"semi",home:a(o[1].row),away:a(o[2].row)}]}else{if(r===3)return c.length?[{stage:"semi",home:a(i[0].row),away:a(c[0].row)},{stage:"semi",home:a(i[1].row),away:a(i[2].row)}]:[];if(r===2){if(c.length<2)return[];const o=[i[0].row,i[1].row,c[0].row,c[1].row].sort(qe);return[{stage:"semi",home:a(o[0]),away:a(o[3])},{stage:"semi",home:a(o[1]),away:a(o[2])}]}}return[]}function Pa({standings:s,teamsById:t}){const a=d.useMemo(()=>{const i={};for(const o of s||[]){const u=o.group_name||"-";i[u]||(i[u]=[]),i[u].push(o)}const c=new Set,r={};for(const o in t){const u=t[o],v=u.group_name||"-";c.add(v),r[v]||(r[v]=[]),r[v].push(u)}for(const o of c){const u=new Set((i[o]||[]).map(E=>String(E.team_id))),x=(r[o]||[]).filter(E=>!u.has(String(E.id))).map(E=>({group_name:o,team_id:E.id,team_name:E.name,matches_played:0,wins:0,draws:0,losses:0,goals_for:0,goals_against:0,goal_difference:0,points:0}));i[o]=[...i[o]||[],...x],i[o].sort(Ea),i[o]=i[o].map((E,A)=>({...E,rank:A+1}))}return i},[s,t]),l=Object.keys(a).sort();return l.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:l.map(i=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",i]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"E"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[i].map(c=>{const r=t[c.team_id]&&typeof t[c.team_id]=="object"?t[c.team_id]:{id:c.team_id,name:String(c.team_name??t[c.team_id]?.name??"—")},o={...r,name:typeof r.name=="string"?r.name:String(r.name??"—")};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:c.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(K,{to:`/team/${o.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:o,size:20}),e.jsx("span",{className:"truncate",children:o.name})]})}),e.jsx("td",{className:"py-1 text-center",children:c.matches_played}),e.jsx("td",{className:"py-1 text-center",children:c.wins}),e.jsx("td",{className:"py-1 text-center",children:c.draws}),e.jsx("td",{className:"py-1 text-center",children:c.losses}),e.jsx("td",{className:"py-1 text-center",children:c.goals_for}),e.jsx("td",{className:"py-1 text-center",children:c.goals_against}),e.jsx("td",{className:"py-1 text-center",children:c.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:c.points})]},`${i}-${c.team_id}`)})})]}),e.jsx("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:"Critérios: Pontos, Vitórias, Saldo de Gols, Gols Pró."})]},i))})}function Fa(s){const t=c=>(s||[]).filter(r=>r.stage===c).sort((r,o)=>(Number(r?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(o?.order_idx)||Number.MAX_SAFE_INTEGER)),a=t("semi"),l=t("final"),i=t("3lugar");return{semis:a,final:l[0],third:i[0]}}function Ra(){const[s,t]=d.useState(null),[a,l]=d.useState({}),[i,c]=d.useState([]),[r,o]=d.useState([]),[u,v]=d.useState(!0),[x,E]=d.useState("todos"),[A,$]=d.useState("todos"),k=d.useRef(null),N=d.useRef(null),M=d.useCallback(async()=>{try{const{data:n,error:f}=await g.from("sports").select("id").eq("name","Futsal").maybeSingle();if(f)throw f;n?.id?t(n.id):(console.warn("⚠️ Esporte 'Futsal' não encontrado na tabela sports."),t(null))}catch(n){console.error("Exceção loadSportId:",n),t(null)}},[]),T=d.useCallback(async n=>{try{if(n){const F=await g.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",n);if(!F.error&&Array.isArray(F.data)&&F.data.length>0){const P={};for(const w of F.data)P[w.id]={...w,name:String(w.name??"—"),logo_url:je(w.logo_url),group_name:w.group_name??"-"};l(P);return}}const f=await g.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").eq("sport.name","Futsal");if(f.error)throw f.error;const _={};for(const F of f.data||[])_[F.id]={...F,name:String(F.name??"—"),logo_url:je(F.logo_url),group_name:F.group_name??"-"};l(_)}catch(f){console.error("Exceção loadTeams:",f),l({})}},[]),B=d.useCallback(async n=>{try{if(n){const P=await g.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points").eq("sport_id",n).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!P.error&&Array.isArray(P.data)&&P.data.length>0){c(P.data);return}}const f=await g.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points, sport:sport_id!inner(name)").eq("sport.name","Futsal").order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!f.error&&Array.isArray(f.data)&&f.data.length>0){c(f.data.map(({sport:P,...w})=>w));return}if(n){const P=await g.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, draws, losses,
            goals_for, goals_against, goal_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",n).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!P.error&&Array.isArray(P.data)&&P.data.length>0){c(P.data.map(w=>({...w,team_name:w.team?.name})));return}}const F=((await g.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, draws, losses,
          goals_for, goals_against, goal_difference, points,
          team:teams!standings_team_id_fkey(name),
          sport:sport_id!inner(name)
        `).eq("sport.name","Futsal").order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(P=>({...P,team_name:P.team?.name}));c(F)}catch(f){console.error("Exceção loadStandings:",f),c([])}},[]),I=d.useCallback(async n=>{try{let f=[];if(n){const{data:P,error:w}=await g.from("match_detail_view").select(`
            id, sport_id, order_idx,
            stage, round, group_name, starts_at, updated_at, venue, status,
            home_team_id, home_team_name, home_team_color, home_team_logo,
            away_team_id, away_team_name, away_team_color, away_team_logo,
            home_score, away_score
          `).eq("sport_id",n);!w&&Array.isArray(P)&&P.length&&(f=P.map(q=>({id:q.id,sport_id:q.sport_id,order_idx:q.order_idx,stage:q.stage,round:q.round,group_name:q.group_name,starts_at:q.starts_at,updated_at:q.updated_at,venue:q.venue,status:q.status,home_score:q.home_score,away_score:q.away_score,home:q.home_team_id?{id:q.home_team_id,name:String(q.home_team_name??"A definir"),color:q.home_team_color,logo_url:je(q.home_team_logo)}:null,away:q.away_team_id?{id:q.away_team_id,name:String(q.away_team_name??"A definir"),color:q.away_team_color,logo_url:je(q.away_team_logo)}:null})))}if(!f.length){const{data:P,error:w}=await g.from("matches").select(`
            id, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score, order_idx,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color ),
            sport:sport_id!inner(name)
          `).eq("sport.name","Futsal");if(w)throw w;f=(P||[]).map(q=>({...q,order_idx:q.order_idx??q.round??q.id,home:q.home?{...q.home,name:String(q.home.name??"A definir"),logo_url:je(q.home.logo_url)}:null,away:q.away?{...q.away,name:String(q.away.name??"A definir"),logo_url:je(q.away.logo_url)}:null}))}const _={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6},F=P=>Number.isFinite(Number(P?.order_idx))?Number(P.order_idx):Number.MAX_SAFE_INTEGER;f.sort((P,w)=>(_[P.stage]??99)-(_[w.stage]??99)||F(P)-F(w)),o(f)}catch(f){console.error("Exceção loadMatches:",f),o([])}},[]),L=d.useCallback(async(n,{skeleton:f=!1}={})=>{f&&v(!0);try{await Promise.all([T(n),B(n),I(n)])}finally{v(!1)}},[T,B,I]);d.useEffect(()=>{M()},[M]),d.useEffect(()=>{if(!s){v(!1);return}if(L(s,{skeleton:!0}),k.current){try{g.removeChannel(k.current)}catch{}k.current=null}const n=g.channel("futsal-hub").on("postgres_changes",s?{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`}:{event:"*",schema:"public",table:"matches"},()=>{N.current&&clearTimeout(N.current),N.current=setTimeout(()=>L(s,{skeleton:!1}),200)}).on("postgres_changes",{event:"*",schema:"public",table:"standings"},()=>{N.current&&clearTimeout(N.current),N.current=setTimeout(()=>L(s,{skeleton:!1}),200)}).subscribe();return k.current=n,()=>{if(N.current&&(clearTimeout(N.current),N.current=null),k.current){try{g.removeChannel(k.current)}catch{}k.current=null}}},[s,L]);const G=d.useMemo(()=>!!(i?.length||(r||[]).some(n=>!!n.group_name)||Object.values(a||{}).some(n=>!!n.group_name)),[i,r,a]),C=d.useMemo(()=>Fa(r),[r]),y=d.useMemo(()=>Ta(i,a),[i,a]),h=C.semis?.length?C.semis:y,j=d.useMemo(()=>{const n=new Set;return(r||[]).forEach(f=>f.group_name&&n.add(f.group_name)),(i||[]).forEach(f=>f.group_name&&n.add(f.group_name)),Object.values(a||{}).forEach(f=>f.group_name&&n.add(f.group_name)),["todos",...Array.from(n).sort()]},[r,i,a]),b=d.useMemo(()=>{const n=new Set;(r||[]).forEach(F=>F.stage&&n.add(F.stage));const f=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(n).sort((F,P)=>f.indexOf(F)+100-(f.indexOf(P)+100))]},[r]),R=d.useMemo(()=>{let n=(r||[]).filter(f=>f.status!=="scheduled"?!1:f.group_name?!0:f.home?.id&&f.away?.id);return x!=="todos"&&(n=n.filter(f=>f.group_name===x)),A!=="todos"&&(n=n.filter(f=>f.stage===A)),n.sort((f,_)=>Me(f.starts_at)-Me(_.starts_at)),n},[r,x,A]),m=d.useMemo(()=>{const n=(r||[]).filter(f=>f.status==="finished");return n.sort((f,_)=>Me(_.updated_at||_.starts_at||0)-Me(f.updated_at||f.starts_at||0)),n.slice(0,12)},[r]);return e.jsx(ka,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:wa}),e.jsx("h2",{className:"text-2xl font-bold",children:Na})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"classificação"})," → ",e.jsx("strong",{children:"chaveamento"})," →"," ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),u?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((n,f)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},f))})]}):e.jsxs(e.Fragment,{children:[G&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Pa,{standings:i,teamsById:a})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),h?.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:h.map((n,f)=>e.jsx(be,{match:n},`s-${n?.id??f}`))})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsx(be,{placeholder:{home:"A definir",away:"A definir"}}),e.jsx(be,{placeholder:{home:"A definir",away:"A definir"}})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),C.final?e.jsx(be,{match:C.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(be,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]}),C.third?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"3º lugar"}),e.jsx(be,{match:C.third})]}):null]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:x,onChange:n=>E(n.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:j.map(n=>e.jsx("option",{value:n,children:n==="todos"?"Todos":`Grupo ${n}`},n))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:A,onChange:n=>$(n.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:b.map(n=>e.jsx("option",{value:n,children:n==="todos"?"Todas":Ys(n)},n))})]}),R.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:R.map((n,f)=>e.jsx(bs,{match:n},n.id??`sched-${f}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),m.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:m.map((n,f)=>e.jsx(bs,{match:n},n.id??`fin-${f}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas com ",e.jsx("strong",{children:"10 minutos corridos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo e o melhor 2º colocado avançam para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," saldo de gols."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor do grupo A × Vencedor do grupo B; Vencedor do grupo C × Melhor 2º colocado."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substituições:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desperdício de tempo:"})," pode ser acrescido ao final do jogo, a critério do árbitro."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Goleiro-linha:"})," permitido."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Expulsão:"})," o time fica com um jogador a menos por 2 minutos ou até sofrer um gol."]})]})})]})]})]})})}const Ma="Vôlei",qa="🏐",Ia="team-logos",Oa="America/Sao_Paulo",Ga={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},tt=s=>s?Ga[s]||s:"",Ee=["Vôlei","Volei","Voleibol"];function at(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function rs(s){const t=at(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:Oa,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const _e=s=>{const t=at(s);return t?t.getTime():Number.POSITIVE_INFINITY},rt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),La=s=>typeof s=="string"&&!rt(s)&&s.trim()!=="";function Da(s){if(!s)return null;if(rt(s))return s;if(La(s)){const{data:t}=g.storage.from(Ia).getPublicUrl(s);return t?.publicUrl||null}return null}const ns=s=>{const t=Da(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};let Ba=class extends ze.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Vôlei ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}};function nt({order_idx:s,stage:t,group_name:a}){const l=[];return s!=null&&String(s).length&&l.push(`Jogo ${s}`),a?l.push(`Grupo ${a}`):t&&l.push(tt(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:l.join(" • ")||"—"})}function os({team:s,align:t="left",badge:a=28}){const l=(()=>{const r=s?.name;if(typeof r=="string")return r;if(r&&typeof r=="object"&&"name"in r)return String(r.name);try{return String(r??"A definir")}catch{return"A definir"}})(),i=!!s?.id,c=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:l},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${i?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:l,children:l}),t==="right"?e.jsx(se,{team:{...s||{},name:l},size:a}):null]});return i?e.jsx(K,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:r=>r.stopPropagation(),title:l,children:c}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:c})}function Ie({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),l=s?.away||(t?.away?{name:t.away}:null),i=a?.id?a:{name:a?.name||"A definir"},c=l?.id?l:{name:l?.name||"A definir"},r=s&&s.status!=="scheduled",o=Number(s?.home_score??0),u=Number(s?.away_score??0),v=Number(s?.meta?.home_sets??0),x=Number(s?.meta?.away_sets??0),A=v>0||x>0||r,$=({label:M,value:T,visible:B})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-2.5 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:M}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:B?T:"-"})]}),k=({team:M,align:T,sets:B,score:I})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${T==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(os,{team:M,align:T})}),e.jsxs("div",{className:"flex items-center gap-2",children:[A?e.jsx($,{label:"Sets",value:B,visible:A}):null,e.jsx($,{label:"Pontos",value:I,visible:r})]})]}),N=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(nt,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(k,{team:i,align:"left",sets:v,score:o}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(k,{team:c,align:"right",sets:x,score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?rs(s.starts_at):s?.venue||""}),r?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:["Sets ",v," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",x]}):null]})]});return s?.id?e.jsx(K,{to:`/match/${s.id}`,className:"block",children:N}):N}function _s({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),l=Number(s?.away_score??0),i=Number(s?.meta?.home_sets??0),c=Number(s?.meta?.away_sets??0),r=t&&(i>0||c>0);return e.jsxs(K,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(nt,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(os,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs(e.Fragment,{children:[r?e.jsxs("div",{className:"text-[11px] font-medium tabular-nums text-gray-600 mb-0.5",children:["Sets: ",i," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",c]}):null,e.jsxs("div",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",l]})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(os,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?rs(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",rs(s.updated_at)]}):null]})]})}function Fe(s,t){return(t.points??0)-(s.points??0)||(t.sv??0)-(s.sv??0)||(s.sp??0)-(t.sp??0)||(t.point_difference??(t.pf??0)-(t.pa??0))-(s.point_difference??(s.pf??0)-(s.pa??0))||(t.pf??0)-(s.pf??0)||String(s.team_id).localeCompare(String(t.team_id))}function Va(s){if(!Array.isArray(s)||s.length===0)return[];const t=s.map(r=>({...r,group_name:de(r.group_name)})).filter(r=>r.group_name&&r.group_name!=="-"),a=new Map;for(const r of t){const o=r.group_name;a.has(o)||a.set(o,[]),a.get(o).push(r)}for(const r of a.keys())a.get(r).sort((o,u)=>(o.rank??999)-(u.rank??999));const l=[],i=[];for(const[r,o]of a)o[0]&&l.push({group:r,...o[0]}),o[1]&&i.push({group:r,...o[1]});l.sort(Fe),i.sort(Fe);const c=l.length;if(c>=4){const r=l.slice(0,4);return[{stage:"semi",home:r[0],away:r[3]},{stage:"semi",home:r[1],away:r[2]}]}else if(c===3){if(!i.length)return[];const r=i[0];return[{stage:"semi",home:l[0],away:r},{stage:"semi",home:l[1],away:l[2]}]}else if(c===2){if(i.length<2)return[];const r=[...l,i[0],i[1]].sort(Fe);return[{stage:"semi",home:r[0],away:r[3]},{stage:"semi",home:r[1],away:r[2]}]}return[]}function za({standings:s,teamsById:t}){const a=d.useMemo(()=>{const i={};for(const c of s||[]){const r=c.group_name||"-";i[r]||(i[r]=[]),i[r].push(c)}for(const c of Object.keys(i))i[c].sort((r,o)=>(r.rank??999)-(o.rank??999));return i},[s]),l=Object.keys(a).sort();return l.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:l.map(i=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",i]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"SV"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"SP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"PF"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"PC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[i].map(c=>{const r=t[c.team_id]||{id:c.team_id,name:c.team_name||"—"},o=Number(c.point_difference??(c.pf??0)-(c.pa??0));return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:c.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(K,{to:`/team/${r.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:{...r,logo_url:ns(r.logo_url)},size:20}),e.jsx("span",{className:"truncate",children:r.name})]})}),e.jsx("td",{className:"py-1 text-center",children:c.matches_played}),e.jsx("td",{className:"py-1 text-center",children:c.wins}),e.jsx("td",{className:"py-1 text-center",children:c.losses}),e.jsx("td",{className:"py-1 text-center",children:c.sv}),e.jsx("td",{className:"py-1 text-center",children:c.sp}),e.jsx("td",{className:"py-1 text-center",children:c.pf}),e.jsx("td",{className:"py-1 text-center",children:c.pa}),e.jsx("td",{className:"py-1 text-center",children:o}),e.jsx("td",{className:"py-1 text-center font-semibold",children:c.points})]},`${i}-${c.team_id}`)})})]}),e.jsxs("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:["Critérios/colunas: ",e.jsx("strong",{children:"#"})," (posição), ",e.jsx("strong",{children:"Time"}),", ",e.jsx("strong",{children:"P"})," (jogos), ",e.jsx("strong",{children:"V"})," (vitórias), ",e.jsx("strong",{children:"D"})," (derrotas), ",e.jsx("strong",{children:"SV"})," (sets vencidos), ",e.jsx("strong",{children:"SP"})," (sets perdidos), ",e.jsx("strong",{children:"PF"})," (pontos feitos), ",e.jsx("strong",{children:"PC"})," (pontos contra), ",e.jsx("strong",{children:"+/-"})," (saldo de pontos), ",e.jsx("strong",{children:"Pts"})," (pontos na tabela)."]})]},i))})}const ot=s=>typeof s=="string"?s.trim().toLowerCase():"",Ua=s=>{const t=ot(s);return t==="semifinal"||t==="semi-final"||t==="semis"?"semi":t==="3º"||t==="3º lugar"||t==="terceiro"||t==="3-lugar"?"3lugar":t},Ja=s=>{const t=ot(s);return t==="encerrado"||t==="finalizado"?"finished":t==="agendado"||t==="programado"?"scheduled":t||"scheduled"},de=s=>{if(!s)return"-";const t=String(s).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toUpperCase();if(!t)return"-";const a=t.match(/^GRUPO\s+([A-Z0-9]+)$/);return a?a[1]:t};function Ns(s,t){const a=new Map,l=(u,v)=>`${u}::${v}`,i=(u,v)=>{const x=l(u,v);return a.has(x)||a.set(x,{group_name:u,team_id:v,team_name:t?.[v]?.name??"—",matches_played:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0,points:0}),a.get(x)},c=new Set;for(const u of s||[]){const v=de(u?.group_name)||"-",x=u?.home?.id,E=u?.away?.id;x&&(i(v,x),c.add(x)),E&&(i(v,E),c.add(E))}for(const u of s||[]){if(u?.status!=="finished")continue;const v=de(u?.group_name)||"-",x=u?.home?.id,E=u?.away?.id;if(!x||!E)continue;const A=i(v,x),$=i(v,E),k=Number(u?.meta?.home_sets??0),N=Number(u?.meta?.away_sets??0),M=Number(u?.home_score??0),T=Number(u?.away_score??0);let B=!1,I=!1;k!==N?(B=k>N,I=!B):M!==T&&(B=M>T,I=!B),A.matches_played++,$.matches_played++,A.sv+=k,A.sp+=N,A.pf+=M,A.pa+=T,$.sv+=N,$.sp+=k,$.pf+=T,$.pa+=M,B?(A.wins++,A.points+=3,$.losses++):I&&($.wins++,$.points+=3,A.losses++)}for(const u of Object.keys(t||{})){const v=Number(u);if(c.has(v)||c.has(u))continue;const x=de(t[u]?.group_name);x&&x!=="-"&&i(x,u)}const r={};for(const u of a.values())u.point_difference=Number(u.pf)-Number(u.pa),(r[u.group_name]||=[]).push(u);const o=[];for(const u of Object.keys(r).sort())r[u].sort(Fe),r[u].forEach((v,x)=>o.push({...v,rank:x+1}));return o}function Ha(){const[s,t]=d.useState(null),[a,l]=d.useState({}),i=d.useRef({});d.useEffect(()=>{i.current=a},[a]);const[c,r]=d.useState([]),[o,u]=d.useState([]),[v,x]=d.useState(!0),[E,A]=d.useState("todos"),[$,k]=d.useState("todos"),N=d.useRef(null),M=d.useRef(null),T=d.useCallback(async()=>{try{const{data:m,error:n}=await g.from("sports").select("id, name").in("name",Ee).limit(1);if(n)throw n;m&&m[0]?.id?t(m[0].id):(console.warn("⚠️ Esporte Vôlei não encontrado em 'sports' (nomes tentados:",Ee.join(", "),")"),t(null))}catch(m){console.error("Exceção loadSportId:",m),t(null)}},[]),B=d.useCallback(async m=>{try{if(m){const _=await g.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",m);if(!_.error&&Array.isArray(_.data)&&_.data.length>0){const F={};for(const P of _.data)F[P.id]={...P,name:String(P.name??"—"),logo_url:ns(P.logo_url)};l(F),i.current=F;return}}const n=await g.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").in("sport.name",Ee);if(n.error)throw n.error;const f={};for(const _ of n.data||[])f[_.id]={..._,name:String(_.name??"—"),logo_url:ns(_.logo_url)};l(f),i.current=f}catch(n){console.error("Exceção loadTeams:",n),l({}),i.current={}}},[]),I=d.useCallback(async m=>{try{if(m){const _=await g.from("standings_volei_view").select("group_name, rank, team_id, team_name, matches_played, wins, losses, sv, sp, pf, pa, point_difference, points").eq("sport_id",m).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!_.error&&Array.isArray(_.data)&&_.data.length>0){console.info("[Vôlei] standings via VIEW/sport_id:",_.data.length),r(_.data);return}}if(m){const _=await g.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, losses,
            sv, sp, pf, pa, point_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",m).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0}),F=(_.data||[]).map(P=>({...P,team_name:P.team?.name,sv:Number(P.sv??0),sp:Number(P.sp??0),pf:Number(P.pf??0),pa:Number(P.pa??0),point_difference:Number(P.point_difference??(P.pf??0)-(P.pa??0))}));if(!_.error&&F.length>0){console.info("[Vôlei] standings via TABLE/sport_id:",F.length),r(F);return}}const f=((await g.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, losses,
          sv, sp, pf, pa, point_difference, points,
          team:teams!inner(name, id),
          sport:sport_id!inner(name, id)
        `).in("sport.name",Ee).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(_=>({..._,team_name:_.team?.name,sv:Number(_.sv??0),sp:Number(_.sp??0),pf:Number(_.pf??0),pa:Number(_.pa??0),point_difference:Number(_.point_difference??(_.pf??0)-(_.pa??0))}));console.info("[Vôlei] standings via TABLE/join por nome:",f.length,"— esportes possíveis:",Ee),r(f)}catch(n){console.error("Exceção loadStandings (vôlei):",n),r([])}},[]),L=d.useCallback(async m=>{try{if(!m){u([]);return}const{data:n,error:f}=await g.from("matches").select(`
          id, sport_id,
          stage, round, group_name, starts_at, updated_at, venue, status, meta,
          home_team_id, away_team_id, home_score, away_score, order_idx
        `).eq("sport_id",m);if(f)throw f;const _=w=>w?{...i.current[w]||{},id:w,name:String(i.current[w]?.name??"A definir")}:null,F=(n||[]).map(w=>{const q=Number.isFinite(Number(w.order_idx))?Number(w.order_idx):null,X=Number.isFinite(Number(w.order_idx))?Number(w.order_idx):Number.isFinite(Number(w.round))?Number(w.round):Number.MAX_SAFE_INTEGER;return{id:w.id,sport_id:w.sport_id,order_idx:q,_sortKey:X,stage:Ua(w.stage),round:w.round,group_name:w.group_name,starts_at:w.starts_at,updated_at:w.updated_at,venue:w.venue,status:Ja(w.status),meta:w.meta,home_score:w.home_score,away_score:w.away_score,home:_(w.home_team_id),away:_(w.away_team_id)}}),P={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6};F.sort((w,q)=>(P[w.stage]??99)-(P[q.stage]??99)||w._sortKey-q._sortKey||_e(w.starts_at)-_e(q.starts_at)||w.id-q.id),u(F),console.info("[Vôlei] matches carregados:",F.length)}catch(n){console.error("Exceção loadMatches (vôlei):",n),u([])}},[]),G=d.useCallback(async(m,{skeleton:n=!1}={})=>{n&&x(!0);try{await B(m),await Promise.all([I(m),L(m)])}finally{x(!1)}},[B,I,L]);d.useEffect(()=>{T()},[T]),d.useEffect(()=>{if(!s){x(!1);return}if(G(s,{skeleton:!0}),N.current){try{g.removeChannel(N.current)}catch{}N.current=null}const m=()=>{M.current&&clearTimeout(M.current),M.current=setTimeout(()=>G(s,{skeleton:!1}),1e3)},n=g.channel(`volei-hub-${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},m).on("postgres_changes",{event:"UPDATE",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},m).on("postgres_changes",{event:"DELETE",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},m).subscribe();return N.current=n,()=>{if(M.current&&(clearTimeout(M.current),M.current=null),N.current){try{g.removeChannel(N.current)}catch{}N.current=null}}},[s,G]),d.useEffect(()=>{if(!v){const m=Ns(o,i.current);m.length&&r(m)}},[v,o,a]),d.useEffect(()=>{if(!v&&c.length===0&&o.length>0){const m=Ns(o,i.current);m.length&&(console.info("[Vôlei] standings derivadas de matches:",m.length),r(m))}},[v,c.length,o]),d.useEffect(()=>{if(!c)return;const m=new Set(c.map(S=>String(S.team_id))),f=Object.keys(i.current||{}).filter(S=>!m.has(String(S)));if(f.length===0)return;const _=new Map;for(const S of o||[]){const O=de(S?.group_name);if(!O)continue;const V=J=>{if(!J)return;const Z=String(J),ne=_.get(Z)||{};ne[O]=(ne[O]||0)+1,_.set(Z,ne)};V(S?.home?.id),V(S?.away?.id)}const F=S=>{const O=_.get(String(S))||{},V=Object.entries(O).sort((J,Z)=>Z[1]-J[1])[0];return V?V[0]:"-"},P=f.map(S=>{const O=i.current[S]||{};return{group_name:(O.group_name?de(O.group_name):null)||F(S)||"-",team_id:isNaN(Number(S))?S:Number(S),team_name:O.name||"—",matches_played:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0,point_difference:0,points:0}}),w=[...c,...P],q={};for(const S of w){const O=S.group_name||"-",V=Number(S.point_difference??(S.pf??0)-(S.pa??0));(q[O]||=[]).push({...S,point_difference:V})}const X=[];for(const S of Object.keys(q).sort())q[S].sort(Fe),q[S].forEach((O,V)=>X.push({...O,rank:V+1}));r(X)},[c,o,a]);const C=c.length>0,y=d.useMemo(()=>{const m=F=>(o||[]).filter(P=>P.stage===F).sort((P,w)=>(Number(P?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(w?.order_idx)||Number.MAX_SAFE_INTEGER)),n=m("semi"),f=m("final"),_=m("3lugar");return{semis:n,final:f[0],third:_[0]}},[o]),h=d.useMemo(()=>Va(c),[c]),j=y.semis?.length?y.semis:h||[];d.useMemo(()=>{const m=new Set;return(o||[]).forEach(n=>{const f=de(n.group_name);f&&f!=="-"&&m.add(f)}),["todos",...Array.from(m).sort()]},[o]),d.useMemo(()=>{const m=new Set;(o||[]).forEach(_=>_.stage&&m.add(_.stage));const n=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(m).sort((_,F)=>n.indexOf(_)+100-(n.indexOf(F)+100))]},[o]);const b=d.useMemo(()=>{const m=(o||[]).some(f=>f.stage==="grupos"&&f.status!=="finished");let n=(o||[]).filter(f=>f.status==="scheduled"&&(m?f.stage==="grupos":!0));return E!=="todos"&&(n=n.filter(f=>de(f.group_name)===E)),$!=="todos"&&(n=n.filter(f=>f.stage===$)),n.sort((f,_)=>_e(f.starts_at)-_e(_.starts_at)||(f.order_idx??1)-(_.order_idx??1)),n},[o,E,$]),R=d.useMemo(()=>{const m=(o||[]).filter(n=>n.status==="finished");return m.sort((n,f)=>_e(f.updated_at||f.starts_at||0)-_e(n.updated_at||n.starts_at||0)),m.slice(0,12)},[o]);return e.jsx(Ba,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:qa}),e.jsx("h2",{className:"text-2xl font-bold",children:Ma})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Classificação por ",e.jsx("strong",{children:"sets"})," (3 pts por vitória). Empate em sets desempata por ",e.jsx("strong",{children:"pontos do placar"}),"."]})]}),v?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((m,n)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},n))})]}):e.jsxs(e.Fragment,{children:[C&&(()=>{const m=(c||[]).filter(n=>de(n.group_name)!=="-");return m.length?e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(za,{standings:m,teamsById:a})]}):null})(),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(j.length,2)}).map((m,n)=>{const f=j[n],_=f?void 0:{home:"A definir",away:"A definir"};return e.jsx(Ie,{match:f,placeholder:_},`s-${f?.id??n}`)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),y.final?e.jsx(Ie,{match:y.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(Ie,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]}),y.third?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"3º lugar"}),e.jsx(Ie,{match:y.third})]}):null]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:E,onChange:m=>A(m.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:["todos",...new Set((o||[]).map(m=>m.group_name).filter(Boolean)).values()].map(m=>e.jsx("option",{value:m,children:m==="todos"?"Todos":`Grupo ${m}`},m))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:$,onChange:m=>k(m.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:["todos",...new Set((o||[]).map(m=>m.stage).filter(Boolean)).values()].map(m=>e.jsx("option",{value:m,children:m==="todos"?"Todas":tt(m)},m))})]}),b.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:b.map((m,n)=>e.jsx(_s,{match:m},m.id??`sched-${n}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),R.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:R.map((m,n)=>e.jsx(_s,{match:m},m.id??`fin-${n}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas com ",e.jsx("strong",{children:"um set de 15 pontos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Vitória:"})," é necessário ter ",e.jsx("strong",{children:"dois pontos de vantagem"})," para vencer a partida."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo e o melhor 2º colocado avançam para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," confronto direto; se houver 3 empates, será utilizado o diferencial de pontos."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor do grupo A × Vencedor do grupo B; Vencedor do grupo C × Melhor 2º colocado."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substituições:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Rodízio:"})," obrigatório."]})]})})]})]})]})})}const Ka="FIFA",Xa="🎮⚽",Za="team-logos",Qa="America/Sao_Paulo",Ya={r32:"Pré-oitavas",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar","1º":"1ª fase","2º":"2ª fase","3º":"3ª fase","4º":"4ª fase"},ws={r32:1,oitavas:2,quartas:3,semi:4,final:5,"3lugar":5},it=s=>s?Ya[s]||s:"",Oe=s=>ws[s]??ws[String(s||"").toLowerCase()]??99;function Wa(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function er(s){const t=Wa(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:Qa,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const lt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),sr=s=>typeof s=="string"&&!lt(s)&&s.trim()!=="";function tr(s){if(!s)return null;if(lt(s))return s;if(sr(s)){const{data:t}=g.storage.from(Za).getPublicUrl(s);return t?.publicUrl||null}return null}const Ge=s=>{const t=tr(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null},ar={17:[1,2],18:[3,4],19:[5,6],20:[7,8],21:[9,10],22:[11,12],23:[13,14],24:[15,16],25:[17,18],26:[19,20],27:[21,22],28:[23,24],29:[25,26],30:[27,28],31:[29,30]},rr={32:[29,30]},nr=(s,t)=>t==="3lugar"?rr[s]||null:ar[s]||null;function or({order_idx:s,stage:t}){const a=[];return s!=null&&String(s).length&&a.push(`Jogo ${s}`),t&&a.push(it(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:a.join(" • ")||"—"})}function ir({team:s,align:t="left",badge:a=28}){const l=(()=>{const r=s?.name;if(typeof r=="string")return r;if(r&&typeof r=="object"&&"name"in r)return String(r.name);try{return String(r??"A definir")}catch{return"A definir"}})(),i=!!s?.id,c=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:l},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${i?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:l,children:l}),t==="right"?e.jsx(se,{team:{...s||{},name:l},size:a}):null]});return i?e.jsx(K,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:r=>r.stopPropagation(),title:l,children:c}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:c})}function lr({match:s,placeholders:t}){const a=s.home||(t?.home?{name:t.home}:null),l=s.away||(t?.away?{name:t.away}:null),i=a?.id?a:{name:a?.name||"A definir"},c=l?.id?l:{name:l?.name||"A definir"},r=s?.status&&s.status!=="scheduled",o=Number(s?.home_score??0),u=Number(s?.away_score??0),v=({value:E})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:r?E:"-"})]}),x=({team:E,align:A,score:$})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${A==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(ir,{team:E,align:A})}),e.jsx(v,{value:$})]});return e.jsxs(K,{to:`/match/${s.id}`,className:"block rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(or,{order_idx:s.order_idx,stage:s.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(x,{team:i,align:"left",score:o}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(x,{team:c,align:"right",score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.starts_at?er(s.starts_at):s.venue||""}),r?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[o," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",u]}):null]})]})}function cr(){const[s,t]=d.useState(null),[a,l]=d.useState([]),[i,c]=d.useState(!0),r=d.useRef(null),o=d.useRef(!1),u=d.useCallback(async()=>{const{data:$,error:k}=await g.from("sports").select("id").eq("name","FIFA").maybeSingle();if(k){console.error("Erro ao carregar sport id:",k);return}$?.id&&t($.id)},[]),v=d.useCallback(async $=>{try{const{data:k,error:N}=await g.from("match_detail_view").select(`
          id, sport_id, order_idx,
          stage, round, group_name, starts_at, updated_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score
        `).eq("sport_id",$);let M=[];if(!N&&k?.length)M=k.map(T=>({id:T.id,sport_id:T.sport_id,order_idx:T.order_idx,stage:T.stage,round:T.round,group_name:T.group_name,starts_at:T.starts_at,updated_at:T.updated_at,venue:T.venue,status:T.status,home_score:T.home_score,away_score:T.away_score,home:T.home_team_id?{id:T.home_team_id,name:String(T.home_team_name??"A definir"),color:T.home_team_color,logo_url:Ge(T.home_team_logo)}:null,away:T.away_team_id?{id:T.away_team_id,name:String(T.away_team_name??"A definir"),color:T.away_team_color,logo_url:Ge(T.away_team_logo)}:null}));else{const{data:T,error:B}=await g.from("matches").select(`
            id, order_idx, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("sport_id",$);if(B)throw B;M=(T||[]).map(I=>({...I,home:I.home&&typeof I.home=="object"?{...I.home,name:String(I.home.name??"A definir"),logo_url:Ge(I.home.logo_url)}:I.home,away:I.away&&typeof I.away=="object"?{...I.away,name:String(I.away.name??"A definir"),logo_url:Ge(I.away.logo_url)}:I.away}))}M.sort((T,B)=>{const I=Oe(T.stage)-Oe(B.stage);return I!==0?I:(T.order_idx??9999)-(B.order_idx??9999)}),l(M)}catch(k){console.error("Exceção loadMatches:",k),l([])}},[]),x=d.useCallback(async $=>{if(!o.current){o.current=!0,c(!0);try{await v($)}finally{c(!1),o.current=!1}}},[v]);d.useEffect(()=>{u()},[u]),d.useEffect(()=>{if(!s)return;if(x(s),r.current){try{g.removeChannel(r.current)}catch{}r.current=null}const $=g.channel(`fifa-hub-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},()=>{x(s)}).subscribe();return r.current=$,()=>{if(r.current){try{g.removeChannel(r.current)}catch{}r.current=null}}},[s,x]);const E=d.useCallback(($,k)=>{const N=nr($,k);return k==="3lugar"&&N?{home:`Perdedor J${N[0]}`,away:`Perdedor J${N[1]}`}:N?{home:`Vencedor J${N[0]}`,away:`Vencedor J${N[1]}`}:null},[]),A=d.useMemo(()=>{const $={};for(const N of a){const M=N.stage||"—";$[M]||($[M]=[]),$[M].push(N)}return Object.keys($).sort((N,M)=>Oe(N)-Oe(M)).map(N=>({stage:N,items:$[N].sort((M,T)=>(M.order_idx??0)-(T.order_idx??0))}))},[a]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Xa}),e.jsx("h2",{className:"text-2xl font-bold",children:Ka})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"chaveamento"})," completo (com placeholders) → ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),i?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map(($,k)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},k))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),A.map(({stage:$,items:k})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:it($)||"Fase"}),k.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:k.map(N=>e.jsx(lr,{match:N,placeholders:E(Number(N.order_idx),N.stage)},N.id))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem confrontos nesta fase."})]},$))]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," torneio de ",e.jsx("strong",{children:"mata-mata"})," (eliminação simples)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estrutura:"})," fases iniciais → oitavas/quartas → semifinais → final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Partidas:"})," jogo único por confronto."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate:"})," prorrogação e/ou pênaltis conforme necessário."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Configurações do console:"})," duração, times e regras definidas pela organização."]})]})})]})]})]})}const Ne="Pebolim",dr="🎯",mr="team-logos",ur="America/Sao_Paulo",gr={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},ct=s=>s?gr[s]||s:"";function dt(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function is(s){const t=dt(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:ur,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const Le=s=>{const t=dt(s);return t?t.getTime():Number.POSITIVE_INFINITY},mt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),hr=s=>typeof s=="string"&&!mt(s)&&s.trim()!=="";function pr(s){if(!s)return null;if(mt(s))return s;if(hr(s)){const{data:t}=g.storage.from(mr).getPublicUrl(s);return t?.publicUrl||null}return null}const we=s=>{const t=pr(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};function ut({order_idx:s,stage:t,group_name:a}){const l=[];return s!=null&&String(s).length&&l.push(`Jogo ${s}`),a?l.push(`Grupo ${a}`):t&&l.push(ct(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:l.join(" • ")||"—"})}function ls({team:s,align:t="left",badge:a=28}){const l=(()=>{const o=s?.name;if(typeof o=="string")return o;if(o&&typeof o=="object"&&"name"in o)return String(o.name);try{return String(o??"A definir")}catch{return"A definir"}})(),i=!!s?.id,c=!i&&l==="A definir",r=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:l},size:a}),e.jsxs("span",{className:`block truncate text-base sm:text-lg font-semibold ${i?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:l,children:[l,c?e.jsx(Xs,{className:"inline-block ml-1 w-4 h-4 text-gray-400"}):null]}),t==="right"?e.jsx(se,{team:{...s||{},name:l},size:a}):null]});return i?e.jsx(K,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:o=>o.stopPropagation(),title:l,children:r}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:r})}function vs({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),l=Number(s?.away_score??0);return e.jsxs(K,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(ut,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(ls,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs("span",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",l]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(ls,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?is(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",is(s.updated_at)]}):null]})]})}function Te({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),l=s?.away||(t?.away?{name:t.away}:null),i=a?.id?a:{name:a?.name||"A definir"},c=l?.id?l:{name:l?.name||"A definir"},r=s&&s.status!=="scheduled",o=Number(s?.home_score??0),u=Number(s?.away_score??0),v=({value:A})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:r?A:"-"})]}),x=({team:A,align:$,score:k})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${$==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(ls,{team:A,align:$})}),e.jsx(v,{value:k})]}),E=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(ut,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(x,{team:i,align:"left",score:o}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(x,{team:c,align:"right",score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?is(s.starts_at):s?.venue||""}),r?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[o," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",u]}):null]})]});return s?.id?e.jsx(K,{to:`/match/${s.id}`,className:"block",children:E}):E}const cs=s=>3*Number(s.wins??0)+Number(s.draws??0);function xr(s,t){const a=cs(s),l=cs(t);if(l!==a)return l-a;const i=Number(s.wins??0),c=Number(t.wins??0);if(c!==i)return c-i;const r=Number(s.goal_difference??Number(s.goals_for??0)-Number(s.goals_against??0)),o=Number(t.goal_difference??Number(t.goals_for??0)-Number(t.goals_against??0));if(o!==r)return o-r;const u=Number(s.goals_for??0),v=Number(t.goals_for??0);return v!==u?v-u:String(s.team_id).localeCompare(String(t.team_id))}function fr({standings:s,teamsById:t}){const a=d.useMemo(()=>{const c=x=>String(x??"-").trim().toUpperCase(),r={},o=new Set;for(const x of s||[]){const E=c(x.group_name);r[E]||(r[E]=[]),r[E].push({...x,group_name:E}),o.add(String(x.team_id))}const u={};for(const x in t){const E=t[x],A=c(E.group_name);u[A]||(u[A]=[]),u[A].push(E)}const v=Object.keys(r).length?Object.keys(r):Object.keys(u);for(const x of v){const E=r[x]||[],A=(u[x]||[]).filter(k=>!o.has(String(k.id))).map(k=>({group_name:x,team_id:k.id,team_name:k.name,matches_played:0,wins:0,draws:0,losses:0,goals_for:0,goals_against:0,goal_difference:0})),$=[...E,...A].sort(xr).map((k,N)=>({...k,rank:N+1}));r[x]=$}return r},[s,t]),l=d.useMemo(()=>{const c=new Map;(s||[]).forEach(o=>c.set(String(o.team_id),String(o.group_name??"-")));const r=[];return Object.values(t||{}).forEach(o=>{const u=c.get(String(o.id)),v=String(o.group_name??"-");u&&u!==v&&r.push({id:o.id,name:o.name,teamG:v,sidG:u})}),r},[s,t]),i=Object.keys(a).sort();return i.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[l.length?e.jsx("div",{className:"md:col-span-3",children:e.jsxs("div",{className:"rounded-md border border-amber-200 bg-amber-50 p-2 text-xs text-amber-800",children:[l.length," time(s) com grupo divergente entre ",e.jsx("em",{children:"teams"})," e ",e.jsx("em",{children:"standings"}),". A UI já ignora isso, mas vale ajustar no banco."]})}):null,i.map(c=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",c]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"E"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[c].map(r=>{const o=t[r.team_id]&&typeof t[r.team_id]=="object"?t[r.team_id]:{id:r.team_id,name:String(r.team_name??t[r.team_id]?.name??"—")},u={...o,name:typeof o.name=="string"?o.name:String(o.name??"—")};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:r.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(K,{to:`/team/${u.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:u,size:20}),e.jsx("span",{className:"truncate",children:u.name})]})}),e.jsx("td",{className:"py-1 text-center",children:r.matches_played}),e.jsx("td",{className:"py-1 text-center",children:r.wins}),e.jsx("td",{className:"py-1 text-center",children:r.draws}),e.jsx("td",{className:"py-1 text-center",children:r.losses}),e.jsx("td",{className:"py-1 text-center",children:r.goals_for}),e.jsx("td",{className:"py-1 text-center",children:r.goals_against}),e.jsx("td",{className:"py-1 text-center",children:r.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:cs(r)})]},`${c}-${r.team_id}`)})})]}),e.jsx("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:"Critérios: Pontos, Vitórias, Saldo de Gols, Gols Pró."})]},c))]})}function yr(s){const t=o=>(s||[]).filter(u=>u.stage===o).sort((u,v)=>(Number(u?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(v?.order_idx)||Number.MAX_SAFE_INTEGER)),a=t("oitavas"),l=t("quartas"),i=t("semi"),c=t("final"),r=t("3lugar");return{oitavas:a,quartas:l,semis:i,final:c[0],third:r[0]}}function jr(s,t){if(!Array.isArray(s)||s.length===0){const r=(o,u)=>({home:{name:`1º Grupo ${o}`},away:{name:`1º Grupo ${u}`}});return{quarters:[r("A","B"),r("C","D"),r("E","F"),r("G","H")],semis:[{home:{name:"Vencedor Quartas 1"},away:{name:"Vencedor Quartas 2"}},{home:{name:"Vencedor Quartas 3"},away:{name:"Vencedor Quartas 4"}}]}}const a={};for(const r of"ABCDEFGH".split("")){const o=s.find(u=>u.group_name===r&&u.rank===1);o&&(a[r]={id:o.team_id,name:o.team_name||t[o.team_id]?.name||"—",logo_url:t[o.team_id]?.logo_url,color:t[o.team_id]?.color})}const l=(r,o)=>({home:a[r]||{name:`1º Grupo ${r}`},away:a[o]||{name:`1º Grupo ${o}`}});return{quarters:[l("A","B"),l("C","D"),l("E","F"),l("G","H")],semis:[{home:{name:"Vencedor Quartas 1"},away:{name:"Vencedor Quartas 2"}},{home:{name:"Vencedor Quartas 3"},away:{name:"Vencedor Quartas 4"}}]}}class br extends ze.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Pebolim ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}}const gt=s=>typeof s=="string"?s.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toLowerCase():"",Ss=s=>{const t=gt(s);return t==="semifinal"||t==="semi-final"||t==="semis"?"semi":t==="3º lugar"||t==="3lugar"||t==="3-lugar"||t==="terceiro"?"3lugar":t},$s=s=>{const t=gt(s);return t==="agendado"||t==="programado"||t==="scheduled"?"scheduled":t==="ao vivo"||t==="andamento"||t==="live"||t==="ongoing"?"ongoing":t==="pausado"||t==="paused"?"paused":t==="encerrado"||t==="finalizado"||t==="finished"?"finished":t||"scheduled"};function _r(){const[s,t]=d.useState(null),[a,l]=d.useState({}),i=d.useRef({});d.useEffect(()=>{i.current=a},[a]);const[c,r]=d.useState([]),[o,u]=d.useState([]),[v,x]=d.useState(!0),[E,A]=d.useState("todos"),[$,k]=d.useState("todos"),N=d.useRef(null),M=d.useRef(null),T=d.useCallback(async()=>{try{const{data:m,error:n}=await g.from("sports").select("id").eq("name",Ne).maybeSingle();n&&console.error("Erro ao carregar sport id:",n),t(m?.id??null)}catch(m){console.error("Exceção loadSportId:",m),t(null)}},[]),B=d.useCallback(async m=>{try{if(m){const _=await g.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",m);if(!_.error&&Array.isArray(_.data)&&_.data.length){const F={};for(const P of _.data)F[P.id]={...P,name:String(P.name??"—"),logo_url:we(P.logo_url),group_name:P.group_name??"-"};l(F),i.current=F;return}}const n=await g.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").eq("sport.name",Ne);if(n.error)throw n.error;const f={};for(const _ of n.data||[])f[_.id]={..._,name:String(_.name??"—"),logo_url:we(_.logo_url),group_name:_.group_name??"-"};l(f),i.current=f}catch(n){console.error("Exceção loadTeams:",n),l({})}},[]),I=d.useCallback(async m=>{try{if(m){const F=await g.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points").eq("sport_id",m).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!F.error&&Array.isArray(F.data)&&F.data.length>0){r(F.data);return}}const n=await g.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points, sport:sport_id!inner(name)").eq("sport.name",Ne).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!n.error&&Array.isArray(n.data)&&n.data.length>0){r(n.data.map(({sport:F,...P})=>P));return}if(m){const F=await g.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, draws, losses,
            goals_for, goals_against, goal_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",m).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!F.error&&Array.isArray(F.data)&&F.data.length>0){r(F.data.map(P=>({...P,team_name:P.team?.name})));return}}const _=((await g.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, draws, losses,
          goals_for, goals_against, goal_difference, points,
          team:teams!standings_team_id_fkey(name),
          sport:sport_id!inner(name)
        `).eq("sport.name",Ne).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(F=>({...F,team_name:F.team?.name}));r(_)}catch(n){console.error("Exceção loadStandings:",n),r([])}},[]),L=d.useCallback(async m=>{try{let n=[];if(m){const{data:F,error:P}=await g.from("match_detail_view").select(`
            id, sport_id, order_idx,
            stage, round, group_name, starts_at, updated_at, venue, status,
            home_team_id, home_team_name, home_team_color, home_team_logo,
            away_team_id, away_team_name, away_team_color, away_team_logo,
            home_score, away_score
          `).eq("sport_id",m);!P&&Array.isArray(F)&&F.length&&(n=F.map(w=>({id:w.id,sport_id:w.sport_id,order_idx:w.order_idx,stage:Ss(w.stage),round:w.round,group_name:w.group_name,starts_at:w.starts_at,updated_at:w.updated_at,venue:w.venue,status:$s(w.status),home_score:w.home_score,away_score:w.away_score,home:w.home_team_id?{id:w.home_team_id,name:String(w.home_team_name??"A definir"),color:w.home_team_color,logo_url:we(w.home_team_logo)}:null,away:w.away_team_id?{id:w.away_team_id,name:String(w.away_team_name??"A definir"),color:w.away_team_color,logo_url:we(w.away_team_logo)}:null})))}if(!n.length){const{data:F,error:P}=await g.from("matches").select(`
            id, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score, order_idx,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color ),
            sport:sport_id!inner(name)
          `).eq("sport.name",Ne);if(P)throw P;n=(F||[]).map(w=>({id:w.id,order_idx:Number.isFinite(Number(w.order_idx))?Number(w.order_idx):null,stage:Ss(w.stage),round:w.round,group_name:w.group_name,starts_at:w.starts_at,updated_at:w.updated_at,venue:w.venue,status:$s(w.status),home_score:w.home_score,away_score:w.away_score,home:w.home?{...w.home,name:String(w.home.name??"A definir"),logo_url:we(w.home.logo_url)}:null,away:w.away?{...w.away,name:String(w.away.name??"A definir"),logo_url:we(w.away.logo_url)}:null}))}const f={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6},_=F=>Number.isFinite(Number(F?.order_idx))?Number(F.order_idx):Number.MAX_SAFE_INTEGER;n.sort((F,P)=>(f[F.stage]??99)-(f[P.stage]??99)||_(F)-_(P)),u(n)}catch(n){console.error("Exceção loadMatches (pebolim):",n),u([])}},[]),G=d.useCallback(async(m,{skeleton:n=!1}={})=>{n&&x(!0);try{await B(m),await Promise.all([I(m),L(m)])}finally{x(!1)}},[B,I,L]);d.useEffect(()=>{T()},[T]),d.useEffect(()=>{if(G(s,{skeleton:!0}),N.current){try{g.removeChannel(N.current)}catch{}N.current=null}if(s){const m=()=>{M.current&&clearTimeout(M.current),M.current=setTimeout(()=>G(s,{skeleton:!1}),400)},n=g.channel(`pebolim-hub-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},m).on("postgres_changes",{event:"*",schema:"public",table:"standings",filter:`sport_id=eq.${s}`},m).subscribe();N.current=n}return()=>{if(M.current&&(clearTimeout(M.current),M.current=null),N.current){try{g.removeChannel(N.current)}catch{}N.current=null}}},[s,G]),d.useMemo(()=>!!(c?.length||(o||[]).some(m=>!!m.group_name)||Object.values(a||{}).some(m=>!!m.group_name)),[c,o,a]);const C=d.useMemo(()=>yr(o),[o]),y=d.useMemo(()=>jr(c,a),[c,a]),h=d.useMemo(()=>{const m=new Set;return(o||[]).forEach(n=>n.group_name&&m.add(n.group_name)),(c||[]).forEach(n=>n.group_name&&m.add(n.group_name)),Object.values(a||{}).forEach(n=>n.group_name&&m.add(n.group_name)),["todos",...Array.from(m).sort()]},[o,c,a]),j=d.useMemo(()=>{const m=new Set;(o||[]).forEach(_=>_.stage&&m.add(_.stage));const n=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(m).sort((_,F)=>n.indexOf(_)+100-(n.indexOf(F)+100))]},[o]),b=d.useMemo(()=>{let m=(o||[]).filter(n=>n.status!=="scheduled"?!1:n.group_name?!0:n.home?.id&&n.away?.id);return E!=="todos"&&(m=m.filter(n=>n.group_name===E)),$!=="todos"&&(m=m.filter(n=>n.stage===$)),m.sort((n,f)=>{const _=Le(n.starts_at),F=Le(f.starts_at);return(Number.isFinite(_-F)?_-F:0)||Number(n.order_idx??Number.MAX_SAFE_INTEGER)-Number(f.order_idx??Number.MAX_SAFE_INTEGER)||n.id-f.id}),m},[o,E,$]),R=d.useMemo(()=>{const m=(o||[]).filter(n=>n.status==="finished");return m.sort((n,f)=>Le(f.updated_at||f.starts_at||0)-Le(n.updated_at||n.starts_at||0)),m.slice(0,12)},[o]);return e.jsx(br,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:dr}),e.jsx("h2",{className:"text-2xl font-bold",children:Ne})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"classificação"})," (se houver grupos) → ",e.jsx("strong",{children:"chaveamento"})," →"," ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),v?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((m,n)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},n))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(fr,{standings:c,teamsById:a})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),C.oitavas?.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Oitavas de final"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:C.oitavas.map((m,n)=>e.jsx(Te,{match:m},`o-${m?.id??n}`))})]}):null,C.quartas?.length||y?.quarters?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Quartas de final"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(C.quartas?.length||0,y?.quarters?.length||0,4)}).map((m,n)=>{const f=C.quartas?.[n],_=y?.quarters?.[n];return e.jsx(Te,{match:f,placeholder:_},`q-${f?.id??n}`)})})]}):null,C.semis?.length||y?.semis?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(C.semis?.length||0,y?.semis?.length||0,2)}).map((m,n)=>{const f=C.semis?.[n],_=y?.semis?.[n];return e.jsx(Te,{match:f,placeholder:_},`s-${f?.id??n}`)})})]}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),C.final?e.jsx(Te,{match:C.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(Te,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:E,onChange:m=>A(m.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:h.map(m=>e.jsx("option",{value:m,children:m==="todos"?"Todos":`Grupo ${m}`},m))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:$,onChange:m=>k(m.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:j.map(m=>e.jsx("option",{value:m,children:m==="todos"?"Todas":ct(m)},m))})]}),b.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:b.map((m,n)=>e.jsx(vs,{match:m},m.id??`sched-${n}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),R.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:R.map((m,n)=>e.jsx(vs,{match:m},m.id??`fin-${n}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas em ",e.jsx("strong",{children:"1 rodada de 4 gols"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (8 grupos de 3 duplas) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo avança para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," saldo de gols."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," quatro quartas de final, duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Quartas de final:"})," Vencedor do grupo A × Vencedor do grupo B = Vencedor 1; Vencedor do grupo C × Vencedor do grupo D = Vencedor 2; Vencedor do grupo E × Vencedor do grupo F = Vencedor 3; Vencedor do grupo G × Vencedor do grupo H = Vencedor 4."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor 1 × Vencedor 2; Vencedor 3 × Vencedor 4."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Duplas:"})," não podem ser substituídas durante o torneio."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"WO:"})," em caso de não comparecimento de um ou mais integrantes, a dupla perde por WO. Atrasos de até 3 minutos são tolerados."]})]})})]})]})]})})}const Nr="team-logos";function ht(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function wr(s){return typeof s=="string"&&!ht(s)&&s.trim()!==""}function Ke(s){if(!s)return null;if(ht(s))return s;if(wr(s)){const{data:t}=g.storage.from(Nr).getPublicUrl(s);return t?.publicUrl||null}return null}const vr={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Sr={grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},$r="America/Sao_Paulo";function Cr(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:$r,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function Ar(s){return s?Sr[s]||s[0]?.toUpperCase()+s.slice(1):""}function kr(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const c=Math.floor(i/1e3),r=Math.floor(c/60),o=c%60;return`${r}:${o.toString().padStart(2,"0")}`}function Er({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",l=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${l} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Xe({match:s,currentTimestamp:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),l=Number(s?.meta?.home_sets??0),i=Number(s?.meta?.away_sets??0),c=l>0||i>0,r=a||c,o=s?.status&&s.status!=="scheduled",u=Number(s?.home_score??0),v=Number(s?.away_score??0),x=s?.status==="ongoing"||s?.status==="paused",E=x?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(K,{to:`/match/${s.id}`,className:`block bg-white border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden ${E}`,children:[e.jsx(Er,{status:s.status}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.sport?.name}),s.group_name?` • Grupo ${s.group_name}`:"",s.stage?` • ${Ar(s.stage)}`:"",s.round?` • J${s.round}`:"",x&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",kr(s,t)]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[11px] font-medium ${s.status==="ongoing"?"bg-green-100 text-green-700":s.status==="paused"?"bg-yellow-100 text-yellow-700":s.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:vr[s.status]||s.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(se,{team:s.home||{name:"A definir"},size:24}),e.jsx("span",{className:"font-medium truncate text-sm",children:s.home?.name||"A definir"})]}),e.jsxs("div",{className:"text-center px-3",children:[r&&e.jsx("div",{className:"text-xs font-semibold tabular-nums mb-1",children:e.jsxs("span",{className:`${o?"":"text-gray-400"}`,children:["Sets: ",l," x ",i]})}),o?e.jsxs("div",{className:"text-lg font-bold tabular-nums",children:[u," x ",v]}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx("span",{className:"font-medium truncate text-sm text-right",children:s.away?.name||"A definir"}),e.jsx(se,{team:s.away||{name:"A definir"},size:24})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center justify-between",children:[e.jsx("span",{children:s.starts_at?Cr(s.starts_at):"Data a definir"}),s.venue&&e.jsx("span",{children:s.venue})]})]})}function Cs(){const{id:s}=zs(),[t,a]=d.useState(null),[l,i]=d.useState([]),[c,r]=d.useState([]),[o,u]=d.useState(!0),[v,x]=d.useState(Date.now()),E=d.useRef(null),A=d.useRef(null),$=async()=>{u(!0);try{const{data:N,error:M}=await g.from("teams").select("id, name, logo_url, color").eq("id",s).maybeSingle();if(M){console.error("Erro ao carregar time:",M);return}if(N){const G={...N,logo_url:(()=>{const C=Ke(N.logo_url);return C?`${C}${C.includes("?")?"&":"?"}v=1`:null})()};a(G)}const{data:T,error:B}=await g.from("players").select("id, name, number").eq("team_id",s).order("number",{ascending:!0,nullsFirst:!0}).order("name");!B&&T&&i(T);const{data:I,error:L}=await g.from("matches").select(`
          id, stage, round, group_name, starts_at, venue, status, 
          home_score, away_score, meta, updated_at,
          sport:sport_id ( id, name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `).or(`home_team_id.eq.${s},away_team_id.eq.${s}`).order("starts_at",{ascending:!1});if(!L&&I){const G=I.map(C=>{const y=C.home&&typeof C.home=="object"?{...C.home,logo_url:(()=>{const j=Ke(C.home.logo_url);return j?`${j}${j.includes("?")?"&":"?"}v=1`:null})()}:C.home,h=C.away&&typeof C.away=="object"?{...C.away,logo_url:(()=>{const j=Ke(C.away.logo_url);return j?`${j}${j.includes("?")?"&":"?"}v=1`:null})()}:C.away;return{...C,home:y,away:h}});r(G)}}finally{u(!1)}};d.useEffect(()=>{$(),A.current=setInterval(()=>{x(Date.now())},1e3),E.current&&(g.removeChannel(E.current),E.current=null);const N=g.channel(`team-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>$()).on("postgres_changes",{event:"*",schema:"public",table:"teams",filter:`id=eq.${s}`},()=>$()).on("postgres_changes",{event:"*",schema:"public",table:"players",filter:`team_id=eq.${s}`},()=>$()).subscribe();return E.current=N,()=>{A.current&&clearInterval(A.current),E.current&&g.removeChannel(E.current),E.current=null}},[s]);const k=d.useMemo(()=>{const N={ongoing:[],paused:[],scheduled:[],finished:[]};return c.forEach(M=>{N[M.status]?N[M.status].push(M):N.finished.push(M)}),N},[c]);return o?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"})]})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(se,{team:t,size:64}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.name}),e.jsxs("p",{className:"text-gray-500",children:[c.length," partida",c.length!==1?"s":""," registrada",c.length!==1?"s":""]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Convocação"}),l.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"space-y-2",children:l.map(N=>e.jsxs("li",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"font-medium",children:N.name}),e.jsx("span",{className:"text-gray-500 text-sm tabular-nums",children:N.number?`#${N.number}`:"—"})]},N.id))})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Estatísticas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:k.ongoing.length+k.paused.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ao vivo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:k.scheduled.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Agendadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:k.finished.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Finalizadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:l.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Jogadores"})]})]})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Partidas"}),c.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma partida registrada."}):e.jsxs("div",{className:"space-y-4",children:[(k.ongoing.length>0||k.paused.length>0)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"🔴 Ao vivo"}),e.jsx("div",{className:"space-y-2",children:[...k.ongoing,...k.paused].map(N=>e.jsx(Xe,{match:N,currentTimestamp:v},N.id))})]}),k.scheduled.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"📅 Próximas partidas"}),e.jsx("div",{className:"space-y-2",children:k.scheduled.map(N=>e.jsx(Xe,{match:N,currentTimestamp:v},N.id))})]}),k.finished.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"✅ Finalizadas"}),e.jsx("div",{className:"space-y-2",children:k.finished.slice(0,5).map(N=>e.jsx(Xe,{match:N,currentTimestamp:v},N.id))}),k.finished.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["... e mais ",k.finished.length-5," partida",k.finished.length-5!==1?"s":""]})]})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-600",children:"Time não encontrado"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"O time solicitado não existe ou foi removido."})]})}const pt={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Tr={r32:"Pré-oitavas",grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Pr="team-logos";function xt(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Fr(s){return typeof s=="string"&&!xt(s)&&s.trim()!==""}function De(s){if(!s)return null;if(xt(s))return s;if(Fr(s)){const{data:t}=g.storage.from(Pr).getPublicUrl(s);return t?.publicUrl||null}return null}const Rr="America/Sao_Paulo";function Ae(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Rr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function ft(s){return s?Tr[s]||s[0]?.toUpperCase()+s.slice(1):""}function Mr({order_idx:s,stage:t,group_name:a}){const l=[];return s&&l.push(`Jogo ${s}`),a&&l.push(`Grupo ${a}`),l.join(" • ")}function yt(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=s.starts_at?new Date(s.starts_at):null,l=s.status==="paused"?new Date(s.updated_at||Date.now()):new Date(t||Date.now());if(!a)return"0:00";const i=l-a;if(i<0)return"0:00";const c=Math.floor(i/1e3),r=Math.floor(c/60),o=c%60;return`${r}:${o.toString().padStart(2,"0")}`}function qr({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",l=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${l} overflow-hidden rounded-t-2xl`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Ir({status:s,meta:t,starts_at:a,updated_at:l,currentTimestamp:i}){const c="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] font-semibold tracking-wide border",r=s==="ongoing"?"bg-green-50 text-green-700 border-green-200":s==="paused"?"bg-amber-50 text-amber-700 border-amber-200":s==="finished"?"bg-gray-100 text-gray-700 border-gray-200":"bg-blue-50 text-blue-700 border-blue-200",o=t?.clock||t?.time||t?.minute,u=s==="ongoing"||s==="paused",v=s==="scheduled"?a?` • ${Ae(a)}`:"":s==="finished"?l?` • ${Ae(l)}`:"":o?` • ${o}`:"";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`${c} ${r}`,children:[pt[s]||s,v?e.jsx("span",{children:v}):null]}),u&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",yt({status:s,starts_at:a,updated_at:l},i)]})]})}function Or({stage:s}){if(!s)return null;const t=ft(s);return e.jsx("span",{className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-semibold tracking-wide text-gray-700",children:t})}function As({team:s,align:t="left",badgeSize:a=48}){const l=!!s?.id,i=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:s||{name:"A definir"},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${l?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:s?.name||"A definir",children:s?.name||"A definir"}),t==="right"?e.jsx(se,{team:s||{name:"A definir"},size:a}):null]});return l?e.jsx(K,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-3 hover:underline ${t==="right"?"justify-end":""}`,onClick:c=>c.stopPropagation(),title:s?.name,children:i}):e.jsx("div",{className:`min-w-0 flex items-center gap-3 ${t==="right"?"justify-end":""}`,children:i})}function ks({title:s,players:t}){return e.jsxs("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:s}),t.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"text-sm divide-y",children:t.map(a=>e.jsxs("li",{className:"flex items-center justify-between py-1.5",children:[e.jsx("span",{className:"truncate",children:a.name}),e.jsx("span",{className:"inline-block w-8 text-right tabular-nums text-gray-500",children:a.number??""})]},a.id))})]})}function Es(){const{id:s}=zs(),[t,a]=d.useState(null),[l,i]=d.useState([]),[c,r]=d.useState([]),[o,u]=d.useState(!0),[v,x]=d.useState(null),[E,A]=d.useState(Date.now()),$=d.useRef(null),k=d.useRef(null),N=d.useRef(!1),M=d.useMemo(()=>(t?.sport?.name||"").toLowerCase().includes("volei"),[t?.sport?.name]),T=d.useCallback(async()=>{if(!(!s||N.current)){N.current=!0,u(!0),x(null);try{const{data:n,error:f}=await g.from("match_detail_view").select(`
          id, sport_id, sport_name, stage, round, group_name, starts_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score, order_idx, created_at, updated_at
        `).eq("id",s).maybeSingle();let _=null;if(!f&&n){_={id:n.id,sport:{id:n.sport_id,name:n.sport_name},stage:n.stage,round:n.round,group_name:n.group_name,starts_at:n.starts_at,updated_at:n.updated_at,venue:n.venue,status:n.status,order_idx:n.order_idx,meta:null,home_score:n.home_score,away_score:n.away_score,home:{id:n.home_team_id,name:n.home_team_name,color:n.home_team_color,logo_url:(()=>{const X=De(n.home_team_logo);return X?`${X}${X.includes("?")?"&":"?"}v=1`:null})()},away:{id:n.away_team_id,name:n.away_team_name,color:n.away_team_color,logo_url:(()=>{const X=De(n.away_team_logo);return X?`${X}${X.includes("?")?"&":"?"}v=1`:null})()}};const{data:q}=await g.from("matches").select("meta").eq("id",s).maybeSingle();q?.meta&&(_.meta=q.meta)}else{const{data:q,error:X}=await g.from("matches").select(`
            id,
            sport:sport_id ( id, name ),
            stage, round, group_name, starts_at, updated_at, venue, status, meta, order_idx,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("id",s).maybeSingle();if(X)throw X;q&&(_={...q,home:q.home&&typeof q.home=="object"?{...q.home,logo_url:(()=>{const S=De(q.home.logo_url);return S?`${S}${S.includes("?")?"&":"?"}v=1`:null})()}:q.home,away:q.away&&typeof q.away=="object"?{...q.away,logo_url:(()=>{const S=De(q.away.logo_url);return S?`${S}${S.includes("?")?"&":"?"}v=1`:null})()}:q.away})}if(!_)throw new Error("Partida não encontrada");a(_);const F=[];_?.home?.id?F.push(g.from("players").select("id, name, number").eq("team_id",_.home.id).order("number",{ascending:!0,nullsFirst:!0}).order("name")):F.push(Promise.resolve({data:[]})),_?.away?.id?F.push(g.from("players").select("id, name, number").eq("team_id",_.away.id).order("number",{ascending:!0,nullsFirst:!0}).order("name")):F.push(Promise.resolve({data:[]}));const[P,w]=await Promise.all(F);i(P.data||[]),r(w.data||[])}catch(n){console.error("Error loading match:",n),x(n.message||"Erro ao carregar partida")}finally{u(!1),N.current=!1}}},[s]);d.useEffect(()=>{if(!s)return;T(),k.current&&clearInterval(k.current),k.current=setInterval(()=>{A(Date.now())},1e3),$.current&&(g.removeChannel($.current),$.current=null);const n=g.channel(`match-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`id=eq.${s}`},()=>T()).on("postgres_changes",{event:"*",schema:"public",table:"match_events",filter:`match_id=eq.${s}`},()=>T()).subscribe();return $.current=n,()=>{k.current&&(clearInterval(k.current),k.current=null),$.current&&(g.removeChannel($.current),$.current=null)}},[s,T]);const B=d.useMemo(()=>t?Mr(t):"",[t]),I=t?.home,L=t?.away,G=Number(t?.meta?.home_sets??0),C=Number(t?.meta?.away_sets??0),y=G>0||C>0,h=M||y,j=t?.status&&t.status!=="scheduled",b=Number(t?.home_score??0),R=Number(t?.away_score??0),m=t?.status==="ongoing"||t?.status==="paused";return v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚠️"}),e.jsx("p",{className:"text-lg text-red-600 mb-2",children:"Erro ao carregar partida"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:v}),e.jsx("button",{onClick:()=>{x(null),T()},className:"bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700",children:"Tentar novamente"})]}):o||!t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-44 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-36 w-full bg-gray-100 rounded-2xl animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-56 bg-gray-100 rounded-2xl animate-pulse"}),e.jsx("div",{className:"h-56 bg-gray-100 rounded-2xl animate-pulse"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(Ir,{status:t.status,meta:t.meta,starts_at:t.starts_at,updated_at:t.updated_at,currentTimestamp:E}),t.stage?e.jsx(Or,{stage:t.stage}):null,B&&e.jsx("div",{className:"text-xs text-gray-600","aria-label":"Detalhes",children:B})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.starts_at?Ae(t.starts_at):null,t.venue?e.jsx("span",{className:"ml-2",children:t.venue}):null]})]}),e.jsxs("div",{className:`relative overflow-hidden rounded-2xl border p-4 sm:p-5 shadow-sm ${m?t.status==="ongoing"?"border-blue-200":"border-amber-200":"border-gray-200"}`,children:[e.jsx(qr,{status:t.status}),e.jsx("div",{className:"pointer-events-none absolute -top-24 -right-24 h-64 w-64 rounded-full bg-gradient-to-br from-blue-50 to-indigo-50 blur-3xl"}),e.jsx("div",{className:"pointer-events-none absolute -bottom-24 -left-24 h-64 w-64 rounded-full bg-gradient-to-tr from-pink-50 to-rose-50 blur-3xl"}),e.jsxs("div",{className:"relative grid grid-cols-1 items-center gap-4 sm:grid-cols-3",children:[e.jsx("div",{className:"min-w-0",children:e.jsx(As,{team:I,badgeSize:56})}),e.jsxs("div",{className:"text-center",children:[h?e.jsx("div",{className:"mb-1 flex items-center justify-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center rounded-full border border-gray-200 bg-white px-2 py-0.5 text-[11px] font-semibold text-gray-700",children:["Sets ",e.jsx("span",{className:"ml-1 tabular-nums",children:G}),e.jsx("span",{className:"mx-1 text-gray-400",children:"x"}),e.jsx("span",{className:"tabular-nums",children:C})]})}):null,j?e.jsxs("div",{className:"text-4xl font-extrabold tabular-nums leading-none sm:text-5xl",children:[b," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",R]}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"}),e.jsxs("div",{className:"mt-1 text-[11px] text-gray-500",children:[pt[t.status]||t.status,m?e.jsxs("span",{className:"ml-2",children:["🕐 ",yt(t,E)]}):null,t.meta?.clock?e.jsx("span",{className:"ml-2",children:t.meta.clock}):null]})]}),e.jsx("div",{className:"min-w-0 sm:text-right",children:e.jsx(As,{team:L,align:"right",badgeSize:56})})]}),M?e.jsxs("div",{className:"relative mt-3 text-[11px] text-gray-500",children:["Vôlei: partidas em ",e.jsx("strong",{children:"um set de 15 pontos"})," (2 pontos de vantagem para vencer)."]}):null]}),e.jsxs("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("div",{className:"text-[11px] font-semibold text-gray-500 mb-2",children:"Detalhes"}),e.jsxs("ul",{className:"text-sm grid sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Modalidade:"})," ",e.jsx("span",{className:"font-medium",children:t?.sport?.name||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Fase:"})," ",e.jsx("span",{className:"font-medium",children:ft(t.stage)||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Grupo:"})," ",e.jsx("span",{className:"font-medium",children:t.group_name||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Jogo nº:"})," ",e.jsx("span",{className:"font-medium",children:t.order_idx??"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Início:"})," ",e.jsx("span",{className:"font-medium",children:t.starts_at?Ae(t.starts_at):"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Local:"})," ",e.jsx("span",{className:"font-medium",children:t.venue||"—"})]}),t.updated_at&&e.jsxs("li",{className:"sm:col-span-2",children:[e.jsx("span",{className:"text-gray-500",children:"Última atualização:"})," ",e.jsx("span",{className:"font-medium",children:Ae(t.updated_at)})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(ks,{title:`Convocação — ${I?.name||"A definir"}`,players:l}),e.jsx(ks,{title:`Convocação — ${L?.name||"A definir"}`,players:c})]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.status==="finished"&&t.updated_at?`Encerrado em ${Ae(t.updated_at)}`:null}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function Ts(){const s=me(),{user:t,setNeedsPasswordSetup:a}=ds(),[l,i]=d.useState(""),[c,r]=d.useState(""),[o,u]=d.useState(!1),[v,x]=d.useState(null),[E,A]=d.useState(null);d.useEffect(()=>{console.log("SetPassword mounted, user:",t)},[t]);const $=async k=>{if(k.preventDefault(),console.log("🔥 FORM SUBMITTED - START"),!o){if(u(!0),A(null),x(null),!l||l.length<8){A("A senha deve ter pelo menos 8 caracteres."),u(!1);return}if(l!==c){A("As senhas não coincidem."),u(!1);return}try{console.log("🚀 Starting password update...");const{error:N}=await g.auth.updateUser({password:l,data:{password_set:!0}});if(N){console.error("Password update error:",N),A(`Erro ao atualizar senha: ${N.message}`),u(!1);return}console.log("✅ Password updated successfully"),console.log("🔍 Checking if admin profile exists...");let M=!1,T=0;const B=5;for(;!M&&T<B;){T++,console.log(`Attempt ${T}/${B} to check profile...`);const{data:G,error:C}=await g.from("profiles").select("role").eq("user_id",t.id).single();!C&&G?.role==="admin"?(M=!0,console.log("✅ Admin profile found!")):(console.log("⏳ Profile not found yet, waiting..."),await new Promise(y=>setTimeout(y,1e3)))}if(!M){console.log("🔧 Creating profile manually as fallback...");const{error:G}=await g.from("profiles").insert({user_id:t.id,name:t.email.split("@")[0],role:"admin"});if(G&&!G.message.includes("duplicate key")){console.error("Manual profile creation error:",G),A("Erro ao criar perfil de administrador."),u(!1);return}}const{data:I,error:L}=await g.rpc("is_admin");console.log("🔍 Final admin check:",I,L),x("Senha definida e perfil configurado com sucesso!"),a(!1),setTimeout(()=>{console.log("🎯 Navigating to admin"),u(!1),s("/admin",{replace:!0})},1500)}catch(N){console.error("Unexpected error:",N),A(`Erro inesperado: ${N.message}`),u(!1)}}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full mx-auto bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Bem-vindo!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Defina sua senha para continuar"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["User ID: ",t?.id?.slice(0,8),"... | Email: ",t?.email]})]}),v&&e.jsx("p",{className:"mb-3 text-green-700 text-center",children:v}),E&&e.jsx("p",{className:"mb-3 text-red-700 text-center",children:E}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nova senha"}),e.jsx("input",{type:"password",placeholder:"Mínimo 8 caracteres",className:"w-full p-3 border border-gray-300 rounded-md",value:l,onChange:k=>i(k.target.value),required:!0,disabled:o})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirme a senha"}),e.jsx("input",{type:"password",placeholder:"Digite a senha novamente",className:"w-full p-3 border border-gray-300 rounded-md",value:c,onChange:k=>r(k.target.value),required:!0,disabled:o})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full bg-blue-600 text-white py-3 rounded-md font-medium hover:bg-blue-700 disabled:opacity-50",children:o?"Configurando perfil...":"Definir senha"})]})]})})}function Gr(){const s=me(),t=a=>{s(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Painel do Administrador"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecione uma área para gerenciar."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("button",{onClick:()=>t("/admin/elencos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"👥"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Elencos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Criar time, editar elenco (jogadores) e logo."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]}),e.jsxs("button",{onClick:()=>t("/admin/campeonatos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"🏆"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Campeonatos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Configurar modalidades, grupos e fases."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]}),e.jsxs("button",{onClick:()=>t("/admin/partidas"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"⏱️"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Partidas"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Iniciar/encerrar jogos e atualizar placar em tempo real."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]})]})]})}function Lr(){const s=me(),[t]=St(),a=t.get("redirect")||"/",l=t.get("reason"),[i,c]=d.useState(""),[r,o]=d.useState(""),[u,v]=d.useState(!1),[x,E]=d.useState(null);d.useEffect(()=>{l==="forbidden"&&E("Faça login para acessar a página solicitada.")},[l]);async function A($){if($.preventDefault(),!u){v(!0),E(null);try{const{error:k}=await g.auth.signInWithPassword({email:i.trim(),password:r});if(k){E("Email ou senha incorretos."),v(!1);return}s(a,{replace:!0})}catch(k){console.error("Login error:",k),E("Erro inesperado durante o login."),v(!1)}}}return e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Login"}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Email"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full p-2 border rounded",value:i,onChange:$=>c($.target.value),autoComplete:"email",required:!0})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Senha"}),e.jsx("input",{type:"password",placeholder:"Senha",className:"w-full p-2 border rounded",value:r,onChange:$=>o($.target.value),autoComplete:"current-password",required:!0})]}),x&&e.jsx("p",{className:"text-red-600 text-sm",children:x}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-blue-600 text-white py-2 rounded disabled:opacity-50 hover:bg-blue-700 transition-colors",children:u?"Entrando...":"Entrar"})]})]})}const Pe="team-logos",Ps=5,Ze=["image/png","image/jpeg","image/webp"],Dr=["oitavas","quartas","semi","final","3lugar"];function Br(){const[s,t]=d.useState([]),[a,l]=d.useState({}),[i,c]=d.useState([]),[r,o]=d.useState(!1),[u,v]=d.useState({name:"",sport_id:""}),[x,E]=d.useState(null),[A,$]=d.useState([]),[k,N]=d.useState(0),[M,T]=d.useState([]),[B,I]=d.useState({}),[L,G]=d.useState({}),C=async()=>{const{data:S}=await g.from("sports").select("id,name").order("name");t(S||[]);const O={};(S||[]).forEach(V=>O[V.id]=V.name),l(O),!u.sport_id&&S?.length&&v(V=>({...V,sport_id:S[0].id}))},y=async()=>{let S=g.from("teams").select("id,name,group_name,sport_id,logo_url").order("name");M.length>0&&(S=S.in("sport_id",M));const{data:O}=await S;c(O||[]);const V=(O||[]).map(J=>J.id);V.length?await Promise.all([h(V),j(O)]):(I({}),G({}))},h=async S=>{if(!S?.length)return;const{data:O}=await g.from("players").select("id, team_id").in("team_id",S),V={};(O||[]).forEach(J=>{V[J.team_id]=(V[J.team_id]||0)+1}),S.forEach(J=>{J in V||(V[J]=0)}),I(V)},j=async S=>{const O=Array.from(new Set((S||[]).map(Z=>Z.sport_id)));if(O.length===0){G({});return}const{data:V}=await g.from("matches").select("sport_id, stage, home_team_id, away_team_id").in("sport_id",O).in("stage",Dr),J={};(V||[]).forEach(Z=>{Z.home_team_id&&Z.away_team_id&&(J[Z.sport_id]=!0)}),O.forEach(Z=>{Z in J||(J[Z]=!1)}),G(J)},b=async S=>{const{data:O}=await g.from("players").select("id,name,number").eq("team_id",S).order("name");$(O||[]),I(V=>({...V,[S]:(O||[]).length}))};d.useEffect(()=>{C()},[]),d.useEffect(()=>{y()},[M]);const R=S=>{const{data:O}=g.storage.from(Pe).getPublicUrl(S);return O?.publicUrl||""},m=S=>{if(!S)return null;const O=S.indexOf(`/storage/v1/object/public/${Pe}/`);return O===-1?null:S.substring(O+`/storage/v1/object/public/${Pe}/`.length)},n=async S=>{if(S.preventDefault(),!u.name||!u.sport_id)return;o(!0);const{error:O}=await g.from("teams").insert({name:u.name.trim(),sport_id:u.sport_id});o(!1),O?alert("Erro ao criar time: "+O.message):(v({name:"",sport_id:u.sport_id}),y())},f=async S=>{if(confirm(`⚠️ Atenção!

Se você remover o time "${S.name}", TODO o campeonato da modalidade será resetado e o histórico de jogos será apagado.

Deseja realmente continuar?`)){o(!0);try{const V=m(S.logo_url);V&&await g.storage.from(Pe).remove([V]).catch(()=>{});const{error:J}=await g.rpc("reset_sport",{p_sport_id:S.sport_id});if(J)throw J;const{error:Z}=await g.from("teams").delete().eq("id",S.id);if(Z)throw Z;x?.id===S.id&&(E(null),$([])),await y(),alert(`Time "${S.name}" removido.

O campeonato da modalidade foi resetado. Configure novamente os grupos e partidas antes de prosseguir.`)}catch(V){alert("Erro ao remover: "+V.message)}finally{o(!1)}}},_=async S=>{if(!x?.id||!S)return;o(!0);const{error:O}=await g.from("players").insert({team_id:x.id,name:S.trim()});o(!1),O?alert("Erro ao adicionar jogador: "+O.message):b(x.id)},F=async S=>{if(!x?.id)return;o(!0);const{error:O}=await g.from("players").delete().eq("id",S);o(!1),O?alert("Erro ao remover jogador: "+O.message):b(x.id)},P=async(S,O)=>{if(!(!S?.id||!O)){if(!Ze.includes(O.type)){alert("Formato inválido. Use PNG, JPG ou WEBP.");return}if(O.size>Ps*1024*1024){alert(`Arquivo grande demais. Máximo ${Ps} MB.`);return}o(!0);try{const V=O.type==="image/png"?"png":O.type==="image/webp"?"webp":"jpg",J=`teams/${S.id}.${V}`,{error:Z}=await g.storage.from(Pe).upload(J,O,{upsert:!0,cacheControl:"3600",contentType:O.type});if(Z)throw Z;const ne=R(J),{error:he}=await g.from("teams").update({logo_url:ne}).eq("id",S.id);if(he)throw he;if(await y(),x?.id===S.id){const ie=(await g.from("teams").select("id,name,logo_url").eq("id",S.id).maybeSingle()).data;ie&&E(Ue=>({...Ue,...ie}))}N(ie=>ie+1)}catch(V){alert("Erro ao enviar logo: "+V.message)}finally{o(!1)}}},w=M.length===0||M.length===s.length,q=()=>{T(S=>w?[]:s.map(O=>O.id))},X=e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{onClick:q,className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${w?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:"Todos"}),s.map(S=>{const O=M.length===0?!0:M.includes(S.id);return e.jsx("button",{onClick:()=>T(V=>V.length===0?[S.id]:V.includes(S.id)?V.filter(J=>J!==S.id):[...V,S.id]),className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${O?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:S.name},S.id)})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:"Elencos"}),X,x&&e.jsxs("section",{className:"rounded-lg border bg-white shadow-sm",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fs,{src:x.logo_url,alt:x.name,size:40,version:k}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:x.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a[x.sport_id]," • ",A.length," jogadores"]})]})]}),e.jsx("button",{onClick:()=>{E(null),$([])},className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",title:"Fechar",children:"✕"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 cursor-pointer text-sm font-medium transition-colors",children:["📷 Atualizar Logo",e.jsx("input",{type:"file",accept:Ze.join(","),className:"hidden",onChange:S=>{const O=S.target.files?.[0];O&&P(x,O),S.target.value=""},disabled:r})]})}),e.jsx(Vr,{disabled:r,onAdd:_}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Jogadores"}),A.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:"Nenhum jogador no elenco"}),e.jsx("p",{className:"text-xs mt-1",children:"Adicione jogadores usando o formulário acima"})]}):e.jsx("div",{className:"grid gap-2",children:A.map(S=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-gray-50",children:[e.jsx("span",{className:"font-medium",children:S.name}),e.jsx("button",{className:"px-3 py-1 text-sm rounded-lg border border-red-300 text-red-600 hover:bg-red-50 transition-colors",onClick:()=>F(S.id),disabled:r,children:"Remover"})]},S.id))})]})]})]}),e.jsxs("section",{className:"rounded-lg border bg-white shadow-sm",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsx("h3",{className:"font-semibold text-lg",children:"Novo Time"})}),e.jsxs("form",{onSubmit:n,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome do time"}),e.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:u.name,onChange:S=>v(O=>({...O,name:S.target.value})),placeholder:"Ex.: A1 — Águias",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Esporte"}),e.jsx("select",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:u.sport_id,onChange:S=>v(O=>({...O,sport_id:S.target.value})),children:s.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))})]})]}),e.jsx("button",{type:"submit",disabled:r,className:"w-full bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:r?"Salvando…":"Criar Time"})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Times Cadastrados (",i.length,")"]}),i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 border rounded-lg",children:[e.jsx("p",{className:"text-sm",children:"Nenhum time cadastrado"}),e.jsx("p",{className:"text-xs mt-1",children:"Crie seu primeiro time usando o formulário acima"})]}):e.jsx("div",{className:"grid gap-3",children:i.map(S=>{const O=a[S.sport_id]||"—",V=B[S.id]??0,J=V>0,Z=!!L[S.sport_id],ne=S.group_name?`Grupo ${S.group_name}`:Z?"Sem grupo (não aplicável)":"Sem grupo";return e.jsx("div",{className:"border rounded-lg bg-white shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(Fs,{src:S.logo_url,alt:S.name,size:48,version:k}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-lg truncate",children:S.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:O}),e.jsxs("span",{className:"text-sm text-gray-600",children:["• ",ne]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[Z&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-800 text-xs font-medium",children:"Chaveamento configurado"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Elenco: "," ",e.jsxs("span",{className:J?"text-gray-900 font-medium":"text-red-600 font-medium",children:[V," ",V===1?"jogador":"jogadores"]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("label",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 cursor-pointer text-sm font-medium transition-colors",children:["📷 Logo",e.jsx("input",{type:"file",accept:Ze.join(","),className:"hidden",onChange:he=>{const ie=he.target.files?.[0];ie&&P(S,ie),he.target.value=""},disabled:r})]}),e.jsx("button",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50 font-medium transition-colors text-sm",onClick:()=>{E(S),b(S.id),window.scrollTo({top:0,behavior:"smooth"})},children:"👥 Elenco"}),e.jsx("button",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-red-300 text-red-600 hover:bg-red-50 font-medium transition-colors text-sm",onClick:()=>f(S),disabled:r,children:"🗑️ Remover"})]})]})},S.id)})})]})]})}function Vr({disabled:s,onAdd:t}){const[a,l]=d.useState("");return e.jsxs("form",{onSubmit:i=>{i.preventDefault(),t(a),l("")},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adicionar Jogador"}),e.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nome do jogador",value:a,onChange:i=>l(i.target.value),required:!0})]}),e.jsx("button",{type:"submit",disabled:s,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?"Adicionando...":"Adicionar Jogador"})]})}function zr(s){if(!s)return"?";const t=s.trim().split(" ");return t.length===1?t[0][0]?.toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}function Ur(s){let t=0;for(let l=0;l<s.length;l++)t=s.charCodeAt(l)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function Fs({src:s,alt:t,size:a=32,version:l=0}){const[i,c]=d.useState(!1),r=d.useMemo(()=>{if(!s)return null;const o=s.includes("?")?"&":"?";return`${s}${o}v=${l}`},[s,l]);return e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 bg-white flex items-center justify-center flex-shrink-0",style:{width:a,height:a},children:[r?e.jsx("img",{src:r,alt:t||"logo",className:`w-full h-full object-cover ${i?"opacity-100":"opacity-0"} transition-opacity duration-200`,loading:"lazy",onLoad:()=>c(!0),onError:()=>c(!1)}):null,!r||!i?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white font-bold uppercase",style:{backgroundColor:Ur(t||"T"),fontSize:a*.35},children:zr(t)}):null]})}const Rs={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Ms={ongoing:1,paused:2,scheduled:3,finished:4},Jr="team-logos",jt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Hr=s=>typeof s=="string"&&!jt(s)&&s.trim()!=="",qs=s=>{if(!s)return null;if(jt(s))return s;if(Hr(s)){const{data:t}=g.storage.from(Jr).getPublicUrl(s);return t?.publicUrl||null}return null},Be=(s="")=>s.toString().trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase();function Kr(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=s.starts_at?new Date(s.starts_at):new Date,i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(!Number.isFinite(i)||i<0)return"0:00";const c=Math.floor(i/1e3),r=Math.floor(c/60),o=c%60;return`${r}:${o.toString().padStart(2,"0")}`}function Xr({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",l=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${l} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}const ve=s=>Number.isFinite(Number(s?.order_idx))?Number(s.order_idx):Number.isFinite(Number(s?.round))?Number(s.round):Number(s?.id??Number.MAX_SAFE_INTEGER),Zr=s=>s.status==="scheduled"&&!!(s.home?.id&&s.away?.id);function Qr(){const[s,t]=d.useState([]),[a,l]=d.useState([]),[i,c]=d.useState(null),[r,o]=d.useState(null),[u,v]=d.useState(!0),[x,E]=d.useState({}),[A,$]=d.useState(null),[k,N]=d.useState(null),[M,T]=d.useState(Date.now()),[B,I]=d.useState(typeof navigator<"u"?navigator.onLine:!0),[L,G]=d.useState(!1),[C,y]=d.useState(null),h=d.useRef(null),j=d.useRef(!0),b=d.useRef(null);d.useEffect(()=>{if(!k)return;const p=setTimeout(()=>N(null),8e3);return()=>clearTimeout(p)},[k]),d.useEffect(()=>{const p=()=>I(!0),z=()=>I(!1);return window.addEventListener("online",p),window.addEventListener("offline",z),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",z)}},[]);const R=(p,z)=>E(D=>({...D,[p]:z})),m=async()=>{const{data:p,error:z}=await g.auth.getSession();return z?(console.error("getSession error:",z),N(z.message||"Falha ao obter sessão de usuário."),null):p?.session||null},n=async()=>{try{await g.auth.getUser();const{data:p,error:z}=await g.rpc("is_admin");if(z)throw z;$(!!p)}catch(p){console.error("is_admin() error:",p),$(!1)}},f=async()=>{const{data:p,error:z}=await g.from("sports").select("name").order("name");if(z){console.error("loadSports error:",z);return}const D=Array.from(new Set((p||[]).map(U=>U.name).filter(Boolean)));l(D.map(U=>({key:Be(U),name:U})))},_=async({showSkeleton:p=!1}={})=>{if(j.current){p&&v(!0);try{let z=g.from("matches").select(`
          id, stage, round, group_name, order_idx, starts_at, venue, created_at, updated_at,
          status, home_score, away_score, meta,
          sport_id,
          home_team_id, away_team_id,
          sport:sport_id ( name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `);r&&(z=z.eq("status",r)),z=z.or(["group_name.not.is.null","stage.eq.r32","and(home_team_id.not.is.null,away_team_id.not.is.null)"].join(","));const{data:D,error:U}=await z;if(U)console.error("loadMatches error:",U),j.current&&N(U.message||"Falha ao carregar partidas.");else{let Q=(D||[]).map(H=>{const Y=H.home&&typeof H.home=="object"?{...H.home,logo_url:(()=>{const oe=qs(H.home.logo_url);return oe?`${oe}${oe.includes("?")?"&":"?"}v=1`:null})()}:H.home,le=H.away&&typeof H.away=="object"?{...H.away,logo_url:(()=>{const oe=qs(H.away.logo_url);return oe?`${oe}${oe.includes("?")?"&":"?"}v=1`:null})()}:H.away,pe=H?.sport?.name||"";return{...H,home:Y,away:le,_sportKey:Be(pe)}});i&&(Q=Q.filter(H=>H._sportKey===i));const W=Q.sort((H,Y)=>{const le=Ms[H.status]||999,pe=Ms[Y.status]||999;return le!==pe?le-pe:ve(H)-ve(Y)});j.current&&t(W)}}finally{j.current&&p&&v(!1)}}};d.useEffect(()=>{j.current=!0,(async()=>{await m(),await n(),await f(),await _({showSkeleton:!0})})(),b.current=setInterval(()=>{j.current&&T(Date.now())},1e3);const{data:z}=g.auth.onAuthStateChange(async(D,U)=>{j.current&&($(null),await n(),U?(await f(),await _({showSkeleton:!0})):t([]))});return()=>{j.current=!1,b.current&&clearInterval(b.current),z?.subscription?.unsubscribe?.(),h.current&&(g.removeChannel(h.current),h.current=null)}},[]),d.useEffect(()=>{if(!j.current)return;_({showSkeleton:!1}),h.current&&(g.removeChannel(h.current),h.current=null);const p=g.channel("admin-matches").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>{setTimeout(()=>{j.current&&_({showSkeleton:!1})},200)}).subscribe();return h.current=p,()=>{h.current&&(g.removeChannel(h.current),h.current=null)}},[i,r]);const F=d.useMemo(()=>{const p=new Map;for(const D of s){const U=D?.sport_id?String(D.sport_id):"unknown";p.has(U)||p.set(U,[]),p.get(U).push(D)}const z=new Set;for(const[D,U]of p.entries()){if(D==="unknown"||U.some(H=>H.status==="ongoing"||H.status==="paused"))continue;const W=U.filter(Zr);W.length&&(W.sort((H,Y)=>ve(H)-ve(Y)),z.add(W[0].id))}return z},[s]),P=async(p,z)=>{R(p,!0),N(null);const D=s;t(U=>U.map(Q=>Q.id===p?{...Q,...z}:Q));try{const{error:U}=await g.from("matches").update(z).eq("id",p);if(U)throw new Error(`Falha ao atualizar: ${U.message}`);return setTimeout(()=>{j.current&&_({showSkeleton:!1})},600),!0}catch(U){return t(D),N(U.message||"Erro ao atualizar partida."),!1}finally{R(p,!1)}},w=async(p,z,D)=>{if(p.status==="scheduled")return;const Q=Be(p?.sport?.name||"").includes("volei"),W=p.meta||{},H=Q?`${z}_points_set`:`${z}_score`;let Y=Math.max(0,Number((Q?W[H]:p[H])||0));D==="inc"&&(Y+=1),D==="dec"&&(Y=Math.max(0,Y-1)),D==="reset"&&(Y=0),Q?await P(p.id,{meta:{...W,[H]:Y}}):await P(p.id,{[H]:Y})},q=(p,z)=>Math.max(0,Number(p?.meta?.[`${z}_points_set`]||0)),X=(p,z)=>{const D=p.meta||{};return Math.max(0,Number(D[z==="home"?"home_sets":"away_sets"]||0))},S=p=>{const z=Number(p?.meta?.rules?.points_to_win_set??15),D=Number(p?.meta?.rules?.win_by??2),U=q(p,"home"),Q=q(p,"away"),W=Math.max(U,Q),H=Math.abs(U-Q);return W>=z&&H>=D},O=async(p,{force:z=!1}={})=>{if(p.status==="scheduled")return;const D=p.meta||{},U=q(p,"home"),Q=q(p,"away"),W=Array.isArray(D.sets)?D.sets:[];if(!z&&!S(p)){N("Para finalizar o set: mínimo 15 pontos e 2 de vantagem (ajustável em meta.rules). Clique novamente para forçar.");return}const H=U>Q?!0:Q>U?!1:null,Y={...D,sets:[...W,{h:U,a:Q,at:new Date().toISOString()}],home_sets:X(p,"home")+(H===!0?1:0),away_sets:X(p,"away")+(H===!1?1:0),home_points_set:0,away_points_set:0};await P(p.id,{meta:Y,home_score:Math.max(0,Number(p.home_score||0))+U,away_score:Math.max(0,Number(p.away_score||0))+Q,updated_at:new Date().toISOString()})},V=async(p,z,D)=>{if(p.status==="scheduled")return;const U=p.meta||{},Q=z==="home"?"home_sets":"away_sets";let W=Math.max(0,Number(U[Q]||0));D==="inc"&&(W+=1),D==="dec"&&(W=Math.max(0,W-1)),D==="reset"&&(W=0),await P(p.id,{meta:{...U,[Q]:W}})},J=async(p,z)=>{const D=new Date().toISOString(),U={status:z,updated_at:D};return z==="ongoing"&&p.status==="scheduled"&&!p.starts_at&&(U.starts_at=D),await P(p.id,U)},Z=async p=>{const z=q(p,"home"),D=q(p,"away");if(z>0||D>0){const U=p.meta||{};await P(p.id,{meta:{...U,home_points_set:0,away_points_set:0},home_score:Math.max(0,Number(p.home_score||0))+z,away_score:Math.max(0,Number(p.away_score||0))+D})}return await J(p,"finished")},ne=async p=>{N(null);const z=p?.sport_id?String(p.sport_id):null;if(!z){N("Partida sem modalidade válida (sport_id ausente).");return}try{const{data:D,error:U}=await g.from("matches").select("id,status,group_name,order_idx,round,home_team_id,away_team_id,sport_id").eq("sport_id",z);if(U)throw U;if(!D)throw new Error("Falha ao validar ordem.");if(D.some(Y=>Y.status==="ongoing"||Y.status==="paused"))throw new Error("Já existe uma partida em andamento/pausada nesta modalidade. Encerre-a antes de iniciar outra.");const W=D.filter(Y=>Y.status==="scheduled"&&!!(Y.home_team_id&&Y.away_team_id));if(!W.length)throw new Error("Não há partidas elegíveis para iniciar.");if(W.sort((Y,le)=>ve(Y)-ve(le)),W[0].id!==p.id)throw new Error("Você só pode iniciar o próximo jogo da fila.");await J(p,"ongoing")}catch(D){console.error("tryStartMatch error:",D),N(D.message||"Não foi possível iniciar a partida (ordem restrita).")}},he=async p=>await ne(p),ie=async p=>await J(p,"paused"),Ue=async p=>await J(p,"ongoing");return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Gerenciar Partidas"}),!B&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded mb-4",children:"⚠️ Você está offline. As alterações serão sincronizadas quando a conexão for restaurada."}),A===!1&&e.jsxs("div",{className:"text-sm p-3 rounded bg-red-50 border border-red-200 text-red-700",children:["Você não está autenticado como ",e.jsx("strong",{children:"admin"}),". As ações podem ser bloqueadas."]}),k&&e.jsxs("div",{className:"text-sm p-3 rounded bg-yellow-50 border border-yellow-200 text-yellow-800 flex items-start gap-3",children:[e.jsx("div",{className:"flex-1 whitespace-pre-wrap",children:String(k)}),e.jsx("button",{onClick:()=>N(null),className:"text-xs px-2 py-1 rounded border border-yellow-300 hover:bg-yellow-100",children:"Fechar"})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Modalidade:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>c(null),className:`px-2 py-1 rounded text-xs ${i?"bg-gray-100 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:"Todas"}),a.map(p=>e.jsx("button",{onClick:()=>c(p.key),className:`px-2 py-1 rounded text-xs ${i===p.key?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:p.name},p.key))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>o(null),className:`px-2 py-1 rounded text-xs ${r?"bg-gray-100 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:"Todos"}),Object.entries(Rs).map(([p,z])=>e.jsx("button",{onClick:()=>o(p),className:`px-2 py-1 rounded text-xs ${r===p?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:z},p))]})]})]}),u?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((p,z)=>e.jsx("div",{className:"h-32 bg-gray-100 rounded animate-pulse"},z))}):s.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma partida encontrada."}):e.jsx("ul",{className:"space-y-4",children:s.map(p=>{const D=Be(p?.sport?.name||"").includes("volei"),U=D?X(p,"home"):0,Q=D?X(p,"away"):0,W=D?q(p,"home"):null,H=D?q(p,"away"):null,Y=!p.group_name,le=!!(p.home?.id&&p.away?.id),pe=le,oe=p.status==="ongoing"||p.status==="paused",bt=oe?p.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200",Je=F.has(p.id);return e.jsxs("li",{className:`border rounded-lg p-3 sm:p-4 flex flex-col gap-3 bg-white shadow-sm relative overflow-hidden ${bt}`,children:[e.jsx(Xr,{status:p.status}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-500 flex flex-wrap items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-medium",children:p.sport?.name}),p.group_name&&e.jsxs("span",{children:["· Grupo ",p.group_name]}),p.stage&&e.jsxs("span",{children:["· ",p.stage==="semi"?"Semifinal":p.stage==="3lugar"?"3º lugar":p.stage==="r32"?"Pré-oitavas":p.stage]}),p.round&&e.jsxs("span",{children:["· J",p.round]}),oe&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",Kr(p,M)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p.status==="scheduled"&&Je&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-indigo-100 text-indigo-700 uppercase tracking-wide",children:"Próximo na ordem"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded self-start sm:self-auto ${p.status==="ongoing"?"bg-green-100 text-green-700":p.status==="paused"?"bg-yellow-100 text-yellow-700":p.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:Rs[p.status]||p.status})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4",children:[e.jsx(Is,{align:"left",team:p.home,score:p.home_score,onInc:()=>w(p,"home","inc"),onDec:()=>w(p,"home","dec"),onReset:()=>w(p,"home","reset"),sets:D?U:null,setPoints:D?W:null,onSetInc:D&&L?()=>V(p,"home","inc"):void 0,onSetDec:D&&L?()=>V(p,"home","dec"):void 0,onSetReset:D&&L?()=>V(p,"home","reset"):void 0,disabled:x[p.id]||p.status==="scheduled"}),e.jsx(Is,{align:"right",team:p.away,score:p.away_score,onInc:()=>w(p,"away","inc"),onDec:()=>w(p,"away","dec"),onReset:()=>w(p,"away","reset"),sets:D?Q:null,setPoints:D?H:null,onSetInc:D&&L?()=>V(p,"away","inc"):void 0,onSetDec:D&&L?()=>V(p,"away","dec"):void 0,onSetReset:D&&L?()=>V(p,"away","reset"):void 0,disabled:x[p.id]||p.status==="scheduled"})]}),D&&e.jsx("button",{onClick:()=>G(fe=>!fe),className:"text-[10px] px-2 py-0.5 rounded border border-gray-300 hover:bg-gray-50 self-start",children:L?"Fechar edição de sets":"Editar sets manualmente"}),D&&(W>0||H>0)&&e.jsx("button",{onClick:async()=>{if(C===p.id){const fe=S(p);y(null),await O(p,{force:!fe})}else y(p.id),setTimeout(()=>y(fe=>fe===p.id?null:fe),3e3)},disabled:x[p.id]||p.status==="scheduled",className:`px-3 py-1 text-xs rounded ${C===p.id?"bg-red-600":"bg-purple-600"} text-white hover:opacity-90 disabled:opacity-50`,title:"Soma os pontos do set aos totais (PF/PA) e incrementa o set do vencedor.",children:C===p.id?"Confirmar finalizar set":"Finalizar set"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[p.status==="scheduled"&&e.jsx("button",{onClick:()=>he(p),disabled:x[p.id]||!pe||!Je,className:"px-3 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",title:pe?Je?"Iniciar próximo jogo da ordem.":"Aguarde: apenas o próximo jogo da ordem pode iniciar.":"Defina as duas equipes antes de iniciar.",children:"Iniciar"}),p.status==="ongoing"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ie(p),disabled:x[p.id],className:"px-3 py-1 text-xs rounded bg-yellow-500 text-white hover:bg-yellow-600 disabled:opacity-50",children:"Pausar"}),e.jsx("button",{onClick:()=>Z(p),disabled:x[p.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),p.status==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Ue(p),disabled:x[p.id],className:"px-3 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:"Retomar"}),e.jsx("button",{onClick:()=>Z(p),disabled:x[p.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),p.status==="finished"&&e.jsx("span",{className:"text-xs text-gray-500 self-center",children:"Partida encerrada (resultado editável)."})]})]},p.id)})}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% {
            transform: translateX(-100%);
          }
          50% {
            transform: translateX(200%);
          }
          100% {
            transform: translateX(-100%);
          }
        }
      `})]})}function Is({team:s,score:t,onInc:a,onDec:l,onReset:i,sets:c,setPoints:r,onSetInc:o,onSetDec:u,onSetReset:v,disabled:x,align:E="left"}){const A=E==="right",$=typeof r=="number"?"Pontos do set":"Pontos",k=Number(typeof r=="number"?r||0:t||0),N=!!(o||u||v),M=({label:I,value:L})=>{const G=Number.isFinite(L)?L:"-";return e.jsxs("div",{className:"flex min-w-[70px] flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-2.5 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:I}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:G})]})},T=A?"justify-end":"justify-start",B=A?"text-right":"text-left";return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-gray-50/80 p-3 shadow-sm space-y-4",children:[e.jsxs("div",{className:`flex flex-wrap items-center justify-between gap-3 ${A?"flex-row-reverse":""}`,children:[e.jsxs("div",{className:`flex min-w-0 items-center gap-2 ${A?"flex-row-reverse text-right":""}`,children:[e.jsx(se,{team:s||{name:"A definir"},size:28}),e.jsx("span",{className:"text-sm font-medium truncate",children:s?.name||"A definir"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${A?"flex-row-reverse":""}`,children:[typeof c=="number"?e.jsx(M,{label:"Sets",value:Number(c||0)}):null,e.jsx(M,{label:$,value:k})]})]}),typeof c=="number"?e.jsxs("div",{className:`space-y-2 ${B}`,children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:"Controle de sets"}),e.jsxs("div",{className:`flex flex-wrap gap-2 ${T}`,children:[e.jsx("button",{type:"button",onClick:u,disabled:x||!N,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"-"}),e.jsx("button",{type:"button",onClick:o,disabled:x||!N,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"+"}),e.jsx("button",{type:"button",onClick:v,disabled:x||!N,className:"flex items-center justify-center rounded-lg bg-red-500 px-3 py-1 text-xs font-semibold text-white transition hover:bg-red-600 disabled:opacity-40",title:"Zerar sets",children:"Zerar"})]})]}):null,e.jsxs("div",{className:`space-y-2 ${B}`,children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:$}),e.jsxs("div",{className:`flex flex-wrap gap-2 ${T}`,children:[e.jsx("button",{type:"button",onClick:l,disabled:x,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"-"}),e.jsx("button",{type:"button",onClick:a,disabled:x,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"+"}),e.jsx("button",{type:"button",onClick:i,disabled:x,className:"flex items-center justify-center rounded-lg bg-red-500 px-3 py-1 text-xs font-semibold text-white transition hover:bg-red-600 disabled:opacity-40",title:typeof r=="number"?"Zerar pontos do set":"Zerar pontos",children:"Zerar"})]})]})]})}const xe={pebolim:{name:"Pebolim",required:24,path:"/admin/campeonatos/pebolim",variant:"1v3_1v2_3v2"},fifa:{name:"FIFA",required:32,path:"/admin/campeonatos/fifa"},futsal:{name:"Futsal",required:9,path:"/admin/campeonatos/futsal",variant:"1v3_1v2_3v2"},volei:{name:"Vôlei",required:9,path:"/admin/campeonatos/volei",variant:"1v2_1v3_2v3"}},Yr={Pebolim:"pebolim",FIFA:"fifa",Futsal:"futsal",Volei:"volei",Vôlei:"volei"},Wr=(s="")=>s.trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),Os=({children:s,tone:t="gray"})=>e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium border ${t==="green"?"bg-green-50 text-green-700 border-green-200":t==="amber"?"bg-amber-50 text-amber-700 border-amber-200":t==="red"?"bg-red-50 text-red-700 border-red-200":t==="blue"?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:s}),Gs=({children:s,className:t=""})=>e.jsx("div",{className:`rounded-2xl border border-gray-200 bg-white shadow-sm ${t}`,children:s}),en=({title:s,subtitle:t,right:a})=>e.jsxs("div",{className:"flex items-start justify-between gap-3 p-4 sm:p-5",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:s}),t&&e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t})]}),a]}),Qe=({children:s,className:t="",...a})=>e.jsx("button",{className:`inline-flex w-full items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-gray-200 disabled:text-gray-500 ${t}`,...a,children:s}),Se=({children:s,className:t="",...a})=>e.jsx("button",{className:`inline-flex w-full items-center justify-center gap-2 rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60 ${t}`,...a,children:s});function sn(){const s=me(),[t,a]=d.useState(!0),[l,i]=d.useState(null),[c,r]=d.useState([]),[o,u]=d.useState({}),[v,x]=d.useState({}),[E,A]=d.useState(null),[$,k]=d.useState(null),N=async()=>{a(!0),i(null);try{const{data:h,error:j}=await g.from("sports").select("id,name").order("name",{ascending:!0});if(j)throw j;const b=h.map(m=>({id:m.id,name:m.name,key:Yr[m.name?.trim()]||Wr(m.name)}));r(b);const R=await Promise.all(b.map(async m=>{const[n,f,_,F]=await Promise.all([g.from("teams").select("id",{count:"exact",head:!0}).eq("sport_id",m.id),g.from("teams").select("id, name, group_name, seed_in_group").eq("sport_id",m.id).not("group_name","is",null),g.from("matches").select("id",{count:"exact",head:!0}).eq("sport_id",m.id),g.from("standings").select("id",{count:"exact",head:!0}).eq("sport_id",m.id)]),P=n?.count??0,w=_?.count??0,q=F?.count??0,X=tn(f?.data||[]),{data:S}=await g.from("v_queue_slots").select("slot, order_idx, match_id, stage, group_name").eq("sport_id",m.id);let O={};const V=(S||[]).map(J=>J.match_id).filter(Boolean);if(V.length){const{data:J}=await g.from("match_detail_view").select("id, home_team_name, away_team_name").in("id",V);O=Object.fromEntries((J||[]).map(Z=>[Z.id,Z]))}return[m.key,{sportId:m.id,sportName:m.name,teamCount:P,groupsMeta:X,matchesCount:w,standingsCount:q,hasAny:(w||q||X.total||0)>0,queueSlots:S||[],queueDetails:O}]}));u(Object.fromEntries(R))}catch(h){i(`Falha ao carregar: ${h.message||h}`)}finally{a(!1)}};d.useEffect(()=>{N();const h=g.channel("tournaments-queue").on("postgres_changes",{event:"*",schema:"public",table:"matches"},N).subscribe();return()=>g.removeChannel(h)},[]);const M=h=>{const j=o[h];if(!j)return!1;if(h==="fifa")return j.teamCount===xe.fifa.required;const b=h==="pebolim"?8:3,R=Object.values(j.groupsMeta.byGroup||{}),m=R.length===b&&R.every(f=>f.members.length===3),n=R.every(f=>rn(f.members.map(_=>_.seed_in_group),[1,2,3]));return m&&n},T=(h,j)=>x(b=>({...b,[h]:j})),B=h=>k({key:h,name:xe[h].name}),I=async h=>{const j=o[h];if(!j)return;const b=j.sportId;T(h,!0),i(null),k(null);try{const{data:R}=await g.from("matches").select("id").eq("sport_id",b),m=(R||[]).map(n=>n.id);if(m.length&&await g.from("match_events").delete().in("match_id",m),await g.from("matches").delete().eq("sport_id",b),await g.from("standings").delete().eq("sport_id",b),h==="fifa"){const{error:n}=await g.rpc("admin_generate_fifa_oitavas32",{p_sport_id:b});if(n)throw n}else{const n=xe[h]?.variant||"1v3_1v2_3v2",{error:f}=await g.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:b,p_variant:n});if(f)throw f}i(`Campeonato de ${xe[h].name} gerado com sucesso (ordem fixa).`),await N()}catch(R){i(`Falha ao gerar partidas: ${R.message||R}`)}finally{T(h,!1)}},L=h=>A({key:h,name:xe[h].name}),G=async h=>{const j=o[h];if(j){T(h,!0);try{const{data:b}=await g.from("matches").select("id").eq("sport_id",j.sportId),R=(b||[]).map(m=>m.id);R.length&&await g.from("match_events").delete().in("match_id",R),await g.from("matches").delete().eq("sport_id",j.sportId),await g.from("standings").delete().eq("sport_id",j.sportId),await g.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",j.sportId),i(`Campeonato de ${xe[h].name} foi reiniciado.`),A(null),await N()}catch(b){i(`Falha ao reiniciar: ${b.message||b}`)}finally{T(h,!1)}}},C=async h=>{await g.rpc("admin_start_first_if_idle",{p_sport_id:h})},y=async h=>{await g.rpc("admin_finish_live_and_start_next",{p_sport_id:h})};return e.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Gerenciar Campeonatos"})]}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Configure grupos, gere as partidas na ordem definida e opere os cartões: ",e.jsx("strong",{children:"Ao vivo"}),", ",e.jsx("strong",{children:"⚠️ Compareçam"})," e ",e.jsx("strong",{children:"Próximo jogo"}),"."]})]}),l&&e.jsx("div",{className:"mb-4 rounded-xl border border-blue-200 bg-blue-50 px-3 py-2 text-sm text-blue-800",children:l}),t?e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Array.from({length:4}).map((h,j)=>e.jsxs(Gs,{className:"p-4",children:[e.jsx("div",{className:"h-6 w-32 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"mt-3 h-4 w-56 animate-pulse rounded bg-gray-100"}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-9 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"h-9 animate-pulse rounded bg-gray-100"})]})]},j))}):e.jsx("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:c.map(h=>{const j=h.key,b=xe[j];if(!b)return null;const R=o[j]||{},m=R.teamCount===b.required,n=!!R.hasAny,f=M(j);return e.jsxs(Gs,{children:[e.jsx(en,{title:b.name,subtitle:`Times: ${R.teamCount??0} / ${b.required}`,right:n?e.jsx(Os,{tone:"amber",children:"Existe"}):e.jsx(Os,{tone:m?"green":"gray",children:m?"Pronto":"Aguardando times"})}),e.jsx("div",{className:"px-4 sm:px-5",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Zt,{className:"h-4 w-4"})," Partidas: ",e.jsx("strong",{className:"ml-1",children:R.matchesCount??0})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ps,{className:"h-4 w-4"})," Grupos definidos: ",e.jsx("strong",{className:"ml-1",children:R.groupsMeta.countGroups||0})]}),j!=="fifa"&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ia,{className:"h-4 w-4"})," Seeds válidos: ",e.jsx("strong",{className:"ml-1",children:R.groupsMeta.seedsOk?"Sim":"Não"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-4 sm:grid-cols-2 sm:p-5",children:[e.jsxs(Qe,{disabled:!m||n,onClick:()=>s(b.path),children:[e.jsx(ps,{className:"h-4 w-4"})," Configurar & Agrupar"]}),e.jsxs(Se,{className:"text-red-600 border-red-600 hover:bg-red-50",disabled:v[j]||j!=="fifa"&&!f,onClick:()=>B(j),children:[v[j]?e.jsx(Yt,{className:"h-4 w-4 animate-spin"}):e.jsx(ra,{className:"h-4 w-4"}),"Gerar Partidas (ordem fixa)"]}),n&&e.jsxs(Se,{onClick:()=>C(R.sportId),children:[e.jsx(Ks,{className:"h-4 w-4"})," Iniciar primeiro (se parado)"]}),n&&e.jsxs(Se,{onClick:()=>y(R.sportId),children:[e.jsx(Kt,{className:"h-4 w-4"})," Finalizar ao vivo e iniciar próximo"]}),e.jsxs(Se,{className:"sm:col-span-2",onClick:()=>L(j),disabled:!n,children:[e.jsx(ca,{className:"h-4 w-4"})," Apagar & Reiniciar"]})]}),e.jsx("div",{className:"px-4 pb-4 sm:px-5 sm:pb-5",children:e.jsx("div",{className:"rounded-xl border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 divide-y sm:grid-cols-3 sm:divide-x sm:divide-y-0",children:[Ye(R,"live"),Ye(R,"call"),Ye(R,"next")]})})})]},j)})}),E&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>A(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Reiniciar ",E.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Isso apagará ",e.jsx("strong",{children:"todas"})," as partidas, eventos e a classificação, e limpará os grupos."]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-2",children:[e.jsx(Se,{onClick:()=>A(null),children:"Cancelar"}),e.jsx(Qe,{onClick:()=>G(E.key),children:"Confirmar"})]})]})]}),$&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>k(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Gerar Partidas para ",$.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Isso apagará ",e.jsx("strong",{children:"todas"})," as partidas, eventos e a classificação, e limpará os grupos antes de gerar novas partidas."]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-2",children:[e.jsx(Se,{onClick:()=>k(null),children:"Cancelar"}),e.jsx(Qe,{onClick:()=>I($.key),children:"Confirmar"})]})]})]})]})}function tn(s){const t={};for(const c of s)t[c.group_name]||(t[c.group_name]={members:[]}),t[c.group_name].members.push({id:c.id,name:c.name,seed_in_group:c.seed_in_group});const a=Object.keys(t).sort(an),l=a.length;let i=!0;for(const c of a){const r=new Set(t[c].members.map(u=>u.seed_in_group));r.has(1)&&r.has(2)&&r.has(3)&&r.size===3||(i=!1)}return{byGroup:t,groups:a,countGroups:l,total:s.length,seedsOk:i}}function an(s,t){const a=s&&s[s.length-1]||"z",l=t&&t[t.length-1]||"z";return a<l?-1:a>l?1:0}function rn(s=[],t=[]){const a=new Set(s),l=new Set(t);if(a.size!==l.size)return!1;for(const i of a)if(!l.has(i))return!1;return!0}function Ye(s,t){const a=t==="live"?"Ao vivo":t==="call"?"⚠️ Compareçam":"Próximo jogo",l=t==="live"?"bg-red-50 border-red-200":t==="call"?"bg-amber-50 border-amber-200":"bg-emerald-50 border-emerald-200",i=(s.queueSlots||[]).find(r=>r.slot===t),c=i?.match_id?s.queueDetails?.[i.match_id]:null;return e.jsx("div",{className:"p-3 sm:p-4",children:e.jsxs("div",{className:`rounded-xl border p-3 sm:p-4 ${l}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:a}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Hs,{className:"h-3.5 w-3.5"}),"#",i?.order_idx??"–"]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[c?e.jsxs("div",{className:"font-medium text-gray-900",children:[c.home_team_name," ",e.jsx("span",{className:"text-gray-500",children:"x"})," ",c.away_team_name]}):e.jsx("div",{className:"text-gray-500",children:"Aguardando…"}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[i?.stage?e.jsx("span",{className:"mr-2",children:i.stage}):null,i?.group_name?e.jsxs("span",{children:["Grupo ",i.group_name]}):null]})]})]})})}const ce=["A","B","C"],$e=3;function nn(){const[s,t]=d.useState([]),[a,l]=d.useState({A:[],B:[],C:[]}),[i,c]=d.useState(new Set),[r,o]=d.useState(!0),[u,v]=d.useState(!1),[x,E]=d.useState(null),A=d.useRef(!1),$=d.useRef(!0),k=me(),N=d.useMemo(()=>{const h=new Map;return s.forEach(j=>h.set(j.id,j)),h},[s]),M=async()=>{if(!A.current){A.current=!0,o(!0);try{const{data:h,error:j}=await g.from("sports").select("id").eq("name","Futsal").maybeSingle();if(j||!h?.id){alert("Erro ao buscar a modalidade Futsal.");return}E(h.id);const{data:b,error:R}=await g.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",h.id).order("name");if(R){alert("Erro ao carregar times de Futsal.");return}t(b||[]);const m={A:[],B:[],C:[]},n=(b||[]).reduce((f,_)=>(ce.includes(_.group_name)&&(f[_.group_name]=f[_.group_name]||[]).push(_),f),{});ce.forEach(f=>{const _=(n[f]||[]).sort((F,P)=>{const w=F.seed_in_group??999,q=P.seed_in_group??999;return w!==q?w-q:F.name.localeCompare(P.name)});m[f]=_.map(F=>F.id)}),l(m)}finally{o(!1),A.current=!1}}};d.useEffect(()=>{$.current=!0,M();const h=g.channel("futsal-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{$.current&&!A.current&&M()}).subscribe();return()=>{$.current=!1,g.removeChannel(h)}},[]);const T=d.useMemo(()=>new Set(ce.flatMap(h=>a[h])),[a]),B=d.useMemo(()=>s.filter(h=>!T.has(h.id)),[s,T]),I=h=>{c(j=>{const b=new Set(j);return b.has(h)?b.delete(h):b.add(h),b})},L=h=>{const j=Array.from(i);if(!j.length){alert("Selecione ao menos 1 time.");return}if(a[h].length+j.length>$e){alert(`O grupo ${h} não pode ter mais de ${$e} times.`),c(new Set);return}l(b=>{const R={...b};for(const m of j){for(const n of ce)R[n]=R[n].filter(f=>f!==m);R[h]=[...R[h],m]}return R}),c(new Set)},G=h=>{l(j=>{const b={...j};for(const R of ce)b[R]=b[R].filter(m=>m!==h);return b})},C=ce.every(h=>a[h].length===$e),y=async()=>{if(!C){alert("Complete todos os grupos antes de confirmar!");return}if(!x){alert("Modalidade Futsal não encontrada.");return}try{v(!0),await g.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",x);for(const j of ce){const b=a[j];if(b.length){await g.from("teams").update({group_name:j}).in("id",b);for(let R=0;R<b.length;R++)await g.from("teams").update({seed_in_group:R+1}).eq("id",b[R])}}await g.rpc("seed_initial_standings",{p_sport_name:"Futsal",p_reset:!0}),await g.rpc("rebuild_standings",{p_sport_name:"Futsal"});const{error:h}=await g.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:x,p_variant:"1v3_1v2_3v2"});if(h){alert("Erro ao gerar jogos de grupos: "+h.message);return}await g.rpc("maybe_create_knockout",{p_sport_name:"Futsal"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>k("/admin/campeonatos"),1200)}catch(h){alert("Erro ao salvar: "+(h?.message||String(h)))}finally{v(!1)}};return r?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Futsal"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. Ao confirmar, os grupos são salvos com"," ",e.jsx("strong",{children:"seed_in_group = 1,2,3"}),", e os jogos são gerados via RPC na"," ",e.jsx("strong",{children:"ordem exata"})," (fila global por ",e.jsx("code",{children:"order_idx"}),"). Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:M,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),B.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:B.map(h=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${i.has(h.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>I(h.id),title:h.name,children:[e.jsx(Ls,{team:h}),e.jsx("span",{className:"truncate",children:h.name})]},h.id))})]}),ce.map(h=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",h]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[h].length===$e?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[h].length,"/",$e]})]}),e.jsx("button",{onClick:()=>L(h),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[h].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[h].map((j,b)=>{const R=N.get(j);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>G(j),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:b+1}),e.jsx(Ls,{team:R}),e.jsx("span",{className:"truncate",title:R?.name,children:R?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},j)})})})]},h))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:ce.map(h=>`${h}(${a[h].length}/${$e})`).join(", ")}),e.jsx("button",{onClick:y,disabled:!C||u,className:`px-6 py-2 rounded font-semibold transition ${C&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Ls({team:s}){const t=on(s?.name),a=s?.color||ln(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function on(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function ln(s){let t=0;for(let l=0;l<s.length;l++)t=s.charCodeAt(l)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const ae=["A","B","C"],ge=3;function cn(){const[s,t]=d.useState([]),[a,l]=d.useState({A:[],B:[],C:[]}),[i,c]=d.useState(new Set),[r,o]=d.useState(!0),[u,v]=d.useState(!1),[x,E]=d.useState(null),A=d.useRef(!1),$=d.useRef(!0),k=me(),N=async()=>{if(!A.current){A.current=!0,o(!0);try{const{data:y,error:h}=await g.from("sports").select("id").eq("name","Volei").maybeSingle();if(h||!y?.id){alert("Erro ao buscar a modalidade Vôlei.");return}E(y.id);const{data:j,error:b}=await g.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",y.id).order("name");if(b){alert("Erro ao carregar times de Vôlei.");return}t(j||[]);const R={A:[],B:[],C:[]},m={A:[],B:[],C:[]};(j||[]).forEach(n=>{n.group_name&&ae.includes(n.group_name)&&m[n.group_name].push(n)}),ae.forEach(n=>{const f=(m[n]||[]).sort((_,F)=>{const P=_.seed_in_group??999,w=F.seed_in_group??999;return P!==w?P-w:_.name.localeCompare(F.name)});R[n]=f.map(_=>_.id)}),l(R)}finally{o(!1),A.current=!1}}};d.useEffect(()=>{$.current=!0,N();const y=g.channel("volei-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{$.current&&!A.current&&N()}).subscribe();return()=>{$.current=!1,g.removeChannel(y)}},[]);const M=d.useMemo(()=>new Set(ae.flatMap(y=>a[y])),[a]),T=d.useMemo(()=>s.filter(y=>!M.has(y.id)),[s,M]),B=y=>{c(h=>{const j=new Set(h);return j.has(y)?j.delete(y):j.add(y),j})},I=y=>{const h=Array.from(i);if(!h.length){alert("Selecione ao menos 1 time.");return}if(a[y].length+h.length>ge){alert(`O grupo ${y} não pode ter mais de ${ge} times.`),c(new Set);return}l(j=>{const b={...j};for(const R of h){for(const m of ae)b[m]=b[m].filter(n=>n!==R);b[y]=[...b[y],R]}return b}),c(new Set)},L=y=>{l(h=>{const j={...h};for(const b of ae)j[b]=j[b].filter(R=>R!==y);return j})},G=ae.every(y=>a[y].length===ge),C=async()=>{if(!G){alert("Complete todos os grupos antes de confirmar!");return}if(!x){alert("Modalidade Vôlei não encontrada.");return}try{v(!0),await g.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",x);for(const h of ae){const j=a[h];if(j.length){await g.from("teams").update({group_name:h}).in("id",j);for(let b=0;b<j.length;b++)await g.from("teams").update({seed_in_group:b+1}).eq("id",j[b])}}await g.rpc("seed_initial_standings",{p_sport_name:"Volei",p_reset:!0}),await g.rpc("rebuild_standings",{p_sport_name:"Volei"});const{error:y}=await g.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:x,p_variant:"1v2_1v3_2v3"});if(y){alert("Erro ao gerar jogos de grupos: "+y.message);return}await g.rpc("maybe_create_knockout",{p_sport_name:"Volei"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>k("/admin/campeonatos"),1200)}catch(y){alert("Erro ao salvar: "+(y?.message||String(y)))}finally{v(!1)}};return r?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Vôlei"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. Ao confirmar, salvamos"," ",e.jsx("strong",{children:"group_name"})," e ",e.jsx("strong",{children:"seed_in_group = 1,2,3"})," conforme a ordem e geramos os jogos via RPC na ",e.jsx("strong",{children:"ordem exata"}),". Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:N,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),T.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:T.map(y=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${i.has(y.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>B(y.id),title:y.name,children:[e.jsx(Ds,{team:y}),e.jsx("span",{className:"truncate",children:y.name})]},y.id))})]}),ae.map(y=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",y]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[y].length===ge?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[y].length,"/",ge]})]}),e.jsx("button",{onClick:()=>I(y),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[y].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[y].map((h,j)=>{const b=s.find(R=>R.id===h);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>L(h),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:j+1}),e.jsx(Ds,{team:b}),e.jsx("span",{className:"truncate",title:b?.name,children:b?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},h)})})})]},y))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:ae.map(y=>`${y}(${a[y].length}/${ge})`).join(", ")}),e.jsx("button",{onClick:C,disabled:!ae.every(y=>a[y].length===ge)||u,className:`px-6 py-2 rounded font-semibold transition ${ae.every(y=>a[y].length===ge)&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Ds({team:s}){const t=dn(s?.name),a=s?.color||mn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function dn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function mn(s){let t=0;for(let l=0;l<s.length;l++)t=s.charCodeAt(l)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const We=16;function un(){const[s,t]=d.useState([]),[a,l]=d.useState(Array.from({length:We},()=>({home:null,away:null}))),[i,c]=d.useState(new Set),[r,o]=d.useState(!0),[u,v]=d.useState(!1),[x,E]=d.useState(null),A=me(),$=async()=>{o(!0);try{const{data:C,error:y}=await g.from("sports").select("id").eq("name","FIFA").maybeSingle();if(y||!C?.id){alert("Erro ao localizar a modalidade FIFA."),o(!1);return}E(C.id);const{data:h,error:j}=await g.from("teams").select("id, name, logo_url, color").eq("sport_id",C.id).order("name");j?alert("Erro ao carregar times do FIFA."):t(h||[])}finally{o(!1)}};d.useEffect(()=>{$()},[]);const k=d.useMemo(()=>new Set(a.flatMap(C=>[C.home,C.away]).filter(Boolean)),[a]),N=d.useMemo(()=>s.filter(C=>!k.has(C.id)),[s,k]),M=C=>{c(y=>{const h=new Set(y);return h.has(C)?h.delete(C):h.add(C),h})},T=(C,y)=>{const h=Array.from(i);if(h.length===0){alert("Selecione um time para alocar.");return}if(h.length>1){alert("Selecione apenas 1 time por vez."),c(new Set);return}const j=h[0];l(b=>{const R=b[C];if(R[y])return alert(`O slot ${y==="home"?"A":"B"} do Jogo ${C+1} já está ocupado.`),b;const m=[...b];return m[C]={...R,[y]:j},m}),c(new Set)},B=(C,y)=>{l(h=>{const j=[...h];return j[C]={...j[C],[y]:null},j})},I=a.length===We&&a.every(C=>C.home&&C.away),L=async()=>{if(!I){alert("Todos os confrontos precisam ter 2 times.");return}if(!x){alert("Modalidade FIFA não encontrada.");return}try{v(!0);const{count:C}=await g.from("matches").select("*",{count:"exact",head:!0}).eq("sport_id",x);if((C??0)>0){if(!window.confirm("Já existe um campeonato de FIFA. Criar um novo vai apagar jogos e classificação existentes. Deseja continuar?"))return;const{data:b}=await g.from("matches").select("id").eq("sport_id",x),R=(b||[]).map(m=>m.id);R.length&&await g.from("match_events").delete().in("match_id",R),await g.from("matches").delete().eq("sport_id",x),await g.from("standings").delete().eq("sport_id",x)}await g.from("teams").update({group_name:null}).eq("sport_id",x);const y=a.map((j,b)=>({sport_id:x,stage:"r32",round:b+1,order_idx:b+1,status:"scheduled",home_team_id:j.home,away_team_id:j.away,venue:"Console FIFA"})),{error:h}=await g.from("matches").insert(y);if(h){alert("Erro ao criar os jogos: "+h.message);return}await g.from("matches").insert(Array.from({length:8}).map((j,b)=>({sport_id:x,stage:"oitavas",round:b+1,order_idx:16+(b+1),status:"scheduled"}))),await g.from("matches").insert(Array.from({length:4}).map((j,b)=>({sport_id:x,stage:"quartas",round:b+1,order_idx:24+(b+1),status:"scheduled"}))),await g.from("matches").insert([{sport_id:x,stage:"semi",round:1,order_idx:29,status:"scheduled"},{sport_id:x,stage:"semi",round:2,order_idx:30,status:"scheduled"},{sport_id:x,stage:"final",round:1,order_idx:31,status:"scheduled"},{sport_id:x,stage:"3lugar",round:1,order_idx:32,status:"scheduled"}]),await g.rpc("seed_initial_standings",{p_sport_name:"FIFA",p_reset:!0}),alert(`✅ Chaveamento criado com sucesso!

Voltando para a tela de campeonatos…`),setTimeout(()=>A("/admin/campeonatos"),1200)}catch(C){alert("Erro ao salvar: "+(C?.message||String(C)))}finally{v(!1)}},G=async()=>{if(!x){alert("Modalidade FIFA não encontrada.");return}if(s.length!==32){alert("É necessário ter exatamente 32 times cadastrados no FIFA para gerar automaticamente.");return}try{v(!0);const{error:C}=await g.rpc("fifa_seed_32_bracket",{p_sport_name:"FIFA",p_reset:!1});if(C)throw C;alert(`✅ Partidas do FIFA geradas com sucesso!

Voltando para a tela de campeonatos…`),setTimeout(()=>A("/admin/campeonatos"),1200)}catch(C){console.error("Erro ao gerar partidas FIFA:",C),alert("Erro ao gerar partidas: "+(C?.message||String(C)))}finally{v(!1)}};return r?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de FIFA"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Monte as pré-oitavas (16 jogos). Ao confirmar, os jogos entram como ",e.jsx("strong",{children:"scheduled"})," com"," ",e.jsx("strong",{children:"order_idx"})," fixo: assim, o Jogo 1 aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:G,disabled:u||!x,title:"Gera automaticamente J1..J16, placeholders J17..J28",className:`text-xs px-3 py-1 rounded border transition ${u?"opacity-60 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Gerar automaticamente (RPC)"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),N.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"grid grid-cols-2 gap-2",children:N.map(C=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${i.has(C.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>M(C.id),title:C.name,children:[e.jsx(es,{team:C}),e.jsx("span",{className:"truncate",children:C.name})]},C.id))})]}),e.jsxs("div",{className:"border rounded p-4 overflow-y-auto max-h-[32rem]",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Confrontos (pré-oitavas)"}),e.jsx("ul",{className:"space-y-4",children:a.map((C,y)=>{const h=s.find(b=>b.id===C.home),j=s.find(b=>b.id===C.away);return e.jsxs("li",{className:"flex flex-col gap-1 border rounded p-2 bg-gray-50",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:["Jogo ",y+1]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 flex-1",children:h?e.jsxs(e.Fragment,{children:[e.jsx(es,{team:h}),e.jsx("span",{className:"truncate",title:h.name,children:h.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>B(y,"home"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>T(y,"home"),children:"Adicionar time A"})}),e.jsx("span",{className:"font-bold",children:"vs"}),e.jsx("div",{className:"flex items-center gap-2 flex-1",children:j?e.jsxs(e.Fragment,{children:[e.jsx(es,{team:j}),e.jsx("span",{className:"truncate",title:j.name,children:j.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>B(y,"away"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>T(y,"away"),children:"Adicionar time B"})})]})]},y)})})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:I?e.jsxs("span",{className:"text-green-700",children:["Todos os ",We," confrontos estão prontos!"]}):e.jsxs("span",{children:["Restam ",32-k.size," times para alocar."]})}),e.jsx("button",{onClick:L,disabled:!I||u,className:`px-6 py-3 rounded font-semibold transition ${I&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar chaveamento"})]})]})}function es({team:s}){const t=gn(s?.name),a=s?.color||hn(s?.name||"T");return e.jsx("div",{className:"w-7 h-7 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function gn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function hn(s){let t=0;for(let l=0;l<s.length;l++)t=s.charCodeAt(l)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const re=["A","B","C","D","E","F","G","H"],Ce=3;function pn(){const[s,t]=d.useState([]),[a,l]=d.useState(re.reduce((y,h)=>({...y,[h]:[]}),{})),[i,c]=d.useState(new Set),[r,o]=d.useState(!0),[u,v]=d.useState(!1),[x,E]=d.useState(null),A=d.useRef(!1),$=d.useRef(!0),k=me(),N=async()=>{if(!A.current){A.current=!0,o(!0);try{const{data:y,error:h}=await g.from("sports").select("id").eq("name","Pebolim").maybeSingle();if(h||!y?.id){alert("Erro ao buscar a modalidade Pebolim.");return}E(y.id);const{data:j,error:b}=await g.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",y.id).order("name");if(b){alert("Erro ao carregar times de Pebolim.");return}t(j||[]);const R=re.reduce((n,f)=>({...n,[f]:[]}),{}),m=(j||[]).reduce((n,f)=>(re.includes(f.group_name)&&(n[f.group_name]=n[f.group_name]||[]).push(f),n),{});re.forEach(n=>{const f=(m[n]||[]).sort((_,F)=>{const P=_.seed_in_group??999,w=F.seed_in_group??999;return P!==w?P-w:_.name.localeCompare(F.name)});R[n]=f.map(_=>_.id)}),l(R)}finally{o(!1),A.current=!1}}};d.useEffect(()=>{$.current=!0,N();const y=g.channel("pebolim-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{$.current&&!A.current&&N()}).subscribe();return()=>{$.current=!1,g.removeChannel(y)}},[]);const M=d.useMemo(()=>new Set(re.flatMap(y=>a[y])),[a]),T=d.useMemo(()=>s.filter(y=>!M.has(y.id)),[s,M]),B=y=>{c(h=>{const j=new Set(h);return j.has(y)?j.delete(y):j.add(y),j})},I=y=>{const h=Array.from(i);if(!h.length){alert("Selecione ao menos 1 time.");return}if(a[y].length+h.length>Ce){alert(`O grupo ${y} não pode ter mais de ${Ce} times.`),c(new Set);return}l(j=>{const b={...j};for(const R of h){for(const m of re)b[m]=b[m].filter(n=>n!==R);b[y]=[...b[y],R]}return b}),c(new Set)},L=y=>{l(h=>{const j={...h};for(const b of re)j[b]=j[b].filter(R=>R!==y);return j})},G=re.every(y=>a[y].length===Ce),C=async()=>{if(!G){alert("Complete todos os grupos antes de confirmar!");return}if(!x){alert("Modalidade Pebolim não encontrada.");return}try{v(!0),await g.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",x);for(const h of re){const j=a[h];if(j.length){await g.from("teams").update({group_name:h}).in("id",j);for(let b=0;b<j.length;b++)await g.from("teams").update({seed_in_group:b+1}).eq("id",j[b])}}await g.rpc("seed_initial_standings",{p_sport_name:"Pebolim",p_reset:!0}),await g.rpc("rebuild_standings",{p_sport_name:"Pebolim"});const{error:y}=await g.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:x,p_variant:"1v3_1v2_3v2"});if(y){alert("Erro ao gerar jogos de grupos: "+y.message);return}await g.rpc("maybe_create_knockout",{p_sport_name:"Pebolim"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>k("/admin/campeonatos"),1200)}catch(y){alert("Erro ao salvar: "+(y?.message||String(y)))}finally{v(!1)}};return r?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Pebolim"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 24 times em 8 grupos de 3. Ao confirmar, salvamos"," ",e.jsx("strong",{children:"group_name"})," e ",e.jsx("strong",{children:"seed_in_group = 1,2,3"})," conforme a ordem e geramos os jogos via RPC na ",e.jsx("strong",{children:"ordem exata"}),". Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:N,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),T.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:T.map(y=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${i.has(y.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>B(y.id),title:y.name,children:[e.jsx(Bs,{team:y}),e.jsx("span",{className:"truncate",children:y.name})]},y.id))})]}),re.map(y=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",y]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[y].length===Ce?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[y].length,"/",Ce]})]}),e.jsx("button",{onClick:()=>I(y),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[y].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[y].map((h,j)=>{const b=s.find(R=>R.id===h);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>L(h),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:j+1}),e.jsx(Bs,{team:b}),e.jsx("span",{className:"truncate",title:b?.name,children:b?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},h)})})})]},y))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:re.map(y=>`${y}(${a[y].length}/${Ce})`).join(", ")}),e.jsx("button",{onClick:C,disabled:!G||u,className:`px-6 py-2 rounded font-semibold transition ${G&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Bs({team:s}){const t=xn(s?.name),a=s?.color||fn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function xn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function fn(s){let t=0;for(let l=0;l<s.length;l++)t=s.charCodeAt(l)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function yn(){return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})})}function jn(){const{session:s,isAdmin:t,ready:a,signOut:l,needsPasswordSetup:i}=ds();Vs();const c=me();if(!a)return e.jsx(yn,{});if(i)return e.jsx(Ts,{});const r=async()=>{try{await l(),c("/",{replace:!0})}catch(o){console.error("Error during signout:",o)}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"bg-blue-600 text-white sticky top-0 z-50 shadow-md",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx(K,{to:"/",className:"hover:opacity-90 transition-opacity",children:e.jsx("img",{src:"/logo-copa-influence.png",alt:"Copa Influence",className:"h-12 md:h-16 w-auto"})}),e.jsx("div",{className:"text-sm",children:s?e.jsxs("div",{className:"flex items-center gap-2",children:[s.user?.email&&e.jsx("span",{className:"text-white/80 text-xs hidden sm:inline",children:s.user.email}),e.jsx("button",{onClick:r,className:"hover:underline transition-colors hover:text-white/80 text-xs sm:text-sm",children:"Sair"})]}):e.jsx(K,{to:"/login",className:"hover:underline transition-colors hover:text-white/80 text-xs sm:text-sm",children:"Entrar"})})]}),e.jsx("div",{className:"border-t border-white/20 py-2",children:e.jsxs("nav",{className:"flex items-center justify-center gap-1 sm:gap-3 text-xs sm:text-sm overflow-x-auto",children:[e.jsx(K,{to:"/",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Home"}),e.jsx(K,{to:"/futsal",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Futsal"}),e.jsx(K,{to:"/volei",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Vôlei"}),e.jsx(K,{to:"/fifa",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"FIFA"}),e.jsx(K,{to:"/pebolim",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Pebolim"}),t&&e.jsx(K,{to:"/admin",className:"bg-white/15 hover:bg-white/25 transition-colors px-2 py-1 rounded text-xs whitespace-nowrap ml-1 sm:ml-2",children:"Admin"})]})})]})}),e.jsx("main",{className:"flex-1 container mx-auto p-4",children:e.jsxs($t,{children:[e.jsx(ee,{path:"/",element:e.jsx(ya,{})}),e.jsx(ee,{path:"/futsal",element:e.jsx(Ra,{})}),e.jsx(ee,{path:"/volei",element:e.jsx(Ha,{})}),e.jsx(ee,{path:"/fifa",element:e.jsx(cr,{})}),e.jsx(ee,{path:"/pebolim",element:e.jsx(_r,{})}),e.jsx(ee,{path:"/team/:id",element:e.jsx(Cs,{})}),e.jsx(ee,{path:"/times/:id",element:e.jsx(Cs,{})}),e.jsx(ee,{path:"/match/:id",element:e.jsx(Es,{})}),e.jsx(ee,{path:"/partida/:id",element:e.jsx(Es,{})}),e.jsx(ee,{path:"/set-password",element:e.jsx(Ts,{})}),e.jsx(ee,{path:"/login",element:e.jsx(Lr,{})}),e.jsx(ee,{path:"/admin",element:e.jsx(ue,{children:e.jsx(Gr,{})})}),e.jsx(ee,{path:"/admin/elencos",element:e.jsx(ue,{children:e.jsx(Br,{})})}),e.jsx(ee,{path:"/admin/partidas",element:e.jsx(ue,{children:e.jsx(Qr,{})})}),e.jsx(ee,{path:"/admin/campeonatos",element:e.jsx(ue,{children:e.jsx(sn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/futsal",element:e.jsx(ue,{children:e.jsx(nn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/volei",element:e.jsx(ue,{children:e.jsx(cn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/fifa",element:e.jsx(ue,{children:e.jsx(un,{})})}),e.jsx(ee,{path:"/admin/campeonatos/pebolim",element:e.jsx(ue,{children:e.jsx(pn,{})})}),e.jsx(ee,{path:"*",element:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"404 - Página não encontrada"}),e.jsx(K,{to:"/",className:"text-blue-600 hover:underline",children:"Voltar ao início"})]})})]})}),e.jsx("footer",{className:"bg-gray-200 p-4 text-center text-xs text-gray-700 mt-auto",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("p",{children:["© ",new Date().getFullYear()," Copa Influence"]}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Desenvolvido para a comunidade da igreja"})]})})]})}Ft.createRoot(document.getElementById("root")).render(e.jsx(ze.StrictMode,{children:e.jsx(Ct,{children:e.jsx(qt,{children:e.jsx(jn,{})})})}));
