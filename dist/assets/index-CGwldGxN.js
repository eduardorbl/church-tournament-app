import{r as qs,b as Os,a as Ls,c,u as Ie,N as Vs,R as qe,L as X,d as xs,e as te,f as Us,h as Bs,i as Q,B as Gs}from"./vendor-vbeBnipd.js";import{c as zs}from"./supabase-BfEApigK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function a(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=a(i);fetch(i.href,l)}})();var pe={exports:{}},me={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Le;function Js(){if(Le)return me;Le=1;var s=qs(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(g,p,v){var C,S={},$=null,R=null;v!==void 0&&($=""+v),p.key!==void 0&&($=""+p.key),p.ref!==void 0&&(R=p.ref);for(C in p)o.call(p,C)&&!l.hasOwnProperty(C)&&(S[C]=p[C]);if(g&&g.defaultProps)for(C in p=g.defaultProps,p)S[C]===void 0&&(S[C]=p[C]);return{$$typeof:t,type:g,key:$,ref:R,props:S,_owner:i.current}}return me.Fragment=a,me.jsx=d,me.jsxs=d,me}var Ve;function Ks(){return Ve||(Ve=1,pe.exports=Js()),pe.exports}var e=Ks(),ge={},Ue;function Xs(){if(Ue)return ge;Ue=1;var s=Os();return ge.createRoot=s.createRoot,ge.hydrateRoot=s.hydrateRoot,ge}var Hs=Xs();const Qs=Ls(Hs),Ys="https://cifdtjfrekucrmapewoj.supabase.co",Zs="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpZmR0amZyZWt1Y3JtYXBld29qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTM2OTAsImV4cCI6MjA3MzU2OTY5MH0.h4cP9OeroEa4XEQsOrdgy8L-fewT--DC2AtUk9ipJAA",h=zs(Ys,Zs),hs=c.createContext(null);function Ws({children:s}){const[t,a]=c.useState(null),[o,i]=c.useState(!1),[l,d]=c.useState(!1),[g,p]=c.useState(!1);c.useEffect(()=>{let S;return(async()=>{try{const{data:R}=await h.auth.getSession(),P=R.session??null;if(a(P),P?.user?.id){await v(P.user.id);const f=P.user.user_metadata?.password_set;(f===void 0||f===!1)&&(console.log("User needs password setup"),p(!0))}else i(!1);d(!0),S=h.auth.onAuthStateChange(async(f,_)=>{try{if(console.log("Auth state changed:",f,_?.user?.email),a(_??null),_?.user?.id){if(g||await v(_.user.id),f==="SIGNED_IN"){const E=_.user.user_metadata?.password_set;(E===void 0||E===!1)&&(console.log("Setting needsPasswordSetup to true"),p(!0))}}else i(!1);f==="SIGNED_OUT"&&(p(!1),i(!1))}catch(E){console.error("Error in auth state change:",E)}}).data.subscription}catch(R){console.error("Error in auth bootstrap:",R),d(!0)}})(),()=>S?.unsubscribe()},[g]);const v=async S=>{try{const{data:$,error:R}=await h.rpc("is_admin");R?(console.error("is_admin RPC error",R),i(!1)):(console.log("Admin check result:",$),i(!!$))}catch($){console.error("Admin check failed:",$),i(!1)}},C=async()=>{try{await h.auth.signOut(),i(!1),p(!1)}catch(S){console.error("Error signing out:",S)}};return e.jsx(hs.Provider,{value:{session:t,isAdmin:o,ready:l,signOut:C,needsPasswordSetup:g,setNeedsPasswordSetup:p,user:t?.user??null,loading:!l},children:s})}function Oe(){return c.useContext(hs)}function ne({children:s}){const{ready:t,session:a,isAdmin:o}=Oe(),i=Ie();if(!t)return e.jsx("div",{className:"p-8 text-center text-sm text-gray-500",children:"Carregando‚Ä¶"});if(!a||!o){const l=encodeURIComponent(i.pathname+i.search);return e.jsx(Vs,{to:`/login?redirect=${l}&reason=forbidden`,replace:!0})}return s}class Be extends qe.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,a){console.error("ErrorBoundary capturou um erro:",t,a),this.setState({error:t,errorInfo:a})}handleReload=()=>{window.location.reload()};handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-4",children:e.jsx("span",{className:"text-2xl text-red-600",children:"‚ö†Ô∏è"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Oops! Algo deu errado"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Ocorreu um erro inesperado na aplica√ß√£o. Voc√™ pode tentar recarregar a p√°gina ou voltar ao in√≠cio."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:this.handleReload,className:"w-full bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors",children:"Recarregar P√°gina"}),e.jsx("button",{onClick:this.handleReset,className:"w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"Tentar Novamente"}),e.jsx(X,{to:"/",className:"block w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors",onClick:this.handleReset,children:"Voltar ao In√≠cio"})]}),!1]})}):this.props.children}}function Ge({children:s}){const t=Ie();return c.useEffect(()=>{console.log("Current route:",t.pathname);const a=l=>{t.pathname.includes("/admin/")&&console.log("Admin route reload detected")},o=l=>{console.log("Navigation detected:",t.pathname)},i=l=>{console.log("Hash change detected")};return window.addEventListener("beforeunload",a),window.addEventListener("popstate",o),window.addEventListener("hashchange",i),window.scrollTo(0,0),()=>{window.removeEventListener("beforeunload",a),window.removeEventListener("popstate",o),window.removeEventListener("hashchange",i)}},[t]),c.useEffect(()=>{const a=document.body,o=`route-${t.pathname.split("/").filter(Boolean).join("-")||"home"}`;return a.className=a.className.replace(/route-\S+/g,""),a.classList.add(o),()=>{a.classList.remove(o)}},[t.pathname]),s}function et(s){const t=s.trim().split(" ");return t.length===1?t[0][0]?.toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}function st(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function H({team:s,size:t=32}){const[a,o]=c.useState(!1),i=s?.name||"A definir",l=s?.logo_url,d=!l||a;return e.jsxs("div",{className:"relative rounded overflow-hidden border bg-white flex items-center justify-center shrink-0",style:{width:t,height:t},children:[!d&&e.jsx("img",{src:l,alt:i,className:"w-full h-full object-cover",loading:"lazy",onError:()=>o(!0)}),d&&e.jsx("div",{className:"flex items-center justify-center text-white font-bold uppercase w-full h-full",style:{backgroundColor:st(i),fontSize:t*.4},children:et(i)})]})}const ps={Futsal:"‚öΩ",Volei:"üèê",FIFA:"üéÆ‚öΩ",Pebolim:"üé≤‚öΩ"},ze=["Futsal","Volei","FIFA","Pebolim"],tt={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},at="team-logos",rt="America/Sao_Paulo";function Je(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:rt,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function fs(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function nt(s){return typeof s=="string"&&!fs(s)&&s.trim()!==""}function Ke(s){if(!s)return null;if(fs(s))return s;if(nt(s)){const{data:t}=h.storage.from(at).getPublicUrl(s);return t?.publicUrl||null}return null}function ys(s){const t=s?.home&&typeof s.home=="object"?s.home.id:null,a=s?.away&&typeof s.away=="object"?s.away.id:null;return!!(t&&a)}function ot(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const l=Math.floor(i/1e3),d=Math.floor(l/60),g=l%60;return`${d}:${g.toString().padStart(2,"0")}`}function it({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function lt({status:s,meta:t}){const a="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[11px] font-medium",o=s==="ongoing"?"bg-green-100 text-green-700":s==="paused"?"bg-yellow-100 text-yellow-700":s==="finished"?"bg-gray-200 text-gray-700":"bg-blue-100 text-blue-700";return e.jsx("span",{className:`${a} ${o}`,children:tt[s]||s})}function js({match:s,currentTimestamp:t}){const a=s.home,o=s.away,i=s.status!=="scheduled",l=typeof s.home_score=="number"?s.home_score:0,d=typeof s.away_score=="number"?s.away_score:0,g=s.status==="ongoing"||s.status==="paused",p=g?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(X,{to:`/match/${s.id}`,className:`block border rounded-lg p-3 bg-white hover:bg-gray-50 transition shadow-sm relative overflow-hidden ${p}`,children:[e.jsx(it,{status:s.status}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{status:s.status,meta:s.meta}),g&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["üïê ",ot(s,t)]}),e.jsxs("span",{className:"text-[11px] text-gray-500",children:[ps[s.sport?.name]||"üèÜ"," ",s.sport?.name]})]}),s.starts_at?e.jsx("span",{className:"text-[11px] text-gray-500",children:Je(s.starts_at)}):e.jsx("span",{className:"text-[11px] text-gray-400",children:s.venue||""})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:a||{name:"A definir"},size:28}),e.jsx(X,{to:a?.id?`/team/${a.id}`:"#",onClick:v=>{a?.id||v.preventDefault(),v.stopPropagation()},className:`truncate text-sm font-medium hover:underline ${a?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:a?.name||"A definir",children:a?.name||"A definir"})]}),e.jsxs("div",{className:"shrink-0 text-center",children:[i?e.jsxs("span",{className:"font-bold text-lg tabular-nums",children:[l," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",d]}):null,e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase tracking-wide",children:[s.stage||"",s.round?` ¬∑ J${s.round}`:"",s.group_name?` ¬∑ G${s.group_name}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx(X,{to:o?.id?`/team/${o.id}`:"#",onClick:v=>{o?.id||v.preventDefault(),v.stopPropagation()},className:`truncate text-sm font-medium hover:underline text-right ${o?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:o?.name||"A definir",children:o?.name||"A definir"}),e.jsx(H,{team:o||{name:"A definir"},size:28})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.venue||""}),s.status==="finished"&&s.updated_at?e.jsxs("span",{children:["Encerrado em ",Je(s.updated_at)]}):null]})]})}function ct({sportName:s,matches:t,currentTimestamp:a}){const o=ps[s]||"üèÜ",i=p=>ys(p),l=t.filter(p=>p.status==="scheduled"&&i(p)).sort((p,v)=>p.starts_at&&v.starts_at?new Date(p.starts_at)-new Date(v.starts_at):p.starts_at?-1:v.starts_at?1:0).slice(0,8),d=t.filter(p=>p.status==="finished"&&i(p)).sort((p,v)=>new Date(v.updated_at||v.starts_at||0)-new Date(p.updated_at||p.starts_at||0)).slice(0,10),g=({title:p,items:v,emptyLabel:C})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:p}),v.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:C}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:v.map(S=>e.jsx(js,{match:S,currentTimestamp:a},S.id))})]});return e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:o}),e.jsx("h3",{className:"text-lg font-bold",children:s})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(g,{title:"Agendados",items:l,emptyLabel:"Nenhuma partida agendada."}),e.jsx(g,{title:"Encerrados (recentes)",items:d,emptyLabel:"Sem resultados recentes."})]})]})}function dt(){const[s,t]=c.useState(!0),[a,o]=c.useState({}),[i,l]=c.useState(Date.now()),d=c.useRef(null),g=c.useRef(null),p=async()=>{t(!0);const{data:S,error:$}=await h.from("matches").select(`
        id,
        sport:sport_id ( id, name ),
        stage, round, group_name,
        starts_at, updated_at, venue, status, meta,
        home_score, away_score,
        home:home_team_id ( id, name, logo_url, color ),
        away:away_team_id ( id, name, logo_url, color )
      `).order("starts_at",{ascending:!0,nullsFirst:!0});if($){console.error($),o({}),t(!1);return}const R=(S||[]).map(f=>{const _=f.home&&typeof f.home=="object"?{...f.home,logo_url:(()=>{const N=Ke(f.home.logo_url);return N?`${N}${N.includes("?")?"&":"?"}v=1`:null})()}:f.home,E=f.away&&typeof f.away=="object"?{...f.away,logo_url:(()=>{const N=Ke(f.away.logo_url);return N?`${N}${N.includes("?")?"&":"?"}v=1`:null})()}:f.away;return{...f,home:_,away:E}}),P={};for(const f of R){const _=f.sport?.name||"Outros";P[_]||(P[_]=[]),P[_].push(f)}o(P),t(!1)};c.useEffect(()=>{p(),g.current=setInterval(()=>{l(Date.now())},1e3),d.current&&h.removeChannel(d.current);const S=h.channel("home-matches").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>p()).subscribe();return d.current=S,()=>{g.current&&clearInterval(g.current),d.current&&h.removeChannel(d.current),d.current=null}},[]);const v=c.useMemo(()=>{const S=Object.keys(a),$=ze.filter(P=>S.includes(P)),R=S.filter(P=>!ze.includes(P)).sort();return[...$,...R]},[a]),C=c.useMemo(()=>Object.values(a).flat().filter($=>($.status==="ongoing"||$.status==="paused")&&ys($)).sort(($,R)=>$.status==="ongoing"&&R.status==="paused"?-1:$.status==="paused"&&R.status==="ongoing"?1:0),[a]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Acompanhe as partidas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Toque em uma partida para ver os detalhes. Toque no nome do time para ir √† p√°gina do time."})]}),s?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-40 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:Array.from({length:6}).map((S,$)=>e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"},$))})]}):e.jsxs(e.Fragment,{children:[C.length>0&&e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"üî¥"}),e.jsx("h3",{className:"text-lg font-bold",children:"Ao vivo / Pausado"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:C.map(S=>e.jsx(js,{match:S,currentTimestamp:i},S.id))})]}),v.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma partida dispon√≠vel no momento."}):v.map(S=>e.jsx(ct,{sportName:S,matches:a[S]||[],currentTimestamp:i},S))]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}const bs="‚öΩ",mt={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},ut="team-logos",gt="America/Sao_Paulo";function Xe(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:gt,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function vs(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function xt(s){return typeof s=="string"&&!vs(s)&&s.trim()!==""}function fe(s){if(!s)return null;if(vs(s))return s;if(xt(s)){const{data:t}=h.storage.from(ut).getPublicUrl(s);return t?.publicUrl||null}return null}function ht(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const l=Math.floor(i/1e3),d=Math.floor(l/60),g=l%60;return`${d}:${g.toString().padStart(2,"0")}`}function pt({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function ft({status:s,meta:t}){const a="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[11px] font-medium",o=s==="ongoing"?"bg-green-100 text-green-700":s==="paused"?"bg-yellow-100 text-yellow-700":s==="finished"?"bg-gray-200 text-gray-700":"bg-blue-100 text-blue-700";return e.jsx("span",{className:`${a} ${o}`,children:mt[s]||s})}function ye({match:s,currentTimestamp:t}){const a=s.home,o=s.away,i=s.status!=="scheduled",l=typeof s.home_score=="number"?s.home_score:0,d=typeof s.away_score=="number"?s.away_score:0,g=s.status==="ongoing"||s.status==="paused",p=g?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(X,{to:`/match/${s.id}`,className:`block border rounded-lg p-3 bg-white hover:bg-gray-50 transition shadow-sm relative overflow-hidden ${p}`,children:[e.jsx(pt,{status:s.status}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{status:s.status,meta:s.meta}),g&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["üïê ",ht(s,t)]}),e.jsxs("span",{className:"text-[11px] text-gray-500",children:[bs," Futsal"]})]}),s.starts_at?e.jsx("span",{className:"text-[11px] text-gray-500",children:Xe(s.starts_at)}):e.jsx("span",{className:"text-[11px] text-gray-400",children:s.venue||""})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:a||{name:"A definir"},size:28}),e.jsx(X,{to:a?.id?`/team/${a.id}`:"#",onClick:v=>{a?.id||v.preventDefault(),v.stopPropagation()},className:`truncate text-sm font-medium hover:underline ${a?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:a?.name||"A definir",children:a?.name||"A definir"})]}),e.jsxs("div",{className:"shrink-0 text-center",children:[i?e.jsxs("span",{className:"font-bold text-lg tabular-nums",children:[l," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",d]}):null,e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase tracking-wide",children:[s.stage||"",s.round?` ¬∑ J${s.round}`:"",s.group_name?` ¬∑ G${s.group_name}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx(X,{to:o?.id?`/team/${o.id}`:"#",onClick:v=>{o?.id||v.preventDefault(),v.stopPropagation()},className:`truncate text-sm font-medium hover:underline text-right ${o?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:o?.name||"A definir",children:o?.name||"A definir"}),e.jsx(H,{team:o||{name:"A definir"},size:28})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.venue||""}),s.status==="finished"&&s.updated_at?e.jsxs("span",{children:["Encerrado em ",Xe(s.updated_at)]}):null]})]})}function je({title:s,home:t,away:a,badge:o}){const i=t||{},l=a||{};return e.jsxs("div",{className:"rounded-lg border p-3 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-gray-500",children:s}),o&&e.jsx("span",{className:`text-[10px] uppercase tracking-wide px-2 py-0.5 rounded ${o==="Definitivo"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:o})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:i.id?i:{name:"A definir"},size:24}),e.jsx("span",{className:`truncate text-sm ${i.id?"text-gray-900":"text-gray-400"}`,title:i.name||"A definir",children:i.name||"A definir"})]}),e.jsx("div",{className:"text-gray-400 text-xs",children:"vs"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx("span",{className:`truncate text-sm text-right ${l.id?"text-gray-900":"text-gray-400"}`,title:l.name||"A definir",children:l.name||"A definir"}),e.jsx(H,{team:l.id?l:{name:"A definir"},size:24})]})]})]})}function yt(s,t){if(!Array.isArray(s)||s.length===0)return null;const a=p=>({id:p,name:t[p]?.name||t[p]||"‚Äî",logo_url:t[p]?.logo_url,color:t[p]?.color}),o=s.find(p=>p.group_name==="A"&&p.rank===1),i=s.find(p=>p.group_name==="B"&&p.rank===1),l=s.find(p=>p.group_name==="C"&&p.rank===1),d=s.filter(p=>p.rank===2);d.sort((p,v)=>(v.points??0)-(p.points??0)||(v.goal_difference??0)-(p.goal_difference??0)||(v.goals_for??0)-(p.goals_for??0)||String(p.team_id).localeCompare(String(v.team_id)));const g=d[0];return o&&i&&l&&g?{semi1:{home:a(o.team_id),away:a(i.team_id)},semi2:{home:a(l.team_id),away:a(g.team_id)}}:null}function jt(s){const t=l=>(s||[]).filter(d=>d.stage===l).sort((d,g)=>(d.round||0)-(g.round||0)),a=t("semi"),o=t("final"),i=t("3lugar");return{semi1:a[0],semi2:a[1],final:o[0],third:i[0]}}function bt({standings:s,teamsById:t}){const a=c.useMemo(()=>{const i={};for(const l of s||[]){const d=l.group_name||"-";i[d]||(i[d]=[]),i[d].push(l)}for(const l of Object.keys(i))i[l].sort((d,g)=>(d.rank||99)-(g.rank||99));return i},[s]),o=Object.keys(a).sort();return o.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classifica√ß√£o."}):e.jsx("div",{className:"space-y-6",children:o.map(i=>e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2 bg-gray-50 border-b text-sm font-semibold",children:["Grupo ",i]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"py-1 pl-3 text-left w-10",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"py-1 text-center w-10",children:"P"}),e.jsx("th",{className:"py-1 text-center w-10",children:"V"}),e.jsx("th",{className:"py-1 text-center w-10",children:"E"}),e.jsx("th",{className:"py-1 text-center w-10",children:"D"}),e.jsx("th",{className:"py-1 text-center w-10",children:"GP"}),e.jsx("th",{className:"py-1 text-center w-10",children:"GC"}),e.jsx("th",{className:"py-1 text-center w-12",children:"+/-"}),e.jsx("th",{className:"py-1 text-center w-12",children:"Pts"})]})}),e.jsx("tbody",{children:a[i].map(l=>{const d=t[l.team_id]&&typeof t[l.team_id]=="object"?t[l.team_id]:{id:l.team_id,name:l.team_name||t[l.team_id]||"‚Äî"};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:l.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${d.id}`,className:"hover:underline flex items-center gap-2",children:[e.jsx(H,{team:d,size:20}),e.jsx("span",{className:"truncate",children:d.name})]})}),e.jsx("td",{className:"py-1 text-center",children:l.matches_played}),e.jsx("td",{className:"py-1 text-center",children:l.wins}),e.jsx("td",{className:"py-1 text-center",children:l.draws}),e.jsx("td",{className:"py-1 text-center",children:l.losses}),e.jsx("td",{className:"py-1 text-center",children:l.goals_for}),e.jsx("td",{className:"py-1 text-center",children:l.goals_against}),e.jsx("td",{className:"py-1 text-center",children:l.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:l.points})]},`${i}-${l.rank}-${l.team_id}`)})})]})]},i))})}const vt=async s=>{try{await h.rpc("seed_initial_standings",{p_sport_name:s,p_reset:!1})}catch(t){console.warn("seed_initial_standings exception:",t)}},Nt=async s=>{try{console.log("üîÑ Recalculando standings para:",s),await h.rpc("recalculate_standings",{p_sport_name:s}),console.log("‚úÖ Standings recalculadas com sucesso")}catch(t){console.error("Erro ao recalcular standings:",t)}};function _t(){const[s,t]=c.useState(null),[a,o]=c.useState([]),[i,l]=c.useState([]),[d,g]=c.useState({}),[p,v]=c.useState(!0),[C,S]=c.useState(Date.now()),$=c.useRef(null),R=c.useRef(null),P=c.useRef(!1),f=c.useRef(new Map),_=async()=>{const{data:r}=await h.from("sports").select("id").eq("name","Futsal").maybeSingle();r?.id&&t(r.id)},E=async r=>{const{data:x}=await h.from("teams").select("id, name, logo_url, color").eq("sport_id",r);if(x){const y={};for(const n of x)y[n.id]={...n,logo_url:(()=>{const m=fe(n.logo_url);return m?`${m}${m.includes("?")?"&":"?"}v=1`:null})()};g(y)}},N=async r=>{const{data:x}=await h.from("matches").select(`
        id,
        stage,
        round,
        group_name,
        starts_at,
        updated_at,
        venue,
        status,
        meta,
        home_score,
        away_score,
        home_team_id,
        away_team_id,
        home:home_team_id ( id, name, logo_url, color ),
        away:away_team_id ( id, name, logo_url, color )
      `).eq("sport_id",r).order("stage",{ascending:!0,nullsFirst:!0}).order("round",{ascending:!0,nullsFirst:!0}).order("starts_at",{ascending:!0,nullsFirst:!0});if(x){const y=x.map(n=>{const m=n.home&&typeof n.home=="object"?{...n.home,logo_url:(()=>{const j=fe(n.home.logo_url);return j?`${j}${j.includes("?")?"&":"?"}v=1`:null})()}:n.home,u=n.away&&typeof n.away=="object"?{...n.away,logo_url:(()=>{const j=fe(n.away.logo_url);return j?`${j}${j.includes("?")?"&":"?"}v=1`:null})()}:n.away;return{...n,home:m,away:u}});o(y)}},T=async r=>{let x=null;const y=await h.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points").eq("sport_id",r).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});!y.error&&y.data&&(x=y.data),x||(x=((await h.from("standings").select(`
          group_name,
          rank,
          team_id,
          matches_played,
          wins, draws, losses,
          goals_for, goals_against, goal_difference,
          points,
          team:teams!standings_team_id_fkey(name, logo_url, color, id)
        `).eq("sport_id",r).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(m=>({...m,team_name:m.team?.name}))||[]),l(x||[])},w=async r=>{v(!0),await Promise.all([E(r),N(r),T(r),vt("Futsal")]),v(!1)},k=r=>{const x=new Map;let y=!1;r.filter(n=>n.status==="finished").forEach(n=>{const m=n.id,u=`${n.home_score}-${n.away_score}`;x.set(m,u);const j=f.current.get(m);j&&j!==u&&(console.log(`üîÑ Detectada mudan√ßa no placar da partida ${n.id}: ${j} ‚Üí ${u}`),y=!0)}),f.current=x,y&&(console.log("üîÑ Mudan√ßas detectadas em partidas finalizadas, recalculando standings..."),Nt("Futsal").then(()=>{s&&T(s)}))};c.useEffect(()=>{_()},[]),c.useEffect(()=>{if(!s)return;w(s),R.current=setInterval(()=>{S(Date.now())},1e3),$.current&&(h.removeChannel($.current),$.current=null);const r=h.channel("futsal-live").on("postgres_changes",{event:"*",schema:"public",table:"match_events"},()=>{console.log("üì° Match events changed, reloading standings..."),T(s)}).on("postgres_changes",{event:"*",schema:"public",table:"matches"},x=>{console.log("üì° Matches changed:",x),w(s)}).on("postgres_changes",{event:"*",schema:"public",table:"standings"},()=>{console.log("üì° Standings changed, reloading..."),T(s)}).subscribe();return $.current=r,()=>{R.current&&clearInterval(R.current),$.current&&h.removeChannel($.current),$.current=null}},[s]),c.useEffect(()=>{a.length>0&&k(a)},[a]);const I=c.useMemo(()=>{const r=a.filter(x=>x.status==="scheduled"&&(x.group_name||x.home_team_id&&x.away_team_id));return r.sort((x,y)=>{const n=x.starts_at?new Date(x.starts_at).getTime():Number.POSITIVE_INFINITY,m=y.starts_at?new Date(y.starts_at).getTime():Number.POSITIVE_INFINITY;return n-m}),r},[a]),q=c.useMemo(()=>a.filter(r=>r.status==="ongoing"||r.status==="paused"),[a]),U=c.useMemo(()=>{const r=a.filter(x=>x.status==="finished");return r.sort((x,y)=>new Date(y.updated_at||y.starts_at||0)-new Date(x.updated_at||x.starts_at||0)),r},[a]),b=c.useMemo(()=>jt(a),[a]),D=c.useMemo(()=>b?.semi1&&b.semi1.home_team_id&&b.semi1.away_team_id||b?.semi2&&b.semi2.home_team_id&&b.semi2.away_team_id?null:yt(i,d),[b,i,d]),J=c.useMemo(()=>{const r=a.filter(x=>x.stage==="grupos");return r.length===0?!1:r.every(x=>x.status==="finished")},[a]),O=b?.semi1?.home_team_id&&b?.semi1?.away_team_id&&b?.semi2?.home_team_id&&b?.semi2?.away_team_id;c.useEffect(()=>{(async()=>s&&J&&(O||P.current||(await h.rpc("maybe_create_knockout",{p_sport_name:"Futsal"}),P.current=!0,await w(s))))()},[s,J,O]);const G=c.useMemo(()=>{const r=[];return b.semi1&&b.semi1.home&&b.semi1.away&&b.semi1.home.id&&b.semi1.away.id?r.push({title:"Semifinal 1",home:b.semi1.home,away:b.semi1.away,badge:"Definitivo"}):D?.semi1&&r.push({title:"Semifinal 1 (provis√≥ria) ‚Äî Venc. Grupo A √ó Venc. Grupo B",home:D.semi1.home,away:D.semi1.away,badge:"Provis√≥rio"}),b.semi2&&b.semi2.home&&b.semi2.away&&b.semi2.home.id&&b.semi2.away.id?r.push({title:"Semifinal 2",home:b.semi2.home,away:b.semi2.away,badge:"Definitivo"}):D?.semi2&&r.push({title:"Semifinal 2 (provis√≥ria) ‚Äî Venc. Grupo C √ó Melhor 2¬∫",home:D.semi2.home,away:D.semi2.away,badge:"Provis√≥rio"}),r},[b,D]),z=c.useMemo(()=>{const r=[];return b.final&&b.final.home_team_id&&b.final.away_team_id&&b.final.home&&b.final.away?r.push({title:"Final",home:b.final.home,away:b.final.away,badge:"Definitivo"}):(D||b.semi1||b.semi2)&&r.push({title:"Final (provis√≥ria)",home:{id:"w-s1",name:"Vencedor Semi 1"},away:{id:"w-s2",name:"Vencedor Semi 2"},badge:"Provis√≥rio"}),r},[b,D]),F=c.useMemo(()=>{const r=[];return b.third&&b.third.home_team_id&&b.third.away_team_id&&b.third.home&&b.third.away?r.push({title:"3¬∫ lugar",home:b.third.home,away:b.third.away,badge:"Definitivo"}):(D||b.semi1||b.semi2)&&r.push({title:"3¬∫ lugar (provis√≥rio)",home:{id:"l-s1",name:"Perdedor Semi 1"},away:{id:"l-s2",name:"Perdedor Semi 2"},badge:"Provis√≥rio"}),r},[b,D]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:bs}),e.jsx("h2",{className:"text-2xl font-bold",children:"Futsal"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Dura√ß√£o oficial: ",e.jsx("strong",{children:"10 minutos corridos"}),". Toque em uma partida para ver os detalhes (status, tempo, elenco)."]})]}),p?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-40 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:Array.from({length:6}).map((r,x)=>e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"},x))})]}):e.jsxs(e.Fragment,{children:[!1,e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Partidas"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Ao vivo / Pausado"}),q.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhuma partida em andamento."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:q.map(r=>e.jsx(ye,{match:r,currentTimestamp:C},r.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Agendados"}),I.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhuma partida agendada."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:I.map(r=>e.jsx(ye,{match:r,currentTimestamp:C},r.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),U.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:U.map(r=>e.jsx(ye,{match:r,currentTimestamp:C},r.id))})]})]})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Informa√ß√µes do campeonato"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Tabela de classifica√ß√£o"}),e.jsx(bt,{standings:i,teamsById:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Chaveamento"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:G.length>0?G.map((r,x)=>e.jsx(je,{title:r.title,home:r.home,away:r.away,badge:r.badge},x)):e.jsx("div",{className:"col-span-full text-xs text-gray-500",children:"Chaveamento ainda n√£o dispon√≠vel. Assim que houver resultados ou classifica√ß√£o suficiente, os confrontos ser√£o exibidos aqui."})}),(z.length>0||F.length>0)&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[z.map((r,x)=>e.jsx(je,{title:r.title,home:r.home,away:r.away,badge:r.badge},`f-${x}`)),F.map((r,x)=>e.jsx(je,{title:r.title,home:r.home,away:r.away,badge:r.badge},`t-${x}`))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Regulamento"}),e.jsx("div",{className:"border rounded-lg p-3 bg-white text-sm text-gray-700 space-y-2",children:e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Dura√ß√£o:"})," partidas de ",e.jsx("strong",{children:"10 minutos corridos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classifica√ß√£o para o mata-mata:"})," avan√ßam o ",e.jsx("strong",{children:"1¬∫"})," de cada grupo e o ",e.jsx("strong",{children:"melhor 2¬∫"})," colocado geral."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate nos grupos:"})," em igualdade de pontos, prevalece o ",e.jsx("strong",{children:"saldo de gols"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"SF1:"})," Vencedor do ",e.jsx("strong",{children:"Grupo A"})," √ó Vencedor do ",e.jsx("strong",{children:"Grupo B"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"SF2:"})," Vencedor do ",e.jsx("strong",{children:"Grupo C"})," √ó ",e.jsx("strong",{children:"Melhor 2¬∫"})]})]})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Final:"})," vencedores das semifinais. Pode haver jogo de 3¬∫ lugar a crit√©rio da organiza√ß√£o."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substitui√ß√µes:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Antijogo:"})," desperd√≠cio proposital de tempo pode gerar acr√©scimo ao final, a crit√©rio do √°rbitro."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Goleiro-linha:"})," permitido."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Expuls√£o:"})," equipe fica com ",e.jsx("strong",{children:"um a menos por 2 minutos"})," ou at√© ",e.jsx("strong",{children:"sofrer um gol"}),"."]})]})})]})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}const Ns="üèê",wt="team-logos",St={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},$t="America/Sao_Paulo";function He(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:$t,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function _s(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Ct(s){return typeof s=="string"&&!_s(s)&&s.trim()!==""}function be(s){if(!s)return null;if(_s(s))return s;if(Ct(s)){const{data:t}=h.storage.from(wt).getPublicUrl(s);return t?.publicUrl||null}return null}function Et(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const l=Math.floor(i/1e3),d=Math.floor(l/60),g=l%60;return`${d}:${g.toString().padStart(2,"0")}`}function At({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Pt({status:s,meta:t}){const a="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[11px] font-medium",o=s==="ongoing"?"bg-green-100 text-green-700":s==="paused"?"bg-yellow-100 text-yellow-700":s==="finished"?"bg-gray-200 text-gray-700":"bg-blue-100 text-blue-700";return e.jsx("span",{className:`${a} ${o}`,children:St[s]||s})}function ve({match:s,currentTimestamp:t}){const a=s.home,o=s.away,i=s.status!=="scheduled",l=typeof s.home_score=="number"?s.home_score:0,d=typeof s.away_score=="number"?s.away_score:0,g=Number(s?.meta?.home_sets||0),p=Number(s?.meta?.away_sets||0),v=g>0||p>0,C=s.status==="ongoing"||s.status==="paused",S=C?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(X,{to:`/match/${s.id}`,className:`block border rounded-lg p-3 bg-white hover:bg-gray-50 transition shadow-sm relative overflow-hidden ${S}`,children:[e.jsx(At,{status:s.status}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pt,{status:s.status,meta:s.meta}),C&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["üïê ",Et(s,t)]}),e.jsxs("span",{className:"text-[11px] text-gray-500",children:[Ns," V√¥lei"]})]}),s.starts_at?e.jsx("span",{className:"text-[11px] text-gray-500",children:He(s.starts_at)}):e.jsx("span",{className:"text-[11px] text-gray-400",children:s.venue||""})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:a||{name:"A definir"},size:28}),e.jsx(X,{to:a?.id?`/team/${a.id}`:"#",onClick:$=>{a?.id||$.preventDefault(),$.stopPropagation()},className:`truncate text-sm font-medium hover:underline ${a?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:a?.name||"A definir",children:a?.name||"A definir"})]}),e.jsxs("div",{className:"shrink-0 text-center",children:[i?e.jsxs(e.Fragment,{children:[v&&e.jsxs("div",{className:"text-xs font-semibold tabular-nums mb-0.5",children:["Sets: ",g," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",p]}),e.jsxs("div",{className:"font-bold text-lg tabular-nums",children:[l," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",d]})]}):null,e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase tracking-wide",children:[s.stage||"",s.round?` ¬∑ J${s.round}`:"",s.group_name?` ¬∑ G${s.group_name}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx(X,{to:o?.id?`/team/${o.id}`:"#",onClick:$=>{o?.id||$.preventDefault(),$.stopPropagation()},className:`truncate text-sm font-medium hover:underline text-right ${o?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:o?.name||"A definir",children:o?.name||"A definir"}),e.jsx(H,{team:o||{name:"A definir"},size:28})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.venue||""}),s.status==="finished"&&s.updated_at?e.jsxs("span",{children:["Encerrado em ",He(s.updated_at)]}):null]})]})}function Ne({title:s,home:t,away:a,badge:o}){const i=t||{},l=a||{};return e.jsxs("div",{className:"rounded-lg border p-3 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-gray-500",children:s}),o&&e.jsx("span",{className:`text-[10px] uppercase tracking-wide px-2 py-0.5 rounded ${o==="Definitivo"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:o})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:i.id?i:{name:"A definir"},size:24}),e.jsx("span",{className:`truncate text-sm ${i.id?"text-gray-900":"text-gray-400"}`,title:i.name||"A definir",children:i.name||"A definir"})]}),e.jsx("div",{className:"text-gray-400 text-xs",children:"vs"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx("span",{className:`truncate text-sm text-right ${l.id?"text-gray-900":"text-gray-400"}`,title:l.name||"A definir",children:l.name||"A definir"}),e.jsx(H,{team:l.id?l:{name:"A definir"},size:24})]})]})]})}function Tt(s){const t={},a=o=>{t[o]||(t[o]={mp:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0})};for(const o of s||[]){if(o.stage!=="grupos"||o.status!=="finished")continue;const i=o.home_team_id||o.home?.id,l=o.away_team_id||o.away?.id;if(!i||!l)continue;const d=Number(o?.meta?.home_sets??0),g=Number(o?.meta?.away_sets??0),p=Number(o?.home_score??0),v=Number(o?.away_score??0);a(i),a(l),t[i].mp+=1,t[l].mp+=1,t[i].sv+=d,t[i].sp+=g,t[l].sv+=g,t[l].sp+=d,t[i].pf+=p,t[i].pa+=v,t[l].pf+=v,t[l].pa+=p;let C=!1;d!==g?C=d>g:p!==v?C=p>v:C=!1,C?(t[i].wins+=1,t[l].losses+=1):(t[l].wins+=1,t[i].losses+=1)}return t}function kt(s,t,a){return(s||[]).map(o=>{const i=a[o.team_id]||{mp:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0};return{...o,team_name:t[o.team_id]&&t[o.team_id].name||o.team_name||t[o.team_id]||"‚Äî",matches_played:i.mp,wins:i.wins,losses:i.losses,sv:i.sv,sp:i.sp,pf:i.pf,pa:i.pa,points:i.wins*3}})}function ke(s,t){const a=Number(s.points??0),o=Number(t.points??0);if(o!==a)return o-a;const i=Number(s.sv??0),l=Number(t.sv??0);if(l!==i)return l-i;const d=Number(s.sp??0),g=Number(t.sp??0);if(d!==g)return d-g;const p=Number(s.pf??0)-Number(s.pa??0),v=Number(t.pf??0)-Number(t.pa??0);return v!==p?v-p:String(s.team_id).localeCompare(String(t.team_id))}function Dt(s,t){if(!Array.isArray(s)||s.length===0)return null;const a={};for(const C of s){const S=C.group_name||"-";a[S]||(a[S]=[]),a[S].push(C)}for(const C of Object.keys(a))a[C].sort(ke);const o=(C,S)=>a[C]&&a[C][S]?a[C][S]:null,i=o("A",0),l=o("B",0),d=o("C",0),p=[o("A",1),o("B",1),o("C",1)].filter(Boolean).sort(ke)[0];if(!(i&&l&&d&&p))return null;const v=C=>({id:C,name:t[C]?.name||t[C]||"‚Äî",logo_url:t[C]?.logo_url,color:t[C]?.color});return{semi1:{home:v(i.team_id),away:v(l.team_id)},semi2:{home:v(d.team_id),away:v(p.team_id)}}}function Mt(s){const t=l=>(s||[]).filter(d=>d.stage===l).sort((d,g)=>(d.round||0)-(g.round||0)),a=t("semi"),o=t("final"),i=t("3lugar");return{semi1:a[0],semi2:a[1],final:o[0],third:i[0]}}function Rt({rows:s,teamsById:t}){const a=c.useMemo(()=>{const i={};for(const l of s||[]){const d=l.group_name||"-";i[d]||(i[d]=[]),i[d].push(l)}for(const l of Object.keys(i))i[l].sort(ke);return i},[s]),o=Object.keys(a).sort();return o.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classifica√ß√£o."}):e.jsx("div",{className:"space-y-6",children:o.map(i=>e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2 bg-gray-50 border-b text-sm font-semibold",children:["Grupo ",i]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"py-1 pl-3 text-left w-10",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"py-1 text-center w-10",children:"P"}),e.jsx("th",{className:"py-1 text-center w-10",children:"V"}),e.jsx("th",{className:"py-1 text-center w-10",children:"D"}),e.jsx("th",{className:"py-1 text-center w-10",children:"SV"}),e.jsx("th",{className:"py-1 text-center w-10",children:"SP"}),e.jsx("th",{className:"py-1 text-center w-12",children:"Pts"})]})}),e.jsx("tbody",{children:a[i].map((l,d)=>{const g=t[l.team_id]&&typeof t[l.team_id]=="object"?t[l.team_id]:{id:l.team_id,name:l.team_name||t[l.team_id]||"‚Äî"};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:d+1}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${g.id}`,className:"hover:underline flex items-center gap-2",children:[e.jsx(H,{team:g,size:20}),e.jsx("span",{className:"truncate",children:g.name})]})}),e.jsx("td",{className:"py-1 text-center",children:l.matches_played}),e.jsx("td",{className:"py-1 text-center",children:l.wins}),e.jsx("td",{className:"py-1 text-center",children:l.losses}),e.jsx("td",{className:"py-1 text-center",children:l.sv}),e.jsx("td",{className:"py-1 text-center",children:l.sp}),e.jsx("td",{className:"py-1 text-center font-semibold",children:l.points})]},`${i}-${l.team_id}`)})})]})]},i))})}const Ft=async s=>{try{await h.rpc("seed_initial_standings",{p_sport_name:s,p_reset:!1})}catch(t){console.warn("seed_initial_standings exception:",t)}},It=async s=>{try{console.log("üîÑ Recalculando standings para:",s),await h.rpc("recalculate_standings",{p_sport_name:s}),console.log("‚úÖ Standings recalculadas com sucesso")}catch(t){console.error("Erro ao recalcular standings:",t)}};function qt(){const[s,t]=c.useState(null),[a,o]=c.useState([]),[i,l]=c.useState([]),[d,g]=c.useState([]),[p,v]=c.useState({}),[C,S]=c.useState(!0),[$,R]=c.useState(Date.now()),P=c.useRef(null),f=c.useRef(null),_=c.useRef(!1),E=c.useRef(new Map),N=async()=>{const{data:n}=await h.from("sports").select("id").eq("name","Volei").maybeSingle();n?.id&&t(n.id)},T=async n=>{const{data:m}=await h.from("teams").select("id, name, logo_url, color").eq("sport_id",n);if(m){const u={};for(const j of m)u[j.id]={...j,logo_url:(()=>{const A=be(j.logo_url);return A?`${A}${A.includes("?")?"&":"?"}v=1`:null})()};v(u)}},w=async n=>{const{data:m}=await h.from("matches").select(`
        id,
        stage,
        round,
        group_name,
        starts_at,
        updated_at,
        venue,
        status,
        meta,
        home_score,
        away_score,
        home_team_id,
        away_team_id,
        home:home_team_id ( id, name, logo_url, color ),
        away:away_team_id ( id, name, logo_url, color )
      `).eq("sport_id",n).order("stage",{ascending:!0,nullsFirst:!0}).order("round",{ascending:!0,nullsFirst:!0}).order("starts_at",{ascending:!0,nullsFirst:!0});if(m){const u=m.map(j=>{const A=j.home&&typeof j.home=="object"?{...j.home,logo_url:(()=>{const V=be(j.home.logo_url);return V?`${V}${V.includes("?")?"&":"?"}v=1`:null})()}:j.home,M=j.away&&typeof j.away=="object"?{...j.away,logo_url:(()=>{const V=be(j.away.logo_url);return V?`${V}${V.includes("?")?"&":"?"}v=1`:null})()}:j.away;return{...j,home:A,away:M}});o(u)}},k=async n=>{let m=null;const u=await h.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points").eq("sport_id",n).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});!u.error&&u.data&&(m=u.data),m||(m=((await h.from("standings").select(`
          group_name,
          rank,
          team_id,
          matches_played,
          wins, draws, losses,
          goals_for, goals_against, goal_difference,
          points,
          team:teams!standings_team_id_fkey(name, logo_url, color, id)
        `).eq("sport_id",n).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(A=>({...A,team_name:A.team?.name}))||[]),l(m||[])},I=async n=>{S(!0),await Promise.all([T(n),w(n),k(n),Ft("Volei")]),S(!1)},q=n=>{const m=new Map;let u=!1;n.filter(j=>j.status==="finished").forEach(j=>{const A=j.id,M=`${j.home_score}-${j.away_score}_${j?.meta?.home_sets||0}-${j?.meta?.away_sets||0}`;m.set(A,M);const V=E.current.get(A);V&&V!==M&&(console.log(`üîÑ Detectada mudan√ßa na partida ${j.id}: ${V} ‚Üí ${M}`),u=!0)}),E.current=m,u&&(console.log("üîÑ Mudan√ßas detectadas em partidas finalizadas, recalculando standings..."),It("Volei").then(()=>{s&&k(s)}))};c.useEffect(()=>{N()},[]),c.useEffect(()=>{if(!s)return;I(s),f.current=setInterval(()=>{R(Date.now())},1e3),P.current&&(h.removeChannel(P.current),P.current=null);const n=h.channel("volei-live").on("postgres_changes",{event:"*",schema:"public",table:"match_events"},()=>{console.log("üì° Match events changed, reloading standings..."),k(s)}).on("postgres_changes",{event:"*",schema:"public",table:"matches"},m=>{console.log("üì° Matches changed:",m),I(s)}).on("postgres_changes",{event:"*",schema:"public",table:"standings"},()=>{console.log("üì° Standings changed, reloading..."),k(s)}).subscribe();return P.current=n,()=>{f.current&&clearInterval(f.current),P.current&&h.removeChannel(P.current),P.current=null}},[s]),c.useEffect(()=>{a.length>0&&q(a)},[a]);const U=c.useMemo(()=>Tt(a),[a]);c.useEffect(()=>{g(kt(i,p,U))},[i,p,U]);const b=c.useMemo(()=>{const n=a.filter(m=>m.status==="scheduled"&&(m.group_name||m.home_team_id&&m.away_team_id));return n.sort((m,u)=>{const j=m.starts_at?new Date(m.starts_at).getTime():Number.POSITIVE_INFINITY,A=u.starts_at?new Date(u.starts_at).getTime():Number.POSITIVE_INFINITY;return j-A}),n},[a]),D=c.useMemo(()=>a.filter(n=>n.status==="ongoing"||n.status==="paused"),[a]),J=c.useMemo(()=>{const n=a.filter(m=>m.status==="finished");return n.sort((m,u)=>new Date(u.updated_at||u.starts_at||0)-new Date(m.updated_at||m.starts_at||0)),n},[a]),O=c.useMemo(()=>Mt(a),[a]),G=c.useMemo(()=>O?.semi1&&O.semi1.home_team_id&&O.semi1.away_team_id||O?.semi2&&O.semi2.home_team_id&&O.semi2.away_team_id?null:Dt(d,p),[O,d,p]),z=c.useMemo(()=>{const n=a.filter(m=>m.stage==="grupos");return n.length===0?!1:n.every(m=>m.status==="finished")},[a]),F=O?.semi1?.home_team_id&&O?.semi1?.away_team_id&&O?.semi2?.home_team_id&&O?.semi2?.away_team_id;c.useEffect(()=>{(async()=>s&&z&&(F||_.current||(await h.rpc("maybe_create_knockout",{p_sport_name:"Volei"}),_.current=!0,await I(s))))()},[s,z,F]);const r=c.useMemo(()=>{const n=[];return O.semi1&&O.semi1.home&&O.semi1.away&&O.semi1.home.id&&O.semi1.away.id?n.push({title:"Semifinal 1",home:O.semi1.home,away:O.semi1.away,badge:"Definitivo"}):G?.semi1&&n.push({title:"Semifinal 1 (provis√≥ria) ‚Äî Venc. Grupo A √ó Venc. Grupo B",home:G.semi1.home,away:G.semi1.away,badge:"Provis√≥rio"}),O.semi2&&O.semi2.home&&O.semi2.away&&O.semi2.home.id&&O.semi2.away.id?n.push({title:"Semifinal 2",home:O.semi2.home,away:O.semi2.away,badge:"Definitivo"}):G?.semi2&&n.push({title:"Semifinal 2 (provis√≥ria) ‚Äî Venc. Grupo C √ó Melhor 2¬∫",home:G.semi2.home,away:G.semi2.away,badge:"Provis√≥rio"}),n},[O,G]),x=c.useMemo(()=>{const n=[];return O.final&&O.final.home_team_id&&O.final.away_team_id&&O.final.home&&O.final.away?n.push({title:"Final",home:O.final.home,away:O.final.away,badge:"Definitivo"}):(G||O.semi1||O.semi2)&&n.push({title:"Final (provis√≥ria)",home:{id:"w-s1",name:"Vencedor Semi 1"},away:{id:"w-s2",name:"Vencedor Semi 2"},badge:"Provis√≥rio"}),n},[O,G]),y=c.useMemo(()=>{const n=[];return O.third&&O.third.home_team_id&&O.third.away_team_id&&O.third.home&&O.third.away?n.push({title:"3¬∫ lugar",home:O.third.home,away:O.third.away,badge:"Definitivo"}):(G||O.semi1||O.semi2)&&n.push({title:"3¬∫ lugar (provis√≥rio)",home:{id:"l-s1",name:"Perdedor Semi 1"},away:{id:"l-s2",name:"Perdedor Semi 2"},badge:"Provis√≥rio"}),n},[O,G]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Ns}),e.jsx("h2",{className:"text-2xl font-bold",children:"V√¥lei"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Partidas em ",e.jsx("strong",{children:"um set de 15 pontos"}),", com ",e.jsx("strong",{children:"2 pontos de vantagem"})," para vencer."]})]}),C?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-40 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:Array.from({length:6}).map((n,m)=>e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"},m))})]}):e.jsxs(e.Fragment,{children:[!1,e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Partidas"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Ao vivo / Pausado"}),D.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhuma partida em andamento."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:D.map(n=>e.jsx(ve,{match:n,currentTimestamp:$},n.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Agendados"}),b.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhuma partida agendada."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:b.map(n=>e.jsx(ve,{match:n,currentTimestamp:$},n.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),J.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:J.map(n=>e.jsx(ve,{match:n,currentTimestamp:$},n.id))})]})]})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Informa√ß√µes do campeonato"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Tabela de classifica√ß√£o"}),e.jsx(Rt,{rows:d,teamsById:p})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Chaveamento"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:r.length>0?r.map((n,m)=>e.jsx(Ne,{title:n.title,home:n.home,away:n.away,badge:n.badge},m)):e.jsx("div",{className:"col-span-full text-xs text-gray-500",children:"Chaveamento ainda n√£o dispon√≠vel. Assim que houver classifica√ß√£o suficiente, os confrontos ser√£o exibidos aqui."})}),(x.length>0||y.length>0)&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[x.map((n,m)=>e.jsx(Ne,{title:n.title,home:n.home,away:n.away,badge:n.badge},`f-${m}`)),y.map((n,m)=>e.jsx(Ne,{title:n.title,home:n.home,away:n.away,badge:n.badge},`t-${m}`))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Regulamento"}),e.jsx("div",{className:"border rounded-lg p-3 bg-white text-sm text-gray-700 space-y-2",children:e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Vit√≥ria do jogo:"})," definida por ",e.jsx("strong",{children:"sets"}),"; se empatar em sets, desempata por ",e.jsx("strong",{children:"pontos do placar"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classifica√ß√£o nos grupos:"})," ",e.jsx("strong",{children:"Pts"})," (3 por vit√≥ria) ‚Üì, depois ",e.jsx("strong",{children:"SV"})," ‚Üì, ",e.jsx("strong",{children:"SP"})," ‚Üë, e saldo de pontos ‚Üì."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Dura√ß√£o/placar:"})," partidas em ",e.jsx("strong",{children:"um set de 15 pontos"}),", com ",e.jsx("strong",{children:"2 de vantagem"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," ",e.jsx("em",{children:"Venc. A √ó Venc. B"})," e ",e.jsx("em",{children:"Venc. C √ó Melhor 2¬∫"}),"."]})]})})]})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}const ws="üéÆ‚öΩ",Ot="team-logos",Lt={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Vt="America/Sao_Paulo";function Qe(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Vt,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function Ss(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Ut(s){return typeof s=="string"&&!Ss(s)&&s.trim()!==""}function _e(s){if(!s)return null;if(Ss(s))return s;if(Ut(s)){const{data:t}=h.storage.from(Ot).getPublicUrl(s);return t?.publicUrl||null}return null}function Bt(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const l=Math.floor(i/1e3),d=Math.floor(l/60),g=l%60;return`${d}:${g.toString().padStart(2,"0")}`}function Gt({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function zt({status:s,meta:t}){const a="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[11px] font-medium",o=s==="ongoing"?"bg-green-100 text-green-700":s==="paused"?"bg-yellow-100 text-yellow-700":s==="finished"?"bg-gray-200 text-gray-700":"bg-blue-100 text-blue-700";return e.jsx("span",{className:`${a} ${o}`,children:Lt[s]||s})}function ie({match:s,currentTimestamp:t}){const a=s.home,o=s.away,i=s.status!=="scheduled",l=typeof s.home_score=="number"?s.home_score:0,d=typeof s.away_score=="number"?s.away_score:0,g=s.status==="ongoing"||s.status==="paused",p=g?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(X,{to:`/match/${s.id}`,className:`block border rounded-lg p-3 bg-white hover:bg-gray-50 transition shadow-sm relative overflow-hidden ${p}`,children:[e.jsx(Gt,{status:s.status}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(zt,{status:s.status,meta:s.meta||{}}),g&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["üïê ",Bt(s,t)]}),e.jsxs("span",{className:"text-[11px] text-gray-500",children:[ws," FIFA"]})]}),s.starts_at?e.jsx("span",{className:"text-[11px] text-gray-500",children:Qe(s.starts_at)}):e.jsx("span",{className:"text-[11px] text-gray-400",children:s.venue||""})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:a||{name:"A definir"},size:28}),e.jsx(X,{to:a?.id?`/team/${a.id}`:"#",onClick:v=>{a?.id||v.preventDefault(),v.stopPropagation()},className:`truncate text-sm font-medium hover:underline ${a?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:a?.name||"A definir",children:a?.name||"A definir"})]}),e.jsxs("div",{className:"shrink-0 text-center",children:[i?e.jsxs("span",{className:"font-bold text-lg tabular-nums",children:[l," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",d]}):null,e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase tracking-wide",children:[s.stage||"",s.round?` ¬∑ J${s.round}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx(X,{to:o?.id?`/team/${o.id}`:"#",onClick:v=>{o?.id||v.preventDefault(),v.stopPropagation()},className:`truncate text-sm font-medium hover:underline text-right ${o?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:o?.name||"A definir",children:o?.name||"A definir"}),e.jsx(H,{team:o||{name:"A definir"},size:28})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.venue||""}),s.status==="finished"&&s.updated_at?e.jsxs("span",{children:["Encerrado em ",Qe(s.updated_at)]}):null]})]})}function Jt(s){const t=d=>(s||[]).filter(g=>g.stage===d).sort((g,p)=>(g.round||0)-(p.round||0)),a=t("oitavas"),o=t("quartas"),i=t("semi"),l=t("final");return{oitavas:a,quartas:o,semis:i,final:l[0]}}const Kt=async s=>{try{await h.rpc("seed_initial_standings",{p_sport_name:s,p_reset:!1})}catch(t){console.warn("seed_initial_standings exception:",t)}};function Xt(){const[s,t]=c.useState(null),[a,o]=c.useState([]),[i,l]=c.useState({}),[d,g]=c.useState(!0),[p,v]=c.useState(Date.now()),C=c.useRef(null),S=c.useRef(null),$=async()=>{const{data:w}=await h.from("sports").select("id").eq("name","FIFA").maybeSingle();w?.id&&t(w.id)},R=async w=>{const{data:k}=await h.from("teams").select("id, name, logo_url, color").eq("sport_id",w);if(k){const I={};for(const q of k)I[q.id]={...q,logo_url:(()=>{const U=_e(q.logo_url);return U?`${U}${U.includes("?")?"&":"?"}v=1`:null})()};l(I)}},P=async w=>{const{data:k}=await h.from("matches").select(`
        id,
        stage,
        round,
        starts_at,
        updated_at,
        venue,
        status,
        meta,
        home_score,
        away_score,
        home_team_id,
        away_team_id,
        home:home_team_id ( id, name, logo_url, color ),
        away:away_team_id ( id, name, logo_url, color )
      `).eq("sport_id",w).order("stage",{ascending:!0,nullsFirst:!0}).order("round",{ascending:!0,nullsFirst:!0});if(k){const I=k.map(q=>{const U=q.home&&typeof q.home=="object"?{...q.home,logo_url:(()=>{const D=_e(q.home.logo_url);return D?`${D}${D.includes("?")?"&":"?"}v=1`:null})()}:q.home,b=q.away&&typeof q.away=="object"?{...q.away,logo_url:(()=>{const D=_e(q.away.logo_url);return D?`${D}${D.includes("?")?"&":"?"}v=1`:null})()}:q.away;return{...q,home:U,away:b}});o(I)}},f=async w=>{g(!0),await Promise.all([R(w),P(w),Kt("FIFA")]),g(!1)};c.useEffect(()=>{$()},[]),c.useEffect(()=>{if(!s)return;f(s),S.current=setInterval(()=>{v(Date.now())},1e3),C.current&&(h.removeChannel(C.current),C.current=null);const w=h.channel("fifa-live").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>f(s)).subscribe();return C.current=w,()=>{S.current&&clearInterval(S.current),C.current&&h.removeChannel(C.current),C.current=null}},[s]);const _=c.useMemo(()=>Jt(a),[a]),E=c.useMemo(()=>a.filter(w=>w.status==="ongoing"||w.status==="paused"),[a]),N=c.useMemo(()=>{const w=a.filter(k=>k.status==="scheduled"&&k.home?.id&&k.away?.id);return w.sort((k,I)=>{const q=k.starts_at?new Date(k.starts_at).getTime():Number.POSITIVE_INFINITY,U=I.starts_at?new Date(I.starts_at).getTime():Number.POSITIVE_INFINITY;return q-U}),w},[a]),T=c.useMemo(()=>{const w=a.filter(k=>k.status==="finished");return w.sort((k,I)=>new Date(I.updated_at||I.starts_at||0)-new Date(k.updated_at||k.starts_at||0)),w},[a]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:ws}),e.jsx("h2",{className:"text-2xl font-bold",children:"FIFA"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Torneio de mata-mata eliminat√≥rio. Toque em uma partida para ver detalhes (status, tempo). Toque no time para abrir a p√°gina do time."})]}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-40 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:Array.from({length:6}).map((w,k)=>e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"},k))})]}):e.jsxs(e.Fragment,{children:[(E.length>0||N.length>0||T.length>0)&&e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Partidas"}),e.jsxs("div",{className:"space-y-4",children:[E.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Ao vivo / Pausado"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:E.map(w=>e.jsx(ie,{match:w,currentTimestamp:p},w.id))})]}),N.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Agendados"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:N.map(w=>e.jsx(ie,{match:w,currentTimestamp:p},w.id))})]}),T.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:T.map(w=>e.jsx(ie,{match:w,currentTimestamp:p},w.id))})]})]})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Oitavas de final"}),_.oitavas&&_.oitavas.length>0?e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:_.oitavas.map(w=>e.jsx(ie,{match:w,currentTimestamp:p},w.id))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem confrontos nas oitavas."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Quartas de final"}),_.quartas&&_.quartas.length>0?e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:_.quartas.map(w=>e.jsx(ie,{match:w,currentTimestamp:p},w.id))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem confrontos nas quartas."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),_.semis&&_.semis.length>0?e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:_.semis.map(w=>e.jsx(ie,{match:w,currentTimestamp:p},w.id))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem confrontos nas semifinais."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),_.final?e.jsx(ie,{match:_.final,currentTimestamp:p}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem confronto final ainda."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Regulamento"}),e.jsx("div",{className:"border rounded-lg p-3 bg-white text-sm text-gray-700 space-y-2",children:e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," torneio de ",e.jsx("strong",{children:"mata-mata eliminat√≥rio"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estrutura:"})," oitavas ‚Üí quartas ‚Üí semifinais ‚Üí final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Elimina√ß√£o:"})," quem perde est√° ",e.jsx("strong",{children:"fora do torneio"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Partidas:"})," jogo √∫nico por confronto."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate:"})," pode haver prorroga√ß√£o e/ou p√™naltis conforme necess√°rio."]})]})})]})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}const $s="üéÆ",Ht="team-logos",Qt={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Yt="America/Sao_Paulo";function Ye(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Yt,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function Cs(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Zt(s){return typeof s=="string"&&!Cs(s)&&s.trim()!==""}function we(s){if(!s)return null;if(Cs(s))return s;if(Zt(s)){const{data:t}=h.storage.from(Ht).getPublicUrl(s);return t?.publicUrl||null}return null}function Wt(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const l=Math.floor(i/1e3),d=Math.floor(l/60),g=l%60;return`${d}:${g.toString().padStart(2,"0")}`}function ea({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function sa({status:s,meta:t}){const a="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[11px] font-medium",o=s==="ongoing"?"bg-green-100 text-green-700":s==="paused"?"bg-yellow-100 text-yellow-700":s==="finished"?"bg-gray-200 text-gray-700":"bg-blue-100 text-blue-700";return e.jsx("span",{className:`${a} ${o}`,children:Qt[s]||s})}function Se({match:s,currentTimestamp:t}){const a=s.home,o=s.away,i=s.status!=="scheduled",l=s.status==="ongoing"||s.status==="paused",d=l?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(X,{to:`/match/${s.id}`,className:`block border rounded-lg p-3 bg-white hover:bg-gray-50 transition shadow-sm relative overflow-hidden ${d}`,children:[e.jsx(ea,{status:s.status}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(sa,{status:s.status,meta:s.meta||{}}),l&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["üïê ",Wt(s,t)]}),e.jsxs("span",{className:"text-[11px] text-gray-500",children:[$s," Pebolim"]})]}),s.starts_at?e.jsx("span",{className:"text-[11px] text-gray-500",children:Ye(s.starts_at)}):e.jsx("span",{className:"text-[11px] text-gray-400",children:s.venue||""})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:a||{name:"A definir"},size:28}),e.jsx(X,{to:a?.id?`/team/${a.id}`:"#",onClick:g=>{a?.id||g.preventDefault(),g.stopPropagation()},className:`truncate text-sm font-medium hover:underline ${a?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:a?.name||"A definir",children:a?.name||"A definir"})]}),e.jsxs("div",{className:"shrink-0 text-center",children:[i?e.jsxs("span",{className:"font-bold text-lg tabular-nums",children:[s.home_score??0," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",s.away_score??0]}):null,e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase tracking-wide",children:[s.stage||"",s.round?` ¬∑ J${s.round}`:"",s.group_name?` ¬∑ G${s.group_name}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx(X,{to:o?.id?`/team/${o.id}`:"#",onClick:g=>{o?.id||g.preventDefault(),g.stopPropagation()},className:`truncate text-sm font-medium hover:underline text-right ${o?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:o?.name||"A definir",children:o?.name||"A definir"}),e.jsx(H,{team:o||{name:"A definir"},size:28})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.venue||""}),s.status==="finished"&&s.updated_at?e.jsxs("span",{children:["Encerrado em ",Ye(s.updated_at)]}):null]})]})}function $e({title:s,home:t,away:a,badge:o}){const i=t||{},l=a||{};return e.jsxs("div",{className:"rounded-lg border p-3 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-[11px] font-semibold text-gray-500",children:s}),o&&e.jsx("span",{className:`text-[10px] uppercase tracking-wide px-2 py-0.5 rounded ${o==="Definitivo"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:o})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:i.id?i:{name:"A definir"},size:24}),e.jsx("span",{className:`truncate text-sm ${i.id?"text-gray-900":"text-gray-400"}`,title:i.name||"A definir",children:i.name||"A definir"})]}),e.jsx("div",{className:"text-gray-400 text-xs",children:"vs"}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx("span",{className:`truncate text-sm text-right ${l.id?"text-gray-900":"text-gray-400"}`,title:l.name||"A definir",children:l.name||"A definir"}),e.jsx(H,{team:l.id?l:{name:"A definir"},size:24})]})]})]})}function ta(s,t){if(!Array.isArray(s)||s.length===0)return null;const a=w=>({id:w,name:t[w]?.name||t[w]||"‚Äî",logo_url:t[w]?.logo_url,color:t[w]?.color}),o=w=>s.find(k=>k.group_name===w&&k.rank===1),i=o("A"),l=o("B"),d=o("C"),g=o("D"),p=o("E"),v=o("F"),C=o("G"),S=o("H");if(!(i&&l&&d&&g&&p&&v&&C&&S))return null;const $={home:a(i.team_id),away:a(l.team_id)},R={home:a(d.team_id),away:a(g.team_id)},P={home:a(p.team_id),away:a(v.team_id)},f={home:a(C.team_id),away:a(S.team_id)};return{quarters:[$,R,P,f],semis:[{home:{id:"v1",name:"Vencedor 1"},away:{id:"v2",name:"Vencedor 2"}},{home:{id:"v3",name:"Vencedor 3"},away:{id:"v4",name:"Vencedor 4"}}]}}function aa(s){const t=l=>(s||[]).filter(d=>d.stage===l).sort((d,g)=>(d.round||0)-(g.round||0)),a=t("quartas"),o=t("semi"),i=t("final");return{q1:a[0],q2:a[1],q3:a[2],q4:a[3],semi1:o[0],semi2:o[1],final:i[0]}}function ra({standings:s,teamsById:t}){const a=c.useMemo(()=>{const i={};for(const l of s||[]){const d=l.group_name||"-";i[d]||(i[d]=[]),i[d].push(l)}for(const l of Object.keys(i))i[l].sort((d,g)=>(d.rank||99)-(g.rank||99));return i},[s]),o=Object.keys(a).sort();return o.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classifica√ß√£o."}):e.jsx("div",{className:"space-y-6",children:o.map(i=>e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"px-3 py-2 bg-gray-50 border-b text-sm font-semibold",children:["Grupo ",i]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"py-1 pl-3 text-left w-10",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"py-1 text-center w-10",children:"P"}),e.jsx("th",{className:"py-1 text-center w-10",children:"V"}),e.jsx("th",{className:"py-1 text-center w-10",children:"E"}),e.jsx("th",{className:"py-1 text-center w-10",children:"D"}),e.jsx("th",{className:"py-1 text-center w-10",children:"GP"}),e.jsx("th",{className:"py-1 text-center w-10",children:"GC"}),e.jsx("th",{className:"py-1 text-center w-12",children:"+/-"}),e.jsx("th",{className:"py-1 text-center w-12",children:"Pts"})]})}),e.jsx("tbody",{children:a[i].map(l=>{const d=t[l.team_id]&&typeof t[l.team_id]=="object"?t[l.team_id]:{id:l.team_id,name:l.team_name||t[l.team_id]||"‚Äî"};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:l.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${d.id}`,className:"hover:underline flex items-center gap-2",children:[e.jsx(H,{team:d,size:20}),e.jsx("span",{className:"truncate",children:d.name})]})}),e.jsx("td",{className:"py-1 text-center",children:l.matches_played}),e.jsx("td",{className:"py-1 text-center",children:l.wins}),e.jsx("td",{className:"py-1 text-center",children:l.draws}),e.jsx("td",{className:"py-1 text-center",children:l.losses}),e.jsx("td",{className:"py-1 text-center",children:l.goals_for}),e.jsx("td",{className:"py-1 text-center",children:l.goals_against}),e.jsx("td",{className:"py-1 text-center",children:l.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:l.points})]},`${i}-${l.rank}-${l.team_id}`)})})]})]},i))})}const na=async s=>{try{await h.rpc("seed_initial_standings",{p_sport_name:s,p_reset:!1})}catch(t){console.warn("seed_initial_standings exception:",t)}},oa=async s=>{try{console.log("üîÑ Recalculando standings para:",s),await h.rpc("recalculate_standings",{p_sport_name:s}),console.log("‚úÖ Standings recalculadas com sucesso")}catch(t){console.error("Erro ao recalcular standings:",t)}};function ia(){const[s,t]=c.useState(null),[a,o]=c.useState([]),[i,l]=c.useState([]),[d,g]=c.useState({}),[p,v]=c.useState(!0),[C,S]=c.useState(Date.now()),$=c.useRef(null),R=c.useRef(null),P=c.useRef(!1),f=c.useRef(new Map),_=async()=>{const{data:F}=await h.from("sports").select("id").eq("name","Pebolim").maybeSingle();F?.id&&t(F.id)},E=async F=>{const{data:r}=await h.from("teams").select("id, name, logo_url, color").eq("sport_id",F);if(r){const x={};for(const y of r)x[y.id]={...y,logo_url:(()=>{const n=we(y.logo_url);return n?`${n}${n.includes("?")?"&":"?"}v=1`:null})()};g(x)}},N=async F=>{const{data:r}=await h.from("matches").select(`
        id,
        stage,
        round,
        group_name,
        starts_at,
        updated_at,
        venue,
        status,
        meta,
        home_score,
        away_score,
        home_team_id,
        away_team_id,
        home:home_team_id ( id, name, logo_url, color ),
        away:away_team_id ( id, name, logo_url, color )
      `).eq("sport_id",F).order("stage",{ascending:!0,nullsFirst:!0}).order("round",{ascending:!0,nullsFirst:!0}).order("starts_at",{ascending:!0,nullsFirst:!0});if(r){const x=r.map(y=>{const n=y.home&&typeof y.home=="object"?{...y.home,logo_url:(()=>{const u=we(y.home.logo_url);return u?`${u}${u.includes("?")?"&":"?"}v=1`:null})()}:y.home,m=y.away&&typeof y.away=="object"?{...y.away,logo_url:(()=>{const u=we(y.away.logo_url);return u?`${u}${u.includes("?")?"&":"?"}v=1`:null})()}:y.away;return{...y,home:n,away:m}});o(x)}},T=async F=>{let r=null;const x=await h.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points").eq("sport_id",F).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});!x.error&&x.data&&(r=x.data),r||(r=((await h.from("standings").select(`
          group_name,
          rank,
          team_id,
          matches_played,
          wins, draws, losses,
          goals_for, goals_against, goal_difference,
          points,
          team:teams!standings_team_id_fkey(name, logo_url, color, id)
        `).eq("sport_id",F).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(n=>({...n,team_name:n.team?.name}))||[]),l(r||[])},w=async F=>{v(!0),await Promise.all([E(F),N(F),T(F),na("Pebolim")]),v(!1)},k=F=>{const r=new Map;let x=!1;F.filter(y=>y.status==="finished").forEach(y=>{const n=y.id,m=`${y.home_score}-${y.away_score}`;r.set(n,m);const u=f.current.get(n);u&&u!==m&&(console.log(`üîÑ Detectada mudan√ßa no placar da partida ${y.id}: ${u} ‚Üí ${m}`),x=!0)}),f.current=r,x&&(console.log("üîÑ Mudan√ßas detectadas em partidas finalizadas, recalculando standings..."),oa("Pebolim").then(()=>{s&&T(s)}))};c.useEffect(()=>{_()},[]),c.useEffect(()=>{if(!s)return;w(s),R.current=setInterval(()=>{S(Date.now())},1e3),$.current&&(h.removeChannel($.current),$.current=null);const F=h.channel("pebolim-live").on("postgres_changes",{event:"*",schema:"public",table:"match_events"},()=>{console.log("üì° Match events changed, reloading standings..."),T(s)}).on("postgres_changes",{event:"*",schema:"public",table:"matches"},r=>{console.log("üì° Matches changed:",r),w(s)}).on("postgres_changes",{event:"*",schema:"public",table:"standings"},()=>{console.log("üì° Standings changed, reloading..."),T(s)}).subscribe();return $.current=F,()=>{R.current&&clearInterval(R.current),$.current&&h.removeChannel($.current),$.current=null}},[s]),c.useEffect(()=>{a.length>0&&k(a)},[a]);const I=c.useMemo(()=>{const F=a.filter(r=>r.status==="scheduled"&&(r.group_name||r.home_team_id&&r.away_team_id));return F.sort((r,x)=>{const y=r.starts_at?new Date(r.starts_at).getTime():Number.POSITIVE_INFINITY,n=x.starts_at?new Date(x.starts_at).getTime():Number.POSITIVE_INFINITY;return y-n}),F},[a]),q=c.useMemo(()=>a.filter(F=>F.status==="ongoing"||F.status==="paused"),[a]),U=c.useMemo(()=>{const F=a.filter(r=>r.status==="finished");return F.sort((r,x)=>new Date(x.updated_at||x.starts_at||0)-new Date(r.updated_at||r.starts_at||0)),F},[a]),b=c.useMemo(()=>aa(a),[a]),D=c.useMemo(()=>b?.q1&&b.q1.home&&b.q1.away||b?.semi1&&b.semi1.home&&b.semi1.away?null:ta(i,d),[b,i,d]),J=c.useMemo(()=>{const F=a.filter(r=>r.stage==="grupos");return F.length===0?!1:F.every(r=>r.status==="finished")},[a]),O=b?.q1?.home&&b?.q1?.away&&b?.q2?.home&&b?.q2?.away&&b?.q3?.home&&b?.q3?.away&&b?.q4?.home&&b?.q4?.away;c.useEffect(()=>{(async()=>s&&J&&(O||P.current||(await h.rpc("maybe_create_knockout",{p_sport_name:"Pebolim"}),P.current=!0,await w(s))))()},[s,J,O]);const G=c.useMemo(()=>{const F=[],r=(y,n)=>{const m=b[y];return m&&m.home&&m.away?(F.push({title:n,home:m.home,away:m.away,badge:"Definitivo"}),!0):!1},x=(y,n)=>{D?.quarters?.[y]&&F.push({title:`${n} (provis√≥ria)`,home:D.quarters[y].home,away:D.quarters[y].away,badge:"Provis√≥rio"})};return r("q1","Quartas 1 ‚Äî A√óB (Vencedor 1)")||x(0,"Quartas 1"),r("q2","Quartas 2 ‚Äî C√óD (Vencedor 2)")||x(1,"Quartas 2"),r("q3","Quartas 3 ‚Äî E√óF (Vencedor 3)")||x(2,"Quartas 3"),r("q4","Quartas 4 ‚Äî G√óH (Vencedor 4)")||x(3,"Quartas 4"),F},[b,D]),z=c.useMemo(()=>{const F=[];b.semi1&&b.semi1.home&&b.semi1.away?F.push({title:"Semifinal 1 ‚Äî Vencedor 1 √ó Vencedor 2",home:b.semi1.home,away:b.semi1.away,badge:"Definitivo"}):D?.semis?.[0]&&F.push({title:"Semifinal 1 (provis√≥ria) ‚Äî Vencedor 1 √ó Vencedor 2",home:D.semis[0].home,away:D.semis[0].away,badge:"Provis√≥rio"}),b.semi2&&b.semi2.home&&b.semi2.away?F.push({title:"Semifinal 2 ‚Äî Vencedor 3 √ó Vencedor 4",home:b.semi2.home,away:b.semi2.away,badge:"Definitivo"}):D?.semis?.[1]&&F.push({title:"Semifinal 2 (provis√≥ria) ‚Äî Vencedor 3 √ó Vencedor 4",home:D.semis[1].home,away:D.semis[1].away,badge:"Provis√≥rio"});const r=[];return b.final&&b.final.home&&b.final.away&&r.push({title:"Final",home:b.final.home,away:b.final.away,badge:"Definitivo"}),{semiCards:F,finalCards:r}},[b,D]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:$s}),e.jsx("h2",{className:"text-2xl font-bold",children:"Pebolim"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Partidas em ",e.jsx("strong",{children:"1 rodada de 4 gols"}),". Tabela de pontos igual ao futsal (3-1-0)."]})]}),p?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-40 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:Array.from({length:6}).map((F,r)=>e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"},r))})]}):e.jsxs(e.Fragment,{children:[!1,e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Partidas"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Ao vivo / Pausado"}),q.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhuma partida em andamento."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:q.map(F=>e.jsx(Se,{match:F,currentTimestamp:C},F.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Agendados"}),I.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhuma partida agendada."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:I.map(F=>e.jsx(Se,{match:F,currentTimestamp:C},F.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),U.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:U.map(F=>e.jsx(Se,{match:F,currentTimestamp:C},F.id))})]})]})]}),e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Informa√ß√µes do campeonato"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Tabela de classifica√ß√£o"}),e.jsx(ra,{standings:i,teamsById:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Chaveamento"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:G.length>0?G.map((F,r)=>e.jsx($e,{title:F.title,home:F.home,away:F.away,badge:F.badge},r)):e.jsx("div",{className:"col-span-full text-xs text-gray-500",children:"Chaveamento ainda n√£o dispon√≠vel. Assim que houver classifica√ß√£o suficiente, os confrontos ser√£o exibidos aqui."})}),(z.semiCards.length>0||z.finalCards.length>0)&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-3 mt-2",children:[z.semiCards.map((F,r)=>e.jsx($e,{title:F.title,home:F.home,away:F.away,badge:F.badge},`s-${r}`)),z.finalCards.map((F,r)=>e.jsx($e,{title:F.title,home:F.home,away:F.away,badge:F.badge},`f-${r}`))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Regulamento"}),e.jsx("div",{className:"border rounded-lg p-3 bg-white text-sm text-gray-700 space-y-2",children:e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Dura√ß√£o/placar:"})," partidas com"," ",e.jsx("strong",{children:"1 rodada de 4 gols"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Duplas:"})," cada partida √© disputada por ",e.jsx("strong",{children:"2 duplas"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos e mata-mata."," ",e.jsx("strong",{children:"8 grupos de 3 duplas"}),"; avan√ßa o ",e.jsx("strong",{children:"1¬∫"})," de cada grupo."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Tabela de pontos:"})," vit√≥ria ",e.jsx("strong",{children:"3 pts"}),", empate"," ",e.jsx("strong",{children:"1 pt"}),", derrota ",e.jsx("strong",{children:"0 pt"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate nos grupos:"})," ",e.jsx("strong",{children:"saldo de gols"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," 4 quartas de final, 2 semifinais e 1 final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Quartas:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Q1:"})," Vencedor A √ó Vencedor B = ",e.jsx("em",{children:"Vencedor 1"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Q2:"})," Vencedor C √ó Vencedor D = ",e.jsx("em",{children:"Vencedor 2"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Q3:"})," Vencedor E √ó Vencedor F = ",e.jsx("em",{children:"Vencedor 3"})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Q4:"})," Vencedor G √ó Vencedor H = ",e.jsx("em",{children:"Vencedor 4"})]})]})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," ",e.jsx("em",{children:"Vencedor 1 √ó Vencedor 2"})," e"," ",e.jsx("em",{children:"Vencedor 3 √ó Vencedor 4"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substitui√ß√µes:"})," os integrantes da dupla"," ",e.jsx("strong",{children:"n√£o podem ser substitu√≠dos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"WO:"})," atraso de at√© ",e.jsx("strong",{children:"3 minutos"})," √© tolerado; aus√™ncia de um ou mais integrantes resulta em ",e.jsx("strong",{children:"WO"}),"."]})]})})]})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}const la="team-logos";function Es(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function ca(s){return typeof s=="string"&&!Es(s)&&s.trim()!==""}function Ce(s){if(!s)return null;if(Es(s))return s;if(ca(s)){const{data:t}=h.storage.from(la).getPublicUrl(s);return t?.publicUrl||null}return null}const da={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},ma={grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3¬∫ lugar"},ua="America/Sao_Paulo";function ga(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:ua,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function xa(s){return s?ma[s]||s[0]?.toUpperCase()+s.slice(1):""}function ha(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const l=Math.floor(i/1e3),d=Math.floor(l/60),g=l%60;return`${d}:${g.toString().padStart(2,"0")}`}function pa({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Ee({match:s,currentTimestamp:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),o=Number(s?.meta?.home_sets??0),i=Number(s?.meta?.away_sets??0),l=o>0||i>0,d=a||l,g=s?.status&&s.status!=="scheduled",p=Number(s?.home_score??0),v=Number(s?.away_score??0),C=s?.status==="ongoing"||s?.status==="paused",S=C?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(X,{to:`/match/${s.id}`,className:`block bg-white border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden ${S}`,children:[e.jsx(pa,{status:s.status}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.sport?.name}),s.group_name?` ‚Ä¢ Grupo ${s.group_name}`:"",s.stage?` ‚Ä¢ ${xa(s.stage)}`:"",s.round?` ‚Ä¢ J${s.round}`:"",C&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["üïê ",ha(s,t)]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[11px] font-medium ${s.status==="ongoing"?"bg-green-100 text-green-700":s.status==="paused"?"bg-yellow-100 text-yellow-700":s.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:da[s.status]||s.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:s.home||{name:"A definir"},size:24}),e.jsx("span",{className:"font-medium truncate text-sm",children:s.home?.name||"A definir"})]}),e.jsxs("div",{className:"text-center px-3",children:[d&&e.jsx("div",{className:"text-xs font-semibold tabular-nums mb-1",children:e.jsxs("span",{className:`${g?"":"text-gray-400"}`,children:["Sets: ",o," x ",i]})}),g?e.jsxs("div",{className:"text-lg font-bold tabular-nums",children:[p," x ",v]}):e.jsx("div",{className:"text-sm text-gray-400",children:"‚Äî"})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx("span",{className:"font-medium truncate text-sm text-right",children:s.away?.name||"A definir"}),e.jsx(H,{team:s.away||{name:"A definir"},size:24})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center justify-between",children:[e.jsx("span",{children:s.starts_at?ga(s.starts_at):"Data a definir"}),s.venue&&e.jsx("span",{children:s.venue})]})]})}function Ze(){const{id:s}=xs(),[t,a]=c.useState(null),[o,i]=c.useState([]),[l,d]=c.useState([]),[g,p]=c.useState(!0),[v,C]=c.useState(Date.now()),S=c.useRef(null),$=c.useRef(null),R=async()=>{p(!0);try{const{data:f,error:_}=await h.from("teams").select("id, name, logo_url, color").eq("id",s).maybeSingle();if(_){console.error("Erro ao carregar time:",_);return}if(f){const k={...f,logo_url:(()=>{const I=Ce(f.logo_url);return I?`${I}${I.includes("?")?"&":"?"}v=1`:null})()};a(k)}const{data:E,error:N}=await h.from("players").select("id, name, number").eq("team_id",s).order("number",{ascending:!0,nullsFirst:!0}).order("name");!N&&E&&i(E);const{data:T,error:w}=await h.from("matches").select(`
          id, stage, round, group_name, starts_at, venue, status, 
          home_score, away_score, meta, updated_at,
          sport:sport_id ( id, name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `).or(`home_team_id.eq.${s},away_team_id.eq.${s}`).order("starts_at",{ascending:!1});if(!w&&T){const k=T.map(I=>{const q=I.home&&typeof I.home=="object"?{...I.home,logo_url:(()=>{const b=Ce(I.home.logo_url);return b?`${b}${b.includes("?")?"&":"?"}v=1`:null})()}:I.home,U=I.away&&typeof I.away=="object"?{...I.away,logo_url:(()=>{const b=Ce(I.away.logo_url);return b?`${b}${b.includes("?")?"&":"?"}v=1`:null})()}:I.away;return{...I,home:q,away:U}});d(k)}}finally{p(!1)}};c.useEffect(()=>{R(),$.current=setInterval(()=>{C(Date.now())},1e3),S.current&&(h.removeChannel(S.current),S.current=null);const f=h.channel(`team-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>R()).on("postgres_changes",{event:"*",schema:"public",table:"teams",filter:`id=eq.${s}`},()=>R()).on("postgres_changes",{event:"*",schema:"public",table:"players",filter:`team_id=eq.${s}`},()=>R()).subscribe();return S.current=f,()=>{$.current&&clearInterval($.current),S.current&&h.removeChannel(S.current),S.current=null}},[s]);const P=c.useMemo(()=>{const f={ongoing:[],paused:[],scheduled:[],finished:[]};return l.forEach(_=>{f[_.status]?f[_.status].push(_):f.finished.push(_)}),f},[l]);return g?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"})]})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(H,{team:t,size:64}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.name}),e.jsxs("p",{className:"text-gray-500",children:[l.length," partida",l.length!==1?"s":""," registrada",l.length!==1?"s":""]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Elenco"}),o.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"space-y-2",children:o.map(f=>e.jsxs("li",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"font-medium",children:f.name}),e.jsx("span",{className:"text-gray-500 text-sm tabular-nums",children:f.number?`#${f.number}`:"‚Äî"})]},f.id))})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Estat√≠sticas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:P.ongoing.length+P.paused.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ao vivo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:P.scheduled.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Agendadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:P.finished.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Finalizadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:o.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Jogadores"})]})]})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Partidas"}),l.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma partida registrada."}):e.jsxs("div",{className:"space-y-4",children:[(P.ongoing.length>0||P.paused.length>0)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"üî¥ Ao vivo"}),e.jsx("div",{className:"space-y-2",children:[...P.ongoing,...P.paused].map(f=>e.jsx(Ee,{match:f,currentTimestamp:v},f.id))})]}),P.scheduled.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"üìÖ Pr√≥ximas partidas"}),e.jsx("div",{className:"space-y-2",children:P.scheduled.map(f=>e.jsx(Ee,{match:f,currentTimestamp:v},f.id))})]}),P.finished.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"‚úÖ Finalizadas"}),e.jsx("div",{className:"space-y-2",children:P.finished.slice(0,5).map(f=>e.jsx(Ee,{match:f,currentTimestamp:v},f.id))}),P.finished.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["... e mais ",P.finished.length-5," partida",P.finished.length-5!==1?"s":""]})]})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-600",children:"Time n√£o encontrado"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"O time solicitado n√£o existe ou foi removido."})]})}const As={Futsal:"‚öΩ",Volei:"üèê",FIFA:"üéÆ‚öΩ",Pebolim:"üéÆ"},We=["Futsal","Volei","FIFA","Pebolim"],De=["ongoing","paused"],fa="team-logos",ya={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},ja="America/Sao_Paulo";function es(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:ja,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function Ps(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function ba(s){return typeof s=="string"&&!Ps(s)&&s.trim()!==""}function ss(s){if(!s)return null;if(Ps(s))return s;if(ba(s)){const{data:t}=h.storage.from(fa).getPublicUrl(s);return t?.publicUrl||null}return null}function va(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const l=Math.floor(i/1e3),d=Math.floor(l/60),g=l%60;return`${d}:${g.toString().padStart(2,"0")}`}function Na({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function _a({status:s,meta:t}){const a="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[11px] font-medium",o=s==="ongoing"?"bg-green-100 text-green-700":s==="paused"?"bg-yellow-100 text-yellow-700":s==="finished"?"bg-gray-200 text-gray-700":"bg-blue-100 text-blue-700";return e.jsx("span",{className:`${a} ${o}`,children:ya[s]||s})}function wa({match:s,currentTimestamp:t}){const a=s.home,o=s.away,i=s.status!=="scheduled",l=typeof s.home_score=="number"?s.home_score:0,d=typeof s.away_score=="number"?s.away_score:0,g=s.status==="ongoing"||s.status==="paused",p=g?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(X,{to:`/match/${s.id}`,className:`block border rounded-lg p-3 bg-white hover:bg-gray-50 transition shadow-sm relative overflow-hidden ${p}`,children:[e.jsx(Na,{status:s.status}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_a,{status:s.status,meta:s.meta}),g&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["üïê ",va(s,t)]}),e.jsx("span",{className:"text-[11px] text-gray-500",children:As[s.sport?.name]||"üèÜ"})]}),e.jsx("span",{className:"text-[11px] text-gray-500",children:s.starts_at?es(s.starts_at):s.venue||""})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:a||{name:"A definir"},size:28}),e.jsx(X,{to:a?.id?`/team/${a.id}`:"#",onClick:v=>{a?.id||v.preventDefault(),v.stopPropagation()},className:`truncate text-sm font-medium hover:underline ${a?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:a?.name||"A definir",children:a?.name||"A definir"})]}),e.jsxs("div",{className:"shrink-0 text-center",children:[i?e.jsxs("span",{className:"font-bold text-lg tabular-nums",children:[l," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",d]}):null,e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase tracking-wide",children:[s.stage||"",s.round?` ¬∑ J${s.round}`:"",s.group_name?` ¬∑ G${s.group_name}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx(X,{to:o?.id?`/team/${o.id}`:"#",onClick:v=>{o?.id||v.preventDefault(),v.stopPropagation()},className:`truncate text-sm font-medium hover:underline text-right ${o?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:o?.name||"A definir",children:o?.name||"A definir"}),e.jsx(H,{team:o||{name:"A definir"},size:28})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.venue||""}),s.status==="finished"&&s.updated_at?e.jsxs("span",{children:["Encerrado em ",es(s.updated_at)]}):null]})]})}function Sa({sportName:s,matches:t,currentTimestamp:a}){const o=As[s]||"üèÜ",i=t.filter(l=>De.includes(l.status));return i.length===0?null:e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:o}),e.jsx("h3",{className:"text-lg font-bold",children:s}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",i.length," ao vivo)"]})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:i.map(l=>e.jsx(wa,{match:l,currentTimestamp:a},l.id))})]})}function $a(){const[s,t]=c.useState(!0),[a,o]=c.useState({}),[i,l]=c.useState(Date.now()),d=c.useRef(null),g=c.useRef(null),p=async()=>{t(!0);const{data:S,error:$}=await h.from("matches").select(`
        id,
        sport:sport_id ( id, name ),
        stage, round, group_name,
        starts_at, updated_at, venue, status, meta,
        home_score, away_score,
        home:home_team_id ( id, name, logo_url, color ),
        away:away_team_id ( id, name, logo_url, color )
      `).in("status",De).order("updated_at",{ascending:!1,nullsFirst:!0});if($){console.error($),o({}),t(!1);return}const R={};for(const P of S||[]){const f=P.sport?.name||"Outros";R[f]||(R[f]=[]);const _={...P,home:P.home&&typeof P.home=="object"?{...P.home,logo_url:(()=>{const E=ss(P.home.logo_url);return E?`${E}${E.includes("?")?"&":"?"}v=1`:null})()}:P.home,away:P.away&&typeof P.away=="object"?{...P.away,logo_url:(()=>{const E=ss(P.away.logo_url);return E?`${E}${E.includes("?")?"&":"?"}v=1`:null})()}:P.away};R[f].push(_)}o(R),t(!1)};c.useEffect(()=>{p(),g.current=setInterval(()=>{l(Date.now())},1e3),d.current&&(h.removeChannel(d.current),d.current=null);const S=h.channel("home-live").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>p()).subscribe();return d.current=S,()=>{g.current&&clearInterval(g.current),d.current&&h.removeChannel(d.current),d.current=null}},[]);const v=c.useMemo(()=>{const S=Object.keys(a),$=We.filter(P=>S.includes(P)),R=S.filter(P=>!We.includes(P)).sort();return[...$,...R]},[a]),C=v.reduce((S,$)=>S+(a[$]?.filter(R=>De.includes(R.status)).length||0),0);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"üî¥"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Ao vivo agora"}),C>0&&e.jsxs("span",{className:"bg-red-100 text-red-700 px-2 py-1 rounded text-sm font-medium",children:[C," partida",C!==1?"s":""]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Veja as partidas em andamento em tempo real. Os tempos s√£o atualizados automaticamente."})]}),s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-40 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:Array.from({length:4}).map((S,$)=>e.jsx("div",{className:"h-24 bg-gray-100 rounded animate-pulse"},$))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-32 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:Array.from({length:2}).map((S,$)=>e.jsx("div",{className:"h-24 bg-gray-100 rounded animate-pulse"},$))})]})]}):C===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"‚è∏Ô∏è"}),e.jsx("p",{className:"text-lg text-gray-500 mb-2",children:"Nenhuma partida ao vivo no momento"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Quando houver jogos em andamento, eles aparecer√£o aqui automaticamente."})]}):v.map(S=>e.jsx(Sa,{sportName:S,matches:a[S]||[],currentTimestamp:i},S)),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}const Ts={Futsal:"‚öΩ",Volei:"üèê",FIFA:"üéÆ‚öΩ",Pebolim:"üéÆ"},ts=["Futsal","Volei","FIFA","Pebolim"],Ca={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Ea="team-logos",Aa="America/Sao_Paulo";function Pa(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Aa,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function ks(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Ta(s){return typeof s=="string"&&!ks(s)&&s.trim()!==""}function as(s){if(!s)return null;if(ks(s))return s;if(Ta(s)){const{data:t}=h.storage.from(Ea).getPublicUrl(s);return t?.publicUrl||null}return null}function Me(s){const t=s?.home&&typeof s.home=="object"?s.home.id:null,a=s?.away&&typeof s.away=="object"?s.away.id:null;return!!(t&&a)}function ka(s,t){if(!s)return"";const a=new Date(s),o=new Date(t),i=a-o;if(i<=0)return"Iniciando";const l=Math.floor(i/(1e3*60));return l<60?`em ${l}min`:l<1440?`em ${Math.floor(l/60)}h`:`em ${Math.floor(l/1440)}d`}function Da({status:s,starts_at:t,currentTimestamp:a}){const o="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[11px] font-medium",i=s==="ongoing"?"bg-green-100 text-green-700":s==="paused"?"bg-yellow-100 text-yellow-700":s==="finished"?"bg-gray-200 text-gray-700":"bg-blue-100 text-blue-700";return e.jsxs("span",{className:`${o} ${i}`,children:[Ca[s]||s,s==="scheduled"&&t?e.jsxs("span",{children:["‚Ä¢ ",Pa(t)]}):null]})}function Ma({match:s,currentTimestamp:t}){const a=s.home,o=s.away,i=s.starts_at&&new Date(s.starts_at)-new Date(t)<7200*1e3&&new Date(s.starts_at)>new Date(t),l=i?"border-orange-200":"border-gray-200",d=i?"bg-orange-50":"bg-white";return e.jsxs(X,{to:`/match/${s.id}`,className:`block border rounded-lg p-3 hover:bg-gray-50 transition shadow-sm relative overflow-hidden ${l} ${d}`,children:[i&&e.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-orange-500 rounded-t-lg"}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{status:s.status,starts_at:s.starts_at,currentTimestamp:t}),s.starts_at&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["‚è∞ ",ka(s.starts_at,t)]}),e.jsx("span",{className:"text-[11px] text-gray-500",children:Ts[s.sport?.name]||"üèÜ"})]}),e.jsx("span",{className:"text-[11px] text-gray-500",children:s.venue?s.venue:""})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(H,{team:a||{name:"A definir"},size:28}),e.jsx(X,{to:a?.id?`/team/${a.id}`:"#",onClick:g=>{a?.id||g.preventDefault(),g.stopPropagation()},className:`truncate text-sm font-medium hover:underline ${a?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:a?.name||"A definir",children:a?.name||"A definir"})]}),e.jsxs("div",{className:"shrink-0 text-center",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"vs"}),e.jsxs("div",{className:"text-[10px] text-gray-400 uppercase tracking-wide",children:[s.stage||"",s.round?` ¬∑ J${s.round}`:"",s.group_name?` ¬∑ G${s.group_name}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx(X,{to:o?.id?`/team/${o.id}`:"#",onClick:g=>{o?.id||g.preventDefault(),g.stopPropagation()},className:`truncate text-sm font-medium hover:underline text-right ${o?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,title:o?.name||"A definir",children:o?.name||"A definir"}),e.jsx(H,{team:o||{name:"A definir"},size:28})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.venue||""}),i&&e.jsx("span",{className:"bg-orange-100 text-orange-700 px-1 py-0.5 rounded font-medium",children:"Pr√≥xima"})]})]})}function Ra({sportName:s,matches:t,currentTimestamp:a}){const o=Ts[s]||"üèÜ",i=c.useMemo(()=>(t||[]).filter(d=>d.status==="scheduled"&&Me(d)).sort((d,g)=>{const p=d.starts_at?new Date(d.starts_at).getTime():Number.POSITIVE_INFINITY,v=g.starts_at?new Date(g.starts_at).getTime():Number.POSITIVE_INFINITY;return p-v}),[t]),l=c.useMemo(()=>i.filter(d=>d.starts_at&&new Date(d.starts_at)-new Date(a)<7200*1e3&&new Date(d.starts_at)>new Date(a)).length,[i,a]);return e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:o}),e.jsx("h3",{className:"text-lg font-bold",children:s}),i.length>0&&e.jsxs("span",{className:"text-sm text-gray-500",children:["(",i.length," agendada",i.length!==1?"s":"",")"]}),l>0&&e.jsxs("span",{className:"bg-orange-100 text-orange-700 px-2 py-1 rounded text-xs font-medium",children:[l," pr√≥xima",l!==1?"s":""]})]}),i.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhuma partida confirmada agendada."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:i.map(d=>e.jsx(Ma,{match:d,currentTimestamp:a},d.id))})]})}function Fa(){const[s,t]=c.useState(!0),[a,o]=c.useState({}),[i,l]=c.useState(Date.now()),d=c.useRef(null),g=c.useRef(null),p=async()=>{t(!0);const{data:$,error:R}=await h.from("matches").select(`
        id,
        sport:sport_id ( id, name ),
        stage, round, group_name,
        starts_at, updated_at, venue, status, meta,
        home:home_team_id ( id, name, logo_url, color ),
        away:away_team_id ( id, name, logo_url, color )
      `).in("status",["scheduled"]).order("starts_at",{ascending:!0,nullsFirst:!0});if(R){console.error(R),o({}),t(!1);return}const P=($||[]).map(_=>{const E=_.home&&typeof _.home=="object"?{..._.home,logo_url:(()=>{const T=as(_.home.logo_url);return T?`${T}${T.includes("?")?"&":"?"}v=1`:null})()}:_.home,N=_.away&&typeof _.away=="object"?{..._.away,logo_url:(()=>{const T=as(_.away.logo_url);return T?`${T}${T.includes("?")?"&":"?"}v=1`:null})()}:_.away;return{..._,home:E,away:N}}),f={};for(const _ of P){const E=_.sport?.name||"Outros";f[E]||(f[E]=[]),f[E].push(_)}o(f),t(!1)};c.useEffect(()=>{p(),g.current=setInterval(()=>{l(Date.now())},6e4),d.current&&h.removeChannel(d.current);const $=h.channel("upcoming-matches").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>p()).subscribe();return d.current=$,()=>{g.current&&clearInterval(g.current),d.current&&h.removeChannel(d.current),d.current=null}},[]);const v=c.useMemo(()=>{const $=Object.keys(a),R=ts.filter(f=>$.includes(f)),P=$.filter(f=>!ts.includes(f)).sort();return[...R,...P]},[a]),C=c.useMemo(()=>v.reduce(($,R)=>{const f=(a[R]||[]).filter(_=>_.status==="scheduled"&&Me(_)&&_.starts_at&&new Date(_.starts_at)-new Date(i)<7200*1e3&&new Date(_.starts_at)>new Date(i));return $+f.length},0),[a,v,i]),S=c.useMemo(()=>v.reduce(($,R)=>{const f=(a[R]||[]).filter(_=>_.status==="scheduled"&&Me(_));return $+f.length},0),[a,v]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"üìÖ"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Pr√≥ximos jogos"}),S>0&&e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm font-medium",children:[S," agendada",S!==1?"s":""]}),C>0&&e.jsxs("span",{className:"bg-orange-100 text-orange-700 px-2 py-1 rounded text-sm font-medium",children:[C," pr√≥xima",C!==1?"s":""]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Toque em uma partida para ver os detalhes. Toque no nome do time para ir √† p√°gina do time. Partidas em at√© 2 horas aparecem destacadas."})]}),s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-48 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:Array.from({length:6}).map(($,R)=>e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"},R))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-40 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3",children:Array.from({length:4}).map(($,R)=>e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"},R))})]})]}):S===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üìÖ"}),e.jsx("p",{className:"text-lg text-gray-500 mb-2",children:"Nenhuma partida agendada no momento"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Quando houver jogos confirmados agendados, eles aparecer√£o aqui."})]}):v.map($=>e.jsx(Ra,{sportName:$,matches:a[$]||[],currentTimestamp:i},$))]})}const Ds={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Ia={grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3¬∫ lugar"},qa="team-logos";function Ms(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Oa(s){return typeof s=="string"&&!Ms(s)&&s.trim()!==""}function xe(s){if(!s)return null;if(Ms(s))return s;if(Oa(s)){const{data:t}=h.storage.from(qa).getPublicUrl(s);return t?.publicUrl||null}return null}const La="America/Sao_Paulo";function de(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:La,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function Rs(s){return s?Ia[s]||s[0]?.toUpperCase()+s.slice(1):""}function Va({stage:s,group_name:t,round:a}){const o=[];return s&&o.push(Rs(s)),t&&o.push(`Grupo ${t}`),a&&o.push(`Jogo ${a}`),o.join(" ‚Ä¢ ")}function Fs(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const l=Math.floor(i/1e3),d=Math.floor(l/60),g=l%60;return`${d}:${g.toString().padStart(2,"0")}`}function Ua({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Ba({status:s,meta:t,starts_at:a,updated_at:o,currentTimestamp:i}){const l="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[11px] font-medium",d=s==="ongoing"?"bg-green-100 text-green-700":s==="paused"?"bg-yellow-100 text-yellow-700":s==="finished"?"bg-gray-200 text-gray-700":"bg-blue-100 text-blue-700",g=t?.clock||t?.time||t?.minute,p=s==="ongoing"||s==="paused",v=s==="scheduled"?a?`‚Ä¢ ${de(a)}`:"":s==="finished"?o?`‚Ä¢ ${de(o)}`:"":g?`‚Ä¢ ${g}`:"";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`${l} ${d}`,children:[Ds[s]||s," ",v?e.jsx("span",{children:v}):null]}),p&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["üïê ",Fs({status:s,starts_at:a,updated_at:o},i)]})]})}function rs(){const{id:s}=xs(),[t,a]=c.useState(null),[o,i]=c.useState([]),[l,d]=c.useState([]),[g,p]=c.useState(!0),[v,C]=c.useState(Date.now()),S=c.useRef(null),$=c.useRef(null),R=c.useMemo(()=>(t?.sport?.name||"").toLowerCase().includes("vole"),[t?.sport?.name]),P=async()=>{p(!0);try{const{data:D,error:J}=await h.from("match_detail_view").select(`
          id, sport_id, sport_name, stage, round, group_name, starts_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score, created_at, updated_at
        `).eq("id",s).maybeSingle();let O=null;if(!J&&D){O={id:D.id,sport:{id:D.sport_id,name:D.sport_name},stage:D.stage,round:D.round,group_name:D.group_name,starts_at:D.starts_at,updated_at:D.updated_at,venue:D.venue,status:D.status,meta:null,home_score:D.home_score,away_score:D.away_score,home:{id:D.home_team_id,name:D.home_team_name,color:D.home_team_color,logo_url:(()=>{const z=xe(D.home_team_logo);return z?`${z}${z.includes("?")?"&":"?"}v=1`:null})()},away:{id:D.away_team_id,name:D.away_team_name,color:D.away_team_color,logo_url:(()=>{const z=xe(D.away_team_logo);return z?`${z}${z.includes("?")?"&":"?"}v=1`:null})()}};const{data:G}=await h.from("matches").select("meta").eq("id",s).maybeSingle();G?.meta&&(O.meta=G.meta)}else{const{data:G}=await h.from("matches").select(`
            id,
            sport:sport_id ( id, name ),
            stage, round, group_name, starts_at, updated_at, venue, status, meta,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("id",s).maybeSingle();G&&(O={...G,home:G.home&&typeof G.home=="object"?{...G.home,logo_url:(()=>{const F=xe(G.home.logo_url);return F?`${F}${F.includes("?")?"&":"?"}v=1`:null})()}:G.home,away:G.away&&typeof G.away=="object"?{...G.away,logo_url:(()=>{const F=xe(G.away.logo_url);return F?`${F}${F.includes("?")?"&":"?"}v=1`:null})()}:G.away})}if(a(O),O?.home?.id){const{data:G}=await h.from("players").select("id, name, number").eq("team_id",O.home.id).order("number",{ascending:!0,nullsFirst:!0}).order("name");i(G||[])}else i([]);if(O?.away?.id){const{data:G}=await h.from("players").select("id, name, number").eq("team_id",O.away.id).order("number",{ascending:!0,nullsFirst:!0}).order("name");d(G||[])}else d([])}finally{p(!1)}};c.useEffect(()=>{P(),$.current=setInterval(()=>{C(Date.now())},1e3),S.current&&(h.removeChannel(S.current),S.current=null);const D=h.channel(`match-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`id=eq.${s}`},()=>P()).on("postgres_changes",{event:"*",schema:"public",table:"match_events",filter:`match_id=eq.${s}`},()=>P()).subscribe();return S.current=D,()=>{$.current&&clearInterval($.current),S.current&&h.removeChannel(S.current),S.current=null}},[s]);const f=c.useMemo(()=>t?Va(t):"",[t]),_=t?.home,E=t?.away,N=Number(t?.meta?.home_sets??0),T=Number(t?.meta?.away_sets??0),w=N>0||T>0,k=R||w,I=t?.status&&t.status!=="scheduled",q=Number(t?.home_score??0),U=Number(t?.away_score??0),b=t?.status==="ongoing"||t?.status==="paused";return g||!t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-40 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-28 w-full bg-gray-100 rounded animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-52 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-52 bg-gray-100 rounded animate-pulse"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ba,{status:t.status,meta:t.meta,starts_at:t.starts_at,updated_at:t.updated_at,currentTimestamp:v}),f&&e.jsx("div",{className:"text-xs text-gray-500","aria-label":"Detalhes da fase",children:f})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.starts_at?de(t.starts_at):null,t.venue?e.jsx("span",{className:"ml-2",children:t.venue}):null]})]}),e.jsxs("div",{className:`bg-white border rounded-lg p-4 shadow-sm relative overflow-hidden ${b?t.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200"}`,children:[e.jsx(Ua,{status:t.status}),e.jsxs("div",{className:"grid grid-cols-3 items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(H,{team:_||{name:"A definir"},size:40}),e.jsx("div",{className:"min-w-0",children:e.jsx(X,{to:_?.id?`/team/${_.id}`:"#",className:`block font-semibold truncate hover:underline ${_?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,onClick:D=>{_?.id||D.preventDefault()},title:_?.name||"A definir",children:_?.name||"A definir"})})]}),e.jsxs("div",{className:"text-center",children:[k?e.jsx("div",{className:"text-sm font-semibold tabular-nums mb-1",children:e.jsxs("span",{className:`${I?"":"text-gray-400"}`,children:["Sets: ",N," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",T]})}):null,I?e.jsxs("div",{className:"text-3xl font-bold tabular-nums",children:[q," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",U]}):e.jsx("div",{className:"text-sm text-gray-400",children:"‚Äî"}),e.jsxs("div",{className:"text-[11px] text-gray-500 mt-1",children:[Ds[t.status]||t.status,b&&e.jsxs("span",{className:"ml-2",children:["üïê ",Fs(t,v)]}),t.meta?.clock?` ‚Ä¢ ${t.meta.clock}`:""]})]}),e.jsxs("div",{className:"flex items-center gap-3 min-w-0 justify-end",children:[e.jsx("div",{className:"min-w-0 text-right",children:e.jsx(X,{to:E?.id?`/team/${E.id}`:"#",className:`block font-semibold truncate hover:underline ${E?.id?"text-gray-900":"text-gray-400 pointer-events-none"}`,onClick:D=>{E?.id||D.preventDefault()},title:E?.name||"A definir",children:E?.name||"A definir"})}),e.jsx(H,{team:E||{name:"A definir"},size:40})]})]}),R?e.jsxs("div",{className:"text-[11px] text-gray-500 mt-2",children:["V√¥lei: partidas em ",e.jsx("strong",{children:"um set de 15 pontos"}),". √â necess√°rio ter"," ",e.jsx("strong",{children:"2 pontos de vantagem"})," para vencer."]}):null]}),e.jsxs("div",{className:"bg-white border rounded-lg p-3 shadow-sm",children:[e.jsx("div",{className:"text-[11px] font-semibold text-gray-500 mb-2",children:"Detalhes"}),e.jsxs("ul",{className:"text-sm grid sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Modalidade:"})," ",e.jsx("span",{className:"font-medium",children:t?.sport?.name||"‚Äî"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Fase:"})," ",e.jsx("span",{className:"font-medium",children:Rs(t.stage)||"‚Äî"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Grupo:"})," ",e.jsx("span",{className:"font-medium",children:t.group_name||"‚Äî"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Rodada:"})," ",e.jsx("span",{className:"font-medium",children:t.round??"‚Äî"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"In√≠cio:"})," ",e.jsx("span",{className:"font-medium",children:t.starts_at?de(t.starts_at):"‚Äî"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Local:"})," ",e.jsx("span",{className:"font-medium",children:t.venue||"‚Äî"})]}),t.updated_at&&e.jsxs("li",{className:"sm:col-span-2",children:[e.jsx("span",{className:"text-gray-500",children:"√öltima atualiza√ß√£o:"})," ",e.jsx("span",{className:"font-medium",children:de(t.updated_at)})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Elenco ‚Äî ",_?.name||"A definir"]}),o.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"text-sm divide-y",children:o.map(D=>e.jsxs("li",{className:"flex items-center justify-between py-1",children:[e.jsx("span",{className:"truncate",children:D.name}),e.jsx("span",{className:"inline-block w-8 text-right tabular-nums text-gray-500",children:D.number??""})]},D.id))})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Elenco ‚Äî ",E?.name||"A definir"]}),l.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"text-sm divide-y",children:l.map(D=>e.jsxs("li",{className:"flex items-center justify-between py-1",children:[e.jsx("span",{className:"truncate",children:D.name}),e.jsx("span",{className:"inline-block w-8 text-right tabular-nums text-gray-500",children:D.number??""})]},D.id))})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.status==="finished"&&t.updated_at?`Encerrado em ${de(t.updated_at)}`:null}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function ns(){const s=te(),{user:t,setNeedsPasswordSetup:a}=Oe(),[o,i]=c.useState(""),[l,d]=c.useState(""),[g,p]=c.useState(!1),[v,C]=c.useState(null),[S,$]=c.useState(null);c.useEffect(()=>{console.log("SetPassword mounted, user:",t)},[t]);const R=async P=>{if(P.preventDefault(),console.log("üî• FORM SUBMITTED - START"),!g){if(p(!0),$(null),C(null),!o||o.length<8){$("A senha deve ter pelo menos 8 caracteres."),p(!1);return}if(o!==l){$("As senhas n√£o coincidem."),p(!1);return}try{console.log("üöÄ Starting password update...");const{error:f}=await h.auth.updateUser({password:o,data:{password_set:!0}});if(f){console.error("Password update error:",f),$(`Erro ao atualizar senha: ${f.message}`),p(!1);return}console.log("‚úÖ Password updated successfully"),console.log("üîç Checking if admin profile exists...");let _=!1,E=0;const N=5;for(;!_&&E<N;){E++,console.log(`Attempt ${E}/${N} to check profile...`);const{data:k,error:I}=await h.from("profiles").select("role").eq("user_id",t.id).single();!I&&k?.role==="admin"?(_=!0,console.log("‚úÖ Admin profile found!")):(console.log("‚è≥ Profile not found yet, waiting..."),await new Promise(q=>setTimeout(q,1e3)))}if(!_){console.log("üîß Creating profile manually as fallback...");const{error:k}=await h.from("profiles").insert({user_id:t.id,name:t.email.split("@")[0],role:"admin"});if(k&&!k.message.includes("duplicate key")){console.error("Manual profile creation error:",k),$("Erro ao criar perfil de administrador."),p(!1);return}}const{data:T,error:w}=await h.rpc("is_admin");console.log("üîç Final admin check:",T,w),C("Senha definida e perfil configurado com sucesso!"),a(!1),setTimeout(()=>{console.log("üéØ Navigating to admin"),p(!1),s("/admin",{replace:!0})},1500)}catch(f){console.error("Unexpected error:",f),$(`Erro inesperado: ${f.message}`),p(!1)}}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full mx-auto bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Bem-vindo!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Defina sua senha para continuar"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["User ID: ",t?.id?.slice(0,8),"... | Email: ",t?.email]})]}),v&&e.jsx("p",{className:"mb-3 text-green-700 text-center",children:v}),S&&e.jsx("p",{className:"mb-3 text-red-700 text-center",children:S}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nova senha"}),e.jsx("input",{type:"password",placeholder:"M√≠nimo 8 caracteres",className:"w-full p-3 border border-gray-300 rounded-md",value:o,onChange:P=>i(P.target.value),required:!0,disabled:g})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirme a senha"}),e.jsx("input",{type:"password",placeholder:"Digite a senha novamente",className:"w-full p-3 border border-gray-300 rounded-md",value:l,onChange:P=>d(P.target.value),required:!0,disabled:g})]}),e.jsx("button",{type:"submit",disabled:g,className:"w-full bg-blue-600 text-white py-3 rounded-md font-medium hover:bg-blue-700 disabled:opacity-50",children:g?"Configurando perfil...":"Definir senha"})]})]})})}function Ga(){const s=te(),t=a=>{s(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Painel do Administrador"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecione uma √°rea para gerenciar."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("button",{onClick:()=>t("/admin/elencos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"üë•"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Elencos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Criar time, editar elenco (jogadores) e logo."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir ‚Üí"})]}),e.jsxs("button",{onClick:()=>t("/admin/campeonatos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"üèÜ"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Campeonatos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Configurar modalidades, grupos e fases."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir ‚Üí"})]}),e.jsxs("button",{onClick:()=>t("/admin/partidas"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"‚è±Ô∏è"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Partidas"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Iniciar/encerrar jogos e atualizar placar em tempo real."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir ‚Üí"})]})]})]})}function za(){const s=te(),[t]=Us(),a=t.get("redirect")||"/admin",o=t.get("reason"),[i,l]=c.useState(""),[d,g]=c.useState(""),[p,v]=c.useState(!1),[C,S]=c.useState(null),[$,R]=c.useState(null),P=async()=>{const{data:_,error:E}=await h.rpc("is_admin");return E?(S(null),R("N√£o foi poss√≠vel validar seu acesso. Tente novamente."),!1):_?(s(a,{replace:!0}),!0):(await h.auth.signOut(),S(null),R("A conta atual n√£o possui acesso de administrador. Entre com uma conta de admin."),!1)};c.useEffect(()=>{S(o==="forbidden"?"Fa√ßa login para acessar a p√°gina de administrador.":null),(async()=>{const{data:_}=await h.auth.getSession();(_?.session??null)?.user?.id&&await P()})()},[o,a]);async function f(_){if(_.preventDefault(),p)return;v(!0),R(null),S(null);const{data:E,error:N}=await h.auth.signInWithPassword({email:i,password:d});if(N){R(N.message||"N√£o foi poss√≠vel entrar. Verifique seus dados."),v(!1);return}if(!E?.user?.id){R("Falha ao obter o usu√°rio autenticado."),v(!1);return}if(!await P()){v(!1);return}v(!1)}return e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Login do Administrador"}),C&&e.jsx("p",{className:"mb-3 text-sm text-blue-700 bg-blue-50 border border-blue-200 rounded p-2",children:C}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Email"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full p-2 border rounded",value:i,onChange:_=>l(_.target.value),autoComplete:"email",inputMode:"email",required:!0})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Senha"}),e.jsx("input",{type:"password",placeholder:"Senha",className:"w-full p-2 border rounded",value:d,onChange:_=>g(_.target.value),autoComplete:"current-password",required:!0})]}),$&&e.jsx("p",{className:"text-red-600 text-sm",children:$}),e.jsx("button",{type:"submit",disabled:p,className:"w-full bg-primary text-white py-2 rounded disabled:opacity-50",children:p?"Entrando‚Ä¶":"Entrar"})]})]})}const ue="team-logos",os=5,Ae=["image/png","image/jpeg","image/webp"],Ja=["oitavas","quartas","semi","final","3lugar"];function Ka(){const[s,t]=c.useState([]),[a,o]=c.useState({}),[i,l]=c.useState([]),[d,g]=c.useState(!1),[p,v]=c.useState({name:"",sport_id:""}),[C,S]=c.useState(null),[$,R]=c.useState([]),[P,f]=c.useState(0),[_,E]=c.useState([]),[N,T]=c.useState({}),[w,k]=c.useState({}),I=async()=>{const{data:u}=await h.from("sports").select("id,name").order("name");t(u||[]);const j={};(u||[]).forEach(A=>j[A.id]=A.name),o(j),!p.sport_id&&u?.length&&v(A=>({...A,sport_id:u[0].id}))},q=async()=>{let u=h.from("teams").select("id,name,group_name,sport_id,logo_url").order("name");_.length>0&&(u=u.in("sport_id",_));const{data:j}=await u;l(j||[]);const A=(j||[]).map(M=>M.id);A.length?await Promise.all([U(A),b(j)]):(T({}),k({}))},U=async u=>{if(!u?.length)return;const{data:j}=await h.from("players").select("id, team_id").in("team_id",u),A={};(j||[]).forEach(M=>{A[M.team_id]=(A[M.team_id]||0)+1}),u.forEach(M=>{M in A||(A[M]=0)}),T(A)},b=async u=>{const j=Array.from(new Set((u||[]).map(V=>V.sport_id)));if(j.length===0){k({});return}const{data:A}=await h.from("matches").select("sport_id, stage, home_team_id, away_team_id").in("sport_id",j).in("stage",Ja),M={};(A||[]).forEach(V=>{V.home_team_id&&V.away_team_id&&(M[V.sport_id]=!0)}),j.forEach(V=>{V in M||(M[V]=!1)}),k(M)},D=async u=>{const{data:j}=await h.from("players").select("id,name,number").eq("team_id",u).order("name");R(j||[]),T(A=>({...A,[u]:(j||[]).length}))};c.useEffect(()=>{I()},[]),c.useEffect(()=>{q()},[_]);const J=u=>{const{data:j}=h.storage.from(ue).getPublicUrl(u);return j?.publicUrl||""},O=u=>{if(!u)return null;const j=u.indexOf(`/storage/v1/object/public/${ue}/`);return j===-1?null:u.substring(j+`/storage/v1/object/public/${ue}/`.length)},G=async u=>{if(u.preventDefault(),!p.name||!p.sport_id)return;g(!0);const{error:j}=await h.from("teams").insert({name:p.name.trim(),sport_id:p.sport_id});g(!1),j?alert("Erro ao criar time: "+j.message):(v({name:"",sport_id:p.sport_id}),q())},z=async u=>{if(confirm(`‚ö†Ô∏è Aten√ß√£o!

Se voc√™ remover o time "${u.name}", TODO o campeonato da modalidade ser√° resetado e o hist√≥rico de jogos ser√° apagado.

Deseja realmente continuar?`)){g(!0);try{const A=O(u.logo_url);A&&await h.storage.from(ue).remove([A]).catch(()=>{});const{error:M}=await h.rpc("reset_sport",{p_sport_id:u.sport_id});if(M)throw M;const{error:V}=await h.from("teams").delete().eq("id",u.id);if(V)throw V;C?.id===u.id&&(S(null),R([])),await q(),alert(`Time "${u.name}" removido.

O campeonato da modalidade foi resetado. Configure novamente os grupos e partidas antes de prosseguir.`)}catch(A){alert("Erro ao remover: "+A.message)}finally{g(!1)}}},F=async u=>{if(!C?.id||!u)return;g(!0);const{error:j}=await h.from("players").insert({team_id:C.id,name:u.trim()});g(!1),j?alert("Erro ao adicionar jogador: "+j.message):D(C.id)},r=async u=>{if(!C?.id)return;g(!0);const{error:j}=await h.from("players").delete().eq("id",u);g(!1),j?alert("Erro ao remover jogador: "+j.message):D(C.id)},x=async(u,j)=>{if(!(!u?.id||!j)){if(!Ae.includes(j.type)){alert("Formato inv√°lido. Use PNG, JPG ou WEBP.");return}if(j.size>os*1024*1024){alert(`Arquivo grande demais. M√°ximo ${os} MB.`);return}g(!0);try{const A=j.type==="image/png"?"png":j.type==="image/webp"?"webp":"jpg",M=`teams/${u.id}.${A}`,{error:V}=await h.storage.from(ue).upload(M,j,{upsert:!0,cacheControl:"3600",contentType:j.type});if(V)throw V;const K=J(M),{error:L}=await h.from("teams").update({logo_url:K}).eq("id",u.id);if(L)throw L;if(await q(),C?.id===u.id){const B=(await h.from("teams").select("id,name,logo_url").eq("id",u.id).maybeSingle()).data;B&&S(W=>({...W,...B}))}f(B=>B+1)}catch(A){alert("Erro ao enviar logo: "+A.message)}finally{g(!1)}}},y=_.length===0||_.length===s.length,n=()=>{E(u=>y?[]:s.map(j=>j.id))},m=e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{onClick:n,className:`px-3 py-1 rounded border ${y?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:"Todos"}),s.map(u=>{const j=_.length===0?!0:_.includes(u.id);return e.jsx("button",{onClick:()=>E(A=>A.length===0?[u.id]:A.includes(u.id)?A.filter(M=>M!==u.id):[...A,u.id]),className:`px-3 py-1 rounded border ${j?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:u.name},u.id)})]});return e.jsxs("div",{className:"grid gap-8 md:grid-cols-2",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Elencos"}),m,e.jsxs("form",{onSubmit:G,className:"rounded-lg border p-4 space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"Novo time"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Nome do time"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:p.name,onChange:u=>v(j=>({...j,name:u.target.value})),placeholder:"Ex.: A1 ‚Äî √Åguias",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Esporte"}),e.jsx("select",{className:"w-full border rounded px-3 py-2",value:p.sport_id,onChange:u=>v(j=>({...j,sport_id:u.target.value})),children:s.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))})]})]}),e.jsx("button",{type:"submit",disabled:d,className:"mt-2 inline-flex items-center gap-2 bg-primary text-white px-4 py-2 rounded disabled:opacity-50",children:d?"Salvando‚Ä¶":"Criar time"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times cadastrados"}),e.jsxs("ul",{className:"divide-y border rounded",children:[i.map(u=>{const j=a[u.sport_id]||"‚Äî",A=N[u.id]??0,M=A>0,V=!!w[u.sport_id],K=u.group_name?`Grupo ${u.group_name}`:V?"Sem grupo (n√£o aplic√°vel)":"Sem grupo";return e.jsxs("li",{className:"p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(is,{src:u.logo_url,alt:u.name,size:32,version:P}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:u.name}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-flex items-center gap-1",children:e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-gray-100 border text-gray-700",children:j})}),e.jsxs("span",{children:["‚Ä¢ ",K]}),V&&e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-green-100 text-green-700",children:"Chaveamento configurado"}),e.jsxs("span",{children:["‚Ä¢ Elenco:"," ",e.jsxs("strong",{className:M?"text-gray-900":"text-red-600",children:[A," ",A===1?"jogador":"jogadores"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-sm px-3 py-1 rounded border hover:bg-gray-50 cursor-pointer",children:["Trocar logo",e.jsx("input",{type:"file",accept:Ae.join(","),className:"hidden",onChange:L=>{const B=L.target.files?.[0];B&&x(u,B),L.target.value=""},disabled:d})]}),e.jsx("button",{className:"text-sm px-3 py-1 rounded border hover:bg-gray-50",onClick:()=>{S(u),D(u.id)},children:"Gerenciar elenco"}),e.jsx("button",{className:"text-sm px-3 py-1 rounded border text-red-600 hover:bg-red-50",onClick:()=>z(u),disabled:d,children:"Remover"})]})]},u.id)}),i.length===0&&e.jsx("li",{className:"p-3 text-sm text-gray-500",children:"Nenhum time cadastrado."})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Elenco do time"}),!C&&e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione um time para gerenciar seu elenco."}),C&&e.jsxs("div",{className:"rounded-lg border p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(is,{src:C.logo_url,alt:C.name,size:40,version:P}),e.jsx("div",{className:"font-semibold",children:C.name}),e.jsx("div",{className:"ml-auto",children:e.jsxs("label",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-50 cursor-pointer",children:["Atualizar logo",e.jsx("input",{type:"file",accept:Ae.join(","),className:"hidden",onChange:u=>{const j=u.target.files?.[0];j&&x(C,j),u.target.value=""},disabled:d})]})})]}),e.jsx(Xa,{disabled:d,onAdd:F}),e.jsxs("ul",{className:"divide-y border rounded",children:[$.map(u=>e.jsxs("li",{className:"p-3 flex items-center justify-between",children:[e.jsx("div",{children:u.name}),e.jsx("button",{className:"text-sm px-3 py-1 rounded border text-red-600 hover:bg-red-50",onClick:()=>r(u.id),disabled:d,children:"Remover"})]},u.id)),$.length===0&&e.jsx("li",{className:"p-3 text-sm text-gray-500",children:"Nenhum jogador no elenco."})]})]})]})]})}function Xa({disabled:s,onAdd:t}){const[a,o]=c.useState("");return e.jsxs("form",{onSubmit:i=>{i.preventDefault(),t(a),o("")},className:"flex items-center gap-2",children:[e.jsx("input",{className:"flex-1 border rounded px-3 py-2",placeholder:"Nome do jogador",value:a,onChange:i=>o(i.target.value),required:!0}),e.jsx("button",{type:"submit",disabled:s,className:"px-3 py-2 rounded bg-primary text-white disabled:opacity-50",children:"Adicionar"})]})}function Ha(s){if(!s)return"?";const t=s.trim().split(" ");return t.length===1?t[0][0]?.toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}function Qa(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function is({src:s,alt:t,size:a=32,version:o=0}){const[i,l]=c.useState(!1),d=c.useMemo(()=>{if(!s)return null;const g=s.includes("?")?"&":"?";return`${s}${g}v=${o}`},[s,o]);return e.jsxs("div",{className:"relative rounded overflow-hidden border bg-white flex items-center justify-center",style:{width:a,height:a},children:[d?e.jsx("img",{src:d,alt:t||"logo",className:`w-full h-full object-cover ${i?"opacity-100":"opacity-0"} transition-opacity duration-200`,loading:"lazy",onLoad:()=>l(!0),onError:()=>l(!1)}):null,!d||!i?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white font-bold uppercase",style:{backgroundColor:Qa(t||"T"),fontSize:a*.4},children:Ha(t)}):null]})}const ls={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},cs={ongoing:1,paused:2,scheduled:3,finished:4},Ya="team-logos";function Is(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Za(s){return typeof s=="string"&&!Is(s)&&s.trim()!==""}function ds(s){if(!s)return null;if(Is(s))return s;if(Za(s)){const{data:t}=h.storage.from(Ya).getPublicUrl(s);return t?.publicUrl||null}return null}function Wa(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),i=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(i<0)return"0:00";const l=Math.floor(i/1e3),d=Math.floor(l/60),g=l%60;return`${d}:${g.toString().padStart(2,"0")}`}function er({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function sr(){const[s,t]=c.useState([]),[a,o]=c.useState([]),[i,l]=c.useState(null),[d,g]=c.useState(null),[p,v]=c.useState(!0),[C,S]=c.useState({}),[$,R]=c.useState(null),[P,f]=c.useState(null),[_,E]=c.useState(Date.now());c.useEffect(()=>{if(!P)return;const n=setTimeout(()=>f(null),8e3);return()=>clearTimeout(n)},[P]);const N=c.useRef(null),T=c.useRef(!0),w=c.useRef(null),k=(n,m)=>S(u=>({...u,[n]:m})),I=async()=>{const{data:n,error:m}=await h.auth.getSession();return m?(console.error("getSession error:",m),f(m.message||"Falha ao obter sess√£o de usu√°rio."),null):n?.session||null},q=async()=>{try{await h.auth.getUser();const{data:n,error:m}=await h.rpc("is_admin");if(m)throw m;R(!!n)}catch(n){console.error("is_admin() error:",n),R(!1)}};c.useEffect(()=>{T.current=!0,(async()=>(await I(),await q(),await U(),await b()))(),w.current=setInterval(()=>{E(Date.now())},1e3);const{data:n}=h.auth.onAuthStateChange(async(m,u)=>{T.current&&(R(null),await q(),u?(await U(),await b()):t([]))});return()=>{T.current=!1,w.current&&clearInterval(w.current),n?.subscription?.unsubscribe?.(),N.current&&(h.removeChannel(N.current),N.current=null)}},[]);const U=async()=>{const{data:n,error:m}=await h.from("sports").select("id,name").order("name");if(m){console.error("loadSports error:",m);return}n&&o(n)},b=async()=>{v(!0);try{let n=h.from("matches").select(`
          id, stage, round, group_name, starts_at, venue, created_at, updated_at,
          status, home_score, away_score, meta,
          home_team_id, away_team_id,
          sport:sport_id ( id, name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `);i&&(n=n.eq("sport_id",i)),d&&(n=n.eq("status",d)),n=n.or("group_name.not.is.null,and(home_team_id.not.is.null,away_team_id.not.is.null)");const{data:m,error:u}=await n;if(u)console.error("loadMatches error:",u),f(u.message||"Falha ao carregar partidas.");else{const A=(m||[]).map(M=>{const V=M.home&&typeof M.home=="object"?{...M.home,logo_url:(()=>{const L=ds(M.home.logo_url);return L?`${L}${L.includes("?")?"&":"?"}v=1`:null})()}:M.home,K=M.away&&typeof M.away=="object"?{...M.away,logo_url:(()=>{const L=ds(M.away.logo_url);return L?`${L}${L.includes("?")?"&":"?"}v=1`:null})()}:M.away;return{...M,home:V,away:K}}).sort((M,V)=>{const K=cs[M.status]||999,L=cs[V.status]||999;return K!==L?K-L:new Date(V.created_at||0)-new Date(M.created_at||0)});t(A)}}finally{T.current&&v(!1)}};c.useEffect(()=>{b(),N.current&&(h.removeChannel(N.current),N.current=null);const n=h.channel("admin-matches").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>b()).subscribe();return N.current=n,()=>{N.current&&h.removeChannel(N.current),N.current=null}},[i,d]);const D=async(n,m,u=null)=>{k(n,!0),f(null);try{if(!await I())return f("Voc√™ precisa estar autenticado para realizar esta a√ß√£o."),!1;if($===!1)return f("Somente administradores podem alterar partidas (RLS)."),!1;console.log("üîÑ === IN√çCIO MUTA√á√ÉO ==="),console.log("üîç Match ID:",n,"(tipo:",typeof n,")"),console.log("üîç Patch original:",JSON.stringify(m,null,2)),console.log("üîç Patch keys/values:",Object.entries(m).map(([L,B])=>`${L}: ${B} (${typeof B})`));const A=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;if(!A.test(n))return console.error("‚ùå ID inv√°lido:",n),f("ID da partida inv√°lido."),!1;for(const[L,B]of Object.entries(m))if(typeof B=="string"&&A.test(B))return console.error("‚ùå PROBLEMA DETECTADO: UUID encontrado em valor:",L,"=",B),f(`Erro: Campo ${L} cont√©m UUID inv√°lido: ${B}`),!1;const M={};for(const[L,B]of Object.entries(m))if(console.log(`üîç Processando ${L}:`,B,`(${typeof B})`),L==="home_score"||L==="away_score"){if(B==null)M[L]=0;else{let W;if(typeof B=="string"){if(A.test(B))return console.error(`‚ùå ERRO CR√çTICO: ${L} cont√©m UUID:`,B),f(`Erro cr√≠tico: ${L} cont√©m UUID em vez de n√∫mero: ${B}`),!1;W=parseInt(B,10)}else if(typeof B=="number")W=Math.floor(B);else return console.error(`‚ùå ${L} tipo inv√°lido:`,typeof B,B),f(`${L} deve ser um n√∫mero.`),!1;if(isNaN(W)||W<0)return console.error(`‚ùå ${L} valor inv√°lido:`,B,"‚Üí",W),f(`${L} deve ser um n√∫mero positivo.`),!1;M[L]=W}console.log(`‚úÖ ${L} ‚Üí ${M[L]} (${typeof M[L]})`)}else if(L==="status"){const W=["scheduled","ongoing","paused","finished"];if(!W.includes(B))return console.error("‚ùå Status inv√°lido:",B),f(`Status deve ser: ${W.join(", ")}`),!1;M[L]=B,console.log(`‚úÖ status ‚Üí ${M[L]}`)}else if(L==="starts_at"){if(B==null)M[L]=null;else try{new Date(B).toISOString(),M[L]=B}catch{return console.error("‚ùå starts_at inv√°lido:",B),f("starts_at deve ser uma data v√°lida."),!1}console.log(`‚úÖ starts_at ‚Üí ${M[L]}`)}else if(L==="meta"){if(B==null)M[L]={};else if(typeof B=="object"&&!Array.isArray(B))M[L]=B;else return console.error("‚ùå meta inv√°lido:",B),f("meta deve ser um objeto."),!1;console.log(`‚úÖ meta ‚Üí ${JSON.stringify(M[L])}`)}else{if(typeof B=="string"&&A.test(B))return console.error(`‚ùå Campo ${L} recebeu UUID quando deveria ser ${typeof B}:`,B),f(`Erro interno: ${L} recebeu UUID inv√°lido.`),!1;console.warn(`‚ö†Ô∏è Campo ${L} n√£o validado explicitamente:`,B),M[L]=B}console.log("üîÑ Patch final:",JSON.stringify(M,null,2)),console.log("üîÑ Tipos finais:",Object.fromEntries(Object.entries(M).map(([L,B])=>[L,typeof B]))),console.log("üîÑ Executando UPDATE...");const{data:V,error:K}=await h.from("matches").update(M).eq("id",n).select("id");if(K){console.error("‚ùå === ERRO SUPABASE ==="),console.error("Error object:",K),console.error("Match ID:",n),console.error("Clean patch:",M),console.error("Original patch:",m),console.error("Error details:",{code:K.code,message:K.message,details:K.details,hint:K.hint});const L=["Falha ao atualizar a partida.",K.code&&`code: ${K.code}`,K.details&&`details: ${K.details}`,K.hint&&`hint: ${K.hint}`,K.message&&`message: ${K.message}`].filter(Boolean).join(`
`);return f(L||"Falha ao atualizar partida (permiss√£o/RLS?)."),!1}if(!V||V.length===0){const L="Nenhuma linha atualizada. Verifique permiss√µes (GRANT/RLS) e se o usu√°rio √© admin.";return console.warn(L,{id:n,patch:M}),f(L),!1}return console.log("‚úÖ Sucesso! Data:",V),console.log("üîÑ === FIM MUTA√á√ÉO ==="),u&&await u(),!0}catch(j){return console.error("‚ùå === EXCEPTION ==="),console.error("Exception:",j),console.error("Stack:",j.stack),f(j.message||"Erro ao atualizar"),!1}finally{k(n,!1),setTimeout(()=>b(),50)}},J=async(n,m,u)=>{if(n.status==="scheduled")return;console.log("üîç === DEBUG changePoints ==="),console.log("üîç Match object:",n),console.log("üîç Match ID:",n.id,"(tipo:",typeof n.id,")"),console.log("üîç Team:",m,"(tipo:",typeof m,")"),console.log("üîç Action:",u);const j=`${m}_score`;console.log("üîç Key calculada:",j),console.log("üîç Valor atual m[key]:",n[j],"(tipo:",typeof n[j],")");let A=Math.max(0,Number(n[j]||0));u==="inc"&&(A+=1),u==="dec"&&(A=Math.max(0,A-1)),u==="reset"&&(A=0),console.log("üîç Valor calculado next:",A,"(tipo:",typeof A,")");const M={[j]:A};console.log("üîç Patch que ser√° enviado:",JSON.stringify(M,null,2)),console.log("üîç === FIM DEBUG changePoints ==="),await D(n.id,M)},O=(n,m)=>{const u=n.meta||{};return Math.max(0,Number(u[m==="home"?"home_sets":"away_sets"]||0))},G=async(n,m,u)=>{if(n.status==="scheduled")return;const j=n.meta||{},A=m==="home"?"home_sets":"away_sets";let M=Math.max(0,Number(j[A]||0));u==="inc"&&(M+=1),u==="dec"&&(M=Math.max(0,M-1)),u==="reset"&&(M=0),await D(n.id,{meta:{...j,[A]:M}})},z=async(n,m)=>{const u={status:m};return m==="ongoing"&&n.status==="scheduled"&&(u.starts_at=new Date().toISOString()),console.log(`üîÑ Mudando status de ${n.status} para ${m}`,{matchId:n.id,patch:u}),await D(n.id,u)},F=async n=>{await z(n,"ongoing")},r=async n=>{await z(n,"paused")},x=async n=>{await z(n,"ongoing")},y=async n=>{await z(n,"finished")};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Gerenciar Partidas"}),$===!1&&e.jsxs("div",{className:"text-sm p-3 rounded bg-red-50 border border-red-200 text-red-700",children:["Voc√™ n√£o est√° autenticado como ",e.jsx("strong",{children:"admin"}),". As a√ß√µes podem ser bloqueadas pelas"," ",e.jsx("strong",{children:"RLS policies"}),"."]}),P&&e.jsxs("div",{className:"text-sm p-3 rounded bg-yellow-50 border border-yellow-200 text-yellow-800 flex items-start gap-3",children:[e.jsx("div",{className:"flex-1 whitespace-pre-wrap",children:String(P)}),e.jsx("button",{onClick:()=>f(null),className:"text-xs px-2 py-1 rounded border border-yellow-300 hover:bg-yellow-100",title:"Fechar alerta",children:"Fechar"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Modalidade:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l(null),className:`px-3 py-1 rounded text-xs ${i?"bg-gray-100 hover:bg-gray-200":"bg-primary text-white"}`,children:"Todas"}),a.map(n=>e.jsx("button",{onClick:()=>l(n.id),className:`px-3 py-1 rounded text-xs ${i===n.id?"bg-primary text-white":"bg-gray-100 hover:bg-gray-200"}`,children:n.name},n.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g(null),className:`px-3 py-1 rounded text-xs ${d?"bg-gray-100 hover:bg-gray-200":"bg-primary text-white"}`,children:"Todos"}),Object.entries(ls).map(([n,m])=>e.jsx("button",{onClick:()=>g(n),className:`px-3 py-1 rounded text-xs ${d===n?"bg-primary text-white":"bg-gray-100 hover:bg-gray-200"}`,children:m},n))]})]})]}),p?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((n,m)=>e.jsx("div",{className:"h-32 bg-gray-100 rounded animate-pulse"},m))}):s.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma partida encontrada."}):e.jsx("ul",{className:"space-y-4",children:s.map(n=>{const m=(n?.sport?.name||"").toLowerCase()==="volei",u=m?O(n,"home"):0,j=m?O(n,"away"):0,A=!n.group_name,M=!!(n.home?.id&&n.away?.id),V=A?M:!0,K=n.status==="ongoing"||n.status==="paused",L=K?n.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs("li",{className:`border rounded-lg p-4 flex flex-col gap-3 bg-white shadow-sm relative overflow-hidden ${L}`,children:[e.jsx(er,{status:n.status}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:n.sport?.name}),n.group_name?` ¬∑ Grupo ${n.group_name}`:"",n.stage?` ¬∑ ${n.stage}`:"",n.round?` ¬∑ J${n.round}`:"",K&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["üïê ",Wa(n,_)]})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${n.status==="ongoing"?"bg-green-100 text-green-700":n.status==="paused"?"bg-yellow-100 text-yellow-700":n.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:ls[n.status]||n.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 items-stretch",children:[e.jsx(ms,{align:"left",team:n.home,score:n.home_score,onInc:()=>J(n,"home","inc"),onDec:()=>J(n,"home","dec"),onReset:()=>J(n,"home","reset"),sets:m?u:null,onSetInc:m?()=>G(n,"home","inc"):void 0,onSetDec:m?()=>G(n,"home","dec"):void 0,onSetReset:m?()=>G(n,"home","reset"):void 0,disabled:C[n.id]||n.status==="scheduled"}),e.jsx(ms,{align:"right",team:n.away,score:n.away_score,onInc:()=>J(n,"away","inc"),onDec:()=>J(n,"away","dec"),onReset:()=>J(n,"away","reset"),sets:m?j:null,onSetInc:m?()=>G(n,"away","inc"):void 0,onSetDec:m?()=>G(n,"away","dec"):void 0,onSetReset:m?()=>G(n,"away","reset"):void 0,disabled:C[n.id]||n.status==="scheduled"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.status==="scheduled"&&e.jsx("button",{onClick:()=>F(n),disabled:C[n.id]||!V,className:"px-3 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:"Iniciar"}),n.status==="ongoing"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>r(n),disabled:C[n.id],className:"px-3 py-1 text-xs rounded bg-yellow-500 text-white hover:bg-yellow-600 disabled:opacity-50",children:"Pausar"}),e.jsx("button",{onClick:()=>y(n),disabled:C[n.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),n.status==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>x(n),disabled:C[n.id],className:"px-3 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:"Retomar"}),e.jsx("button",{onClick:()=>y(n),disabled:C[n.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),n.status==="finished"&&e.jsx("span",{className:"text-xs text-gray-500 self-center",children:"Partida encerrada (resultado edit√°vel)."})]})]},n.id)})}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function ms({team:s,score:t,onInc:a,onDec:o,onReset:i,sets:l,onSetInc:d,onSetDec:g,onSetReset:p,disabled:v,align:C="left"}){const S=C==="right";return e.jsxs("div",{className:`flex flex-col gap-3 border rounded p-3 ${S?"items-end":"items-start"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 w-full ${S?"justify-end":"justify-start"}`,children:[e.jsx(H,{team:s||{name:"A definir"},size:28}),e.jsx("span",{className:"truncate",children:s?.name||"A definir"})]}),typeof l=="number"&&e.jsxs("div",{className:`flex items-center gap-3 ${S?"justify-end":""}`,children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Sets:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:g,disabled:v,className:"px-2 py-1 text-xs border rounded hover:bg-gray-100 disabled:opacity-50",children:"-"}),e.jsx("span",{className:"font-semibold w-6 text-center tabular-nums",children:l}),e.jsx("button",{onClick:d,disabled:v,className:"px-2 py-1 text-xs border rounded hover:bg-gray-100 disabled:opacity-50",children:"+"}),e.jsx("button",{onClick:p,disabled:v,className:"px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50 ml-6",title:"Zerar sets",children:"Zerar"})]})]}),e.jsxs("div",{className:`flex items-center gap-3 ${S?"justify-end":""}`,children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Pontos:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:o,disabled:v,className:"px-2 py-1 text-xs border rounded hover:bg-gray-100 disabled:opacity-50",children:"-"}),e.jsx("span",{className:"font-bold text-lg w-8 text-center tabular-nums",children:Number(t||0)}),e.jsx("button",{onClick:a,disabled:v,className:"px-2 py-1 text-xs border rounded hover:bg-gray-100 disabled:opacity-50",children:"+"}),e.jsx("button",{onClick:i,disabled:v,className:"px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 disabled:opacity-50 ml-6",title:"Zerar pontos",children:"Zerar"})]})]})]})}const he={pebolim:{name:"Pebolim",required:24,path:"/admin/campeonatos/pebolim"},fifa:{name:"FIFA",required:32,path:"/admin/campeonatos/fifa"},futsal:{name:"Futsal",required:9,path:"/admin/campeonatos/futsal"},volei:{name:"V√¥lei",required:9,path:"/admin/campeonatos/volei"}},tr={Pebolim:"pebolim",FIFA:"fifa",Futsal:"futsal",Volei:"volei",V√¥lei:"volei"},ar=(s="")=>s.trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase();function rr(){const[s,t]=c.useState(!0),[a,o]=c.useState({}),[i,l]=c.useState({}),[d,g]=c.useState(null),[p,v]=c.useState(!1),[C,S]=c.useState(null),$=te(),R=async()=>{t(!0);const{data:_,error:E}=await h.from("sports").select("id,name");if(E||!_){o({}),l({}),t(!1);return}const N={},T={};await Promise.all(_.map(async w=>{const k=(w.name??"").trim(),I=tr[k]||ar(k),{count:q}=await h.from("teams").select("*",{count:"exact",head:!0}).eq("sport_id",w.id);N[I]=q||0;const[U,b,D]=await Promise.all([h.from("matches").select("*",{count:"exact",head:!0}).eq("sport_id",w.id),h.from("standings").select("*",{count:"exact",head:!0}).eq("sport_id",w.id),h.from("teams").select("*",{count:"exact",head:!0}).eq("sport_id",w.id).not("group_name","is",null)]);T[I]=(U?.count||0)+(b?.count||0)+(D?.count||0)>0})),o(N),l(T),t(!1)};c.useEffect(()=>{R()},[]);const P=_=>{const{name:E,path:N}=he[_];g({key:_,name:E,path:N})},f=async _=>{try{v(!0);const N={fifa:"FIFA",futsal:"Futsal",volei:"Volei",pebolim:"Pebolim"}[_]??_,{data:T,error:w}=await h.from("sports").select("id,name").eq("name",N).maybeSingle();if(w||!T?.id)throw new Error("Esporte n√£o encontrado.");const{data:k,error:I}=await h.from("matches").select("id").eq("sport_id",T.id);if(I)throw new Error("Erro ao buscar partidas.");const q=(k||[]).map(J=>J.id);if(q.length>0){const{error:J}=await h.from("match_events").delete().in("match_id",q);if(J)throw new Error("Erro ao apagar eventos das partidas.")}const{error:U}=await h.from("matches").delete().eq("sport_id",T.id);if(U)throw new Error("Erro ao apagar partidas.");const{error:b}=await h.from("standings").delete().eq("sport_id",T.id);if(b)throw new Error("Erro ao apagar classifica√ß√£o.");const{error:D}=await h.from("teams").update({group_name:null}).eq("sport_id",T.id);if(D)throw new Error("Erro ao limpar grupos dos times.");S(`Campeonato de ${he[_].name} foi reiniciado com sucesso.`),g(null),await R(),$(he[_].path)}catch(E){S(`Falha ao reiniciar: ${E.message||E}`)}finally{v(!1),setTimeout(()=>S(null),5e3)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Gerenciar Campeonatos"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Escolha a modalidade para configurar os grupos, fases e tabelas."})]}),C&&e.jsx("div",{className:"rounded-md border border-green-300 bg-green-50 text-green-800 px-3 py-2 text-sm",children:C}),s?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Array.from({length:4}).map((_,E)=>e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"h-10 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"mt-3 h-4 w-2/3 bg-gray-100 rounded animate-pulse"})]},E))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Object.entries(he).map(([_,{name:E,required:N,path:T}])=>{const w=a[_]||0,k=w===N,I=!!i[_];let q=`${E} pronto para iniciar!`;if(!k){const b=w-N;b<0?q=`Precisa de ${N} times, tem ${w} (faltam ${Math.abs(b)}).`:q=`Precisa de ${N} times, tem ${w} (${b} a mais).`}const U=()=>{k&&(I?P(_):$(T))};return e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg",children:E}),I&&e.jsx("span",{className:"text-xs rounded-full bg-amber-100 text-amber-700 px-2 py-1 whitespace-nowrap",children:"Existe"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:I?e.jsxs(e.Fragment,{children:["J√° existe um campeonato de ",e.jsx("strong",{children:E}),".",e.jsx("span",{className:"block mt-1 font-medium text-amber-700",children:"Criar novo ir√° apagar os dados atuais."})]}):q}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{disabled:!k,onClick:U,className:`w-full rounded-lg px-4 py-3 text-sm font-semibold transition ${k?"bg-primary text-white hover:bg-primary/90":"bg-gray-100 text-gray-400 border border-gray-300 cursor-not-allowed"}`,children:I?"Criar Novo Campeonato":`Configurar ${E}`}),I&&k&&e.jsx("button",{type:"button",onClick:()=>P(_),className:"w-full rounded-lg px-4 py-2 text-sm font-medium text-red-700 border border-red-300 hover:bg-red-50 transition",children:"Apagar & Reiniciar"})]}),!k&&e.jsxs("div",{className:"text-xs text-gray-500 bg-gray-50 p-2 rounded",children:[e.jsx("strong",{children:"Aten√ß√£o:"})," ",q]})]},_)})}),d&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>g(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Reiniciar ",d.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["J√° existe um campeonato de ",e.jsx("strong",{children:d.name}),". Se voc√™ continuar,",e.jsx("span",{className:"font-medium",children:" todas as partidas, eventos, grupos e a classifica√ß√£o ser√£o apagados"}),". Esta a√ß√£o n√£o pode ser desfeita."]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:()=>g(null),className:"flex-1 rounded-lg border px-4 py-2 text-sm font-medium hover:bg-gray-50 transition",children:"Cancelar"}),e.jsx("button",{onClick:()=>f(d.key),disabled:p,className:`flex-1 rounded-lg px-4 py-2 text-sm font-semibold text-white transition ${p?"bg-red-300":"bg-red-600 hover:bg-red-700"}`,children:p?"Apagando...":"Confirmar"})]})]})]})]})}const Y=["A","B","C"],ae=3;function nr(){const[s,t]=c.useState([]),[a,o]=c.useState({A:[],B:[],C:[]}),[i,l]=c.useState(new Set),[d,g]=c.useState(!0),[p,v]=c.useState(null),[C,S]=c.useState([]),[$,R]=c.useState([]),P=te(),f=c.useMemo(()=>{const r=new Map;return s.forEach(x=>r.set(x.id,x)),r},[s]),_=async()=>{g(!0);const{data:r,error:x}=await h.from("sports").select("id").eq("name","Volei").maybeSingle();if(x||!r?.id){alert("Erro ao buscar a modalidade V√¥lei."),g(!1);return}v(r.id);const{data:y,error:n}=await h.from("teams").select("id,name,logo_url,color,group_name").eq("sport_id",r.id).order("name");if(n){alert("Erro ao carregar times de V√¥lei."),g(!1);return}t(y||[]);const m={A:[],B:[],C:[]};(y||[]).forEach(V=>{V.group_name&&Y.includes(V.group_name)&&m[V.group_name].push(V.id)}),o(m);const{data:u,error:j}=await h.from("standings").select("team_id,group_name,points,goal_difference,goals_for").eq("sport_id",r.id);j&&console.warn("Erro ao carregar standings do V√¥lei:",j.message),S(u||[]);const{data:A,error:M}=await h.from("matches").select(`
        id, stage, round, status,
        home_team_id, away_team_id,
        home:home_team_id ( id, name, logo_url, color ),
        away:away_team_id ( id, name, logo_url, color )
      `).eq("sport_id",r.id).in("stage",["semi","final","3lugar"]);M?(console.warn("Erro ao carregar partidas de mata-mata:",M.message),R([])):R(A||[]),g(!1)};c.useEffect(()=>{_();const r=h.channel("volei-ko").on("postgres_changes",{event:"*",schema:"public",table:"matches"},_).subscribe();return()=>h.removeChannel(r)},[]);const E=c.useMemo(()=>new Set(Y.flatMap(r=>a[r])),[a]),N=c.useMemo(()=>s.filter(r=>!E.has(r.id)),[s,E]),T=r=>{l(x=>{const y=new Set(x);return y.has(r)?y.delete(r):y.add(r),y})},w=r=>{const x=Array.from(i);if(!x.length){alert("Selecione ao menos 1 time.");return}if(a[r].length+x.length>ae){alert(`O grupo ${r} n√£o pode ter mais de ${ae} times.`),l(new Set);return}o(y=>{const n={...y};for(const m of x){for(const u of Y)n[u]=n[u].filter(j=>j!==m);n[r]=[...n[r],m]}return n}),l(new Set)},k=r=>{o(x=>{const y={...x};for(const n of Y)y[n]=y[n].filter(m=>m!==r);return y})},I=Y.every(r=>a[r].length===ae),q=r=>{const x=[],y="Quadra V√¥lei";return Y.forEach(n=>{const m=a[n];m.length===ae&&[[m[0],m[1]],[m[0],m[2]],[m[1],m[2]]].forEach(([j,A],M)=>{x.push({sport_id:r,stage:"grupos",round:M+1,group_name:n,status:"scheduled",home_team_id:j,away_team_id:A,venue:y})})}),x},U=async()=>{if(!I){alert("Complete todos os grupos antes de confirmar!");return}try{if(!p){alert("Modalidade V√¥lei n√£o encontrada.");return}const{error:r}=await h.from("teams").update({group_name:null}).eq("sport_id",p);if(r){alert("Erro ao limpar grupos dos times.");return}for(const y of Y)if(a[y].length>0){const{error:n}=await h.from("teams").update({group_name:y}).in("id",a[y]);if(n){alert(`Erro ao atribuir grupo ${y}.`);return}}await h.rpc("seed_initial_standings",{p_sport_name:"Volei",p_reset:!0}),await h.rpc("rebuild_standings",{p_sport_name:"Volei"});const{count:x}=await h.from("matches").select("*",{count:"exact",head:!0}).eq("sport_id",p).eq("stage","grupos");if(!x||x===0){const y=q(p);if(y.length>0){const{error:n}=await h.from("matches").insert(y);if(n){alert("Erro ao gerar os jogos da fase de grupos.");return}}}await h.rpc("maybe_create_knockout",{p_sport_name:"Volei"}),alert("Grupos confirmados e jogos gerados!"),P("/admin")}catch(r){alert("Erro ao salvar: "+(r?.message||String(r)))}},b=r=>r==null?0:Number(r);function D(r,x){const y=b(r.points),n=b(x.points);if(n!==y)return n-y;const m=b(r.goal_difference),u=b(x.goal_difference);if(u!==m)return u-m;const j=b(r.goals_for),A=b(x.goals_for);if(A!==j)return A-j;const M=String(r.team_id??""),V=String(x.team_id??"");return M<V?-1:M>V?1:0}const J=c.useMemo(()=>{const r={A:[],B:[],C:[]};C.forEach(x=>{Y.includes(x.group_name)&&r[x.group_name].push(x)});for(const x of Y)r[x].length===0&&a[x]?.length&&(r[x]=a[x].map(y=>({team_id:y,group_name:x,points:0,goal_difference:0,goals_for:0}))),r[x].sort(D);return r},[C,a]),O=c.useMemo(()=>{const r=Y.map(A=>J[A]?.[0]).filter(Boolean),x=Y.map(A=>J[A]?.[1]).filter(Boolean);if(r.length<3||x.length<1)return{pairs:[],ready:!1};const y=[...x].sort(D)[0],n=r.find(A=>A.group_name!==y.group_name)||r[0],m=r.filter(A=>A.team_id!==n.team_id),u={round:1,home:f.get(n.team_id)||null,away:f.get(y.team_id)||null};let j={round:2,home:null,away:null};return m.length===2&&(j={round:2,home:f.get(m[0].team_id)||null,away:f.get(m[1].team_id)||null}),{pairs:[u,j],ready:!0}},[J,f]),G=c.useMemo(()=>{const r=new Map(O.pairs.map(m=>[m.round,m])),x=$.filter(m=>m.stage==="semi"),y=[1,2],n=[];for(const m of y){const u=x.find(B=>B.round===m),j=r.get(m),A=!!u?.home_team_id,M=!!u?.away_team_id,V=A?u.home||f.get(u.home_team_id)||null:j?.home||null,K=M?u.away||f.get(u.away_team_id)||null:j?.away||null,L=A&&M;n.push({round:m,home:V,away:K,definitive:L})}return n},[$,O,f]),z=c.useMemo(()=>{const r=$.find(y=>y.stage==="final"),x=$.find(y=>y.stage==="3lugar");return{final:r&&r.home_team_id&&r.away_team_id?{home:r.home||f.get(r.home_team_id)||null,away:r.away||f.get(r.away_team_id)||null}:null,third:x&&x.home_team_id&&x.away_team_id?{home:x.home||f.get(x.home_team_id)||null,away:x.away||f.get(x.away_team_id)||null}:null}},[$,f]),F=async()=>{p&&(await h.rpc("rebuild_standings",{p_sport_name:"Volei"}),await h.rpc("maybe_create_knockout",{p_sport_name:"Volei"}),await _())};return d?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configura√ß√£o do Campeonato de V√¥lei"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. O chaveamento mostra a proje√ß√£o"," ",e.jsx("em",{children:"provis√≥ria"})," pela classifica√ß√£o e vira ",e.jsx("em",{children:"definitivo"})," quando o servidor preencher os slots."]})]}),e.jsx("button",{onClick:F,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"For√ßar atualiza√ß√£o da classifica√ß√£o",children:"Atualizar classifica√ß√£o"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times dispon√≠veis"}),N.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time dispon√≠vel."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:N.map(r=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${i.has(r.id)?"bg-primary text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>T(r.id),title:r.name,children:[e.jsx(Re,{team:r}),e.jsx("span",{className:"truncate",children:r.name})]},r.id))})]}),Y.map(r=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",r]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[r].length===ae?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[r].length,"/",ae]})]}),e.jsx("button",{onClick:()=>w(r),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[r].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[r].map(x=>{const y=s.find(n=>n.id===x);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>k(x),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{team:y}),e.jsx("span",{className:"truncate",title:y?.name,children:y?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},x)})})})]},r))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:Y.map(r=>`${r}(${a[r].length}/${ae})`).join(", ")}),e.jsx("button",{onClick:U,disabled:!Y.every(r=>a[r].length===ae),className:`px-6 py-2 rounded font-semibold transition ${Y.every(r=>a[r].length===ae)?"bg-primary text-white hover:bg-primary/90":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Confirmar grupos e gerar jogos"})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Chaveamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[G.map(r=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Semifinal ",r.round]}),e.jsx("span",{className:`text-[10px] uppercase tracking-wide px-2 py-0.5 rounded ${r.definitive?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:r.definitive?"Definitivo":"Provis√≥rio"})]}),e.jsx(le,{team:r.home,placeholder:"A definir"}),e.jsx("div",{className:"my-1 text-center text-[10px] text-gray-400",children:"vs"}),e.jsx(le,{team:r.away,placeholder:"A definir"})]},r.round)),G.every(r=>!r.home&&!r.away)&&e.jsx("div",{className:"md:col-span-2 text-xs text-gray-500",children:"Semifinais ainda n√£o calcul√°veis. Complete os grupos e/ou atualize a classifica√ß√£o."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Final"}),e.jsx("span",{className:`text-[10px] uppercase tracking-wide px-2 py-0.5 rounded ${z.final?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:z.final?"Definitivo":"A aguardar semis"})]}),e.jsx(le,{team:z.final?.home,placeholder:"Vencedor Semi 1"}),e.jsx("div",{className:"my-1 text-center text-[10px] text-gray-400",children:"vs"}),e.jsx(le,{team:z.final?.away,placeholder:"Vencedor Semi 2"})]}),e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"3¬∫ Lugar"}),e.jsx("span",{className:`text-[10px] uppercase tracking-wide px-2 py-0.5 rounded ${z.third?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:z.third?"Definitivo":"A aguardar semis"})]}),e.jsx(le,{team:z.third?.home,placeholder:"Perdedor Semi 1"}),e.jsx("div",{className:"my-1 text-center text-[10px] text-gray-400",children:"vs"}),e.jsx(le,{team:z.third?.away,placeholder:"Perdedor Semi 2"})]})]})]})]})}function le({team:s,placeholder:t}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{team:s}),e.jsx("span",{className:"text-sm",children:s?.name||e.jsx("span",{className:"text-gray-400",children:t})})]})}function Re({team:s}){const t=or(s?.name),a=s?.color||ir(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function or(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function ir(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const Z=["A","B","C"],re=3;function lr(){const[s,t]=c.useState([]),[a,o]=c.useState({A:[],B:[],C:[]}),[i,l]=c.useState(new Set),[d,g]=c.useState(!0),[p,v]=c.useState(null),[C,S]=c.useState([]),[$,R]=c.useState([]),P=te(),f=c.useMemo(()=>{const r=new Map;return s.forEach(x=>r.set(x.id,x)),r},[s]),_=async()=>{g(!0);const{data:r,error:x}=await h.from("sports").select("id").eq("name","Volei").maybeSingle();if(x||!r?.id){alert("Erro ao buscar a modalidade V√¥lei."),g(!1);return}v(r.id);const{data:y,error:n}=await h.from("teams").select("id,name,logo_url,color,group_name").eq("sport_id",r.id).order("name");if(n){alert("Erro ao carregar times de V√¥lei."),g(!1);return}t(y||[]);const m={A:[],B:[],C:[]};(y||[]).forEach(V=>{V.group_name&&Z.includes(V.group_name)&&m[V.group_name].push(V.id)}),o(m);const{data:u,error:j}=await h.from("standings").select("team_id,group_name,points,goal_difference,goals_for").eq("sport_id",r.id);j&&console.warn("Erro ao carregar standings do V√¥lei:",j.message),S(u||[]);const{data:A,error:M}=await h.from("matches").select(`
        id, stage, round, status,
        home_team_id, away_team_id,
        home:home_team_id ( id, name, logo_url, color ),
        away:away_team_id ( id, name, logo_url, color )
      `).eq("sport_id",r.id).in("stage",["semi","final","3lugar"]);M?(console.warn("Erro ao carregar partidas de mata-mata:",M.message),R([])):R(A||[]),g(!1)};c.useEffect(()=>{_();const r=h.channel("volei-ko").on("postgres_changes",{event:"*",schema:"public",table:"matches"},_).subscribe();return()=>h.removeChannel(r)},[]);const E=c.useMemo(()=>new Set(Z.flatMap(r=>a[r])),[a]),N=c.useMemo(()=>s.filter(r=>!E.has(r.id)),[s,E]),T=r=>{l(x=>{const y=new Set(x);return y.has(r)?y.delete(r):y.add(r),y})},w=r=>{const x=Array.from(i);if(!x.length){alert("Selecione ao menos 1 time.");return}if(a[r].length+x.length>re){alert(`O grupo ${r} n√£o pode ter mais de ${re} times.`),l(new Set);return}o(y=>{const n={...y};for(const m of x){for(const u of Z)n[u]=n[u].filter(j=>j!==m);n[r]=[...n[r],m]}return n}),l(new Set)},k=r=>{o(x=>{const y={...x};for(const n of Z)y[n]=y[n].filter(m=>m!==r);return y})},I=Z.every(r=>a[r].length===re),q=r=>{const x=[],y="Quadra V√¥lei";return Z.forEach(n=>{const m=a[n];m.length===re&&[[m[0],m[1]],[m[0],m[2]],[m[1],m[2]]].forEach(([j,A],M)=>{x.push({sport_id:r,stage:"grupos",round:M+1,group_name:n,status:"scheduled",home_team_id:j,away_team_id:A,venue:y})})}),x},U=async()=>{if(!I){alert("Complete todos os grupos antes de confirmar!");return}try{if(!p){alert("Modalidade V√¥lei n√£o encontrada.");return}const{error:r}=await h.from("teams").update({group_name:null}).eq("sport_id",p);if(r){alert("Erro ao limpar grupos dos times.");return}for(const y of Z)if(a[y].length>0){const{error:n}=await h.from("teams").update({group_name:y}).in("id",a[y]);if(n){alert(`Erro ao atribuir grupo ${y}.`);return}}await h.rpc("seed_initial_standings",{p_sport_name:"Volei",p_reset:!0}),await h.rpc("rebuild_standings",{p_sport_name:"Volei"});const{count:x}=await h.from("matches").select("*",{count:"exact",head:!0}).eq("sport_id",p).eq("stage","grupos");if(!x||x===0){const y=q(p);if(y.length>0){const{error:n}=await h.from("matches").insert(y);if(n){alert("Erro ao gerar os jogos da fase de grupos.");return}}}await h.rpc("maybe_create_knockout",{p_sport_name:"Volei"}),alert("Grupos confirmados e jogos gerados!"),P("/admin")}catch(r){alert("Erro ao salvar: "+(r?.message||String(r)))}},b=r=>r==null?0:Number(r);function D(r,x){const y=b(r.points),n=b(x.points);if(n!==y)return n-y;const m=b(r.goal_difference),u=b(x.goal_difference);if(u!==m)return u-m;const j=b(r.goals_for),A=b(x.goals_for);if(A!==j)return A-j;const M=String(r.team_id??""),V=String(x.team_id??"");return M<V?-1:M>V?1:0}const J=c.useMemo(()=>{const r={A:[],B:[],C:[]};C.forEach(x=>{Z.includes(x.group_name)&&r[x.group_name].push(x)});for(const x of Z)r[x].length===0&&a[x]?.length&&(r[x]=a[x].map(y=>({team_id:y,group_name:x,points:0,goal_difference:0,goals_for:0}))),r[x].sort(D);return r},[C,a]),O=c.useMemo(()=>{const r=Z.map(A=>J[A]?.[0]).filter(Boolean),x=Z.map(A=>J[A]?.[1]).filter(Boolean);if(r.length<3||x.length<1)return{pairs:[],ready:!1};const y=[...x].sort(D)[0],n=r.find(A=>A.group_name!==y.group_name)||r[0],m=r.filter(A=>A.team_id!==n.team_id),u={round:1,home:f.get(n.team_id)||null,away:f.get(y.team_id)||null};let j={round:2,home:null,away:null};return m.length===2&&(j={round:2,home:f.get(m[0].team_id)||null,away:f.get(m[1].team_id)||null}),{pairs:[u,j],ready:!0}},[J,f]),G=c.useMemo(()=>{const r=new Map(O.pairs.map(m=>[m.round,m])),x=$.filter(m=>m.stage==="semi"),y=[1,2],n=[];for(const m of y){const u=x.find(B=>B.round===m),j=r.get(m),A=!!u?.home_team_id,M=!!u?.away_team_id,V=A?u.home||f.get(u.home_team_id)||null:j?.home||null,K=M?u.away||f.get(u.away_team_id)||null:j?.away||null,L=A&&M;n.push({round:m,home:V,away:K,definitive:L})}return n},[$,O,f]),z=c.useMemo(()=>{const r=$.find(y=>y.stage==="final"),x=$.find(y=>y.stage==="3lugar");return{final:r&&r.home_team_id&&r.away_team_id?{home:r.home||f.get(r.home_team_id)||null,away:r.away||f.get(r.away_team_id)||null}:null,third:x&&x.home_team_id&&x.away_team_id?{home:x.home||f.get(x.home_team_id)||null,away:x.away||f.get(x.away_team_id)||null}:null}},[$,f]),F=async()=>{p&&(await h.rpc("rebuild_standings",{p_sport_name:"Volei"}),await h.rpc("maybe_create_knockout",{p_sport_name:"Volei"}),await _())};return d?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configura√ß√£o do Campeonato de V√¥lei"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. O chaveamento mostra a proje√ß√£o"," ",e.jsx("em",{children:"provis√≥ria"})," pela classifica√ß√£o e vira ",e.jsx("em",{children:"definitivo"})," quando o servidor preencher os slots."]})]}),e.jsx("button",{onClick:F,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"For√ßar atualiza√ß√£o da classifica√ß√£o",children:"Atualizar classifica√ß√£o"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times dispon√≠veis"}),N.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time dispon√≠vel."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:N.map(r=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${i.has(r.id)?"bg-primary text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>T(r.id),title:r.name,children:[e.jsx(Fe,{team:r}),e.jsx("span",{className:"truncate",children:r.name})]},r.id))})]}),Z.map(r=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",r]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[r].length===re?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[r].length,"/",re]})]}),e.jsx("button",{onClick:()=>w(r),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[r].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[r].map(x=>{const y=s.find(n=>n.id===x);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>k(x),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{team:y}),e.jsx("span",{className:"truncate",title:y?.name,children:y?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},x)})})})]},r))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:Z.map(r=>`${r}(${a[r].length}/${re})`).join(", ")}),e.jsx("button",{onClick:U,disabled:!Z.every(r=>a[r].length===re),className:`px-6 py-2 rounded font-semibold transition ${Z.every(r=>a[r].length===re)?"bg-primary text-white hover:bg-primary/90":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Confirmar grupos e gerar jogos"})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Chaveamento"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[G.map(r=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Semifinal ",r.round]}),e.jsx("span",{className:`text-[10px] uppercase tracking-wide px-2 py-0.5 rounded ${r.definitive?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:r.definitive?"Definitivo":"Provis√≥rio"})]}),e.jsx(ce,{team:r.home,placeholder:"A definir"}),e.jsx("div",{className:"my-1 text-center text-[10px] text-gray-400",children:"vs"}),e.jsx(ce,{team:r.away,placeholder:"A definir"})]},r.round)),G.every(r=>!r.home&&!r.away)&&e.jsx("div",{className:"md:col-span-2 text-xs text-gray-500",children:"Semifinais ainda n√£o calcul√°veis. Complete os grupos e/ou atualize a classifica√ß√£o."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Final"}),e.jsx("span",{className:`text-[10px] uppercase tracking-wide px-2 py-0.5 rounded ${z.final?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:z.final?"Definitivo":"A aguardar semis"})]}),e.jsx(ce,{team:z.final?.home,placeholder:"Vencedor Semi 1"}),e.jsx("div",{className:"my-1 text-center text-[10px] text-gray-400",children:"vs"}),e.jsx(ce,{team:z.final?.away,placeholder:"Vencedor Semi 2"})]}),e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"3¬∫ Lugar"}),e.jsx("span",{className:`text-[10px] uppercase tracking-wide px-2 py-0.5 rounded ${z.third?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:z.third?"Definitivo":"A aguardar semis"})]}),e.jsx(ce,{team:z.third?.home,placeholder:"Perdedor Semi 1"}),e.jsx("div",{className:"my-1 text-center text-[10px] text-gray-400",children:"vs"}),e.jsx(ce,{team:z.third?.away,placeholder:"Perdedor Semi 2"})]})]})]})]})}function ce({team:s,placeholder:t}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{team:s}),e.jsx("span",{className:"text-sm",children:s?.name||e.jsx("span",{className:"text-gray-400",children:t})})]})}function Fe({team:s}){const t=cr(s?.name),a=s?.color||dr(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function cr(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function dr(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const Pe=16;function mr(){const[s,t]=c.useState([]),[a,o]=c.useState(Array.from({length:Pe},()=>({home:null,away:null}))),[i,l]=c.useState(new Set),[d,g]=c.useState(!0),p=te(),v=async()=>{g(!0);const{data:E,error:N}=await h.from("sports").select("id").eq("name","FIFA").maybeSingle();if(N){alert("Erro ao buscar a modalidade FIFA."),g(!1);return}if(E?.id){const{data:T,error:w}=await h.from("teams").select("id,name,logo_url,color").eq("sport_id",E.id).order("name");w?alert("Erro ao carregar times de FIFA."):t(T||[])}g(!1)};c.useEffect(()=>{v()},[]);const C=c.useMemo(()=>new Set(a.flatMap(E=>[E.home,E.away]).filter(Boolean)),[a]),S=c.useMemo(()=>s.filter(E=>!C.has(E.id)),[s,C]),$=E=>{l(N=>{const T=new Set(N);return T.has(E)?T.delete(E):T.add(E),T})},R=(E,N)=>{const T=Array.from(i);if(T.length===0){alert("Selecione ao menos 1 time.");return}if(T.length>1){alert("Selecione apenas 1 time por vez."),l(new Set);return}const w=T[0];o(k=>{const I=k[E];if(I[N])return alert(`O slot ${N} do Jogo ${E+1} j√° est√° ocupado.`),k;const q=[...k];return q[E]={...I,[N]:w},q}),l(new Set)},P=(E,N)=>{o(T=>{const w=[...T];return w[E]={...w[E],[N]:null},w})},f=a.every(E=>E.home&&E.away)&&a.length===Pe,_=async()=>{if(!f){alert("Todos os confrontos precisam ter 2 times.");return}try{const{data:E,error:N}=await h.from("sports").select("id").eq("name","FIFA").maybeSingle();if(N||!E?.id){alert("N√£o encontrei a modalidade FIFA.");return}const T=E.id,{count:w}=await h.from("matches").select("*",{count:"exact",head:!0}).eq("sport_id",T);if((w??0)>0){if(!window.confirm("J√° existe um campeonato de FIFA. Criar um novo vai apagar jogos e classifica√ß√£o existentes. Deseja continuar?"))return;const{error:b}=await h.from("matches").delete().eq("sport_id",T);if(b){alert("Erro ao apagar jogos existentes: "+b.message);return}const{error:D}=await h.from("standings").delete().eq("sport_id",T);if(D){alert("Erro ao apagar classifica√ß√£o: "+D.message);return}}await h.from("teams").update({group_name:null}).eq("sport_id",T);const k=a.map((U,b)=>({sport_id:T,stage:"oitavas",round:b+1,status:"scheduled",home_team_id:U.home,away_team_id:U.away,venue:"Console FIFA"})),{error:I}=await h.from("matches").insert(k);if(I){alert("Erro ao criar os jogos: "+I.message);return}await h.rpc("seed_initial_standings",{p_sport_name:"FIFA",p_reset:!0});const{error:q}=await h.rpc("maybe_create_knockout",{p_sport_name:"FIFA"});q&&alert("Aviso: n√£o consegui preparar as fases seguintes agora, mas os jogos de oitavas foram criados."),alert("Chaveamento criado com sucesso!"),p("/admin")}catch(E){alert("Erro ao salvar: "+(E?.message||String(E)))}};return d?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configura√ß√£o do Campeonato de FIFA"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecione um time e clique no slot A/B do jogo para alocar. Repita at√© preencher os 16 jogos."}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times dispon√≠veis"}),S.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time dispon√≠vel."}):e.jsx("ul",{className:"grid grid-cols-2 gap-2",children:S.map(E=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${i.has(E.id)?"bg-primary text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>$(E.id),title:E.name,children:[e.jsx(Te,{team:E}),e.jsx("span",{className:"truncate",children:E.name})]},E.id))})]}),e.jsxs("div",{className:"border rounded p-4 overflow-y-auto max-h-[32rem]",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Confrontos (oitavas)"}),e.jsx("ul",{className:"space-y-4",children:a.map((E,N)=>{const T=s.find(k=>k.id===E.home),w=s.find(k=>k.id===E.away);return e.jsxs("li",{className:"flex flex-col gap-1 border rounded p-2 bg-gray-50",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:["Jogo ",N+1]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 flex-1",children:T?e.jsxs(e.Fragment,{children:[e.jsx(Te,{team:T}),e.jsx("span",{className:"truncate",title:T.name,children:T.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>P(N,"home"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>R(N,"home"),children:"Adicionar time A"})}),e.jsx("span",{className:"font-bold",children:"vs"}),e.jsx("div",{className:"flex items-center gap-2 flex-1",children:w?e.jsxs(e.Fragment,{children:[e.jsx(Te,{team:w}),e.jsx("span",{className:"truncate",title:w.name,children:w.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>P(N,"away"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>R(N,"away"),children:"Adicionar time B"})})]})]},N)})})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:f?e.jsxs("span",{className:"text-green-700",children:["Todos os ",Pe," confrontos est√£o prontos!"]}):e.jsxs("span",{children:["Restam ",32-C.size," times para alocar."]})}),e.jsx("button",{onClick:_,disabled:!f,className:`px-6 py-3 rounded font-semibold transition ${f?"bg-primary text-white hover:bg-primary/90":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Confirmar chaveamento"})]})]})}function Te({team:s}){const t=ur(s?.name),a=s?.color||gr(s?.name||"T");return e.jsx("div",{className:"w-7 h-7 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function ur(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function gr(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${(Math.abs(t)%16777215).toString(16).padStart(6,"0")}`}const ee=["A","B","C","D","E","F","G","H"],oe=3;function xr(){const[s,t]=c.useState([]),[a,o]=c.useState(ee.reduce((N,T)=>({...N,[T]:[]}),{})),[i,l]=c.useState(new Set),[d,g]=c.useState(!0),p=te(),v=async()=>{g(!0);const{data:N,error:T}=await h.from("sports").select("id").eq("name","Pebolim").maybeSingle();if(T){alert("Erro ao buscar a modalidade Pebolim."),g(!1);return}if(N?.id){const{data:w,error:k}=await h.from("teams").select("id,name,logo_url,color,group_name").eq("sport_id",N.id).order("name");if(k){alert("Erro ao carregar times de Pebolim."),g(!1);return}t(w||[]);const I=ee.reduce((q,U)=>({...q,[U]:[]}),{});(w||[]).forEach(q=>{q.group_name&&ee.includes(q.group_name)&&I[q.group_name].push(q.id)}),o(I)}g(!1)};c.useEffect(()=>{v()},[]);const C=c.useMemo(()=>new Set(ee.flatMap(N=>a[N])),[a]),S=c.useMemo(()=>s.filter(N=>!C.has(N.id)),[s,C]),$=N=>{l(T=>{const w=new Set(T);return w.has(N)?w.delete(N):w.add(N),w})},R=N=>{const T=Array.from(i);if(T.length===0){alert("Selecione ao menos 1 time.");return}if(a[N].length+T.length>oe){alert(`O grupo ${N} n√£o pode ter mais de ${oe} times.`),l(new Set);return}o(w=>{const k={...w};for(const I of T){for(const q of ee)k[q]=k[q].filter(U=>U!==I);k[N]=[...k[N],I]}return k}),l(new Set)},P=N=>{o(T=>{const w={...T};for(const k of ee)w[k]=w[k].filter(I=>I!==N);return w})},f=ee.every(N=>a[N].length===oe),_=N=>{const T=[],w="Mesa Pebolim";return ee.forEach(k=>{const I=a[k];I.length===oe&&[[I[0],I[1]],[I[0],I[2]],[I[1],I[2]]].forEach(([U,b],D)=>{T.push({sport_id:N,stage:"grupos",round:D+1,group_name:k,status:"scheduled",home_team_id:U,away_team_id:b,venue:w})})}),T},E=async()=>{if(!f){alert("Complete todos os grupos antes de confirmar!");return}try{const{data:N,error:T}=await h.from("sports").select("id").eq("name","Pebolim").maybeSingle();if(T||!N?.id){alert("N√£o encontrei a modalidade Pebolim no banco.");return}const w=N.id,{count:k}=await h.from("matches").select("*",{count:"exact",head:!0}).eq("sport_id",w);if(k&&k>0){if(!window.confirm("J√° existe um campeonato de Pebolim. Criar um novo vai apagar jogos, chaves e classifica√ß√£o existentes. Deseja continuar?"))return;const{error:b}=await h.from("matches").delete().eq("sport_id",w);if(b){alert("Erro ao apagar jogos existentes.");return}const{error:D}=await h.from("standings").delete().eq("sport_id",w);if(D){alert("Erro ao apagar classifica√ß√£o existente.");return}}const{error:I}=await h.from("teams").update({group_name:null}).eq("sport_id",w);if(I){alert("Erro ao limpar grupos dos times.");return}for(const U of ee)if(a[U].length>0){const{error:b}=await h.from("teams").update({group_name:U}).in("id",a[U]);if(b){alert(`Erro ao atribuir grupo ${U}.`);return}}await h.rpc("seed_initial_standings",{p_sport_name:"Pebolim",p_reset:!0}),await h.rpc("rebuild_standings",{p_sport_name:"Pebolim"});const q=_(w);if(q.length>0){const{error:U}=await h.from("matches").insert(q);if(U){console.error("Insert matches error:",U),alert(`Erro ao gerar jogos: ${U.message}
${U.details??""}`);return}}await h.rpc("maybe_create_knockout",{p_sport_name:"Pebolim"}),alert("Grupos confirmados e jogos gerados!"),p("/admin")}catch(N){alert("Erro ao salvar: "+(N?.message||String(N)))}};return d?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configura√ß√£o do Campeonato de Pebolim"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Organize os 24 times em 8 grupos de 3. Clique nos times para selecion√°-los (ficam escuros). Depois clique no bot√£o de um grupo para mover todos os selecionados."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times dispon√≠veis"}),S.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time dispon√≠vel."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:S.map(N=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${i.has(N.id)?"bg-primary text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>$(N.id),title:N.name,children:[e.jsx(us,{team:N}),e.jsx("span",{className:"truncate",children:N.name})]},N.id))})]}),ee.map(N=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",N]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[N].length===oe?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[N].length,"/",oe]})]}),e.jsx("button",{onClick:()=>R(N),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[N].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[N].map(T=>{const w=s.find(k=>k.id===T);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>P(T),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{team:w}),e.jsx("span",{className:"truncate",title:w?.name,children:w?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},T)})})})]},N))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:f?e.jsxs("span",{className:"text-green-700",children:["Tudo certo! ",oe," times em cada grupo."]}):e.jsxs("span",{children:["Complete os grupos:"," ",ee.map(N=>`${N}(${a[N].length}/${oe})`).join(", "),"."]})}),e.jsx("button",{onClick:E,disabled:!f,className:`px-6 py-2 rounded font-semibold transition ${f?"bg-primary text-white hover:bg-primary/90":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Confirmar grupos e gerar jogos"})]})]})}function us({team:s}){const t=hr(s?.name),a=s?.color||pr(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function hr(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function pr(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function fr(){const s=te();return e.jsx("div",{className:"text-center py-12",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-4",children:"404"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-4",children:"P√°gina n√£o encontrada"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"A p√°gina que voc√™ est√° procurando n√£o existe ou foi movida."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>s("/",{replace:!0}),className:"block w-full bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors",children:"Voltar ao In√≠cio"}),e.jsx("button",{onClick:()=>window.history.back(),className:"block w-full bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors",children:"P√°gina Anterior"})]})]})})}function gs(){return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})})}function se({to:s,children:t,className:a,onClick:o,...i}){const l=te(),d=g=>{g.preventDefault(),o&&o(g),l(s,{replace:!1})};return e.jsx(X,{to:s,className:a,onClick:d,...i,children:t})}function yr(){const{session:s,isAdmin:t,ready:a,signOut:o,needsPasswordSetup:i,loading:l}=Oe(),d=Ie(),g=te();if(c.useEffect(()=>{console.log("Route changed to:",d.pathname)},[d.pathname]),!a||l)return e.jsx(gs,{});if(i)return e.jsx(Be,{children:e.jsx(Ge,{children:e.jsx(ns,{})})});const p=async()=>{try{await o(),g("/",{replace:!0})}catch(v){console.error("Error during signout:",v)}};return e.jsx(Be,{children:e.jsx(Ge,{children:e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"bg-primary text-white p-4 sticky top-0 z-50 shadow-md",children:e.jsxs("div",{className:"container mx-auto flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsx(se,{to:"/",className:"text-xl font-bold hover:opacity-90 transition-opacity",children:"Copa Influence üèÜ"}),e.jsxs("nav",{className:"flex flex-wrap items-center gap-3 text-sm",children:[e.jsx(se,{to:"/",className:`hover:underline transition-colors ${d.pathname==="/"?"font-semibold":""}`,children:"Home"}),e.jsx(se,{to:"/futsal",className:`hover:underline transition-colors ${d.pathname==="/futsal"?"font-semibold":""}`,children:"Futsal"}),e.jsx(se,{to:"/volei",className:`hover:underline transition-colors ${d.pathname==="/volei"?"font-semibold":""}`,children:"V√¥lei"}),e.jsx(se,{to:"/fifa",className:`hover:underline transition-colors ${d.pathname==="/fifa"?"font-semibold":""}`,children:"FIFA"}),e.jsx(se,{to:"/pebolim",className:`hover:underline transition-colors ${d.pathname==="/pebolim"?"font-semibold":""}`,children:"Pebolim"}),e.jsx(se,{to:"/ao-vivo",className:`hover:underline transition-colors ${d.pathname==="/ao-vivo"?"font-semibold":""}`,children:"Ao vivo"}),e.jsx(se,{to:"/proximos",className:`hover:underline transition-colors ${d.pathname==="/proximos"?"font-semibold":""}`,children:"Pr√≥ximos"}),a&&t&&e.jsx(se,{to:"/admin",className:`ml-2 inline-block bg-white/15 hover:bg-white/25 transition-colors px-3 py-1 rounded ${d.pathname.startsWith("/admin")?"bg-white/25 font-semibold":""}`,children:"Administrador"})]}),e.jsx("div",{className:"text-sm",children:s?e.jsxs("div",{className:"flex items-center gap-3",children:[s.user?.email&&e.jsx("span",{className:"text-white/80 text-xs",children:s.user.email}),e.jsx("button",{onClick:p,className:"hover:underline transition-colors hover:text-white/80",children:"Sair"})]}):e.jsx(se,{to:"/login",className:"hover:underline transition-colors hover:text-white/80",children:"Entrar"})})]})}),e.jsx("main",{className:"flex-1 container mx-auto p-4",children:e.jsx(qe.Suspense,{fallback:e.jsx(gs,{}),children:e.jsxs(Bs,{children:[e.jsx(Q,{path:"/",element:e.jsx(dt,{})}),e.jsx(Q,{path:"/futsal",element:e.jsx(_t,{})}),e.jsx(Q,{path:"/volei",element:e.jsx(qt,{})}),e.jsx(Q,{path:"/fifa",element:e.jsx(Xt,{})}),e.jsx(Q,{path:"/pebolim",element:e.jsx(ia,{})}),e.jsx(Q,{path:"/ao-vivo",element:e.jsx($a,{})}),e.jsx(Q,{path:"/proximos",element:e.jsx(Fa,{})}),e.jsx(Q,{path:"/team/:id",element:e.jsx(Ze,{})}),e.jsx(Q,{path:"/times/:id",element:e.jsx(Ze,{})}),e.jsx(Q,{path:"/match/:id",element:e.jsx(rs,{})}),e.jsx(Q,{path:"/partida/:id",element:e.jsx(rs,{})}),e.jsx(Q,{path:"/set-password",element:e.jsx(ns,{})}),e.jsx(Q,{path:"/login",element:s?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Voc√™ j√° est√° logado."}),e.jsx(se,{to:t?"/admin":"/",className:"bg-primary text-white px-4 py-2 rounded hover:bg-primary/90",children:t?"Ir para Admin":"Voltar ao In√≠cio"})]}):e.jsx(za,{})}),e.jsx(Q,{path:"/admin",element:e.jsx(ne,{children:e.jsx(Ga,{})})}),e.jsx(Q,{path:"/admin/elencos",element:e.jsx(ne,{children:e.jsx(Ka,{})})}),e.jsx(Q,{path:"/admin/partidas",element:e.jsx(ne,{children:e.jsx(sr,{})})}),e.jsx(Q,{path:"/admin/campeonatos",element:e.jsx(ne,{children:e.jsx(rr,{})})}),e.jsx(Q,{path:"/admin/campeonatos/futsal",element:e.jsx(ne,{children:e.jsx(nr,{})})}),e.jsx(Q,{path:"/admin/campeonatos/volei",element:e.jsx(ne,{children:e.jsx(lr,{})})}),e.jsx(Q,{path:"/admin/campeonatos/fifa",element:e.jsx(ne,{children:e.jsx(mr,{})})}),e.jsx(Q,{path:"/admin/campeonatos/pebolim",element:e.jsx(ne,{children:e.jsx(xr,{})})}),e.jsx(Q,{path:"*",element:e.jsx(fr,{})})]})})}),e.jsx("footer",{className:"bg-gray-200 p-4 text-center text-xs text-gray-700 mt-auto",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("p",{children:["¬© ",new Date().getFullYear()," Copa Influence"]}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Desenvolvido para a comunidade da igreja"})]})})]})})})}ardosrbl/Downloads/church-tournament-app/src/main.jsx;window.addEventListener("unhandledrejection",s=>{console.error("Unhandled promise rejection:",s.reason),s.preventDefault()});window.addEventListener("error",s=>{console.error("Global error:",s.error)});const jr=Qs.createRoot(document.getElementById("root"));jr.render(e.jsx(qe.StrictMode,{children:e.jsx(Gs,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx(Ws,{children:e.jsx(yr,{})})})}));
