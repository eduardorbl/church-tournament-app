import{r as Nt,b as wt,a as vt,c as l,u as ds,N as St,L as X,R as Ve,d as zs,e as me,f as $t,h as Ct,i as ee,B as At}from"./vendor-vbeBnipd.js";import{c as kt}from"./supabase-BfEApigK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function a(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=a(n);fetch(n.href,c)}})();var Je={exports:{}},$e={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var us;function Et(){if(us)return $e;us=1;var s=Nt(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function o(r,u,N){var y,k={},A=null,S=null;N!==void 0&&(A=""+N),u.key!==void 0&&(A=""+u.key),u.ref!==void 0&&(S=u.ref);for(y in u)i.call(u,y)&&!c.hasOwnProperty(y)&&(k[y]=u[y]);if(r&&r.defaultProps)for(y in u=r.defaultProps,u)k[y]===void 0&&(k[y]=u[y]);return{$$typeof:t,type:r,key:A,ref:S,props:k,_owner:n.current}}return $e.Fragment=a,$e.jsx=o,$e.jsxs=o,$e}var gs;function Tt(){return gs||(gs=1,Je.exports=Et()),Je.exports}var e=Tt(),Fe={},hs;function Pt(){if(hs)return Fe;hs=1;var s=wt();return Fe.createRoot=s.createRoot,Fe.hydrateRoot=s.hydrateRoot,Fe}var Ft=Pt();const Mt=vt(Ft),Rt="https://cifdtjfrekucrmapewoj.supabase.co",qt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpZmR0amZyZWt1Y3JtYXBld29qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTM2OTAsImV4cCI6MjA3MzU2OTY5MH0.h4cP9OeroEa4XEQsOrdgy8L-fewT--DC2AtUk9ipJAA",p=kt(Rt,qt),Us=l.createContext({session:null,user:null,isAdmin:!1,needsPasswordSetup:!1,ready:!1,loading:!1,signIn:async()=>({data:null,error:null}),signOut:async()=>({error:null}),updatePassword:async()=>({data:null,error:null}),refreshAuth:async()=>{}});function ms(){return l.useContext(Us)}function It({children:s}){const[t,a]=l.useState(null),[i,n]=l.useState(!1),[c,o]=l.useState(!1),[r,u]=l.useState(!1),[N,y]=l.useState(!0),k=l.useRef(!0),A=l.useRef(0),S=O=>O?.user_metadata?.password_set===!0;l.useEffect(()=>{k.current=!0,(async()=>{try{y(!0);const{data:D,error:C}=await p.auth.getSession();if(C)throw C;const f=D?.session??null;if(!k.current)return;a(f),o(f?.user?!S(f.user):!1),u(!0),y(!1),f?.user?.id?P(f):n(!1)}catch(D){if(console.error("Auth init error:",D),!k.current)return;a(null),n(!1),o(!1),u(!0),y(!1)}})();const{data:O}=p.auth.onAuthStateChange(async(D,C)=>{k.current&&(a(C??null),C?.user?(o(!S(C.user)),C.user.id?P(C):n(!1)):(n(!1),o(!1)))});return()=>{k.current=!1,O?.subscription?.unsubscribe?.()}},[]);const P=async O=>{const D=++A.current;try{if(!O?.user?.id){k.current&&D===A.current&&n(!1);return}const{data:f,error:h}=await p.rpc("is_admin");k.current&&D===A.current&&n(!!f&&!h)}catch(C){console.error("checkAdmin error:",C),k.current&&D===A.current&&n(!1)}},w=async(O,D)=>{const C=await p.auth.signInWithPassword({email:O,password:D});return C.data?.session?.user?.id&&!C.error&&(a(C.data.session),o(!S(C.data.session.user)),P(C.data.session)),C},M=async()=>{const{error:O}=await p.auth.signOut();return O||(a(null),n(!1),o(!1)),{error:O}},T=async O=>{const{data:D,error:C}=await p.auth.updateUser({password:O,data:{password_set:!0}});if(!C){o(!1);const{data:f}=await p.auth.getSession();a(f?.session??null)}return{data:D,error:C}},z=async()=>{const{data:O}=await p.auth.getSession(),D=O?.session??null;a(D),D?.user?.id?(o(!S(D.user)),P(D)):(n(!1),o(!1))},G={session:t,user:t?.user??null,isAdmin:i,needsPasswordSetup:c,ready:r,loading:N,signIn:w,signOut:M,updatePassword:T,refreshAuth:z};return e.jsx(Us.Provider,{value:G,children:s})}function ue({children:s}){const{ready:t,session:a,isAdmin:i}=ms(),n=ds();if(!t)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Verificando permissões..."})]})});if(!a||!i){const c=encodeURIComponent(n.pathname+n.search);return e.jsx(St,{to:`/login?redirect=${c}&reason=forbidden`,replace:!0})}return s}function se({team:s={},size:t=24,className:a=""}){const[i,n]=l.useState(!1),c=l.useMemo(()=>{const u=s?.logo_url;return typeof u=="string"&&u.trim()&&!i?u:null},[s?.logo_url,i]),o=l.useMemo(()=>{const u=String(s?.name??"").trim();if(!u)return"•";const N=u.match(new RegExp("\\p{L}","u"));return(N?N[0]:u[0]).toUpperCase()},[s?.name]),r={width:t,height:t};return e.jsx("span",{className:`inline-flex items-center justify-center rounded border border-gray-200 bg-white overflow-hidden ${a}`,style:r,title:s?.name,children:c?e.jsx("img",{src:c,alt:s?.name||"Logo",className:"w-full h-full object-cover",onError:()=>n(!0),draggable:!1}):e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-gray-600 select-none",children:o})})}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ot=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,a,i)=>i?i.toUpperCase():a.toLowerCase()),ps=s=>{const t=Ot(s);return t.charAt(0).toUpperCase()+t.slice(1)},Js=(...s)=>s.filter((t,a,i)=>!!t&&t.trim()!==""&&i.indexOf(t)===a).join(" ").trim(),Lt=s=>{for(const t in s)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Dt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=l.forwardRef(({color:s="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:i,className:n="",children:c,iconNode:o,...r},u)=>l.createElement("svg",{ref:u,...Dt,width:t,height:t,stroke:s,strokeWidth:i?Number(a)*24/Number(t):a,className:Js("lucide",n),...!c&&!Lt(r)&&{"aria-hidden":"true"},...r},[...o.map(([N,y])=>l.createElement(N,y)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=(s,t)=>{const a=l.forwardRef(({className:i,...n},c)=>l.createElement(Bt,{ref:c,iconNode:t,className:Js(`lucide-${Gt(ps(s))}`,`lucide-${s}`,i),...n}));return a.displayName=ps(s),a};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Hs=te("chevron-right",Vt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],Ut=te("chevrons-right",zt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ks=te("circle-play",Jt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Xs=te("circle-question-mark",Ht);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=[["path",{d:"M12 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 12 18z",key:"b19h5q"}],["path",{d:"M2 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 2 18z",key:"h7h5ge"}]],Xt=te("fast-forward",Kt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],Qt=te("list-checks",Zt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Yt=te("loader-circle",Wt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],sa=te("megaphone",ea);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],aa=te("refresh-cw",ta);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],na=te("rotate-cw",ra);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],xs=te("settings",oa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],la=te("shield-alert",ia);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],da=te("trash-2",ca);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],Zs=te("trophy",ma),fs=[{name:"Volei",label:"Vôlei",key:"volei",callText:"⚠️ Compareçam à quadra de Vôlei:"},{name:"Futsal",label:"Futsal",key:"futsal",callText:"⚠️ Compareçam à quadra de Futsal:"},{name:"Pebolim",label:"Pebolim",key:"pebolim",callText:"⚠️ Compareçam à mesa de pebolim:"},{name:"FIFA",label:"FIFA",key:"fifa",callText:"⚠️ Compareçam à área do console:"}],ua={r32:"PRÉ-OITAVAS",grupos:"GRUPOS",oitavas:"OITAVAS",quartas:"QUARTAS",semi:"SEMI",final:"FINAL","3lugar":"3º LUGAR"};function ga(s){return s?ua[s]||String(s).toUpperCase():null}const ha="team-logos";function Qs(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function pa(s){return typeof s=="string"&&!Qs(s)&&s.trim()!==""}function xa(s){if(!s)return null;if(Qs(s))return s;if(pa(s)){const{data:t}=p.storage.from(ha).getPublicUrl(s);return t?.publicUrl||null}return null}function fa(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),n=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(n<0)return"0:00";const c=Math.floor(n/1e3),o=Math.floor(c/60),r=c%60;return`${o}:${r.toString().padStart(2,"0")}`}function ys(s,t){const a=s?.meta||{};return Math.max(0,Number(a[t==="home"?"home_sets":"away_sets"]||0))}function ya({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function ja(){const[s,t]=l.useState({}),[a,i]=l.useState(!0),[n,c]=l.useState(null),[o,r]=l.useState(Date.now()),u=l.useRef(!0),N=l.useRef(!1),y=async()=>{if(!N.current){N.current=!0,i(!0),c(null);try{const{data:A,error:S}=await p.from("sports").select("id,name");if(S)throw S;const P=new Map((A||[]).map(T=>[T.name,T.id])),w=fs.filter(T=>P.has(T.name)).map(T=>({...T,sportId:P.get(T.name)})),M=await Promise.all(w.map(async T=>{const{data:z,error:G}=await p.from("v_queue_slots").select("slot, order_idx, match_id, stage, group_name").eq("sport_id",T.sportId);if(G)throw G;const O=Object.fromEntries((z||[]).map(_=>[_.slot,_])),D=(z||[]).map(_=>_.match_id).filter(Boolean);let C={};if(D.length){const{data:_}=await p.from("matches").select(`
                id, order_idx, stage, group_name, status, starts_at, updated_at, venue, meta,
                home_score, away_score,
                home:home_team_id ( id, name, logo_url, color ),
                away:away_team_id ( id, name, logo_url, color ),
                sport:sport_id ( id, name )
              `).in("id",D),F=(_||[]).map(d=>{const m=d.home&&typeof d.home=="object"?{...d.home,logo_url:ye(d.home.logo_url)}:d.home,E=d.away&&typeof d.away=="object"?{...d.away,logo_url:ye(d.away.logo_url)}:d.away;return{...d,home:m,away:E}});C=Object.fromEntries(F.map(d=>[d.id,d]))}if(!O?.live?.match_id){const{data:_,error:F}=await p.from("matches").select(`
                id, order_idx, stage, group_name, status, starts_at, updated_at, venue, meta,
                home_score, away_score,
                home:home_team_id ( id, name, logo_url, color ),
                away:away_team_id ( id, name, logo_url, color ),
                sport:sport_id ( id, name )
              `).eq("sport_id",T.sportId).in("status",["ongoing","paused"]).limit(6);if(!F&&_?.length){const d=_.slice().sort((v,q)=>{const $=U=>U==="ongoing"?1:U==="paused"?2:9,R=$(v.status)-$(q.status);return R!==0?R:new Date(q.updated_at||q.starts_at||0)-new Date(v.updated_at||v.starts_at||0)})[0],m=d.home&&typeof d.home=="object"?{...d.home,logo_url:ye(d.home.logo_url)}:d.home,E=d.away&&typeof d.away=="object"?{...d.away,logo_url:ye(d.away.logo_url)}:d.away,g={...d,home:m,away:E};C[g.id]=g,O.live={slot:"live",match_id:g.id,order_idx:g.order_idx,stage:g.stage,group_name:g.group_name}}}const f=[O.call?.match_id,O.next?.match_id].filter(Boolean),{data:h}=await p.from("matches").select(`
              id, order_idx, stage, group_name, status,
              home:home_team_id ( id, name, logo_url, color ),
              away:away_team_id ( id, name, logo_url, color )
            `).eq("sport_id",T.sportId).eq("status","scheduled").not("order_idx","is",null).order("order_idx",{ascending:!0}).limit(10),b=(h||[]).filter(_=>!f.includes(_.id)).slice(0,6).map(_=>({id:_.id,order_idx:_.order_idx,stage:_.stage,group_name:_.group_name,home:_.home?{..._.home,logo_url:ye(_.home.logo_url)}:null,away:_.away?{..._.away,logo_url:ye(_.away.logo_url)}:null}));return[T.key,{...T,slots:O,details:C,compactUpcoming:b}]}));t(Object.fromEntries(M))}catch(A){c(`Falha ao carregar a Home: ${A.message||A}`)}finally{i(!1),N.current=!1}}};l.useEffect(()=>{u.current=!0,y();const A=setInterval(()=>r(Date.now()),1e3),S=p.channel("home-central").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>u.current&&y()).on("postgres_changes",{event:"*",schema:"public",table:"match_events"},()=>u.current&&y()).subscribe();return()=>{u.current=!1,clearInterval(A),p.removeChannel(S)}},[]);const k=l.useMemo(()=>fs.map(A=>A.key).filter(A=>s[A]),[s]);return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Central do Evento"})]}),e.jsxs("button",{onClick:y,className:"inline-flex items-center gap-2 rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Recarregar agora",children:[e.jsx(aa,{className:"h-4 w-4"}),"Atualizar"]})]}),n&&e.jsx("div",{className:"mb-5 rounded-xl border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-800",children:n}),a?e.jsx(Na,{}):e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:k.map(A=>e.jsx(ba,{block:s[A],now:o},A))}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function ba({block:s,now:t}){const{label:a,callText:i,slots:n,details:c,compactUpcoming:o}=s||{},r=n?.live?.match_id?c?.[n.live.match_id]:null,u=n?.call?.match_id?c?.[n.call.match_id]:null,N=n?.next?.match_id?c?.[n.next.match_id]:null;return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between gap-3 p-4 sm:p-5",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-lg font-semibold",children:a})})}),e.jsx("div",{className:"px-4 sm:px-5",children:e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-red-800",children:[e.jsx(Ks,{className:"h-4 w-4"}),r?e.jsxs(X,{to:`/match/${r.id}`,className:"hover:underline",children:[r.status==="paused"?"Pausado":"Ao vivo"," — Jogo ",r.order_idx,r.group_name?` • Grupo ${r.group_name}`:""]}):e.jsx("span",{children:"Ao vivo"})]}),r?.stage?e.jsx(ss,{stage:r.stage}):e.jsx("span",{className:"text-xs text-red-700/70",children:"Aguardando…"})]}),r?e.jsx(_a,{match:r,now:t}):e.jsx("div",{className:"text-sm text-gray-600",children:"Nenhuma partida ao vivo no momento."})]})}),e.jsx("div",{className:"px-4 pb-4 sm:px-5 sm:pb-5",children:e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(js,{tone:"amber",icon:e.jsx(sa,{className:"h-4 w-4"}),title:"Próxima partida",subtitle:i,match:u}),e.jsx(js,{tone:"emerald",icon:e.jsx(Ut,{className:"h-4 w-4"}),title:"Jogo seguinte",subtitle:"Na sequência:",match:N})]})}),o?.length?e.jsxs("div",{className:"border-t px-4 py-3 sm:px-5",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-gray-800",children:"Agendados (próximos)"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:o.map(y=>e.jsxs(X,{to:`/match/${y.id}`,className:"flex items-center justify-between rounded-lg border bg-gray-50 px-3 py-2 hover:bg-gray-100",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"truncate text-sm font-medium text-gray-900",children:["Jogo ",y.order_idx,y.group_name?` • Grupo ${y.group_name}`:""]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-gray-700",children:[e.jsx(Be,{team:y.home,size:20,allowLink:!1}),e.jsx("span",{className:"text-gray-400",children:"x"}),e.jsx(Be,{team:y.away,size:20,align:"right",allowLink:!1})]})]}),e.jsx("div",{className:"ml-3 shrink-0",children:e.jsx(ss,{stage:y.stage})})]},y.id))})]}):null]})}function ss({stage:s}){const t=ga(s);return t?e.jsx("span",{className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-semibold tracking-wide text-gray-700",children:t}):null}function _a({match:s,now:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),i=s.status!=="scheduled",n=Number(s?.home_score??0),c=Number(s?.away_score??0),o=a?ys(s,"home"):0,r=a?ys(s,"away"):0;return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl bg-white p-3 shadow-sm hover:bg-gray-50 relative overflow-hidden",children:[e.jsx(ya,{status:s.status}),e.jsxs("div",{className:"mb-2 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.group_name?e.jsxs("span",{children:["Grupo ",s.group_name]}):e.jsx("span",{}),s.venue?e.jsxs("span",{className:"text-gray-400",children:["• ",s.venue]}):null]}),(s.status==="ongoing"||s.status==="paused")&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",fa(s,t)]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(bs,{team:s.home,align:"left"}),e.jsxs("div",{className:"shrink-0 text-center",children:[a&&e.jsxs("div",{className:"text-[11px] font-semibold text-gray-600 tabular-nums",children:[o," ",e.jsx("span",{className:"text-gray-400",children:"sets"})," ",r]}),i?e.jsxs("div",{className:"text-xl font-bold tabular-nums",children:[n," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",c]}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"})]}),e.jsx(bs,{team:s.away,align:"right"})]})]})}function js({tone:s,icon:t,title:a,subtitle:i,match:n}){const c=s==="amber"?"border-amber-200 bg-amber-50":s==="emerald"?"border-emerald-200 bg-emerald-50":"border-gray-200 bg-gray-50";return e.jsxs("div",{className:`rounded-xl border ${c} p-3 sm:p-4`,children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[t,e.jsx("span",{children:a})]}),n?.stage?e.jsx(ss,{stage:n.stage}):null]}),e.jsx("div",{className:"text-xs text-gray-600",children:i}),e.jsx("div",{className:"mt-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.jsxs(X,{to:`/match/${n.id}`,className:"hover:underline",children:["Jogo ",n.order_idx,n.group_name?` • Grupo ${n.group_name}`:""]})}),e.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[e.jsx(Be,{team:n.home}),e.jsx("span",{className:"px-1 text-gray-400",children:"x"}),e.jsx(Be,{team:n.away,align:"right"})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-gray-500 flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:n.venue||""}),e.jsxs(X,{to:`/match/${n.id}`,className:"inline-flex items-center gap-1 text-blue-600 hover:underline",children:["Ver partida ",e.jsx(Hs,{className:"h-3.5 w-3.5"})]})]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Aguardando…"})})]})}function Be({team:s,size:t=24,align:a="left",allowLink:i=!0}){const n=e.jsxs(e.Fragment,{children:[e.jsx(se,{team:s||{name:"A definir"},size:t}),e.jsx("span",{className:`truncate text-sm ${a==="right"?"text-right":""}`,children:s?.name||"A definir"})]});return!i||!s?.id?e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${a==="right"?"justify-end":""}`,children:n}):e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 ${a==="right"?"justify-end":""} hover:underline`,title:s?.name,onClick:c=>c.stopPropagation(),children:n})}function bs({team:s,align:t="left"}){return e.jsxs("div",{className:`flex items-center ${t==="right"?"justify-end":""} gap-2 min-w-0 flex-1`,children:[t!=="right"&&e.jsx(se,{team:s||{name:"A definir"},size:36}),s?.id?e.jsx(X,{to:`/team/${s.id}`,className:`truncate text-sm font-medium hover:underline ${t==="right"?"text-right":"text-left"}`,title:s?.name,onClick:a=>a.stopPropagation(),children:s?.name||"A definir"}):e.jsx("span",{className:`truncate text-sm ${t==="right"?"text-right text-gray-400":"text-gray-400"}`,children:"A definir"}),t==="right"&&e.jsx(se,{team:s||{name:"A definir"},size:36})]})}function Na(){return e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:Array.from({length:4}).map((s,t)=>e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("div",{className:"mb-3 h-6 w-40 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"mb-3 h-24 animate-pulse rounded bg-red-100/60"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsx("div",{className:"h-20 animate-pulse rounded bg-amber-100/60"}),e.jsx("div",{className:"h-20 animate-pulse rounded bg-emerald-100/60"})]}),e.jsx("div",{className:"mt-3 h-16 animate-pulse rounded bg-gray-100"})]},t))})}function ye(s){const t=xa(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null}const wa="Futsal",va="⚽",Sa="team-logos",$a="America/Sao_Paulo",Ca={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Ws=s=>s?Ca[s]||s:"",Aa=new Set(["grupos","grupo","groups","group","group stage","group_stage","fase de grupos","fase-de-grupos"]),ka=new Set(["finished","encerrado","finalizado","completed","complete","cancelado","cancelled","canceled","walkover","wo"]),Ys=s=>s==null?"":String(s).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().trim();function Ea(s){if(!s)return!1;const t=Ys(s.stage);if(t)return Aa.has(t);const a=String(s?.group_name??"").trim();return!a||a==="-"?!1:!!(/^grupo\s+/i.test(a)||/^[a-z0-9]$/i.test(a))}const Ta=s=>ka.has(Ys(s));function et(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function ts(s){const t=et(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:$a,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const Me=s=>{const t=et(s);return t?t.getTime():Number.POSITIVE_INFINITY},st=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Pa=s=>typeof s=="string"&&!st(s)&&s.trim()!=="";function Fa(s){if(!s)return null;if(st(s))return s;if(Pa(s)){const{data:t}=p.storage.from(Sa).getPublicUrl(s);return t?.publicUrl||null}return null}const je=s=>{const t=Fa(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};let Ma=class extends Ve.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Futsal ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}};function tt({order_idx:s,stage:t,group_name:a}){const i=[];return s!=null&&String(s).length&&i.push(`Jogo ${s}`),a?i.push(`Grupo ${a}`):t&&i.push(Ws(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:i.join(" • ")||"—"})}function as({team:s,align:t="left",badge:a=28}){const i=(()=>{const r=s?.name;if(typeof r=="string")return r;if(r&&typeof r=="object"&&"name"in r)return String(r.name);try{return String(r??"A definir")}catch{return"A definir"}})(),n=!!s?.id,c=!n&&i==="A definir",o=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:i},size:a}),e.jsxs("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:[i,c?e.jsx(Xs,{className:"inline-block ml-1 w-4 h-4 text-gray-400"}):null]}),t==="right"?e.jsx(se,{team:{...s||{},name:i},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:r=>r.stopPropagation(),title:i,children:o}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:o})}function Ce({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),i=s?.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},c=i?.id?i:{name:i?.name||"A definir"},o=s?.status&&s.status!=="scheduled",r=Number(s?.home_score??0),u=Number(s?.away_score??0),N=({value:A})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:o?A:"-"})]}),y=({team:A,align:S,score:P})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${S==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(as,{team:A,align:S})}),e.jsx(N,{value:P})]}),k=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(tt,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(y,{team:n,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(y,{team:c,align:"right",score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ts(s.starts_at):s?.venue||""}),o?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",u]}):null]})]});return s?.id?e.jsx(X,{to:`/match/${s.id}`,className:"block",children:k}):e.jsx("div",{className:"block",children:k})}function _s({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),i=Number(s?.away_score??0);return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(tt,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(as,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs("span",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",i]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(as,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ts(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",ts(s.updated_at)]}):null]})]})}function Ra(s,t){const a=Number(s.points??0),i=Number(t.points??0);if(i!==a)return i-a;const n=Number(s.wins??0),c=Number(t.wins??0);if(c!==n)return c-n;const o=Number(s.goal_difference??Number(s.goals_for??0)-Number(s.goals_against??0)),r=Number(t.goal_difference??Number(t.goals_for??0)-Number(t.goals_against??0));if(r!==o)return r-o;const u=Number(s.goals_for??0),N=Number(t.goals_for??0);return N!==u?N-u:String(s.team_id).localeCompare(String(t.team_id))}function Re(s,t){return(t.points??0)-(s.points??0)||(t.wins??0)-(s.wins??0)||(t.goal_difference??0)-(s.goal_difference??0)||(t.goals_for??0)-(s.goals_for??0)||String(s.team_id).localeCompare(String(t.team_id))}function qa(s,t={}){if(!Array.isArray(s)||s.length===0)return[];const a=r=>{const u=t[r.team_id];return u?{id:r.team_id,name:String(u.name??r.team_name??"—"),color:u.color,logo_url:u.logo_url}:{id:r.team_id,name:String(r.team_name??"—")}},i=new Map;for(const r of s){const u=r.group_name||"-";i.has(u)||i.set(u,[]),i.get(u).push(r)}for(const r of i.keys())i.get(r).sort(Re);const n=[],c=[];for(const[r,u]of i)u[0]&&n.push({group:r,row:u[0]}),u[1]&&c.push({group:r,row:u[1]});n.sort((r,u)=>Re(r.row,u.row)),c.sort((r,u)=>Re(r.row,u.row));const o=n.length;if(o>=4){const r=n.slice(0,4);return[{stage:"semi",home:a(r[0].row),away:a(r[3].row)},{stage:"semi",home:a(r[1].row),away:a(r[2].row)}]}else{if(o===3)return c.length?[{stage:"semi",home:a(n[0].row),away:a(c[0].row)},{stage:"semi",home:a(n[1].row),away:a(n[2].row)}]:[];if(o===2){if(c.length<2)return[];const r=[n[0].row,n[1].row,c[0].row,c[1].row].sort(Re);return[{stage:"semi",home:a(r[0]),away:a(r[3])},{stage:"semi",home:a(r[1]),away:a(r[2])}]}}return[]}function Ia({standings:s,teamsById:t}){const a=l.useMemo(()=>{const n={};for(const r of s||[]){const u=r.group_name||"-";n[u]||(n[u]=[]),n[u].push(r)}const c=new Set,o={};for(const r in t){const u=t[r],N=u.group_name||"-";c.add(N),o[N]||(o[N]=[]),o[N].push(u)}for(const r of c){const u=new Set((n[r]||[]).map(k=>String(k.team_id))),y=(o[r]||[]).filter(k=>!u.has(String(k.id))).map(k=>({group_name:r,team_id:k.id,team_name:k.name,matches_played:0,wins:0,draws:0,losses:0,goals_for:0,goals_against:0,goal_difference:0,points:0}));n[r]=[...n[r]||[],...y],n[r].sort(Ra),n[r]=n[r].map((k,A)=>({...k,rank:A+1}))}return n},[s,t]),i=Object.keys(a).sort();return i.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:i.map(n=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",n]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"E"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[n].map(c=>{const o=t[c.team_id]&&typeof t[c.team_id]=="object"?t[c.team_id]:{id:c.team_id,name:String(c.team_name??t[c.team_id]?.name??"—")},r={...o,name:typeof o.name=="string"?o.name:String(o.name??"—")};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:c.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${r.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:r,size:20}),e.jsx("span",{className:"truncate",children:r.name})]})}),e.jsx("td",{className:"py-1 text-center",children:c.matches_played}),e.jsx("td",{className:"py-1 text-center",children:c.wins}),e.jsx("td",{className:"py-1 text-center",children:c.draws}),e.jsx("td",{className:"py-1 text-center",children:c.losses}),e.jsx("td",{className:"py-1 text-center",children:c.goals_for}),e.jsx("td",{className:"py-1 text-center",children:c.goals_against}),e.jsx("td",{className:"py-1 text-center",children:c.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:c.points})]},`${n}-${c.team_id}`)})})]}),e.jsx("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:"Critérios: Pontos, Vitórias, Saldo de Gols, Gols Pró."})]},n))})}function Ga(s){const t=c=>(s||[]).filter(o=>o.stage===c).sort((o,r)=>(Number(o?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(r?.order_idx)||Number.MAX_SAFE_INTEGER)),a=t("semi"),i=t("final"),n=t("3lugar");return{semis:a,final:i[0],third:n[0]}}function Oa(){const[s,t]=l.useState(null),[a,i]=l.useState({}),[n,c]=l.useState([]),[o,r]=l.useState([]),[u,N]=l.useState(!0),[y,k]=l.useState("todos"),[A,S]=l.useState("todos"),P=l.useRef(null),w=l.useRef(null),M=l.useCallback(async()=>{try{const{data:g,error:v}=await p.from("sports").select("id").eq("name","Futsal").maybeSingle();if(v)throw v;g?.id?t(g.id):(console.warn("⚠️ Esporte 'Futsal' não encontrado na tabela sports."),t(null))}catch(g){console.error("Exceção loadSportId:",g),t(null)}},[]),T=l.useCallback(async g=>{try{if(g){const $=await p.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",g);if(!$.error&&Array.isArray($.data)&&$.data.length>0){const R={};for(const U of $.data)R[U.id]={...U,name:String(U.name??"—"),logo_url:je(U.logo_url),group_name:U.group_name??"-"};i(R);return}}const v=await p.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").eq("sport.name","Futsal");if(v.error)throw v.error;const q={};for(const $ of v.data||[])q[$.id]={...$,name:String($.name??"—"),logo_url:je($.logo_url),group_name:$.group_name??"-"};i(q)}catch(v){console.error("Exceção loadTeams:",v),i({})}},[]),z=l.useCallback(async g=>{try{if(g){const R=await p.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points").eq("sport_id",g).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!R.error&&Array.isArray(R.data)&&R.data.length>0){c(R.data);return}}const v=await p.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points, sport:sport_id!inner(name)").eq("sport.name","Futsal").order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!v.error&&Array.isArray(v.data)&&v.data.length>0){c(v.data.map(({sport:R,...U})=>U));return}if(g){const R=await p.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, draws, losses,
            goals_for, goals_against, goal_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",g).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!R.error&&Array.isArray(R.data)&&R.data.length>0){c(R.data.map(U=>({...U,team_name:U.team?.name})));return}}const $=((await p.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, draws, losses,
          goals_for, goals_against, goal_difference, points,
          team:teams!standings_team_id_fkey(name),
          sport:sport_id!inner(name)
        `).eq("sport.name","Futsal").order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(R=>({...R,team_name:R.team?.name}));c($)}catch(v){console.error("Exceção loadStandings:",v),c([])}},[]),G=l.useCallback(async g=>{try{let v=[];if(g){const{data:R,error:U}=await p.from("match_detail_view").select(`
            id, sport_id, order_idx,
            stage, round, group_name, starts_at, updated_at, venue, status,
            home_team_id, home_team_name, home_team_color, home_team_logo,
            away_team_id, away_team_name, away_team_color, away_team_logo,
            home_score, away_score
          `).eq("sport_id",g);!U&&Array.isArray(R)&&R.length&&(v=R.map(j=>({id:j.id,sport_id:j.sport_id,order_idx:j.order_idx,stage:j.stage,round:j.round,group_name:j.group_name,starts_at:j.starts_at,updated_at:j.updated_at,venue:j.venue,status:j.status,home_score:j.home_score,away_score:j.away_score,home:j.home_team_id?{id:j.home_team_id,name:String(j.home_team_name??"A definir"),color:j.home_team_color,logo_url:je(j.home_team_logo)}:null,away:j.away_team_id?{id:j.away_team_id,name:String(j.away_team_name??"A definir"),color:j.away_team_color,logo_url:je(j.away_team_logo)}:null})))}if(!v.length){const{data:R,error:U}=await p.from("matches").select(`
            id, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score, order_idx,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color ),
            sport:sport_id!inner(name)
          `).eq("sport.name","Futsal");if(U)throw U;v=(R||[]).map(j=>({...j,order_idx:j.order_idx??j.round??j.id,home:j.home?{...j.home,name:String(j.home.name??"A definir"),logo_url:je(j.home.logo_url)}:null,away:j.away?{...j.away,name:String(j.away.name??"A definir"),logo_url:je(j.away.logo_url)}:null}))}const q={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6},$=R=>Number.isFinite(Number(R?.order_idx))?Number(R.order_idx):Number.MAX_SAFE_INTEGER;v.sort((R,U)=>(q[R.stage]??99)-(q[U.stage]??99)||$(R)-$(U)),r(v)}catch(v){console.error("Exceção loadMatches:",v),r([])}},[]),O=l.useCallback(async(g,{skeleton:v=!1}={})=>{v&&N(!0);try{await Promise.all([T(g),z(g),G(g)])}finally{N(!1)}},[T,z,G]);l.useEffect(()=>{M()},[M]),l.useEffect(()=>{if(!s){N(!1);return}if(O(s,{skeleton:!0}),P.current){try{p.removeChannel(P.current)}catch{}P.current=null}const g=p.channel("futsal-hub").on("postgres_changes",s?{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`}:{event:"*",schema:"public",table:"matches"},()=>{w.current&&clearTimeout(w.current),w.current=setTimeout(()=>O(s,{skeleton:!1}),200)}).on("postgres_changes",{event:"*",schema:"public",table:"standings"},()=>{w.current&&clearTimeout(w.current),w.current=setTimeout(()=>O(s,{skeleton:!1}),200)}).subscribe();return P.current=g,()=>{if(w.current&&(clearTimeout(w.current),w.current=null),P.current){try{p.removeChannel(P.current)}catch{}P.current=null}}},[s,O]);const D=l.useMemo(()=>!!(n?.length||(o||[]).some(g=>!!g.group_name)||Object.values(a||{}).some(g=>!!g.group_name)),[n,o,a]),C=l.useMemo(()=>{const g=(o||[]).filter(Ea);return g.length?g.every(v=>Ta(v?.status)):!0},[o]),f=l.useMemo(()=>Ga(o),[o]),h=f.semis||[],b=l.useMemo(()=>C?qa(n,a):[],[C,n,a]),_=l.useMemo(()=>h.length?h:b,[h,b]),F=l.useMemo(()=>{const g=new Set;return(o||[]).forEach(v=>v.group_name&&g.add(v.group_name)),(n||[]).forEach(v=>v.group_name&&g.add(v.group_name)),Object.values(a||{}).forEach(v=>v.group_name&&g.add(v.group_name)),["todos",...Array.from(g).sort()]},[o,n,a]),d=l.useMemo(()=>{const g=new Set;(o||[]).forEach($=>$.stage&&g.add($.stage));const v=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(g).sort(($,R)=>v.indexOf($)+100-(v.indexOf(R)+100))]},[o]),m=l.useMemo(()=>{let g=(o||[]).filter(v=>v.status!=="scheduled"?!1:v.group_name?!0:v.home?.id&&v.away?.id);return y!=="todos"&&(g=g.filter(v=>v.group_name===y)),A!=="todos"&&(g=g.filter(v=>v.stage===A)),g.sort((v,q)=>Me(v.starts_at)-Me(q.starts_at)),g},[o,y,A]),E=l.useMemo(()=>{const g=(o||[]).filter(v=>v.status==="finished");return g.sort((v,q)=>Me(q.updated_at||q.starts_at||0)-Me(v.updated_at||v.starts_at||0)),g.slice(0,12)},[o]);return e.jsx(Ma,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:va}),e.jsx("h2",{className:"text-2xl font-bold",children:wa})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"classificação"})," → ",e.jsx("strong",{children:"chaveamento"})," →"," ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),u?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((g,v)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},v))})]}):e.jsxs(e.Fragment,{children:[D&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Ia,{standings:n,teamsById:a})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),_?.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:_.map((g,v)=>e.jsx(Ce,{match:g},`s-${g?.id??v}`))})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("p",{className:"text-xs text-gray-500",children:C?"Aguardando definição oficial dos confrontos.":"Confrontos aparecem aqui assim que todos os jogos da fase de grupos terminarem."}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:2}).map((g,v)=>e.jsx(Ce,{placeholder:{home:"A definir",away:"A definir"}},`s-ph-${v}`))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),f.final?e.jsx(Ce,{match:f.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(Ce,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]}),f.third?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"3º lugar"}),e.jsx(Ce,{match:f.third})]}):null]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:y,onChange:g=>k(g.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:F.map(g=>e.jsx("option",{value:g,children:g==="todos"?"Todos":`Grupo ${g}`},g))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:A,onChange:g=>S(g.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:d.map(g=>e.jsx("option",{value:g,children:g==="todos"?"Todas":Ws(g)},g))})]}),m.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:m.map((g,v)=>e.jsx(_s,{match:g},g.id??`sched-${v}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),E.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:E.map((g,v)=>e.jsx(_s,{match:g},g.id??`fin-${v}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas com ",e.jsx("strong",{children:"10 minutos corridos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo e o melhor 2º colocado avançam para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," saldo de gols."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor do grupo A × Vencedor do grupo B; Vencedor do grupo C × Melhor 2º colocado."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substituições:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desperdício de tempo:"})," pode ser acrescido ao final do jogo, a critério do árbitro."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Goleiro-linha:"})," permitido."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Expulsão:"})," o time fica com um jogador a menos por 2 minutos ou até sofrer um gol."]})]})})]})]})]})})}const La="Vôlei",Da="🏐",Ba="team-logos",Va="America/Sao_Paulo",za={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},at=s=>s?za[s]||s:"",Ae=["Vôlei","Volei","Voleibol"];function rt(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function rs(s){const t=rt(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:Va,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const be=s=>{const t=rt(s);return t?t.getTime():Number.POSITIVE_INFINITY},nt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Ua=s=>typeof s=="string"&&!nt(s)&&s.trim()!=="";function Ja(s){if(!s)return null;if(nt(s))return s;if(Ua(s)){const{data:t}=p.storage.from(Ba).getPublicUrl(s);return t?.publicUrl||null}return null}const ns=s=>{const t=Ja(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};let Ha=class extends Ve.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Vôlei ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}};function ot({order_idx:s,stage:t,group_name:a}){const i=[];return s!=null&&String(s).length&&i.push(`Jogo ${s}`),a?i.push(`Grupo ${a}`):t&&i.push(at(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:i.join(" • ")||"—"})}function os({team:s,align:t="left",badge:a=28}){const i=(()=>{const o=s?.name;if(typeof o=="string")return o;if(o&&typeof o=="object"&&"name"in o)return String(o.name);try{return String(o??"A definir")}catch{return"A definir"}})(),n=!!s?.id,c=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:i},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:i}),t==="right"?e.jsx(se,{team:{...s||{},name:i},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:o=>o.stopPropagation(),title:i,children:c}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:c})}function qe({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),i=s?.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},c=i?.id?i:{name:i?.name||"A definir"},o=s&&s.status!=="scheduled",r=Number(s?.home_score??0),u=Number(s?.away_score??0),N=Number(s?.meta?.home_sets??0),y=Number(s?.meta?.away_sets??0),A=N>0||y>0||o,S=({label:M,value:T,visible:z})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-2.5 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:M}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:z?T:"-"})]}),P=({team:M,align:T,sets:z,score:G})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${T==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(os,{team:M,align:T})}),e.jsxs("div",{className:"flex items-center gap-2",children:[A?e.jsx(S,{label:"Sets",value:z,visible:A}):null,e.jsx(S,{label:"Pontos",value:G,visible:o})]})]}),w=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(ot,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(P,{team:n,align:"left",sets:N,score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(P,{team:c,align:"right",sets:y,score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?rs(s.starts_at):s?.venue||""}),o?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:["Sets ",N," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",y]}):null]})]});return s?.id?e.jsx(X,{to:`/match/${s.id}`,className:"block",children:w}):w}function Ns({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),i=Number(s?.away_score??0),n=Number(s?.meta?.home_sets??0),c=Number(s?.meta?.away_sets??0),o=t&&(n>0||c>0);return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(ot,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(os,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs(e.Fragment,{children:[o?e.jsxs("div",{className:"text-[11px] font-medium tabular-nums text-gray-600 mb-0.5",children:["Sets: ",n," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",c]}):null,e.jsxs("div",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",i]})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(os,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?rs(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",rs(s.updated_at)]}):null]})]})}function Pe(s,t){return(t.points??0)-(s.points??0)||(t.sv??0)-(s.sv??0)||(s.sp??0)-(t.sp??0)||(t.point_difference??(t.pf??0)-(t.pa??0))-(s.point_difference??(s.pf??0)-(s.pa??0))||(t.pf??0)-(s.pf??0)||String(s.team_id).localeCompare(String(t.team_id))}function Ka(s){if(!Array.isArray(s)||s.length===0)return[];const t=s.map(o=>({...o,group_name:de(o.group_name)})).filter(o=>o.group_name&&o.group_name!=="-"),a=new Map;for(const o of t){const r=o.group_name;a.has(r)||a.set(r,[]),a.get(r).push(o)}for(const o of a.keys())a.get(o).sort((r,u)=>(r.rank??999)-(u.rank??999));const i=[],n=[];for(const[o,r]of a)r[0]&&i.push({group:o,...r[0]}),r[1]&&n.push({group:o,...r[1]});i.sort(Pe),n.sort(Pe);const c=i.length;if(c>=4){const o=i.slice(0,4);return[{stage:"semi",home:o[0],away:o[3]},{stage:"semi",home:o[1],away:o[2]}]}else if(c===3){if(!n.length)return[];const o=n[0];return[{stage:"semi",home:i[0],away:o},{stage:"semi",home:i[1],away:i[2]}]}else if(c===2){if(n.length<2)return[];const o=[...i,n[0],n[1]].sort(Pe);return[{stage:"semi",home:o[0],away:o[3]},{stage:"semi",home:o[1],away:o[2]}]}return[]}function Xa({standings:s,teamsById:t}){const a=l.useMemo(()=>{const n={};for(const c of s||[]){const o=c.group_name||"-";n[o]||(n[o]=[]),n[o].push(c)}for(const c of Object.keys(n))n[c].sort((o,r)=>(o.rank??999)-(r.rank??999));return n},[s]),i=Object.keys(a).sort();return i.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:i.map(n=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",n]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"SV"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"SP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"PF"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"PC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[n].map(c=>{const o=t[c.team_id]||{id:c.team_id,name:c.team_name||"—"},r=Number(c.point_difference??(c.pf??0)-(c.pa??0));return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:c.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${o.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:{...o,logo_url:ns(o.logo_url)},size:20}),e.jsx("span",{className:"truncate",children:o.name})]})}),e.jsx("td",{className:"py-1 text-center",children:c.matches_played}),e.jsx("td",{className:"py-1 text-center",children:c.wins}),e.jsx("td",{className:"py-1 text-center",children:c.losses}),e.jsx("td",{className:"py-1 text-center",children:c.sv}),e.jsx("td",{className:"py-1 text-center",children:c.sp}),e.jsx("td",{className:"py-1 text-center",children:c.pf}),e.jsx("td",{className:"py-1 text-center",children:c.pa}),e.jsx("td",{className:"py-1 text-center",children:r}),e.jsx("td",{className:"py-1 text-center font-semibold",children:c.points})]},`${n}-${c.team_id}`)})})]}),e.jsxs("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:["Critérios/colunas: ",e.jsx("strong",{children:"#"})," (posição), ",e.jsx("strong",{children:"Time"}),", ",e.jsx("strong",{children:"P"})," (jogos), ",e.jsx("strong",{children:"V"})," (vitórias), ",e.jsx("strong",{children:"D"})," (derrotas), ",e.jsx("strong",{children:"SV"})," (sets vencidos), ",e.jsx("strong",{children:"SP"})," (sets perdidos), ",e.jsx("strong",{children:"PF"})," (pontos feitos), ",e.jsx("strong",{children:"PC"})," (pontos contra), ",e.jsx("strong",{children:"+/-"})," (saldo de pontos), ",e.jsx("strong",{children:"Pts"})," (pontos na tabela)."]})]},n))})}const it=s=>typeof s=="string"?s.trim().toLowerCase():"",Za=s=>{const t=it(s);return t==="semifinal"||t==="semi-final"||t==="semis"?"semi":t==="3º"||t==="3º lugar"||t==="terceiro"||t==="3-lugar"?"3lugar":t},Qa=s=>{const t=it(s);return t==="encerrado"||t==="finalizado"?"finished":t==="agendado"||t==="programado"?"scheduled":t||"scheduled"},de=s=>{if(!s)return"-";const t=String(s).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toUpperCase();if(!t)return"-";const a=t.match(/^GRUPO\s+([A-Z0-9]+)$/);return a?a[1]:t};function ws(s,t){const a=new Map,i=(u,N)=>`${u}::${N}`,n=(u,N)=>{const y=i(u,N);return a.has(y)||a.set(y,{group_name:u,team_id:N,team_name:t?.[N]?.name??"—",matches_played:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0,points:0}),a.get(y)},c=new Set;for(const u of s||[]){const N=de(u?.group_name)||"-",y=u?.home?.id,k=u?.away?.id;y&&(n(N,y),c.add(y)),k&&(n(N,k),c.add(k))}for(const u of s||[]){if(u?.status!=="finished")continue;const N=de(u?.group_name)||"-",y=u?.home?.id,k=u?.away?.id;if(!y||!k)continue;const A=n(N,y),S=n(N,k),P=Number(u?.meta?.home_sets??0),w=Number(u?.meta?.away_sets??0),M=Number(u?.home_score??0),T=Number(u?.away_score??0);let z=!1,G=!1;P!==w?(z=P>w,G=!z):M!==T&&(z=M>T,G=!z),A.matches_played++,S.matches_played++,A.sv+=P,A.sp+=w,A.pf+=M,A.pa+=T,S.sv+=w,S.sp+=P,S.pf+=T,S.pa+=M,z?(A.wins++,A.points+=3,S.losses++):G&&(S.wins++,S.points+=3,A.losses++)}for(const u of Object.keys(t||{})){const N=Number(u);if(c.has(N)||c.has(u))continue;const y=de(t[u]?.group_name);y&&y!=="-"&&n(y,u)}const o={};for(const u of a.values())u.point_difference=Number(u.pf)-Number(u.pa),(o[u.group_name]||=[]).push(u);const r=[];for(const u of Object.keys(o).sort())o[u].sort(Pe),o[u].forEach((N,y)=>r.push({...N,rank:y+1}));return r}function Wa(){const[s,t]=l.useState(null),[a,i]=l.useState({}),n=l.useRef({});l.useEffect(()=>{n.current=a},[a]);const[c,o]=l.useState([]),[r,u]=l.useState([]),[N,y]=l.useState(!0),[k,A]=l.useState("todos"),[S,P]=l.useState("todos"),w=l.useRef(null),M=l.useRef(null),T=l.useCallback(async()=>{try{const{data:d,error:m}=await p.from("sports").select("id, name").in("name",Ae).limit(1);if(m)throw m;d&&d[0]?.id?t(d[0].id):(console.warn("⚠️ Esporte Vôlei não encontrado em 'sports' (nomes tentados:",Ae.join(", "),")"),t(null))}catch(d){console.error("Exceção loadSportId:",d),t(null)}},[]),z=l.useCallback(async d=>{try{if(d){const g=await p.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",d);if(!g.error&&Array.isArray(g.data)&&g.data.length>0){const v={};for(const q of g.data)v[q.id]={...q,name:String(q.name??"—"),logo_url:ns(q.logo_url)};i(v),n.current=v;return}}const m=await p.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").in("sport.name",Ae);if(m.error)throw m.error;const E={};for(const g of m.data||[])E[g.id]={...g,name:String(g.name??"—"),logo_url:ns(g.logo_url)};i(E),n.current=E}catch(m){console.error("Exceção loadTeams:",m),i({}),n.current={}}},[]),G=l.useCallback(async d=>{try{if(d){const g=await p.from("standings_volei_view").select("group_name, rank, team_id, team_name, matches_played, wins, losses, sv, sp, pf, pa, point_difference, points").eq("sport_id",d).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!g.error&&Array.isArray(g.data)&&g.data.length>0){console.info("[Vôlei] standings via VIEW/sport_id:",g.data.length),o(g.data);return}}if(d){const g=await p.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, losses,
            sv, sp, pf, pa, point_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",d).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0}),v=(g.data||[]).map(q=>({...q,team_name:q.team?.name,sv:Number(q.sv??0),sp:Number(q.sp??0),pf:Number(q.pf??0),pa:Number(q.pa??0),point_difference:Number(q.point_difference??(q.pf??0)-(q.pa??0))}));if(!g.error&&v.length>0){console.info("[Vôlei] standings via TABLE/sport_id:",v.length),o(v);return}}const E=((await p.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, losses,
          sv, sp, pf, pa, point_difference, points,
          team:teams!inner(name, id),
          sport:sport_id!inner(name, id)
        `).in("sport.name",Ae).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(g=>({...g,team_name:g.team?.name,sv:Number(g.sv??0),sp:Number(g.sp??0),pf:Number(g.pf??0),pa:Number(g.pa??0),point_difference:Number(g.point_difference??(g.pf??0)-(g.pa??0))}));console.info("[Vôlei] standings via TABLE/join por nome:",E.length,"— esportes possíveis:",Ae),o(E)}catch(m){console.error("Exceção loadStandings (vôlei):",m),o([])}},[]),O=l.useCallback(async d=>{try{if(!d){u([]);return}const{data:m,error:E}=await p.from("matches").select(`
          id, sport_id,
          stage, round, group_name, starts_at, updated_at, venue, status, meta,
          home_team_id, away_team_id, home_score, away_score, order_idx
        `).eq("sport_id",d);if(E)throw E;const g=$=>$?{...n.current[$]||{},id:$,name:String(n.current[$]?.name??"A definir")}:null,v=(m||[]).map($=>{const R=Number.isFinite(Number($.order_idx))?Number($.order_idx):null,U=Number.isFinite(Number($.order_idx))?Number($.order_idx):Number.isFinite(Number($.round))?Number($.round):Number.MAX_SAFE_INTEGER;return{id:$.id,sport_id:$.sport_id,order_idx:R,_sortKey:U,stage:Za($.stage),round:$.round,group_name:$.group_name,starts_at:$.starts_at,updated_at:$.updated_at,venue:$.venue,status:Qa($.status),meta:$.meta,home_score:$.home_score,away_score:$.away_score,home:g($.home_team_id),away:g($.away_team_id)}}),q={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6};v.sort(($,R)=>(q[$.stage]??99)-(q[R.stage]??99)||$._sortKey-R._sortKey||be($.starts_at)-be(R.starts_at)||$.id-R.id),u(v),console.info("[Vôlei] matches carregados:",v.length)}catch(m){console.error("Exceção loadMatches (vôlei):",m),u([])}},[]),D=l.useCallback(async(d,{skeleton:m=!1}={})=>{m&&y(!0);try{await z(d),await Promise.all([G(d),O(d)])}finally{y(!1)}},[z,G,O]);l.useEffect(()=>{T()},[T]),l.useEffect(()=>{if(!s){y(!1);return}if(D(s,{skeleton:!0}),w.current){try{p.removeChannel(w.current)}catch{}w.current=null}const d=()=>{M.current&&clearTimeout(M.current),M.current=setTimeout(()=>D(s,{skeleton:!1}),1e3)},m=p.channel(`volei-hub-${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},d).on("postgres_changes",{event:"UPDATE",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},d).on("postgres_changes",{event:"DELETE",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},d).subscribe();return w.current=m,()=>{if(M.current&&(clearTimeout(M.current),M.current=null),w.current){try{p.removeChannel(w.current)}catch{}w.current=null}}},[s,D]),l.useEffect(()=>{if(!N){const d=ws(r,n.current);d.length&&o(d)}},[N,r,a]),l.useEffect(()=>{if(!N&&c.length===0&&r.length>0){const d=ws(r,n.current);d.length&&(console.info("[Vôlei] standings derivadas de matches:",d.length),o(d))}},[N,c.length,r]),l.useEffect(()=>{if(!c)return;const d=new Set(c.map(j=>String(j.team_id))),E=Object.keys(n.current||{}).filter(j=>!d.has(String(j)));if(E.length===0)return;const g=new Map;for(const j of r||[]){const I=de(j?.group_name);if(!I)continue;const B=H=>{if(!H)return;const Z=String(H),ne=g.get(Z)||{};ne[I]=(ne[I]||0)+1,g.set(Z,ne)};B(j?.home?.id),B(j?.away?.id)}const v=j=>{const I=g.get(String(j))||{},B=Object.entries(I).sort((H,Z)=>Z[1]-H[1])[0];return B?B[0]:"-"},q=E.map(j=>{const I=n.current[j]||{};return{group_name:(I.group_name?de(I.group_name):null)||v(j)||"-",team_id:isNaN(Number(j))?j:Number(j),team_name:I.name||"—",matches_played:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0,point_difference:0,points:0}}),$=[...c,...q],R={};for(const j of $){const I=j.group_name||"-",B=Number(j.point_difference??(j.pf??0)-(j.pa??0));(R[I]||=[]).push({...j,point_difference:B})}const U=[];for(const j of Object.keys(R).sort())R[j].sort(Pe),R[j].forEach((I,B)=>U.push({...I,rank:B+1}));o(U)},[c,r,a]);const C=c.length>0,f=l.useMemo(()=>{const d=v=>(r||[]).filter(q=>q.stage===v).sort((q,$)=>(Number(q?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number($?.order_idx)||Number.MAX_SAFE_INTEGER)),m=d("semi"),E=d("final"),g=d("3lugar");return{semis:m,final:E[0],third:g[0]}},[r]),h=l.useMemo(()=>Ka(c),[c]),b=f.semis?.length?f.semis:h||[];l.useMemo(()=>{const d=new Set;return(r||[]).forEach(m=>{const E=de(m.group_name);E&&E!=="-"&&d.add(E)}),["todos",...Array.from(d).sort()]},[r]),l.useMemo(()=>{const d=new Set;(r||[]).forEach(g=>g.stage&&d.add(g.stage));const m=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(d).sort((g,v)=>m.indexOf(g)+100-(m.indexOf(v)+100))]},[r]);const _=l.useMemo(()=>{const d=(r||[]).some(E=>E.stage==="grupos"&&E.status!=="finished");let m=(r||[]).filter(E=>E.status==="scheduled"&&(d?E.stage==="grupos":!0));return k!=="todos"&&(m=m.filter(E=>de(E.group_name)===k)),S!=="todos"&&(m=m.filter(E=>E.stage===S)),m.sort((E,g)=>be(E.starts_at)-be(g.starts_at)||(E.order_idx??1)-(g.order_idx??1)),m},[r,k,S]),F=l.useMemo(()=>{const d=(r||[]).filter(m=>m.status==="finished");return d.sort((m,E)=>be(E.updated_at||E.starts_at||0)-be(m.updated_at||m.starts_at||0)),d.slice(0,12)},[r]);return e.jsx(Ha,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Da}),e.jsx("h2",{className:"text-2xl font-bold",children:La})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Classificação por ",e.jsx("strong",{children:"sets"})," (3 pts por vitória). Empate em sets desempata por ",e.jsx("strong",{children:"pontos do placar"}),"."]})]}),N?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((d,m)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},m))})]}):e.jsxs(e.Fragment,{children:[C&&(()=>{const d=(c||[]).filter(m=>de(m.group_name)!=="-");return d.length?e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Xa,{standings:d,teamsById:a})]}):null})(),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(b.length,2)}).map((d,m)=>{const E=b[m],g=E?void 0:{home:"A definir",away:"A definir"};return e.jsx(qe,{match:E,placeholder:g},`s-${E?.id??m}`)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),f.final?e.jsx(qe,{match:f.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(qe,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]}),f.third?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"3º lugar"}),e.jsx(qe,{match:f.third})]}):null]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:k,onChange:d=>A(d.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:["todos",...new Set((r||[]).map(d=>d.group_name).filter(Boolean)).values()].map(d=>e.jsx("option",{value:d,children:d==="todos"?"Todos":`Grupo ${d}`},d))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:S,onChange:d=>P(d.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:["todos",...new Set((r||[]).map(d=>d.stage).filter(Boolean)).values()].map(d=>e.jsx("option",{value:d,children:d==="todos"?"Todas":at(d)},d))})]}),_.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:_.map((d,m)=>e.jsx(Ns,{match:d},d.id??`sched-${m}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),F.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:F.map((d,m)=>e.jsx(Ns,{match:d},d.id??`fin-${m}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas com ",e.jsx("strong",{children:"um set de 15 pontos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Vitória:"})," é necessário ter ",e.jsx("strong",{children:"dois pontos de vantagem"})," para vencer a partida."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo e o melhor 2º colocado avançam para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," confronto direto; se houver 3 empates, será utilizado o diferencial de pontos."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor do grupo A × Vencedor do grupo B; Vencedor do grupo C × Melhor 2º colocado."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substituições:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Rodízio:"})," obrigatório."]})]})})]})]})]})})}const Ya="FIFA",er="🎮⚽",sr="team-logos",tr="America/Sao_Paulo",ar={r32:"Pré-oitavas",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar","1º":"1ª fase","2º":"2ª fase","3º":"3ª fase","4º":"4ª fase"},vs={r32:1,oitavas:2,quartas:3,semi:4,final:5,"3lugar":5},lt=s=>s?ar[s]||s:"",Ie=s=>vs[s]??vs[String(s||"").toLowerCase()]??99;function rr(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function nr(s){const t=rr(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:tr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const ct=s=>typeof s=="string"&&/^https?:\/\//i.test(s),or=s=>typeof s=="string"&&!ct(s)&&s.trim()!=="";function ir(s){if(!s)return null;if(ct(s))return s;if(or(s)){const{data:t}=p.storage.from(sr).getPublicUrl(s);return t?.publicUrl||null}return null}const Ge=s=>{const t=ir(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null},lr={17:[1,2],18:[3,4],19:[5,6],20:[7,8],21:[9,10],22:[11,12],23:[13,14],24:[15,16],25:[17,18],26:[19,20],27:[21,22],28:[23,24],29:[25,26],30:[27,28],31:[29,30]},cr={32:[29,30]},dr=(s,t)=>t==="3lugar"?cr[s]||null:lr[s]||null;function mr({order_idx:s,stage:t}){const a=[];return s!=null&&String(s).length&&a.push(`Jogo ${s}`),t&&a.push(lt(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:a.join(" • ")||"—"})}function ur({team:s,align:t="left",badge:a=28}){const i=(()=>{const o=s?.name;if(typeof o=="string")return o;if(o&&typeof o=="object"&&"name"in o)return String(o.name);try{return String(o??"A definir")}catch{return"A definir"}})(),n=!!s?.id,c=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:i},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:i}),t==="right"?e.jsx(se,{team:{...s||{},name:i},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:o=>o.stopPropagation(),title:i,children:c}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:c})}function gr({match:s,placeholders:t}){const a=s.home||(t?.home?{name:t.home}:null),i=s.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},c=i?.id?i:{name:i?.name||"A definir"},o=s?.status&&s.status!=="scheduled",r=Number(s?.home_score??0),u=Number(s?.away_score??0),N=({value:k})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:o?k:"-"})]}),y=({team:k,align:A,score:S})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${A==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(ur,{team:k,align:A})}),e.jsx(N,{value:S})]});return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(mr,{order_idx:s.order_idx,stage:s.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(y,{team:n,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(y,{team:c,align:"right",score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.starts_at?nr(s.starts_at):s.venue||""}),o?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",u]}):null]})]})}function hr(){const[s,t]=l.useState(null),[a,i]=l.useState([]),[n,c]=l.useState(!0),o=l.useRef(null),r=l.useRef(!1),u=l.useCallback(async()=>{const{data:S,error:P}=await p.from("sports").select("id").eq("name","FIFA").maybeSingle();if(P){console.error("Erro ao carregar sport id:",P);return}S?.id&&t(S.id)},[]),N=l.useCallback(async S=>{try{const{data:P,error:w}=await p.from("match_detail_view").select(`
          id, sport_id, order_idx,
          stage, round, group_name, starts_at, updated_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score
        `).eq("sport_id",S);let M=[];if(!w&&P?.length)M=P.map(T=>({id:T.id,sport_id:T.sport_id,order_idx:T.order_idx,stage:T.stage,round:T.round,group_name:T.group_name,starts_at:T.starts_at,updated_at:T.updated_at,venue:T.venue,status:T.status,home_score:T.home_score,away_score:T.away_score,home:T.home_team_id?{id:T.home_team_id,name:String(T.home_team_name??"A definir"),color:T.home_team_color,logo_url:Ge(T.home_team_logo)}:null,away:T.away_team_id?{id:T.away_team_id,name:String(T.away_team_name??"A definir"),color:T.away_team_color,logo_url:Ge(T.away_team_logo)}:null}));else{const{data:T,error:z}=await p.from("matches").select(`
            id, order_idx, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("sport_id",S);if(z)throw z;M=(T||[]).map(G=>({...G,home:G.home&&typeof G.home=="object"?{...G.home,name:String(G.home.name??"A definir"),logo_url:Ge(G.home.logo_url)}:G.home,away:G.away&&typeof G.away=="object"?{...G.away,name:String(G.away.name??"A definir"),logo_url:Ge(G.away.logo_url)}:G.away}))}M.sort((T,z)=>{const G=Ie(T.stage)-Ie(z.stage);return G!==0?G:(T.order_idx??9999)-(z.order_idx??9999)}),i(M)}catch(P){console.error("Exceção loadMatches:",P),i([])}},[]),y=l.useCallback(async S=>{if(!r.current){r.current=!0,c(!0);try{await N(S)}finally{c(!1),r.current=!1}}},[N]);l.useEffect(()=>{u()},[u]),l.useEffect(()=>{if(!s)return;if(y(s),o.current){try{p.removeChannel(o.current)}catch{}o.current=null}const S=p.channel(`fifa-hub-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},()=>{y(s)}).subscribe();return o.current=S,()=>{if(o.current){try{p.removeChannel(o.current)}catch{}o.current=null}}},[s,y]);const k=l.useCallback((S,P)=>{const w=dr(S,P);return P==="3lugar"&&w?{home:`Perdedor J${w[0]}`,away:`Perdedor J${w[1]}`}:w?{home:`Vencedor J${w[0]}`,away:`Vencedor J${w[1]}`}:null},[]),A=l.useMemo(()=>{const S={};for(const w of a){const M=w.stage||"—";S[M]||(S[M]=[]),S[M].push(w)}return Object.keys(S).sort((w,M)=>Ie(w)-Ie(M)).map(w=>({stage:w,items:S[w].sort((M,T)=>(M.order_idx??0)-(T.order_idx??0))}))},[a]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:er}),e.jsx("h2",{className:"text-2xl font-bold",children:Ya})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"chaveamento"})," completo (com placeholders) → ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),n?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((S,P)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},P))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),A.map(({stage:S,items:P})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:lt(S)||"Fase"}),P.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:P.map(w=>e.jsx(gr,{match:w,placeholders:k(Number(w.order_idx),w.stage)},w.id))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem confrontos nesta fase."})]},S))]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," torneio de ",e.jsx("strong",{children:"mata-mata"})," (eliminação simples)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estrutura:"})," fases iniciais → oitavas/quartas → semifinais → final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Partidas:"})," jogo único por confronto."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate:"})," prorrogação e/ou pênaltis conforme necessário."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Configurações do console:"})," duração, times e regras definidas pela organização."]})]})})]})]})]})}const He="Pebolim",pr="🎯",xr="team-logos",fr="America/Sao_Paulo",yr={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},dt=s=>s?yr[s]||s:"";function mt(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function is(s){const t=mt(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:fr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const Oe=s=>{const t=mt(s);return t?t.getTime():Number.POSITIVE_INFINITY},ut=s=>typeof s=="string"&&/^https?:\/\//i.test(s),jr=s=>typeof s=="string"&&!ut(s)&&s.trim()!=="";function br(s){if(!s)return null;if(ut(s))return s;if(jr(s)){const{data:t}=p.storage.from(xr).getPublicUrl(s);return t?.publicUrl||null}return null}const ke=s=>{const t=br(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};function gt({order_idx:s,stage:t,group_name:a}){const i=[];return s!=null&&String(s).length&&i.push(`Jogo ${s}`),a?i.push(`Grupo ${a}`):t&&i.push(dt(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:i.join(" • ")||"—"})}function ls({team:s,align:t="left",badge:a=28}){const i=(()=>{const r=s?.name;if(typeof r=="string")return r;if(r&&typeof r=="object"&&"name"in r)return String(r.name);try{return String(r??"A definir")}catch{return"A definir"}})(),n=!!s?.id,c=!n&&i==="A definir",o=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:i},size:a}),e.jsxs("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:[i,c?e.jsx(Xs,{className:"inline-block ml-1 w-4 h-4 text-gray-400"}):null]}),t==="right"?e.jsx(se,{team:{...s||{},name:i},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:r=>r.stopPropagation(),title:i,children:o}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:o})}function Ss({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),i=Number(s?.away_score??0);return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(gt,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(ls,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs("span",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",i]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(ls,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?is(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",is(s.updated_at)]}):null]})]})}function Ee({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),i=s?.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},c=i?.id?i:{name:i?.name||"A definir"},o=s&&s.status!=="scheduled",r=Number(s?.home_score??0),u=Number(s?.away_score??0),N=({value:A})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:o?A:"-"})]}),y=({team:A,align:S,score:P})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${S==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(ls,{team:A,align:S})}),e.jsx(N,{value:P})]}),k=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(gt,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(y,{team:n,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(y,{team:c,align:"right",score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?is(s.starts_at):s?.venue||""}),o?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",u]}):null]})]});return s?.id?e.jsx(X,{to:`/match/${s.id}`,className:"block",children:k}):k}const cs=s=>3*Number(s.wins??0)+Number(s.draws??0);function _r(s,t){const a=cs(s),i=cs(t);if(i!==a)return i-a;const n=Number(s.wins??0),c=Number(t.wins??0);if(c!==n)return c-n;const o=Number(s.goal_difference??Number(s.goals_for??0)-Number(s.goals_against??0)),r=Number(t.goal_difference??Number(t.goals_for??0)-Number(t.goals_against??0));if(r!==o)return r-o;const u=Number(s.goals_for??0),N=Number(t.goals_for??0);return N!==u?N-u:String(s.team_id).localeCompare(String(t.team_id))}function Nr({standings:s,teamsById:t,sportId:a}){const i=l.useMemo(()=>{const o=k=>String(k??"-").trim().toUpperCase(),r={},u=new Set;for(const k of s||[]){const A=o(k.group_name);r[A]||(r[A]=[]),r[A].push({...k,group_name:A}),u.add(String(k.team_id))}const N={};for(const k in t){const A=t[k];if(a&&A&&A.sport_id&&String(A.sport_id)!==String(a))continue;const S=o(A.group_name);N[S]||(N[S]=[]),N[S].push(A)}const y=Object.keys(r).length?Object.keys(r):Object.keys(N);for(const k of y){const A=r[k]||[],S=(N[k]||[]).filter(w=>!u.has(String(w.id))).map(w=>({group_name:k,team_id:w.id,team_name:w.name,matches_played:0,wins:0,draws:0,losses:0,goals_for:0,goals_against:0,goal_difference:0})),P=[...A,...S].sort(_r).map((w,M)=>({...w,rank:M+1}));r[k]=P}return r},[s,t,a]),n=l.useMemo(()=>{const o=new Map;(s||[]).forEach(u=>o.set(String(u.team_id),String(u.group_name??"-")));const r=[];return Object.values(t||{}).forEach(u=>{const N=o.get(String(u.id)),y=String(u.group_name??"-");N&&N!==y&&r.push({id:u.id,name:u.name,teamG:y,sidG:N})}),r},[s,t]),c=Object.keys(i).sort();return c.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[n.length?e.jsx("div",{className:"md:col-span-3",children:e.jsxs("div",{className:"rounded-md border border-amber-200 bg-amber-50 p-2 text-xs text-amber-800",children:[n.length," time(s) com grupo divergente entre ",e.jsx("em",{children:"teams"})," e ",e.jsx("em",{children:"standings"}),". A UI já ignora isso, mas vale ajustar no banco."]})}):null,c.map(o=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",o]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"E"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:i[o].map(r=>{const u=t[r.team_id]&&typeof t[r.team_id]=="object"?t[r.team_id]:{id:r.team_id,name:String(r.team_name??t[r.team_id]?.name??"—")},N={...u,name:typeof u.name=="string"?u.name:String(u.name??"—")};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:r.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${N.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:N,size:20}),e.jsx("span",{className:"truncate",children:N.name})]})}),e.jsx("td",{className:"py-1 text-center",children:r.matches_played}),e.jsx("td",{className:"py-1 text-center",children:r.wins}),e.jsx("td",{className:"py-1 text-center",children:r.draws}),e.jsx("td",{className:"py-1 text-center",children:r.losses}),e.jsx("td",{className:"py-1 text-center",children:r.goals_for}),e.jsx("td",{className:"py-1 text-center",children:r.goals_against}),e.jsx("td",{className:"py-1 text-center",children:r.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:cs(r)})]},`${o}-${r.team_id}`)})})]}),e.jsx("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:"Critérios: Pontos, Vitórias, Saldo de Gols, Gols Pró."})]},o))]})}function wr(s){const t=r=>(s||[]).filter(u=>u.stage===r).sort((u,N)=>(Number(u?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(N?.order_idx)||Number.MAX_SAFE_INTEGER)),a=t("oitavas"),i=t("quartas"),n=t("semi"),c=t("final"),o=t("3lugar");return{oitavas:a,quartas:i,semis:n,final:c[0],third:o[0]}}function vr(s,t){if(!Array.isArray(s)||s.length===0){const o=(r,u)=>({home:{name:`1º Grupo ${r}`},away:{name:`1º Grupo ${u}`}});return{quarters:[o("A","B"),o("C","D"),o("E","F"),o("G","H")],semis:[{home:{name:"Vencedor Quartas 1"},away:{name:"Vencedor Quartas 2"}},{home:{name:"Vencedor Quartas 3"},away:{name:"Vencedor Quartas 4"}}]}}const a={};for(const o of"ABCDEFGH".split("")){const r=s.find(u=>u.group_name===o&&u.rank===1);r&&(a[o]={id:r.team_id,name:r.team_name||t[r.team_id]?.name||"—",logo_url:t[r.team_id]?.logo_url,color:t[r.team_id]?.color})}const i=(o,r)=>({home:a[o]||{name:`1º Grupo ${o}`},away:a[r]||{name:`1º Grupo ${r}`}});return{quarters:[i("A","B"),i("C","D"),i("E","F"),i("G","H")],semis:[{home:{name:"Vencedor Quartas 1"},away:{name:"Vencedor Quartas 2"}},{home:{name:"Vencedor Quartas 3"},away:{name:"Vencedor Quartas 4"}}]}}class Sr extends Ve.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Pebolim ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}}const ht=s=>typeof s=="string"?s.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toLowerCase():"",$s=s=>{const t=ht(s);return t==="semifinal"||t==="semi-final"||t==="semis"?"semi":t==="3º lugar"||t==="3lugar"||t==="3-lugar"||t==="terceiro"?"3lugar":t},Cs=s=>{const t=ht(s);return t==="agendado"||t==="programado"||t==="scheduled"?"scheduled":t==="ao vivo"||t==="andamento"||t==="live"||t==="ongoing"?"ongoing":t==="pausado"||t==="paused"?"paused":t==="encerrado"||t==="finalizado"||t==="finished"?"finished":t||"scheduled"};function $r(){const[s,t]=l.useState(null),[a,i]=l.useState({}),n=l.useRef({});l.useEffect(()=>{n.current=a},[a]);const[c,o]=l.useState([]),[r,u]=l.useState([]),[N,y]=l.useState(!0),[k,A]=l.useState("todos"),[S,P]=l.useState("todos"),w=l.useRef(null),M=l.useRef(null),T=l.useCallback(async()=>{try{const{data:d,error:m}=await p.from("sports").select("id").eq("name",He).maybeSingle();m&&console.error("Erro ao carregar sport id:",m),t(d?.id??null)}catch(d){console.error("Exceção loadSportId:",d),t(null)}},[]),z=l.useCallback(async d=>{try{if(d){const m=await p.from("teams").select("id, name, logo_url, color, group_name, sport_id").eq("sport_id",d);if(!m.error&&Array.isArray(m.data)&&m.data.length){const E={};for(const g of m.data)E[g.id]={...g,name:String(g.name??"—"),logo_url:ke(g.logo_url),group_name:g.group_name??"-",sport_id:g.sport_id??d};i(E),n.current=E;return}}i({})}catch(m){console.error("Exceção loadTeams:",m),i({})}},[]),G=l.useCallback(async d=>{try{if(d){const{data:g,error:v}=await p.from("standings_view").select(`
            sport_id, group_name, rank, team_id, team_name,
            matches_played, wins, draws, losses,
            goals_for, goals_against, goal_difference, points
          `).eq("sport_id",d).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(v)throw v;if(Array.isArray(g)&&g.length>0){o(g);return}}const m=await p.from("standings_view").select(`
          sport_id, group_name, rank, team_id, team_name,
          matches_played, wins, draws, losses,
          goals_for, goals_against, goal_difference, points
        `);if(m.error)throw m.error;const E=Array.isArray(m.data)?m.data:[];o(d?E.filter(g=>String(g.sport_id)===String(d)):E)}catch(m){console.error("Exceção loadStandings:",m),o([])}},[]),O=l.useCallback(async d=>{try{let m=[];if(d){const{data:v,error:q}=await p.from("match_detail_view").select(`
            id, sport_id, order_idx,
            stage, round, group_name, starts_at, updated_at, venue, status,
            home_team_id, home_team_name, home_team_color, home_team_logo,
            away_team_id, away_team_name, away_team_color, away_team_logo,
            home_score, away_score
          `).eq("sport_id",d);!q&&Array.isArray(v)&&v.length&&(m=v.map($=>({id:$.id,sport_id:$.sport_id,order_idx:$.order_idx,stage:$s($.stage),round:$.round,group_name:$.group_name,starts_at:$.starts_at,updated_at:$.updated_at,venue:$.venue,status:Cs($.status),home_score:$.home_score,away_score:$.away_score,home:$.home_team_id?{id:$.home_team_id,name:String($.home_team_name??"A definir"),color:$.home_team_color,logo_url:ke($.home_team_logo)}:null,away:$.away_team_id?{id:$.away_team_id,name:String($.away_team_name??"A definir"),color:$.away_team_color,logo_url:ke($.away_team_logo)}:null})))}if(!m.length){const{data:v,error:q}=await p.from("matches").select(`
            id, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score, order_idx,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color ),
            sport:sport_id!inner(name)
          `).eq("sport.name",He);if(q)throw q;m=(v||[]).map($=>({id:$.id,order_idx:Number.isFinite(Number($.order_idx))?Number($.order_idx):null,stage:$s($.stage),round:$.round,group_name:$.group_name,starts_at:$.starts_at,updated_at:$.updated_at,venue:$.venue,status:Cs($.status),home_score:$.home_score,away_score:$.away_score,home:$.home?{...$.home,name:String($.home.name??"A definir"),logo_url:ke($.home.logo_url)}:null,away:$.away?{...$.away,name:String($.away.name??"A definir"),logo_url:ke($.away.logo_url)}:null}))}const E={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6},g=v=>Number.isFinite(Number(v?.order_idx))?Number(v.order_idx):Number.MAX_SAFE_INTEGER;m.sort((v,q)=>(E[v.stage]??99)-(E[q.stage]??99)||g(v)-g(q)),u(m)}catch(m){console.error("Exceção loadMatches (pebolim):",m),u([])}},[]),D=l.useCallback(async(d,{skeleton:m=!1}={})=>{m&&y(!0);try{await z(d),await Promise.all([G(d),O(d)])}finally{y(!1)}},[z,G,O]);l.useEffect(()=>{T()},[T]),l.useEffect(()=>{if(s){if(D(s,{skeleton:!0}),w.current){try{p.removeChannel(w.current)}catch{}w.current=null}if(s){const d=()=>{M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{Promise.all([G(s),O(s)]).catch(E=>console.error(E))},400)},m=p.channel(`pebolim-hub-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},d).on("postgres_changes",{event:"*",schema:"public",table:"standings",filter:`sport_id=eq.${s}`},d).subscribe();w.current=m}return()=>{if(M.current&&(clearTimeout(M.current),M.current=null),w.current){try{p.removeChannel(w.current)}catch{}w.current=null}}}},[s,D]),l.useMemo(()=>!!(c?.length||(r||[]).some(d=>!!d.group_name)||Object.values(a||{}).some(d=>!!d.group_name)),[c,r,a]);const C=l.useMemo(()=>wr(r),[r]),f=l.useMemo(()=>vr(c,a),[c,a]),h=l.useMemo(()=>{const d=new Set;return(r||[]).forEach(m=>m.group_name&&d.add(m.group_name)),(c||[]).forEach(m=>m.group_name&&d.add(m.group_name)),Object.values(a||{}).forEach(m=>m.group_name&&d.add(m.group_name)),["todos",...Array.from(d).sort()]},[r,c,a]),b=l.useMemo(()=>{const d=new Set;(r||[]).forEach(g=>g.stage&&d.add(g.stage));const m=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(d).sort((g,v)=>m.indexOf(g)+100-(m.indexOf(v)+100))]},[r]),_=l.useMemo(()=>{let d=(r||[]).filter(m=>m.status!=="scheduled"?!1:m.group_name?!0:m.home?.id&&m.away?.id);return k!=="todos"&&(d=d.filter(m=>m.group_name===k)),S!=="todos"&&(d=d.filter(m=>m.stage===S)),d.sort((m,E)=>{const g=Oe(m.starts_at),v=Oe(E.starts_at);return(Number.isFinite(g-v)?g-v:0)||Number(m.order_idx??Number.MAX_SAFE_INTEGER)-Number(E.order_idx??Number.MAX_SAFE_INTEGER)||m.id-E.id}),d},[r,k,S]),F=l.useMemo(()=>{const d=(r||[]).filter(m=>m.status==="finished");return d.sort((m,E)=>Oe(E.updated_at||E.starts_at||0)-Oe(m.updated_at||m.starts_at||0)),d.slice(0,12)},[r]);return e.jsx(Sr,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:pr}),e.jsx("h2",{className:"text-2xl font-bold",children:He})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"classificação"})," (se houver grupos) → ",e.jsx("strong",{children:"chaveamento"})," →"," ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),N?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((d,m)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},m))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Nr,{standings:c,teamsById:a,sportId:s})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),C.oitavas?.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Oitavas de final"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:C.oitavas.map((d,m)=>e.jsx(Ee,{match:d},`o-${d?.id??m}`))})]}):null,C.quartas?.length||f?.quarters?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Quartas de final"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(C.quartas?.length||0,f?.quarters?.length||0,4)}).map((d,m)=>{const E=C.quartas?.[m],g=f?.quarters?.[m];return e.jsx(Ee,{match:E,placeholder:g},`q-${E?.id??m}`)})})]}):null,C.semis?.length||f?.semis?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(C.semis?.length||0,f?.semis?.length||0,2)}).map((d,m)=>{const E=C.semis?.[m],g=f?.semis?.[m];return e.jsx(Ee,{match:E,placeholder:g},`s-${E?.id??m}`)})})]}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),C.final?e.jsx(Ee,{match:C.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(Ee,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:k,onChange:d=>A(d.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:h.map(d=>e.jsx("option",{value:d,children:d==="todos"?"Todos":`Grupo ${d}`},d))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:S,onChange:d=>P(d.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:b.map(d=>e.jsx("option",{value:d,children:d==="todos"?"Todas":dt(d)},d))})]}),_.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:_.map((d,m)=>e.jsx(Ss,{match:d},d.id??`sched-${m}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),F.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:F.map((d,m)=>e.jsx(Ss,{match:d},d.id??`fin-${m}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas em ",e.jsx("strong",{children:"1 rodada de 4 gols"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (8 grupos de 3 duplas) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo avança para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," saldo de gols."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," quatro quartas de final, duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Quartas de final:"})," Vencedor do grupo A × Vencedor do grupo B = Vencedor 1; Vencedor do grupo C × Vencedor do grupo D = Vencedor 2; Vencedor do grupo E × Vencedor do grupo F = Vencedor 3; Vencedor do grupo G × Vencedor do grupo H = Vencedor 4."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor 1 × Vencedor 2; Vencedor 3 × Vencedor 4."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Duplas:"})," não podem ser substituídas durante o torneio."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"WO:"})," em caso de não comparecimento de um ou mais integrantes, a dupla perde por WO. Atrasos de até 3 minutos são tolerados."]})]})})]})]})]})})}const Cr="team-logos";function pt(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Ar(s){return typeof s=="string"&&!pt(s)&&s.trim()!==""}function Ke(s){if(!s)return null;if(pt(s))return s;if(Ar(s)){const{data:t}=p.storage.from(Cr).getPublicUrl(s);return t?.publicUrl||null}return null}const kr={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Er={grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Tr="America/Sao_Paulo";function Pr(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Tr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function Fr(s){return s?Er[s]||s[0]?.toUpperCase()+s.slice(1):""}function Mr(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),n=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(n<0)return"0:00";const c=Math.floor(n/1e3),o=Math.floor(c/60),r=c%60;return`${o}:${r.toString().padStart(2,"0")}`}function Rr({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Xe({match:s,currentTimestamp:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),i=Number(s?.meta?.home_sets??0),n=Number(s?.meta?.away_sets??0),c=i>0||n>0,o=a||c,r=s?.status&&s.status!=="scheduled",u=Number(s?.home_score??0),N=Number(s?.away_score??0),y=s?.status==="ongoing"||s?.status==="paused",k=y?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(X,{to:`/match/${s.id}`,className:`block bg-white border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden ${k}`,children:[e.jsx(Rr,{status:s.status}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.sport?.name}),s.group_name?` • Grupo ${s.group_name}`:"",s.stage?` • ${Fr(s.stage)}`:"",s.round?` • J${s.round}`:"",y&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",Mr(s,t)]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[11px] font-medium ${s.status==="ongoing"?"bg-green-100 text-green-700":s.status==="paused"?"bg-yellow-100 text-yellow-700":s.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:kr[s.status]||s.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(se,{team:s.home||{name:"A definir"},size:24}),e.jsx("span",{className:"font-medium truncate text-sm",children:s.home?.name||"A definir"})]}),e.jsxs("div",{className:"text-center px-3",children:[o&&e.jsx("div",{className:"text-xs font-semibold tabular-nums mb-1",children:e.jsxs("span",{className:`${r?"":"text-gray-400"}`,children:["Sets: ",i," x ",n]})}),r?e.jsxs("div",{className:"text-lg font-bold tabular-nums",children:[u," x ",N]}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx("span",{className:"font-medium truncate text-sm text-right",children:s.away?.name||"A definir"}),e.jsx(se,{team:s.away||{name:"A definir"},size:24})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center justify-between",children:[e.jsx("span",{children:s.starts_at?Pr(s.starts_at):"Data a definir"}),s.venue&&e.jsx("span",{children:s.venue})]})]})}function As(){const{id:s}=zs(),[t,a]=l.useState(null),[i,n]=l.useState([]),[c,o]=l.useState([]),[r,u]=l.useState(!0),[N,y]=l.useState(Date.now()),k=l.useRef(null),A=l.useRef(null),S=async()=>{u(!0);try{const{data:w,error:M}=await p.from("teams").select("id, name, logo_url, color").eq("id",s).maybeSingle();if(M){console.error("Erro ao carregar time:",M);return}if(w){const D={...w,logo_url:(()=>{const C=Ke(w.logo_url);return C?`${C}${C.includes("?")?"&":"?"}v=1`:null})()};a(D)}const{data:T,error:z}=await p.from("players").select("id, name, number").eq("team_id",s).order("number",{ascending:!0,nullsFirst:!0}).order("name");!z&&T&&n(T);const{data:G,error:O}=await p.from("matches").select(`
          id, stage, round, group_name, starts_at, venue, status, 
          home_score, away_score, meta, updated_at,
          sport:sport_id ( id, name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `).or(`home_team_id.eq.${s},away_team_id.eq.${s}`).order("starts_at",{ascending:!1});if(!O&&G){const D=G.map(C=>{const f=C.home&&typeof C.home=="object"?{...C.home,logo_url:(()=>{const b=Ke(C.home.logo_url);return b?`${b}${b.includes("?")?"&":"?"}v=1`:null})()}:C.home,h=C.away&&typeof C.away=="object"?{...C.away,logo_url:(()=>{const b=Ke(C.away.logo_url);return b?`${b}${b.includes("?")?"&":"?"}v=1`:null})()}:C.away;return{...C,home:f,away:h}});o(D)}}finally{u(!1)}};l.useEffect(()=>{S(),A.current=setInterval(()=>{y(Date.now())},1e3),k.current&&(p.removeChannel(k.current),k.current=null);const w=p.channel(`team-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>S()).on("postgres_changes",{event:"*",schema:"public",table:"teams",filter:`id=eq.${s}`},()=>S()).on("postgres_changes",{event:"*",schema:"public",table:"players",filter:`team_id=eq.${s}`},()=>S()).subscribe();return k.current=w,()=>{A.current&&clearInterval(A.current),k.current&&p.removeChannel(k.current),k.current=null}},[s]);const P=l.useMemo(()=>{const w={ongoing:[],paused:[],scheduled:[],finished:[]};return c.forEach(M=>{w[M.status]?w[M.status].push(M):w.finished.push(M)}),w},[c]);return r?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"})]})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(se,{team:t,size:64}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.name}),e.jsxs("p",{className:"text-gray-500",children:[c.length," partida",c.length!==1?"s":""," registrada",c.length!==1?"s":""]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Convocação"}),i.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"space-y-2",children:i.map(w=>e.jsxs("li",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"font-medium",children:w.name}),e.jsx("span",{className:"text-gray-500 text-sm tabular-nums",children:w.number?`#${w.number}`:"—"})]},w.id))})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Estatísticas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:P.ongoing.length+P.paused.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ao vivo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:P.scheduled.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Agendadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:P.finished.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Finalizadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Jogadores"})]})]})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Partidas"}),c.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma partida registrada."}):e.jsxs("div",{className:"space-y-4",children:[(P.ongoing.length>0||P.paused.length>0)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"🔴 Ao vivo"}),e.jsx("div",{className:"space-y-2",children:[...P.ongoing,...P.paused].map(w=>e.jsx(Xe,{match:w,currentTimestamp:N},w.id))})]}),P.scheduled.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"📅 Próximas partidas"}),e.jsx("div",{className:"space-y-2",children:P.scheduled.map(w=>e.jsx(Xe,{match:w,currentTimestamp:N},w.id))})]}),P.finished.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"✅ Finalizadas"}),e.jsx("div",{className:"space-y-2",children:P.finished.slice(0,5).map(w=>e.jsx(Xe,{match:w,currentTimestamp:N},w.id))}),P.finished.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["... e mais ",P.finished.length-5," partida",P.finished.length-5!==1?"s":""]})]})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-600",children:"Time não encontrado"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"O time solicitado não existe ou foi removido."})]})}const xt={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},qr={r32:"Pré-oitavas",grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Ir="team-logos";function ft(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Gr(s){return typeof s=="string"&&!ft(s)&&s.trim()!==""}function Le(s){if(!s)return null;if(ft(s))return s;if(Gr(s)){const{data:t}=p.storage.from(Ir).getPublicUrl(s);return t?.publicUrl||null}return null}const Or="America/Sao_Paulo";function Se(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Or,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function yt(s){return s?qr[s]||s[0]?.toUpperCase()+s.slice(1):""}function Lr({order_idx:s,stage:t,group_name:a}){const i=[];return s&&i.push(`Jogo ${s}`),a&&i.push(`Grupo ${a}`),i.join(" • ")}function jt(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=s.starts_at?new Date(s.starts_at):null,i=s.status==="paused"?new Date(s.updated_at||Date.now()):new Date(t||Date.now());if(!a)return"0:00";const n=i-a;if(n<0)return"0:00";const c=Math.floor(n/1e3),o=Math.floor(c/60),r=c%60;return`${o}:${r.toString().padStart(2,"0")}`}function Dr({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-2xl`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Br({status:s,meta:t,starts_at:a,updated_at:i,currentTimestamp:n}){const c="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] font-semibold tracking-wide border",o=s==="ongoing"?"bg-green-50 text-green-700 border-green-200":s==="paused"?"bg-amber-50 text-amber-700 border-amber-200":s==="finished"?"bg-gray-100 text-gray-700 border-gray-200":"bg-blue-50 text-blue-700 border-blue-200",r=t?.clock||t?.time||t?.minute,u=s==="ongoing"||s==="paused",N=s==="scheduled"?a?` • ${Se(a)}`:"":s==="finished"?i?` • ${Se(i)}`:"":r?` • ${r}`:"";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`${c} ${o}`,children:[xt[s]||s,N?e.jsx("span",{children:N}):null]}),u&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",jt({status:s,starts_at:a,updated_at:i},n)]})]})}function Vr({stage:s}){if(!s)return null;const t=yt(s);return e.jsx("span",{className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-semibold tracking-wide text-gray-700",children:t})}function ks({team:s,align:t="left",badgeSize:a=48}){const i=!!s?.id,n=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:s||{name:"A definir"},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${i?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:s?.name||"A definir",children:s?.name||"A definir"}),t==="right"?e.jsx(se,{team:s||{name:"A definir"},size:a}):null]});return i?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-3 hover:underline ${t==="right"?"justify-end":""}`,onClick:c=>c.stopPropagation(),title:s?.name,children:n}):e.jsx("div",{className:`min-w-0 flex items-center gap-3 ${t==="right"?"justify-end":""}`,children:n})}function Es({title:s,players:t}){return e.jsxs("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:s}),t.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"text-sm divide-y",children:t.map(a=>e.jsxs("li",{className:"flex items-center justify-between py-1.5",children:[e.jsx("span",{className:"truncate",children:a.name}),e.jsx("span",{className:"inline-block w-8 text-right tabular-nums text-gray-500",children:a.number??""})]},a.id))})]})}function Ts(){const{id:s}=zs(),[t,a]=l.useState(null),[i,n]=l.useState([]),[c,o]=l.useState([]),[r,u]=l.useState(!0),[N,y]=l.useState(null),[k,A]=l.useState(Date.now()),S=l.useRef(null),P=l.useRef(null),w=l.useRef(!1),M=l.useMemo(()=>(t?.sport?.name||"").toLowerCase().includes("volei"),[t?.sport?.name]),T=l.useCallback(async()=>{if(!(!s||w.current)){w.current=!0,u(!0),y(null);try{const{data:m,error:E}=await p.from("match_detail_view").select(`
          id, sport_id, sport_name, stage, round, group_name, starts_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score, order_idx, created_at, updated_at
        `).eq("id",s).maybeSingle();let g=null;if(!E&&m){g={id:m.id,sport:{id:m.sport_id,name:m.sport_name},stage:m.stage,round:m.round,group_name:m.group_name,starts_at:m.starts_at,updated_at:m.updated_at,venue:m.venue,status:m.status,order_idx:m.order_idx,meta:null,home_score:m.home_score,away_score:m.away_score,home:{id:m.home_team_id,name:m.home_team_name,color:m.home_team_color,logo_url:(()=>{const U=Le(m.home_team_logo);return U?`${U}${U.includes("?")?"&":"?"}v=1`:null})()},away:{id:m.away_team_id,name:m.away_team_name,color:m.away_team_color,logo_url:(()=>{const U=Le(m.away_team_logo);return U?`${U}${U.includes("?")?"&":"?"}v=1`:null})()}};const{data:R}=await p.from("matches").select("meta").eq("id",s).maybeSingle();R?.meta&&(g.meta=R.meta)}else{const{data:R,error:U}=await p.from("matches").select(`
            id,
            sport:sport_id ( id, name ),
            stage, round, group_name, starts_at, updated_at, venue, status, meta, order_idx,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("id",s).maybeSingle();if(U)throw U;R&&(g={...R,home:R.home&&typeof R.home=="object"?{...R.home,logo_url:(()=>{const j=Le(R.home.logo_url);return j?`${j}${j.includes("?")?"&":"?"}v=1`:null})()}:R.home,away:R.away&&typeof R.away=="object"?{...R.away,logo_url:(()=>{const j=Le(R.away.logo_url);return j?`${j}${j.includes("?")?"&":"?"}v=1`:null})()}:R.away})}if(!g)throw new Error("Partida não encontrada");a(g);const v=[];g?.home?.id?v.push(p.from("players").select("id, name, number").eq("team_id",g.home.id).order("number",{ascending:!0,nullsFirst:!0}).order("name")):v.push(Promise.resolve({data:[]})),g?.away?.id?v.push(p.from("players").select("id, name, number").eq("team_id",g.away.id).order("number",{ascending:!0,nullsFirst:!0}).order("name")):v.push(Promise.resolve({data:[]}));const[q,$]=await Promise.all(v);n(q.data||[]),o($.data||[])}catch(m){console.error("Error loading match:",m),y(m.message||"Erro ao carregar partida")}finally{u(!1),w.current=!1}}},[s]);l.useEffect(()=>{if(!s)return;T(),P.current&&clearInterval(P.current),P.current=setInterval(()=>{A(Date.now())},1e3),S.current&&(p.removeChannel(S.current),S.current=null);const m=p.channel(`match-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`id=eq.${s}`},()=>T()).on("postgres_changes",{event:"*",schema:"public",table:"match_events",filter:`match_id=eq.${s}`},()=>T()).subscribe();return S.current=m,()=>{P.current&&(clearInterval(P.current),P.current=null),S.current&&(p.removeChannel(S.current),S.current=null)}},[s,T]);const z=l.useMemo(()=>t?Lr(t):"",[t]),G=t?.home,O=t?.away,D=Number(t?.meta?.home_sets??0),C=Number(t?.meta?.away_sets??0),f=D>0||C>0,h=M||f,b=t?.status&&t.status!=="scheduled",_=Number(t?.home_score??0),F=Number(t?.away_score??0),d=t?.status==="ongoing"||t?.status==="paused";return N?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚠️"}),e.jsx("p",{className:"text-lg text-red-600 mb-2",children:"Erro ao carregar partida"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:N}),e.jsx("button",{onClick:()=>{y(null),T()},className:"bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700",children:"Tentar novamente"})]}):r||!t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-44 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-36 w-full bg-gray-100 rounded-2xl animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-56 bg-gray-100 rounded-2xl animate-pulse"}),e.jsx("div",{className:"h-56 bg-gray-100 rounded-2xl animate-pulse"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(Br,{status:t.status,meta:t.meta,starts_at:t.starts_at,updated_at:t.updated_at,currentTimestamp:k}),t.stage?e.jsx(Vr,{stage:t.stage}):null,z&&e.jsx("div",{className:"text-xs text-gray-600","aria-label":"Detalhes",children:z})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.starts_at?Se(t.starts_at):null,t.venue?e.jsx("span",{className:"ml-2",children:t.venue}):null]})]}),e.jsxs("div",{className:`relative overflow-hidden rounded-2xl border p-4 sm:p-5 shadow-sm ${d?t.status==="ongoing"?"border-blue-200":"border-amber-200":"border-gray-200"}`,children:[e.jsx(Dr,{status:t.status}),e.jsx("div",{className:"pointer-events-none absolute -top-24 -right-24 h-64 w-64 rounded-full bg-gradient-to-br from-blue-50 to-indigo-50 blur-3xl"}),e.jsx("div",{className:"pointer-events-none absolute -bottom-24 -left-24 h-64 w-64 rounded-full bg-gradient-to-tr from-pink-50 to-rose-50 blur-3xl"}),e.jsxs("div",{className:"relative grid grid-cols-1 items-center gap-4 sm:grid-cols-3",children:[e.jsx("div",{className:"min-w-0",children:e.jsx(ks,{team:G,badgeSize:56})}),e.jsxs("div",{className:"text-center",children:[h?e.jsx("div",{className:"mb-1 flex items-center justify-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center rounded-full border border-gray-200 bg-white px-2 py-0.5 text-[11px] font-semibold text-gray-700",children:["Sets ",e.jsx("span",{className:"ml-1 tabular-nums",children:D}),e.jsx("span",{className:"mx-1 text-gray-400",children:"x"}),e.jsx("span",{className:"tabular-nums",children:C})]})}):null,b?e.jsxs("div",{className:"text-4xl font-extrabold tabular-nums leading-none sm:text-5xl",children:[_," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",F]}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"}),e.jsxs("div",{className:"mt-1 text-[11px] text-gray-500",children:[xt[t.status]||t.status,d?e.jsxs("span",{className:"ml-2",children:["🕐 ",jt(t,k)]}):null,t.meta?.clock?e.jsx("span",{className:"ml-2",children:t.meta.clock}):null]})]}),e.jsx("div",{className:"min-w-0 sm:text-right",children:e.jsx(ks,{team:O,align:"right",badgeSize:56})})]}),M?e.jsxs("div",{className:"relative mt-3 text-[11px] text-gray-500",children:["Vôlei: partidas em ",e.jsx("strong",{children:"um set de 15 pontos"})," (2 pontos de vantagem para vencer)."]}):null]}),e.jsxs("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("div",{className:"text-[11px] font-semibold text-gray-500 mb-2",children:"Detalhes"}),e.jsxs("ul",{className:"text-sm grid sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Modalidade:"})," ",e.jsx("span",{className:"font-medium",children:t?.sport?.name||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Fase:"})," ",e.jsx("span",{className:"font-medium",children:yt(t.stage)||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Grupo:"})," ",e.jsx("span",{className:"font-medium",children:t.group_name||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Jogo nº:"})," ",e.jsx("span",{className:"font-medium",children:t.order_idx??"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Início:"})," ",e.jsx("span",{className:"font-medium",children:t.starts_at?Se(t.starts_at):"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Local:"})," ",e.jsx("span",{className:"font-medium",children:t.venue||"—"})]}),t.updated_at&&e.jsxs("li",{className:"sm:col-span-2",children:[e.jsx("span",{className:"text-gray-500",children:"Última atualização:"})," ",e.jsx("span",{className:"font-medium",children:Se(t.updated_at)})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(Es,{title:`Convocação — ${G?.name||"A definir"}`,players:i}),e.jsx(Es,{title:`Convocação — ${O?.name||"A definir"}`,players:c})]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.status==="finished"&&t.updated_at?`Encerrado em ${Se(t.updated_at)}`:null}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function Ps(){const s=me(),t=ds(),{user:a,updatePassword:i}=ms(),[n,c]=l.useState(""),[o,r]=l.useState(""),[u,N]=l.useState(!1),[y,k]=l.useState(null),[A,S]=l.useState(null),P=l.useMemo(()=>{const T=new URLSearchParams(t.search).get("redirect");return T&&T.startsWith("/")?T:"/"},[t.search]);l.useEffect(()=>{console.log("SetPassword mounted, user:",a?.id)},[a]);const w=async M=>{if(M.preventDefault(),console.log("🔥 FORM SUBMITTED - START"),!u){if(N(!0),S(null),k(null),!n||n.length<8){S("A senha deve ter pelo menos 8 caracteres."),N(!1);return}if(n!==o){S("As senhas não coincidem."),N(!1);return}try{console.log("🚀 Starting password update...");const{error:T}=await i(n);if(T){console.error("Password update error:",T),S(`Erro ao atualizar senha: ${T.message}`),N(!1);return}console.log("✅ Password updated successfully"),k("Senha definida com sucesso!"),setTimeout(()=>{console.log("🎯 Navigating after password set"),N(!1),s(P,{replace:!0})},1e3)}catch(T){console.error("Unexpected error:",T),S(`Erro inesperado: ${T.message}`),N(!1)}}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full mx-auto bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Bem-vindo!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Defina sua senha para continuar"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Email: ",a?.email]})]}),y&&e.jsx("p",{className:"mb-3 text-green-700 text-center",children:y}),A&&e.jsx("p",{className:"mb-3 text-red-700 text-center",children:A}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nova senha"}),e.jsx("input",{type:"password",placeholder:"Mínimo 8 caracteres",className:"w-full p-3 border border-gray-300 rounded-md",value:n,onChange:M=>c(M.target.value),required:!0,disabled:u})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirme a senha"}),e.jsx("input",{type:"password",placeholder:"Digite a senha novamente",className:"w-full p-3 border border-gray-300 rounded-md",value:o,onChange:M=>r(M.target.value),required:!0,disabled:u})]}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-blue-600 text-white py-3 rounded-md font-medium hover:bg-blue-700 disabled:opacity-50",children:u?"Configurando perfil...":"Definir senha"})]})]})})}function zr(){const s=me(),t=a=>{s(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Painel do Administrador"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecione uma área para gerenciar."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("button",{onClick:()=>t("/admin/elencos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"👥"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Elencos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Criar time, editar elenco (jogadores) e logo."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]}),e.jsxs("button",{onClick:()=>t("/admin/campeonatos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"🏆"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Campeonatos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Configurar modalidades, grupos e fases."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]}),e.jsxs("button",{onClick:()=>t("/admin/partidas"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"⏱️"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Partidas"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Iniciar/encerrar jogos e atualizar placar em tempo real."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]})]})]})}function Ur(){const s=me(),[t]=$t(),a=t.get("redirect")||"/",i=t.get("reason"),[n,c]=l.useState(""),[o,r]=l.useState(""),[u,N]=l.useState(!1),[y,k]=l.useState(null);l.useEffect(()=>{i==="forbidden"&&k("Faça login para acessar a página solicitada.")},[i]);async function A(S){if(S.preventDefault(),!u){N(!0),k(null);try{const{error:P}=await p.auth.signInWithPassword({email:n.trim(),password:o});if(P){k("Email ou senha incorretos."),N(!1);return}s(a,{replace:!0})}catch(P){console.error("Login error:",P),k("Erro inesperado durante o login."),N(!1)}}}return e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Login"}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Email"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full p-2 border rounded",value:n,onChange:S=>c(S.target.value),autoComplete:"email",required:!0})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Senha"}),e.jsx("input",{type:"password",placeholder:"Senha",className:"w-full p-2 border rounded",value:o,onChange:S=>r(S.target.value),autoComplete:"current-password",required:!0})]}),y&&e.jsx("p",{className:"text-red-600 text-sm",children:y}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-blue-600 text-white py-2 rounded disabled:opacity-50 hover:bg-blue-700 transition-colors",children:u?"Entrando...":"Entrar"})]})]})}const Te="team-logos",Fs=5,Ze=["image/png","image/jpeg","image/webp"],Jr=["oitavas","quartas","semi","final","3lugar"];function Hr(){const[s,t]=l.useState([]),[a,i]=l.useState({}),[n,c]=l.useState([]),[o,r]=l.useState(!1),[u,N]=l.useState({name:"",sport_id:""}),[y,k]=l.useState(null),[A,S]=l.useState([]),[P,w]=l.useState(0),[M,T]=l.useState([]),[z,G]=l.useState({}),[O,D]=l.useState({}),C=async()=>{const{data:j}=await p.from("sports").select("id,name").order("name");t(j||[]);const I={};(j||[]).forEach(B=>I[B.id]=B.name),i(I),!u.sport_id&&j?.length&&N(B=>({...B,sport_id:j[0].id}))},f=async()=>{let j=p.from("teams").select("id,name,group_name,sport_id,logo_url").order("name");M.length>0&&(j=j.in("sport_id",M));const{data:I}=await j;c(I||[]);const B=(I||[]).map(H=>H.id);B.length?await Promise.all([h(B),b(I)]):(G({}),D({}))},h=async j=>{if(!j?.length)return;const{data:I}=await p.from("players").select("id, team_id").in("team_id",j),B={};(I||[]).forEach(H=>{B[H.team_id]=(B[H.team_id]||0)+1}),j.forEach(H=>{H in B||(B[H]=0)}),G(B)},b=async j=>{const I=Array.from(new Set((j||[]).map(Z=>Z.sport_id)));if(I.length===0){D({});return}const{data:B}=await p.from("matches").select("sport_id, stage, home_team_id, away_team_id").in("sport_id",I).in("stage",Jr),H={};(B||[]).forEach(Z=>{Z.home_team_id&&Z.away_team_id&&(H[Z.sport_id]=!0)}),I.forEach(Z=>{Z in H||(H[Z]=!1)}),D(H)},_=async j=>{const{data:I}=await p.from("players").select("id,name,number").eq("team_id",j).order("name");S(I||[]),G(B=>({...B,[j]:(I||[]).length}))};l.useEffect(()=>{C()},[]),l.useEffect(()=>{f()},[M]);const F=j=>{const{data:I}=p.storage.from(Te).getPublicUrl(j);return I?.publicUrl||""},d=j=>{if(!j)return null;const I=j.indexOf(`/storage/v1/object/public/${Te}/`);return I===-1?null:j.substring(I+`/storage/v1/object/public/${Te}/`.length)},m=async j=>{if(j.preventDefault(),!u.name||!u.sport_id)return;r(!0);const{error:I}=await p.from("teams").insert({name:u.name.trim(),sport_id:u.sport_id});r(!1),I?alert("Erro ao criar time: "+I.message):(N({name:"",sport_id:u.sport_id}),f())},E=async j=>{if(confirm(`⚠️ Atenção!

Se você remover o time "${j.name}", TODO o campeonato da modalidade será resetado e o histórico de jogos será apagado.

Deseja realmente continuar?`)){r(!0);try{const B=d(j.logo_url);B&&await p.storage.from(Te).remove([B]).catch(()=>{});const{error:H}=await p.rpc("reset_sport",{p_sport_id:j.sport_id});if(H)throw H;const{error:Z}=await p.from("teams").delete().eq("id",j.id);if(Z)throw Z;y?.id===j.id&&(k(null),S([])),await f(),alert(`Time "${j.name}" removido.

O campeonato da modalidade foi resetado. Configure novamente os grupos e partidas antes de prosseguir.`)}catch(B){alert("Erro ao remover: "+B.message)}finally{r(!1)}}},g=async j=>{if(!y?.id||!j)return;r(!0);const{error:I}=await p.from("players").insert({team_id:y.id,name:j.trim()});r(!1),I?alert("Erro ao adicionar jogador: "+I.message):_(y.id)},v=async j=>{if(!y?.id)return;r(!0);const{error:I}=await p.from("players").delete().eq("id",j);r(!1),I?alert("Erro ao remover jogador: "+I.message):_(y.id)},q=async(j,I)=>{if(!(!j?.id||!I)){if(!Ze.includes(I.type)){alert("Formato inválido. Use PNG, JPG ou WEBP.");return}if(I.size>Fs*1024*1024){alert(`Arquivo grande demais. Máximo ${Fs} MB.`);return}r(!0);try{const B=I.type==="image/png"?"png":I.type==="image/webp"?"webp":"jpg",H=`teams/${j.id}.${B}`,{error:Z}=await p.storage.from(Te).upload(H,I,{upsert:!0,cacheControl:"3600",contentType:I.type});if(Z)throw Z;const ne=F(H),{error:he}=await p.from("teams").update({logo_url:ne}).eq("id",j.id);if(he)throw he;if(await f(),y?.id===j.id){const ie=(await p.from("teams").select("id,name,logo_url").eq("id",j.id).maybeSingle()).data;ie&&k(ze=>({...ze,...ie}))}w(ie=>ie+1)}catch(B){alert("Erro ao enviar logo: "+B.message)}finally{r(!1)}}},$=M.length===0||M.length===s.length,R=()=>{T(j=>$?[]:s.map(I=>I.id))},U=e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{onClick:R,className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${$?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:"Todos"}),s.map(j=>{const I=M.length===0?!0:M.includes(j.id);return e.jsx("button",{onClick:()=>T(B=>B.length===0?[j.id]:B.includes(j.id)?B.filter(H=>H!==j.id):[...B,j.id]),className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${I?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:j.name},j.id)})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:"Elencos"}),U,y&&e.jsxs("section",{className:"rounded-lg border bg-white shadow-sm",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ms,{src:y.logo_url,alt:y.name,size:40,version:P}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:y.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a[y.sport_id]," • ",A.length," jogadores"]})]})]}),e.jsx("button",{onClick:()=>{k(null),S([])},className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",title:"Fechar",children:"✕"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 cursor-pointer text-sm font-medium transition-colors",children:["📷 Atualizar Logo",e.jsx("input",{type:"file",accept:Ze.join(","),className:"hidden",onChange:j=>{const I=j.target.files?.[0];I&&q(y,I),j.target.value=""},disabled:o})]})}),e.jsx(Kr,{disabled:o,onAdd:g}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Jogadores"}),A.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:"Nenhum jogador no elenco"}),e.jsx("p",{className:"text-xs mt-1",children:"Adicione jogadores usando o formulário acima"})]}):e.jsx("div",{className:"grid gap-2",children:A.map(j=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-gray-50",children:[e.jsx("span",{className:"font-medium",children:j.name}),e.jsx("button",{className:"px-3 py-1 text-sm rounded-lg border border-red-300 text-red-600 hover:bg-red-50 transition-colors",onClick:()=>v(j.id),disabled:o,children:"Remover"})]},j.id))})]})]})]}),e.jsxs("section",{className:"rounded-lg border bg-white shadow-sm",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsx("h3",{className:"font-semibold text-lg",children:"Novo Time"})}),e.jsxs("form",{onSubmit:m,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome do time"}),e.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:u.name,onChange:j=>N(I=>({...I,name:j.target.value})),placeholder:"Ex.: A1 — Águias",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Esporte"}),e.jsx("select",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:u.sport_id,onChange:j=>N(I=>({...I,sport_id:j.target.value})),children:s.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))})]})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?"Salvando…":"Criar Time"})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Times Cadastrados (",n.length,")"]}),n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 border rounded-lg",children:[e.jsx("p",{className:"text-sm",children:"Nenhum time cadastrado"}),e.jsx("p",{className:"text-xs mt-1",children:"Crie seu primeiro time usando o formulário acima"})]}):e.jsx("div",{className:"grid gap-3",children:n.map(j=>{const I=a[j.sport_id]||"—",B=z[j.id]??0,H=B>0,Z=!!O[j.sport_id],ne=j.group_name?`Grupo ${j.group_name}`:Z?"Sem grupo (não aplicável)":"Sem grupo";return e.jsx("div",{className:"border rounded-lg bg-white shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(Ms,{src:j.logo_url,alt:j.name,size:48,version:P}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-lg truncate",children:j.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:I}),e.jsxs("span",{className:"text-sm text-gray-600",children:["• ",ne]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[Z&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-800 text-xs font-medium",children:"Chaveamento configurado"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Elenco: "," ",e.jsxs("span",{className:H?"text-gray-900 font-medium":"text-red-600 font-medium",children:[B," ",B===1?"jogador":"jogadores"]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("label",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 cursor-pointer text-sm font-medium transition-colors",children:["📷 Logo",e.jsx("input",{type:"file",accept:Ze.join(","),className:"hidden",onChange:he=>{const ie=he.target.files?.[0];ie&&q(j,ie),he.target.value=""},disabled:o})]}),e.jsx("button",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50 font-medium transition-colors text-sm",onClick:()=>{k(j),_(j.id),window.scrollTo({top:0,behavior:"smooth"})},children:"👥 Elenco"}),e.jsx("button",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-red-300 text-red-600 hover:bg-red-50 font-medium transition-colors text-sm",onClick:()=>E(j),disabled:o,children:"🗑️ Remover"})]})]})},j.id)})})]})]})}function Kr({disabled:s,onAdd:t}){const[a,i]=l.useState("");return e.jsxs("form",{onSubmit:n=>{n.preventDefault(),t(a),i("")},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adicionar Jogador"}),e.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nome do jogador",value:a,onChange:n=>i(n.target.value),required:!0})]}),e.jsx("button",{type:"submit",disabled:s,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?"Adicionando...":"Adicionar Jogador"})]})}function Xr(s){if(!s)return"?";const t=s.trim().split(" ");return t.length===1?t[0][0]?.toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}function Zr(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function Ms({src:s,alt:t,size:a=32,version:i=0}){const[n,c]=l.useState(!1),o=l.useMemo(()=>{if(!s)return null;const r=s.includes("?")?"&":"?";return`${s}${r}v=${i}`},[s,i]);return e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 bg-white flex items-center justify-center flex-shrink-0",style:{width:a,height:a},children:[o?e.jsx("img",{src:o,alt:t||"logo",className:`w-full h-full object-cover ${n?"opacity-100":"opacity-0"} transition-opacity duration-200`,loading:"lazy",onLoad:()=>c(!0),onError:()=>c(!1)}):null,!o||!n?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white font-bold uppercase",style:{backgroundColor:Zr(t||"T"),fontSize:a*.35},children:Xr(t)}):null]})}const Rs={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},qs={ongoing:1,paused:2,scheduled:3,finished:4},Qr="team-logos",bt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Wr=s=>typeof s=="string"&&!bt(s)&&s.trim()!=="",Is=s=>{if(!s)return null;if(bt(s))return s;if(Wr(s)){const{data:t}=p.storage.from(Qr).getPublicUrl(s);return t?.publicUrl||null}return null},De=(s="")=>s.toString().trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase();function Yr(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=s.starts_at?new Date(s.starts_at):new Date,n=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(!Number.isFinite(n)||n<0)return"0:00";const c=Math.floor(n/1e3),o=Math.floor(c/60),r=c%60;return`${o}:${r.toString().padStart(2,"0")}`}function en({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}const _e=s=>Number.isFinite(Number(s?.order_idx))?Number(s.order_idx):Number.isFinite(Number(s?.round))?Number(s.round):Number(s?.id??Number.MAX_SAFE_INTEGER),sn=s=>s.status==="scheduled"&&!!(s.home?.id&&s.away?.id);function tn(){const[s,t]=l.useState([]),[a,i]=l.useState([]),[n,c]=l.useState(null),[o,r]=l.useState(null),[u,N]=l.useState(!0),[y,k]=l.useState({}),[A,S]=l.useState(null),[P,w]=l.useState(null),[M,T]=l.useState(Date.now()),[z,G]=l.useState(typeof navigator<"u"?navigator.onLine:!0),[O,D]=l.useState(!1),[C,f]=l.useState(null),h=l.useRef(null),b=l.useRef(!0),_=l.useRef(null);l.useEffect(()=>{if(!P)return;const x=setTimeout(()=>w(null),8e3);return()=>clearTimeout(x)},[P]),l.useEffect(()=>{const x=()=>G(!0),V=()=>G(!1);return window.addEventListener("online",x),window.addEventListener("offline",V),()=>{window.removeEventListener("online",x),window.removeEventListener("offline",V)}},[]);const F=(x,V)=>k(L=>({...L,[x]:V})),d=async()=>{const{data:x,error:V}=await p.auth.getSession();return V?(console.error("getSession error:",V),w(V.message||"Falha ao obter sessão de usuário."),null):x?.session||null},m=async()=>{try{await p.auth.getUser();const{data:x,error:V}=await p.rpc("is_admin");if(V)throw V;S(!!x)}catch(x){console.error("is_admin() error:",x),S(!1)}},E=async()=>{const{data:x,error:V}=await p.from("sports").select("name").order("name");if(V){console.error("loadSports error:",V);return}const L=Array.from(new Set((x||[]).map(J=>J.name).filter(Boolean)));i(L.map(J=>({key:De(J),name:J})))},g=async({showSkeleton:x=!1}={})=>{if(b.current){x&&N(!0);try{let V=p.from("matches").select(`
          id, stage, round, group_name, order_idx, starts_at, venue, created_at, updated_at,
          status, home_score, away_score, meta,
          sport_id,
          home_team_id, away_team_id,
          sport:sport_id ( name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `);o&&(V=V.eq("status",o)),V=V.or(["group_name.not.is.null","stage.eq.r32","and(home_team_id.not.is.null,away_team_id.not.is.null)"].join(","));const{data:L,error:J}=await V;if(J)console.error("loadMatches error:",J),b.current&&w(J.message||"Falha ao carregar partidas.");else{let Q=(L||[]).map(K=>{const W=K.home&&typeof K.home=="object"?{...K.home,logo_url:(()=>{const oe=Is(K.home.logo_url);return oe?`${oe}${oe.includes("?")?"&":"?"}v=1`:null})()}:K.home,le=K.away&&typeof K.away=="object"?{...K.away,logo_url:(()=>{const oe=Is(K.away.logo_url);return oe?`${oe}${oe.includes("?")?"&":"?"}v=1`:null})()}:K.away,pe=K?.sport?.name||"";return{...K,home:W,away:le,_sportKey:De(pe)}});n&&(Q=Q.filter(K=>K._sportKey===n));const Y=Q.sort((K,W)=>{const le=qs[K.status]||999,pe=qs[W.status]||999;return le!==pe?le-pe:_e(K)-_e(W)});b.current&&t(Y)}}finally{b.current&&x&&N(!1)}}};l.useEffect(()=>{b.current=!0,(async()=>{await d(),await m(),await E(),await g({showSkeleton:!0})})(),_.current=setInterval(()=>{b.current&&T(Date.now())},1e3);const{data:V}=p.auth.onAuthStateChange(async(L,J)=>{b.current&&(S(null),await m(),J?(await E(),await g({showSkeleton:!0})):t([]))});return()=>{b.current=!1,_.current&&clearInterval(_.current),V?.subscription?.unsubscribe?.(),h.current&&(p.removeChannel(h.current),h.current=null)}},[]),l.useEffect(()=>{if(!b.current)return;g({showSkeleton:!1}),h.current&&(p.removeChannel(h.current),h.current=null);const x=p.channel("admin-matches").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>{setTimeout(()=>{b.current&&g({showSkeleton:!1})},200)}).subscribe();return h.current=x,()=>{h.current&&(p.removeChannel(h.current),h.current=null)}},[n,o]);const v=l.useMemo(()=>{const x=new Map;for(const L of s){const J=L?.sport_id?String(L.sport_id):"unknown";x.has(J)||x.set(J,[]),x.get(J).push(L)}const V=new Set;for(const[L,J]of x.entries()){if(L==="unknown"||J.some(K=>K.status==="ongoing"||K.status==="paused"))continue;const Y=J.filter(sn);Y.length&&(Y.sort((K,W)=>_e(K)-_e(W)),V.add(Y[0].id))}return V},[s]),q=async(x,V)=>{F(x,!0),w(null);const L=s;t(J=>J.map(Q=>Q.id===x?{...Q,...V}:Q));try{const{error:J}=await p.from("matches").update(V).eq("id",x);if(J)throw new Error(`Falha ao atualizar: ${J.message}`);return setTimeout(()=>{b.current&&g({showSkeleton:!1})},600),!0}catch(J){return t(L),w(J.message||"Erro ao atualizar partida."),!1}finally{F(x,!1)}},$=async(x,V,L)=>{if(x.status==="scheduled")return;const Q=De(x?.sport?.name||"").includes("volei"),Y=x.meta||{},K=Q?`${V}_points_set`:`${V}_score`;let W=Math.max(0,Number((Q?Y[K]:x[K])||0));L==="inc"&&(W+=1),L==="dec"&&(W=Math.max(0,W-1)),L==="reset"&&(W=0),Q?await q(x.id,{meta:{...Y,[K]:W}}):await q(x.id,{[K]:W})},R=(x,V)=>Math.max(0,Number(x?.meta?.[`${V}_points_set`]||0)),U=(x,V)=>{const L=x.meta||{};return Math.max(0,Number(L[V==="home"?"home_sets":"away_sets"]||0))},j=x=>{const V=Number(x?.meta?.rules?.points_to_win_set??15),L=Number(x?.meta?.rules?.win_by??2),J=R(x,"home"),Q=R(x,"away"),Y=Math.max(J,Q),K=Math.abs(J-Q);return Y>=V&&K>=L},I=async(x,{force:V=!1}={})=>{if(x.status==="scheduled")return;const L=x.meta||{},J=R(x,"home"),Q=R(x,"away"),Y=Array.isArray(L.sets)?L.sets:[];if(!V&&!j(x)){w("Para finalizar o set: mínimo 15 pontos e 2 de vantagem (ajustável em meta.rules). Clique novamente para forçar.");return}const K=J>Q?!0:Q>J?!1:null,W={...L,sets:[...Y,{h:J,a:Q,at:new Date().toISOString()}],home_sets:U(x,"home")+(K===!0?1:0),away_sets:U(x,"away")+(K===!1?1:0),home_points_set:0,away_points_set:0};await q(x.id,{meta:W,home_score:Math.max(0,Number(x.home_score||0))+J,away_score:Math.max(0,Number(x.away_score||0))+Q,updated_at:new Date().toISOString()})},B=async(x,V,L)=>{if(x.status==="scheduled")return;const J=x.meta||{},Q=V==="home"?"home_sets":"away_sets";let Y=Math.max(0,Number(J[Q]||0));L==="inc"&&(Y+=1),L==="dec"&&(Y=Math.max(0,Y-1)),L==="reset"&&(Y=0),await q(x.id,{meta:{...J,[Q]:Y}})},H=async(x,V)=>{const L=new Date().toISOString(),J={status:V,updated_at:L};return V==="ongoing"&&x.status==="scheduled"&&!x.starts_at&&(J.starts_at=L),await q(x.id,J)},Z=async x=>{const V=R(x,"home"),L=R(x,"away");if(V>0||L>0){const J=x.meta||{};await q(x.id,{meta:{...J,home_points_set:0,away_points_set:0},home_score:Math.max(0,Number(x.home_score||0))+V,away_score:Math.max(0,Number(x.away_score||0))+L})}return await H(x,"finished")},ne=async x=>{w(null);const V=x?.sport_id?String(x.sport_id):null;if(!V){w("Partida sem modalidade válida (sport_id ausente).");return}try{const{data:L,error:J}=await p.from("matches").select("id,status,group_name,order_idx,round,home_team_id,away_team_id,sport_id").eq("sport_id",V);if(J)throw J;if(!L)throw new Error("Falha ao validar ordem.");if(L.some(W=>W.status==="ongoing"||W.status==="paused"))throw new Error("Já existe uma partida em andamento/pausada nesta modalidade. Encerre-a antes de iniciar outra.");const Y=L.filter(W=>W.status==="scheduled"&&!!(W.home_team_id&&W.away_team_id));if(!Y.length)throw new Error("Não há partidas elegíveis para iniciar.");if(Y.sort((W,le)=>_e(W)-_e(le)),Y[0].id!==x.id)throw new Error("Você só pode iniciar o próximo jogo da fila.");await H(x,"ongoing")}catch(L){console.error("tryStartMatch error:",L),w(L.message||"Não foi possível iniciar a partida (ordem restrita).")}},he=async x=>await ne(x),ie=async x=>await H(x,"paused"),ze=async x=>await H(x,"ongoing");return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Gerenciar Partidas"}),!z&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded mb-4",children:"⚠️ Você está offline. As alterações serão sincronizadas quando a conexão for restaurada."}),A===!1&&e.jsxs("div",{className:"text-sm p-3 rounded bg-red-50 border border-red-200 text-red-700",children:["Você não está autenticado como ",e.jsx("strong",{children:"admin"}),". As ações podem ser bloqueadas."]}),P&&e.jsxs("div",{className:"text-sm p-3 rounded bg-yellow-50 border border-yellow-200 text-yellow-800 flex items-start gap-3",children:[e.jsx("div",{className:"flex-1 whitespace-pre-wrap",children:String(P)}),e.jsx("button",{onClick:()=>w(null),className:"text-xs px-2 py-1 rounded border border-yellow-300 hover:bg-yellow-100",children:"Fechar"})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Modalidade:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>c(null),className:`px-2 py-1 rounded text-xs ${n?"bg-gray-100 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:"Todas"}),a.map(x=>e.jsx("button",{onClick:()=>c(x.key),className:`px-2 py-1 rounded text-xs ${n===x.key?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:x.name},x.key))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>r(null),className:`px-2 py-1 rounded text-xs ${o?"bg-gray-100 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:"Todos"}),Object.entries(Rs).map(([x,V])=>e.jsx("button",{onClick:()=>r(x),className:`px-2 py-1 rounded text-xs ${o===x?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:V},x))]})]})]}),u?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((x,V)=>e.jsx("div",{className:"h-32 bg-gray-100 rounded animate-pulse"},V))}):s.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma partida encontrada."}):e.jsx("ul",{className:"space-y-4",children:s.map(x=>{const L=De(x?.sport?.name||"").includes("volei"),J=L?U(x,"home"):0,Q=L?U(x,"away"):0,Y=L?R(x,"home"):null,K=L?R(x,"away"):null,W=!x.group_name,le=!!(x.home?.id&&x.away?.id),pe=le,oe=x.status==="ongoing"||x.status==="paused",_t=oe?x.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200",Ue=v.has(x.id);return e.jsxs("li",{className:`border rounded-lg p-3 sm:p-4 flex flex-col gap-3 bg-white shadow-sm relative overflow-hidden ${_t}`,children:[e.jsx(en,{status:x.status}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-500 flex flex-wrap items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-medium",children:x.sport?.name}),x.group_name&&e.jsxs("span",{children:["· Grupo ",x.group_name]}),x.stage&&e.jsxs("span",{children:["· ",x.stage==="semi"?"Semifinal":x.stage==="3lugar"?"3º lugar":x.stage==="r32"?"Pré-oitavas":x.stage]}),x.round&&e.jsxs("span",{children:["· J",x.round]}),oe&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",Yr(x,M)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x.status==="scheduled"&&Ue&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-indigo-100 text-indigo-700 uppercase tracking-wide",children:"Próximo na ordem"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded self-start sm:self-auto ${x.status==="ongoing"?"bg-green-100 text-green-700":x.status==="paused"?"bg-yellow-100 text-yellow-700":x.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:Rs[x.status]||x.status})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4",children:[e.jsx(Gs,{align:"left",team:x.home,score:x.home_score,onInc:()=>$(x,"home","inc"),onDec:()=>$(x,"home","dec"),onReset:()=>$(x,"home","reset"),sets:L?J:null,setPoints:L?Y:null,onSetInc:L&&O?()=>B(x,"home","inc"):void 0,onSetDec:L&&O?()=>B(x,"home","dec"):void 0,onSetReset:L&&O?()=>B(x,"home","reset"):void 0,disabled:y[x.id]||x.status==="scheduled"}),e.jsx(Gs,{align:"right",team:x.away,score:x.away_score,onInc:()=>$(x,"away","inc"),onDec:()=>$(x,"away","dec"),onReset:()=>$(x,"away","reset"),sets:L?Q:null,setPoints:L?K:null,onSetInc:L&&O?()=>B(x,"away","inc"):void 0,onSetDec:L&&O?()=>B(x,"away","dec"):void 0,onSetReset:L&&O?()=>B(x,"away","reset"):void 0,disabled:y[x.id]||x.status==="scheduled"})]}),L&&e.jsx("button",{onClick:()=>D(fe=>!fe),className:"text-[10px] px-2 py-0.5 rounded border border-gray-300 hover:bg-gray-50 self-start",children:O?"Fechar edição de sets":"Editar sets manualmente"}),L&&(Y>0||K>0)&&e.jsx("button",{onClick:async()=>{if(C===x.id){const fe=j(x);f(null),await I(x,{force:!fe})}else f(x.id),setTimeout(()=>f(fe=>fe===x.id?null:fe),3e3)},disabled:y[x.id]||x.status==="scheduled",className:`px-3 py-1 text-xs rounded ${C===x.id?"bg-red-600":"bg-purple-600"} text-white hover:opacity-90 disabled:opacity-50`,title:"Soma os pontos do set aos totais (PF/PA) e incrementa o set do vencedor.",children:C===x.id?"Confirmar finalizar set":"Finalizar set"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[x.status==="scheduled"&&e.jsx("button",{onClick:()=>he(x),disabled:y[x.id]||!pe||!Ue,className:"px-3 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",title:pe?Ue?"Iniciar próximo jogo da ordem.":"Aguarde: apenas o próximo jogo da ordem pode iniciar.":"Defina as duas equipes antes de iniciar.",children:"Iniciar"}),x.status==="ongoing"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ie(x),disabled:y[x.id],className:"px-3 py-1 text-xs rounded bg-yellow-500 text-white hover:bg-yellow-600 disabled:opacity-50",children:"Pausar"}),e.jsx("button",{onClick:()=>Z(x),disabled:y[x.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),x.status==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ze(x),disabled:y[x.id],className:"px-3 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:"Retomar"}),e.jsx("button",{onClick:()=>Z(x),disabled:y[x.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),x.status==="finished"&&e.jsx("span",{className:"text-xs text-gray-500 self-center",children:"Partida encerrada (resultado editável)."})]})]},x.id)})}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% {
            transform: translateX(-100%);
          }
          50% {
            transform: translateX(200%);
          }
          100% {
            transform: translateX(-100%);
          }
        }
      `})]})}function Gs({team:s,score:t,onInc:a,onDec:i,onReset:n,sets:c,setPoints:o,onSetInc:r,onSetDec:u,onSetReset:N,disabled:y,align:k="left"}){const A=k==="right",S=typeof o=="number"?"Pontos do set":"Pontos",P=Number(typeof o=="number"?o||0:t||0),w=!!(r||u||N),M=({label:G,value:O})=>{const D=Number.isFinite(O)?O:"-";return e.jsxs("div",{className:"flex min-w-[70px] flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-2.5 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:G}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:D})]})},T=A?"justify-end":"justify-start",z=A?"text-right":"text-left";return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-gray-50/80 p-3 shadow-sm space-y-4",children:[e.jsxs("div",{className:`flex flex-wrap items-center justify-between gap-3 ${A?"flex-row-reverse":""}`,children:[e.jsxs("div",{className:`flex min-w-0 items-center gap-2 ${A?"flex-row-reverse text-right":""}`,children:[e.jsx(se,{team:s||{name:"A definir"},size:28}),e.jsx("span",{className:"text-sm font-medium truncate",children:s?.name||"A definir"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${A?"flex-row-reverse":""}`,children:[typeof c=="number"?e.jsx(M,{label:"Sets",value:Number(c||0)}):null,e.jsx(M,{label:S,value:P})]})]}),typeof c=="number"?e.jsxs("div",{className:`space-y-2 ${z}`,children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:"Controle de sets"}),e.jsxs("div",{className:`flex flex-wrap gap-2 ${T}`,children:[e.jsx("button",{type:"button",onClick:u,disabled:y||!w,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"-"}),e.jsx("button",{type:"button",onClick:r,disabled:y||!w,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"+"}),e.jsx("button",{type:"button",onClick:N,disabled:y||!w,className:"flex items-center justify-center rounded-lg bg-red-500 px-3 py-1 text-xs font-semibold text-white transition hover:bg-red-600 disabled:opacity-40",title:"Zerar sets",children:"Zerar"})]})]}):null,e.jsxs("div",{className:`space-y-2 ${z}`,children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:S}),e.jsxs("div",{className:`flex flex-wrap gap-2 ${T}`,children:[e.jsx("button",{type:"button",onClick:i,disabled:y,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"-"}),e.jsx("button",{type:"button",onClick:a,disabled:y,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"+"}),e.jsx("button",{type:"button",onClick:n,disabled:y,className:"flex items-center justify-center rounded-lg bg-red-500 px-3 py-1 text-xs font-semibold text-white transition hover:bg-red-600 disabled:opacity-40",title:typeof o=="number"?"Zerar pontos do set":"Zerar pontos",children:"Zerar"})]})]})]})}const xe={pebolim:{name:"Pebolim",required:24,path:"/admin/campeonatos/pebolim",variant:"1v3_1v2_3v2"},fifa:{name:"FIFA",required:32,path:"/admin/campeonatos/fifa"},futsal:{name:"Futsal",required:9,path:"/admin/campeonatos/futsal",variant:"1v3_1v2_3v2"},volei:{name:"Vôlei",required:9,path:"/admin/campeonatos/volei",variant:"1v2_1v3_2v3"}},an={Pebolim:"pebolim",FIFA:"fifa",Futsal:"futsal",Volei:"volei",Vôlei:"volei"},rn=(s="")=>s.trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),Os=({children:s,tone:t="gray"})=>e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium border ${t==="green"?"bg-green-50 text-green-700 border-green-200":t==="amber"?"bg-amber-50 text-amber-700 border-amber-200":t==="red"?"bg-red-50 text-red-700 border-red-200":t==="blue"?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:s}),Ls=({children:s,className:t=""})=>e.jsx("div",{className:`rounded-2xl border border-gray-200 bg-white shadow-sm ${t}`,children:s}),nn=({title:s,subtitle:t,right:a})=>e.jsxs("div",{className:"flex items-start justify-between gap-3 p-4 sm:p-5",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:s}),t&&e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t})]}),a]}),Qe=({children:s,className:t="",...a})=>e.jsx("button",{className:`inline-flex w-full items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-gray-200 disabled:text-gray-500 ${t}`,...a,children:s}),Ne=({children:s,className:t="",...a})=>e.jsx("button",{className:`inline-flex w-full items-center justify-center gap-2 rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60 ${t}`,...a,children:s});function on(){const s=me(),[t,a]=l.useState(!0),[i,n]=l.useState(null),[c,o]=l.useState([]),[r,u]=l.useState({}),[N,y]=l.useState({}),[k,A]=l.useState(null),[S,P]=l.useState(null),w=async()=>{a(!0),n(null);try{const{data:h,error:b}=await p.from("sports").select("id,name").order("name",{ascending:!0});if(b)throw b;const _=h.map(d=>({id:d.id,name:d.name,key:an[d.name?.trim()]||rn(d.name)}));o(_);const F=await Promise.all(_.map(async d=>{const[m,E,g,v]=await Promise.all([p.from("teams").select("id",{count:"exact",head:!0}).eq("sport_id",d.id),p.from("teams").select("id, name, group_name, seed_in_group").eq("sport_id",d.id).not("group_name","is",null),p.from("matches").select("id",{count:"exact",head:!0}).eq("sport_id",d.id),p.from("standings").select("id",{count:"exact",head:!0}).eq("sport_id",d.id)]),q=m?.count??0,$=g?.count??0,R=v?.count??0,U=ln(E?.data||[]),{data:j}=await p.from("v_queue_slots").select("slot, order_idx, match_id, stage, group_name").eq("sport_id",d.id);let I={};const B=(j||[]).map(H=>H.match_id).filter(Boolean);if(B.length){const{data:H}=await p.from("match_detail_view").select("id, home_team_name, away_team_name").in("id",B);I=Object.fromEntries((H||[]).map(Z=>[Z.id,Z]))}return[d.key,{sportId:d.id,sportName:d.name,teamCount:q,groupsMeta:U,matchesCount:$,standingsCount:R,hasAny:($||R||U.total||0)>0,queueSlots:j||[],queueDetails:I}]}));u(Object.fromEntries(F))}catch(h){n(`Falha ao carregar: ${h.message||h}`)}finally{a(!1)}};l.useEffect(()=>{w();const h=p.channel("tournaments-queue").on("postgres_changes",{event:"*",schema:"public",table:"matches"},w).subscribe();return()=>p.removeChannel(h)},[]);const M=h=>{const b=r[h];if(!b)return!1;if(h==="fifa")return b.teamCount===xe.fifa.required;const _=h==="pebolim"?8:3,F=Object.values(b.groupsMeta.byGroup||{}),d=F.length===_&&F.every(E=>E.members.length===3),m=F.every(E=>dn(E.members.map(g=>g.seed_in_group),[1,2,3]));return d&&m},T=(h,b)=>y(_=>({..._,[h]:b})),z=h=>P({key:h,name:xe[h].name}),G=async h=>{const b=r[h];if(!b)return;const _=b.sportId;T(h,!0),n(null),P(null);try{if(h==="fifa"){const{error:F}=await p.rpc("fifa_preserve_order_and_reset_played",{p_reset_played:!0});if(F)throw F}else{const{data:F}=await p.from("matches").select("id").eq("sport_id",_),d=(F||[]).map(g=>g.id);d.length&&await p.from("match_events").delete().in("match_id",d),await p.from("matches").delete().eq("sport_id",_),await p.from("standings").delete().eq("sport_id",_);const m=xe[h]?.variant||"1v3_1v2_3v2",{error:E}=await p.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:_,p_variant:m});if(E)throw E}n(`Campeonato de ${xe[h].name} gerado com sucesso (ordem fixa).`),await w()}catch(F){n(`Falha ao gerar partidas: ${F.message||F}`)}finally{T(h,!1)}},O=h=>A({key:h,name:xe[h].name}),D=async h=>{const b=r[h];if(b){T(h,!0);try{const{data:_}=await p.from("matches").select("id").eq("sport_id",b.sportId),F=(_||[]).map(d=>d.id);F.length&&await p.from("match_events").delete().in("match_id",F),await p.from("matches").delete().eq("sport_id",b.sportId),await p.from("standings").delete().eq("sport_id",b.sportId),await p.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",b.sportId),n(`Campeonato de ${xe[h].name} foi reiniciado.`),A(null),await w()}catch(_){n(`Falha ao reiniciar: ${_.message||_}`)}finally{T(h,!1)}}},C=async h=>{await p.rpc("admin_start_first_if_idle",{p_sport_id:h})},f=async h=>{await p.rpc("admin_finish_live_and_start_next",{p_sport_id:h})};return e.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Gerenciar Campeonatos"})]}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Configure grupos, gere as partidas na ordem definida e opere os cartões: ",e.jsx("strong",{children:"Ao vivo"}),", ",e.jsx("strong",{children:"⚠️ Compareçam"})," e ",e.jsx("strong",{children:"Próximo jogo"}),"."]})]}),i&&e.jsx("div",{className:"mb-4 rounded-xl border border-blue-200 bg-blue-50 px-3 py-2 text-sm text-blue-800",children:i}),t?e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Array.from({length:4}).map((h,b)=>e.jsxs(Ls,{className:"p-4",children:[e.jsx("div",{className:"h-6 w-32 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"mt-3 h-4 w-56 animate-pulse rounded bg-gray-100"}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-9 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"h-9 animate-pulse rounded bg-gray-100"})]})]},b))}):e.jsx("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:c.map(h=>{const b=h.key,_=xe[b];if(!_)return null;const F=r[b]||{},d=F.teamCount===_.required,m=!!F.hasAny,E=M(b);return e.jsxs(Ls,{children:[e.jsx(nn,{title:_.name,subtitle:`Times: ${F.teamCount??0} / ${_.required}`,right:m?e.jsx(Os,{tone:"amber",children:"Existe"}):e.jsx(Os,{tone:d?"green":"gray",children:d?"Pronto":"Aguardando times"})}),e.jsx("div",{className:"px-4 sm:px-5",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Qt,{className:"h-4 w-4"})," Partidas: ",e.jsx("strong",{className:"ml-1",children:F.matchesCount??0})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(xs,{className:"h-4 w-4"})," Grupos definidos: ",e.jsx("strong",{className:"ml-1",children:F.groupsMeta.countGroups||0})]}),b!=="fifa"&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(la,{className:"h-4 w-4"})," Seeds válidos: ",e.jsx("strong",{className:"ml-1",children:F.groupsMeta.seedsOk?"Sim":"Não"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-4 sm:grid-cols-2 sm:p-5",children:[e.jsxs(Qe,{disabled:!d||m,onClick:()=>s(_.path),children:[e.jsx(xs,{className:"h-4 w-4"})," Configurar & Agrupar"]}),e.jsxs(Ne,{className:"text-red-600 border-red-600 hover:bg-red-50",disabled:N[b]||(b==="fifa"?!d:!E),onClick:()=>z(b),children:[N[b]?e.jsx(Yt,{className:"h-4 w-4 animate-spin"}):e.jsx(na,{className:"h-4 w-4"}),"Gerar Partidas (ordem fixa)"]}),m&&e.jsxs(Ne,{onClick:()=>C(F.sportId),children:[e.jsx(Ks,{className:"h-4 w-4"})," Iniciar primeiro (se parado)"]}),m&&e.jsxs(Ne,{onClick:()=>f(F.sportId),children:[e.jsx(Xt,{className:"h-4 w-4"})," Finalizar ao vivo e iniciar próximo"]}),e.jsxs(Ne,{className:"sm:col-span-2",onClick:()=>O(b),disabled:!m,children:[e.jsx(da,{className:"h-4 w-4"})," Apagar & Reiniciar"]})]}),e.jsx("div",{className:"px-4 pb-4 sm:px-5 sm:pb-5",children:e.jsx("div",{className:"rounded-xl border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 divide-y sm:grid-cols-3 sm:divide-x sm:divide-y-0",children:[We(F,"live"),We(F,"call"),We(F,"next")]})})})]},b)})}),k&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>A(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Reiniciar ",k.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Isso apagará ",e.jsx("strong",{children:"todas"})," as partidas, eventos e a classificação, e limpará os grupos."]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-2",children:[e.jsx(Ne,{onClick:()=>A(null),children:"Cancelar"}),e.jsx(Qe,{onClick:()=>D(k.key),children:"Confirmar"})]})]})]}),S&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>P(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Gerar Partidas para ",S.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Isso apagará ",e.jsx("strong",{children:"todas"})," as partidas, eventos e a classificação, e limpará os grupos antes de gerar novas partidas."]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-2",children:[e.jsx(Ne,{onClick:()=>P(null),children:"Cancelar"}),e.jsx(Qe,{onClick:()=>G(S.key),children:"Confirmar"})]})]})]})]})}function ln(s){const t={};for(const c of s)t[c.group_name]||(t[c.group_name]={members:[]}),t[c.group_name].members.push({id:c.id,name:c.name,seed_in_group:c.seed_in_group});const a=Object.keys(t).sort(cn),i=a.length;let n=!0;for(const c of a){const o=new Set(t[c].members.map(u=>u.seed_in_group));o.has(1)&&o.has(2)&&o.has(3)&&o.size===3||(n=!1)}return{byGroup:t,groups:a,countGroups:i,total:s.length,seedsOk:n}}function cn(s,t){const a=s&&s[s.length-1]||"z",i=t&&t[t.length-1]||"z";return a<i?-1:a>i?1:0}function dn(s=[],t=[]){const a=new Set(s),i=new Set(t);if(a.size!==i.size)return!1;for(const n of a)if(!i.has(n))return!1;return!0}function We(s,t){const a=t==="live"?"Ao vivo":t==="call"?"⚠️ Compareçam":"Próximo jogo",i=t==="live"?"bg-red-50 border-red-200":t==="call"?"bg-amber-50 border-amber-200":"bg-emerald-50 border-emerald-200",n=(s.queueSlots||[]).find(o=>o.slot===t),c=n?.match_id?s.queueDetails?.[n.match_id]:null;return e.jsx("div",{className:"p-3 sm:p-4",children:e.jsxs("div",{className:`rounded-xl border p-3 sm:p-4 ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:a}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Hs,{className:"h-3.5 w-3.5"}),"#",n?.order_idx??"–"]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[c?e.jsxs("div",{className:"font-medium text-gray-900",children:[c.home_team_name," ",e.jsx("span",{className:"text-gray-500",children:"x"})," ",c.away_team_name]}):e.jsx("div",{className:"text-gray-500",children:"Aguardando…"}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[n?.stage?e.jsx("span",{className:"mr-2",children:n.stage}):null,n?.group_name?e.jsxs("span",{children:["Grupo ",n.group_name]}):null]})]})]})})}const ce=["A","B","C"],we=3;function mn(){const[s,t]=l.useState([]),[a,i]=l.useState({A:[],B:[],C:[]}),[n,c]=l.useState(new Set),[o,r]=l.useState(!0),[u,N]=l.useState(!1),[y,k]=l.useState(null),A=l.useRef(!1),S=l.useRef(!0),P=me(),w=l.useMemo(()=>{const h=new Map;return s.forEach(b=>h.set(b.id,b)),h},[s]),M=async()=>{if(!A.current){A.current=!0,r(!0);try{const{data:h,error:b}=await p.from("sports").select("id").eq("name","Futsal").maybeSingle();if(b||!h?.id){alert("Erro ao buscar a modalidade Futsal.");return}k(h.id);const{data:_,error:F}=await p.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",h.id).order("name");if(F){alert("Erro ao carregar times de Futsal.");return}t(_||[]);const d={A:[],B:[],C:[]},m=(_||[]).reduce((E,g)=>(ce.includes(g.group_name)&&(E[g.group_name]=E[g.group_name]||[]).push(g),E),{});ce.forEach(E=>{const g=(m[E]||[]).sort((v,q)=>{const $=v.seed_in_group??999,R=q.seed_in_group??999;return $!==R?$-R:v.name.localeCompare(q.name)});d[E]=g.map(v=>v.id)}),i(d)}finally{r(!1),A.current=!1}}};l.useEffect(()=>{S.current=!0,M();const h=p.channel("futsal-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{S.current&&!A.current&&M()}).subscribe();return()=>{S.current=!1,p.removeChannel(h)}},[]);const T=l.useMemo(()=>new Set(ce.flatMap(h=>a[h])),[a]),z=l.useMemo(()=>s.filter(h=>!T.has(h.id)),[s,T]),G=h=>{c(b=>{const _=new Set(b);return _.has(h)?_.delete(h):_.add(h),_})},O=h=>{const b=Array.from(n);if(!b.length){alert("Selecione ao menos 1 time.");return}if(a[h].length+b.length>we){alert(`O grupo ${h} não pode ter mais de ${we} times.`),c(new Set);return}i(_=>{const F={..._};for(const d of b){for(const m of ce)F[m]=F[m].filter(E=>E!==d);F[h]=[...F[h],d]}return F}),c(new Set)},D=h=>{i(b=>{const _={...b};for(const F of ce)_[F]=_[F].filter(d=>d!==h);return _})},C=ce.every(h=>a[h].length===we),f=async()=>{if(!C){alert("Complete todos os grupos antes de confirmar!");return}if(!y){alert("Modalidade Futsal não encontrada.");return}try{N(!0),await p.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",y);for(const b of ce){const _=a[b];if(_.length){await p.from("teams").update({group_name:b}).in("id",_);for(let F=0;F<_.length;F++)await p.from("teams").update({seed_in_group:F+1}).eq("id",_[F])}}await p.rpc("seed_initial_standings",{p_sport_name:"Futsal",p_reset:!0}),await p.rpc("rebuild_standings",{p_sport_name:"Futsal"});const{error:h}=await p.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:y,p_variant:"1v3_1v2_3v2"});if(h){alert("Erro ao gerar jogos de grupos: "+h.message);return}await p.rpc("maybe_create_knockout",{p_sport_name:"Futsal"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>P("/admin/campeonatos"),1200)}catch(h){alert("Erro ao salvar: "+(h?.message||String(h)))}finally{N(!1)}};return o?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Futsal"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. Ao confirmar, os grupos são salvos com"," ",e.jsx("strong",{children:"seed_in_group = 1,2,3"}),", e os jogos são gerados via RPC na"," ",e.jsx("strong",{children:"ordem exata"})," (fila global por ",e.jsx("code",{children:"order_idx"}),"). Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:M,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),z.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:z.map(h=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(h.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>G(h.id),title:h.name,children:[e.jsx(Ds,{team:h}),e.jsx("span",{className:"truncate",children:h.name})]},h.id))})]}),ce.map(h=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",h]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[h].length===we?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[h].length,"/",we]})]}),e.jsx("button",{onClick:()=>O(h),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[h].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[h].map((b,_)=>{const F=w.get(b);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>D(b),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:_+1}),e.jsx(Ds,{team:F}),e.jsx("span",{className:"truncate",title:F?.name,children:F?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},b)})})})]},h))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:ce.map(h=>`${h}(${a[h].length}/${we})`).join(", ")}),e.jsx("button",{onClick:f,disabled:!C||u,className:`px-6 py-2 rounded font-semibold transition ${C&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Ds({team:s}){const t=un(s?.name),a=s?.color||gn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function un(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function gn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const ae=["A","B","C"],ge=3;function hn(){const[s,t]=l.useState([]),[a,i]=l.useState({A:[],B:[],C:[]}),[n,c]=l.useState(new Set),[o,r]=l.useState(!0),[u,N]=l.useState(!1),[y,k]=l.useState(null),A=l.useRef(!1),S=l.useRef(!0),P=me(),w=async()=>{if(!A.current){A.current=!0,r(!0);try{const{data:f,error:h}=await p.from("sports").select("id").eq("name","Volei").maybeSingle();if(h||!f?.id){alert("Erro ao buscar a modalidade Vôlei.");return}k(f.id);const{data:b,error:_}=await p.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",f.id).order("name");if(_){alert("Erro ao carregar times de Vôlei.");return}t(b||[]);const F={A:[],B:[],C:[]},d={A:[],B:[],C:[]};(b||[]).forEach(m=>{m.group_name&&ae.includes(m.group_name)&&d[m.group_name].push(m)}),ae.forEach(m=>{const E=(d[m]||[]).sort((g,v)=>{const q=g.seed_in_group??999,$=v.seed_in_group??999;return q!==$?q-$:g.name.localeCompare(v.name)});F[m]=E.map(g=>g.id)}),i(F)}finally{r(!1),A.current=!1}}};l.useEffect(()=>{S.current=!0,w();const f=p.channel("volei-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{S.current&&!A.current&&w()}).subscribe();return()=>{S.current=!1,p.removeChannel(f)}},[]);const M=l.useMemo(()=>new Set(ae.flatMap(f=>a[f])),[a]),T=l.useMemo(()=>s.filter(f=>!M.has(f.id)),[s,M]),z=f=>{c(h=>{const b=new Set(h);return b.has(f)?b.delete(f):b.add(f),b})},G=f=>{const h=Array.from(n);if(!h.length){alert("Selecione ao menos 1 time.");return}if(a[f].length+h.length>ge){alert(`O grupo ${f} não pode ter mais de ${ge} times.`),c(new Set);return}i(b=>{const _={...b};for(const F of h){for(const d of ae)_[d]=_[d].filter(m=>m!==F);_[f]=[..._[f],F]}return _}),c(new Set)},O=f=>{i(h=>{const b={...h};for(const _ of ae)b[_]=b[_].filter(F=>F!==f);return b})},D=ae.every(f=>a[f].length===ge),C=async()=>{if(!D){alert("Complete todos os grupos antes de confirmar!");return}if(!y){alert("Modalidade Vôlei não encontrada.");return}try{N(!0),await p.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",y);for(const h of ae){const b=a[h];if(b.length){await p.from("teams").update({group_name:h}).in("id",b);for(let _=0;_<b.length;_++)await p.from("teams").update({seed_in_group:_+1}).eq("id",b[_])}}await p.rpc("seed_initial_standings",{p_sport_name:"Volei",p_reset:!0}),await p.rpc("rebuild_standings",{p_sport_name:"Volei"});const{error:f}=await p.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:y,p_variant:"1v2_1v3_2v3"});if(f){alert("Erro ao gerar jogos de grupos: "+f.message);return}await p.rpc("maybe_create_knockout",{p_sport_name:"Volei"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>P("/admin/campeonatos"),1200)}catch(f){alert("Erro ao salvar: "+(f?.message||String(f)))}finally{N(!1)}};return o?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Vôlei"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. Ao confirmar, salvamos"," ",e.jsx("strong",{children:"group_name"})," e ",e.jsx("strong",{children:"seed_in_group = 1,2,3"})," conforme a ordem e geramos os jogos via RPC na ",e.jsx("strong",{children:"ordem exata"}),". Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:w,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),T.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:T.map(f=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(f.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>z(f.id),title:f.name,children:[e.jsx(Bs,{team:f}),e.jsx("span",{className:"truncate",children:f.name})]},f.id))})]}),ae.map(f=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",f]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[f].length===ge?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[f].length,"/",ge]})]}),e.jsx("button",{onClick:()=>G(f),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[f].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[f].map((h,b)=>{const _=s.find(F=>F.id===h);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>O(h),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:b+1}),e.jsx(Bs,{team:_}),e.jsx("span",{className:"truncate",title:_?.name,children:_?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},h)})})})]},f))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:ae.map(f=>`${f}(${a[f].length}/${ge})`).join(", ")}),e.jsx("button",{onClick:C,disabled:!ae.every(f=>a[f].length===ge)||u,className:`px-6 py-2 rounded font-semibold transition ${ae.every(f=>a[f].length===ge)&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Bs({team:s}){const t=pn(s?.name),a=s?.color||xn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function pn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function xn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const Ye=16;function fn(){const[s,t]=l.useState([]),[a,i]=l.useState(Array.from({length:Ye},()=>({home:null,away:null}))),[n,c]=l.useState(new Set),[o,r]=l.useState(!0),[u,N]=l.useState(!1),[y,k]=l.useState(null),A=me(),S=async()=>{r(!0);try{const{data:C,error:f}=await p.from("sports").select("id").eq("name","FIFA").maybeSingle();if(f||!C?.id){alert("Erro ao localizar a modalidade FIFA."),r(!1);return}k(C.id);const{data:h,error:b}=await p.from("teams").select("id, name, logo_url, color").eq("sport_id",C.id).order("name");b?alert("Erro ao carregar times do FIFA."):t(h||[])}finally{r(!1)}};l.useEffect(()=>{S()},[]);const P=l.useMemo(()=>new Set(a.flatMap(C=>[C.home,C.away]).filter(Boolean)),[a]),w=l.useMemo(()=>s.filter(C=>!P.has(C.id)),[s,P]),M=C=>{c(f=>{const h=new Set(f);return h.has(C)?h.delete(C):h.add(C),h})},T=(C,f)=>{const h=Array.from(n);if(h.length===0){alert("Selecione um time para alocar.");return}if(h.length>1){alert("Selecione apenas 1 time por vez."),c(new Set);return}const b=h[0];i(_=>{const F=_[C];if(F[f])return alert(`O slot ${f==="home"?"A":"B"} do Jogo ${C+1} já está ocupado.`),_;const d=[..._];return d[C]={...F,[f]:b},d}),c(new Set)},z=(C,f)=>{i(h=>{const b=[...h];return b[C]={...b[C],[f]:null},b})},G=a.length===Ye&&a.every(C=>C.home&&C.away),O=async()=>{if(!G){alert("Todos os confrontos precisam ter 2 times.");return}if(!y){alert("Modalidade FIFA não encontrada.");return}try{N(!0);const{count:C}=await p.from("matches").select("*",{count:"exact",head:!0}).eq("sport_id",y);if((C??0)>0){if(!window.confirm("Já existe um campeonato de FIFA. Criar um novo vai apagar jogos e classificação existentes. Deseja continuar?"))return;const{data:_}=await p.from("matches").select("id").eq("sport_id",y),F=(_||[]).map(d=>d.id);F.length&&await p.from("match_events").delete().in("match_id",F),await p.from("matches").delete().eq("sport_id",y),await p.from("standings").delete().eq("sport_id",y)}await p.from("teams").update({group_name:null}).eq("sport_id",y);const f=a.map((b,_)=>({sport_id:y,stage:"r32",round:_+1,order_idx:_+1,status:"scheduled",home_team_id:b.home,away_team_id:b.away,venue:"Console FIFA"})),{error:h}=await p.from("matches").insert(f);if(h){alert("Erro ao criar os jogos: "+h.message);return}await p.from("matches").insert(Array.from({length:8}).map((b,_)=>({sport_id:y,stage:"oitavas",round:_+1,order_idx:16+(_+1),status:"scheduled"}))),await p.from("matches").insert(Array.from({length:4}).map((b,_)=>({sport_id:y,stage:"quartas",round:_+1,order_idx:24+(_+1),status:"scheduled"}))),await p.from("matches").insert([{sport_id:y,stage:"semi",round:1,order_idx:29,status:"scheduled"},{sport_id:y,stage:"semi",round:2,order_idx:30,status:"scheduled"},{sport_id:y,stage:"final",round:1,order_idx:31,status:"scheduled"},{sport_id:y,stage:"3lugar",round:1,order_idx:32,status:"scheduled"}]),await p.rpc("seed_initial_standings",{p_sport_name:"FIFA",p_reset:!0}),alert(`✅ Chaveamento criado com sucesso!

Voltando para a tela de campeonatos…`),setTimeout(()=>A("/admin/campeonatos"),1200)}catch(C){alert("Erro ao salvar: "+(C?.message||String(C)))}finally{N(!1)}},D=async()=>{if(!y){alert("Modalidade FIFA não encontrada.");return}if(s.length!==32){alert("É necessário ter exatamente 32 times cadastrados no FIFA para gerar automaticamente.");return}try{N(!0);const{error:C}=await p.rpc("fifa_seed_32_bracket",{p_sport_name:"FIFA",p_reset:!1});if(C)throw C;alert(`✅ Partidas do FIFA geradas com sucesso!

Voltando para a tela de campeonatos…`),setTimeout(()=>A("/admin/campeonatos"),1200)}catch(C){console.error("Erro ao gerar partidas FIFA:",C),alert("Erro ao gerar partidas: "+(C?.message||String(C)))}finally{N(!1)}};return o?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de FIFA"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Monte as pré-oitavas (16 jogos). Ao confirmar, os jogos entram como ",e.jsx("strong",{children:"scheduled"})," com"," ",e.jsx("strong",{children:"order_idx"})," fixo: assim, o Jogo 1 aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:D,disabled:u||!y,title:"Gera automaticamente J1..J16, placeholders J17..J28",className:`text-xs px-3 py-1 rounded border transition ${u?"opacity-60 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Gerar automaticamente (RPC)"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),w.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"grid grid-cols-2 gap-2",children:w.map(C=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(C.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>M(C.id),title:C.name,children:[e.jsx(es,{team:C}),e.jsx("span",{className:"truncate",children:C.name})]},C.id))})]}),e.jsxs("div",{className:"border rounded p-4 overflow-y-auto max-h-[32rem]",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Confrontos (pré-oitavas)"}),e.jsx("ul",{className:"space-y-4",children:a.map((C,f)=>{const h=s.find(_=>_.id===C.home),b=s.find(_=>_.id===C.away);return e.jsxs("li",{className:"flex flex-col gap-1 border rounded p-2 bg-gray-50",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:["Jogo ",f+1]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 flex-1",children:h?e.jsxs(e.Fragment,{children:[e.jsx(es,{team:h}),e.jsx("span",{className:"truncate",title:h.name,children:h.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>z(f,"home"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>T(f,"home"),children:"Adicionar time A"})}),e.jsx("span",{className:"font-bold",children:"vs"}),e.jsx("div",{className:"flex items-center gap-2 flex-1",children:b?e.jsxs(e.Fragment,{children:[e.jsx(es,{team:b}),e.jsx("span",{className:"truncate",title:b.name,children:b.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>z(f,"away"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>T(f,"away"),children:"Adicionar time B"})})]})]},f)})})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:G?e.jsxs("span",{className:"text-green-700",children:["Todos os ",Ye," confrontos estão prontos!"]}):e.jsxs("span",{children:["Restam ",32-P.size," times para alocar."]})}),e.jsx("button",{onClick:O,disabled:!G||u,className:`px-6 py-3 rounded font-semibold transition ${G&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar chaveamento"})]})]})}function es({team:s}){const t=yn(s?.name),a=s?.color||jn(s?.name||"T");return e.jsx("div",{className:"w-7 h-7 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function yn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function jn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const re=["A","B","C","D","E","F","G","H"],ve=3;function bn(){const[s,t]=l.useState([]),[a,i]=l.useState(re.reduce((f,h)=>({...f,[h]:[]}),{})),[n,c]=l.useState(new Set),[o,r]=l.useState(!0),[u,N]=l.useState(!1),[y,k]=l.useState(null),A=l.useRef(!1),S=l.useRef(!0),P=me(),w=async()=>{if(!A.current){A.current=!0,r(!0);try{const{data:f,error:h}=await p.from("sports").select("id").eq("name","Pebolim").maybeSingle();if(h||!f?.id){alert("Erro ao buscar a modalidade Pebolim.");return}k(f.id);const{data:b,error:_}=await p.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",f.id).order("name");if(_){alert("Erro ao carregar times de Pebolim.");return}t(b||[]);const F=re.reduce((m,E)=>({...m,[E]:[]}),{}),d=(b||[]).reduce((m,E)=>(re.includes(E.group_name)&&(m[E.group_name]=m[E.group_name]||[]).push(E),m),{});re.forEach(m=>{const E=(d[m]||[]).sort((g,v)=>{const q=g.seed_in_group??999,$=v.seed_in_group??999;return q!==$?q-$:g.name.localeCompare(v.name)});F[m]=E.map(g=>g.id)}),i(F)}finally{r(!1),A.current=!1}}};l.useEffect(()=>{S.current=!0,w();const f=p.channel("pebolim-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{S.current&&!A.current&&w()}).subscribe();return()=>{S.current=!1,p.removeChannel(f)}},[]);const M=l.useMemo(()=>new Set(re.flatMap(f=>a[f])),[a]),T=l.useMemo(()=>s.filter(f=>!M.has(f.id)),[s,M]),z=f=>{c(h=>{const b=new Set(h);return b.has(f)?b.delete(f):b.add(f),b})},G=f=>{const h=Array.from(n);if(!h.length){alert("Selecione ao menos 1 time.");return}if(a[f].length+h.length>ve){alert(`O grupo ${f} não pode ter mais de ${ve} times.`),c(new Set);return}i(b=>{const _={...b};for(const F of h){for(const d of re)_[d]=_[d].filter(m=>m!==F);_[f]=[..._[f],F]}return _}),c(new Set)},O=f=>{i(h=>{const b={...h};for(const _ of re)b[_]=b[_].filter(F=>F!==f);return b})},D=re.every(f=>a[f].length===ve),C=async()=>{if(!D){alert("Complete todos os grupos antes de confirmar!");return}if(!y){alert("Modalidade Pebolim não encontrada.");return}try{N(!0),await p.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",y);for(const h of re){const b=a[h];if(b.length){await p.from("teams").update({group_name:h}).in("id",b);for(let _=0;_<b.length;_++)await p.from("teams").update({seed_in_group:_+1}).eq("id",b[_])}}await p.rpc("seed_initial_standings",{p_sport_name:"Pebolim",p_reset:!0}),await p.rpc("rebuild_standings",{p_sport_name:"Pebolim"});const{error:f}=await p.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:y,p_variant:"1v3_1v2_3v2"});if(f){alert("Erro ao gerar jogos de grupos: "+f.message);return}await p.rpc("maybe_create_knockout",{p_sport_name:"Pebolim"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>P("/admin/campeonatos"),1200)}catch(f){alert("Erro ao salvar: "+(f?.message||String(f)))}finally{N(!1)}};return o?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Pebolim"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 24 times em 8 grupos de 3. Ao confirmar, salvamos"," ",e.jsx("strong",{children:"group_name"})," e ",e.jsx("strong",{children:"seed_in_group = 1,2,3"})," conforme a ordem e geramos os jogos via RPC na ",e.jsx("strong",{children:"ordem exata"}),". Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:w,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),T.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:T.map(f=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(f.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>z(f.id),title:f.name,children:[e.jsx(Vs,{team:f}),e.jsx("span",{className:"truncate",children:f.name})]},f.id))})]}),re.map(f=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",f]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[f].length===ve?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[f].length,"/",ve]})]}),e.jsx("button",{onClick:()=>G(f),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[f].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[f].map((h,b)=>{const _=s.find(F=>F.id===h);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>O(h),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:b+1}),e.jsx(Vs,{team:_}),e.jsx("span",{className:"truncate",title:_?.name,children:_?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},h)})})})]},f))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:re.map(f=>`${f}(${a[f].length}/${ve})`).join(", ")}),e.jsx("button",{onClick:C,disabled:!D||u,className:`px-6 py-2 rounded font-semibold transition ${D&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Vs({team:s}){const t=_n(s?.name),a=s?.color||Nn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function _n(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function Nn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function wn(){return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})})}function vn(){const{session:s,isAdmin:t,ready:a,signOut:i,needsPasswordSetup:n}=ms();ds();const c=me();if(!a)return e.jsx(wn,{});if(n)return e.jsx(Ps,{});const o=async()=>{try{await i(),c("/",{replace:!0})}catch(r){console.error("Error during signout:",r)}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"bg-blue-600 text-white sticky top-0 z-50 shadow-md",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx(X,{to:"/",className:"hover:opacity-90 transition-opacity",children:e.jsx("img",{src:"/logo-copa-influence.png",alt:"Copa Influence",className:"h-12 md:h-16 w-auto"})}),e.jsx("div",{className:"text-sm",children:s?e.jsxs("div",{className:"flex items-center gap-2",children:[s.user?.email&&e.jsx("span",{className:"text-white/80 text-xs hidden sm:inline",children:s.user.email}),e.jsx("button",{onClick:o,className:"hover:underline transition-colors hover:text-white/80 text-xs sm:text-sm",children:"Sair"})]}):e.jsx(X,{to:"/login",className:"hover:underline transition-colors hover:text-white/80 text-xs sm:text-sm",children:"Entrar"})})]}),e.jsx("div",{className:"border-t border-white/20 py-2",children:e.jsxs("nav",{className:"flex items-center justify-center gap-1 sm:gap-3 text-xs sm:text-sm overflow-x-auto",children:[e.jsx(X,{to:"/",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Home"}),e.jsx(X,{to:"/futsal",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Futsal"}),e.jsx(X,{to:"/volei",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Vôlei"}),e.jsx(X,{to:"/fifa",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"FIFA"}),e.jsx(X,{to:"/pebolim",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Pebolim"}),t&&e.jsx(X,{to:"/admin",className:"bg-white/15 hover:bg-white/25 transition-colors px-2 py-1 rounded text-xs whitespace-nowrap ml-1 sm:ml-2",children:"Admin"})]})})]})}),e.jsx("main",{className:"flex-1 container mx-auto p-4",children:e.jsxs(Ct,{children:[e.jsx(ee,{path:"/",element:e.jsx(ja,{})}),e.jsx(ee,{path:"/futsal",element:e.jsx(Oa,{})}),e.jsx(ee,{path:"/volei",element:e.jsx(Wa,{})}),e.jsx(ee,{path:"/fifa",element:e.jsx(hr,{})}),e.jsx(ee,{path:"/pebolim",element:e.jsx($r,{})}),e.jsx(ee,{path:"/team/:id",element:e.jsx(As,{})}),e.jsx(ee,{path:"/times/:id",element:e.jsx(As,{})}),e.jsx(ee,{path:"/match/:id",element:e.jsx(Ts,{})}),e.jsx(ee,{path:"/partida/:id",element:e.jsx(Ts,{})}),e.jsx(ee,{path:"/set-password",element:e.jsx(Ps,{})}),e.jsx(ee,{path:"/login",element:e.jsx(Ur,{})}),e.jsx(ee,{path:"/admin",element:e.jsx(ue,{children:e.jsx(zr,{})})}),e.jsx(ee,{path:"/admin/elencos",element:e.jsx(ue,{children:e.jsx(Hr,{})})}),e.jsx(ee,{path:"/admin/partidas",element:e.jsx(ue,{children:e.jsx(tn,{})})}),e.jsx(ee,{path:"/admin/campeonatos",element:e.jsx(ue,{children:e.jsx(on,{})})}),e.jsx(ee,{path:"/admin/campeonatos/futsal",element:e.jsx(ue,{children:e.jsx(mn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/volei",element:e.jsx(ue,{children:e.jsx(hn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/fifa",element:e.jsx(ue,{children:e.jsx(fn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/pebolim",element:e.jsx(ue,{children:e.jsx(bn,{})})}),e.jsx(ee,{path:"*",element:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"404 - Página não encontrada"}),e.jsx(X,{to:"/",className:"text-blue-600 hover:underline",children:"Voltar ao início"})]})})]})}),e.jsx("footer",{className:"bg-gray-200 p-4 text-center text-xs text-gray-700 mt-auto",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("p",{children:["© ",new Date().getFullYear()," Copa Influence"]}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Desenvolvido para a comunidade da igreja"})]})})]})}Mt.createRoot(document.getElementById("root")).render(e.jsx(Ve.StrictMode,{children:e.jsx(At,{children:e.jsx(It,{children:e.jsx(vn,{})})})}));
