import{r as _t,b as Nt,a as wt,c as l,u as ds,N as vt,L as X,R as Ve,d as zs,e as me,f as St,h as $t,i as ee,B as Ct}from"./vendor-vbeBnipd.js";import{c as At}from"./supabase-BfEApigK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function a(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=a(n);fetch(n.href,c)}})();var Je={exports:{}},Se={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var us;function kt(){if(us)return Se;us=1;var s=_t(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function o(r,m,v){var y,k={},E=null,A=null;v!==void 0&&(E=""+v),m.key!==void 0&&(E=""+m.key),m.ref!==void 0&&(A=m.ref);for(y in m)i.call(m,y)&&!c.hasOwnProperty(y)&&(k[y]=m[y]);if(r&&r.defaultProps)for(y in m=r.defaultProps,m)k[y]===void 0&&(k[y]=m[y]);return{$$typeof:t,type:r,key:E,ref:A,props:k,_owner:n.current}}return Se.Fragment=a,Se.jsx=o,Se.jsxs=o,Se}var gs;function Et(){return gs||(gs=1,Je.exports=kt()),Je.exports}var e=Et(),Pe={},hs;function Tt(){if(hs)return Pe;hs=1;var s=Nt();return Pe.createRoot=s.createRoot,Pe.hydrateRoot=s.hydrateRoot,Pe}var Pt=Tt();const Ft=wt(Pt),Rt="https://cifdtjfrekucrmapewoj.supabase.co",Mt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpZmR0amZyZWt1Y3JtYXBld29qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTM2OTAsImV4cCI6MjA3MzU2OTY5MH0.h4cP9OeroEa4XEQsOrdgy8L-fewT--DC2AtUk9ipJAA",x=At(Rt,Mt),Us=l.createContext({session:null,user:null,isAdmin:!1,needsPasswordSetup:!1,ready:!1,loading:!1,signIn:async()=>({data:null,error:null}),signOut:async()=>({error:null}),updatePassword:async()=>({data:null,error:null}),refreshAuth:async()=>{}});function ms(){return l.useContext(Us)}function qt({children:s}){const[t,a]=l.useState(null),[i,n]=l.useState(!1),[c,o]=l.useState(!1),[r,m]=l.useState(!1),[v,y]=l.useState(!0),k=l.useRef(!0),E=l.useRef(0),A=M=>M?.user_metadata?.password_set===!0;l.useEffect(()=>{k.current=!0,(async()=>{try{y(!0);const{data:D,error:b}=await x.auth.getSession();if(b)throw b;const d=D?.session??null;if(!k.current)return;a(d),o(d?.user?!A(d.user):!1),m(!0),y(!1),d?.user?.id?$(d):n(!1)}catch(D){if(console.error("Auth init error:",D),!k.current)return;a(null),n(!1),o(!1),m(!0),y(!1)}})();const{data:M}=x.auth.onAuthStateChange(async(D,b)=>{k.current&&(a(b??null),b?.user?(o(!A(b.user)),b.user.id?$(b):n(!1)):(n(!1),o(!1)))});return()=>{k.current=!1,M?.subscription?.unsubscribe?.()}},[]);const $=async M=>{const D=++E.current;try{if(!M?.user?.id){k.current&&D===E.current&&n(!1);return}const{data:d,error:f}=await x.rpc("is_admin");k.current&&D===E.current&&n(!!d&&!f)}catch(b){console.error("checkAdmin error:",b),k.current&&D===E.current&&n(!1)}},S=async(M,D)=>{const b=await x.auth.signInWithPassword({email:M,password:D});return b.data?.session?.user?.id&&!b.error&&(a(b.data.session),o(!A(b.data.session.user)),$(b.data.session)),b},P=async()=>{const{error:M}=await x.auth.signOut();return M||(a(null),n(!1),o(!1)),{error:M}},F=async M=>{const{data:D,error:b}=await x.auth.updateUser({password:M,data:{password_set:!0}});if(!b){o(!1);const{data:d}=await x.auth.getSession();a(d?.session??null)}return{data:D,error:b}},V=async()=>{const{data:M}=await x.auth.getSession(),D=M?.session??null;a(D),D?.user?.id?(o(!A(D.user)),$(D)):(n(!1),o(!1))},L={session:t,user:t?.user??null,isAdmin:i,needsPasswordSetup:c,ready:r,loading:v,signIn:S,signOut:P,updatePassword:F,refreshAuth:V};return e.jsx(Us.Provider,{value:L,children:s})}function ue({children:s}){const{ready:t,session:a,isAdmin:i}=ms(),n=ds();if(!t)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Verificando permissões..."})]})});if(!a||!i){const c=encodeURIComponent(n.pathname+n.search);return e.jsx(vt,{to:`/login?redirect=${c}&reason=forbidden`,replace:!0})}return s}function se({team:s={},size:t=24,className:a=""}){const[i,n]=l.useState(!1),c=l.useMemo(()=>{const m=s?.logo_url;return typeof m=="string"&&m.trim()&&!i?m:null},[s?.logo_url,i]),o=l.useMemo(()=>{const m=String(s?.name??"").trim();if(!m)return"•";const v=m.match(new RegExp("\\p{L}","u"));return(v?v[0]:m[0]).toUpperCase()},[s?.name]),r={width:t,height:t};return e.jsx("span",{className:`inline-flex items-center justify-center rounded border border-gray-200 bg-white overflow-hidden ${a}`,style:r,title:s?.name,children:c?e.jsx("img",{src:c,alt:s?.name||"Logo",className:"w-full h-full object-cover",onError:()=>n(!0),draggable:!1}):e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-gray-600 select-none",children:o})})}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Gt=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,a,i)=>i?i.toUpperCase():a.toLowerCase()),ps=s=>{const t=Gt(s);return t.charAt(0).toUpperCase()+t.slice(1)},Js=(...s)=>s.filter((t,a,i)=>!!t&&t.trim()!==""&&i.indexOf(t)===a).join(" ").trim(),Ot=s=>{for(const t in s)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Lt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=l.forwardRef(({color:s="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:i,className:n="",children:c,iconNode:o,...r},m)=>l.createElement("svg",{ref:m,...Lt,width:t,height:t,stroke:s,strokeWidth:i?Number(a)*24/Number(t):a,className:Js("lucide",n),...!c&&!Ot(r)&&{"aria-hidden":"true"},...r},[...o.map(([v,y])=>l.createElement(v,y)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=(s,t)=>{const a=l.forwardRef(({className:i,...n},c)=>l.createElement(Dt,{ref:c,iconNode:t,className:Js(`lucide-${It(ps(s))}`,`lucide-${s}`,i),...n}));return a.displayName=ps(s),a};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Hs=te("chevron-right",Bt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],zt=te("chevrons-right",Vt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Jt=te("circle-play",Ut);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ks=te("circle-question-mark",Ht);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],Xt=te("list-checks",Kt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Qt=te("loader-circle",Zt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],Yt=te("megaphone",Wt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],sa=te("refresh-cw",ea);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],aa=te("rotate-cw",ta);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],xs=te("settings",ra);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],oa=te("shield-alert",na);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],la=te("trash-2",ia);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],Xs=te("trophy",ca),fs=[{name:"Volei",label:"Vôlei",key:"volei",callText:"⚠️ Compareçam à quadra de Vôlei:"},{name:"Futsal",label:"Futsal",key:"futsal",callText:"⚠️ Compareçam à quadra de Futsal:"},{name:"Pebolim",label:"Pebolim",key:"pebolim",callText:"⚠️ Compareçam à mesa de pebolim:"},{name:"FIFA",label:"FIFA",key:"fifa",callText:"⚠️ Compareçam à área do console:"}],da={r32:"PRÉ-OITAVAS",grupos:"GRUPOS",oitavas:"OITAVAS",quartas:"QUARTAS",semi:"SEMI",final:"FINAL","3lugar":"3º LUGAR"};function ma(s){return s?da[s]||String(s).toUpperCase():null}const ua="team-logos";function Zs(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function ga(s){return typeof s=="string"&&!Zs(s)&&s.trim()!==""}function ha(s){if(!s)return null;if(Zs(s))return s;if(ga(s)){const{data:t}=x.storage.from(ua).getPublicUrl(s);return t?.publicUrl||null}return null}function pa(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),n=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(n<0)return"0:00";const c=Math.floor(n/1e3),o=Math.floor(c/60),r=c%60;return`${o}:${r.toString().padStart(2,"0")}`}function ys(s,t){const a=s?.meta||{};return Math.max(0,Number(a[t==="home"?"home_sets":"away_sets"]||0))}function xa({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function fa(){const[s,t]=l.useState({}),[a,i]=l.useState(!0),[n,c]=l.useState(null),[o,r]=l.useState(Date.now()),m=l.useRef(!0),v=l.useRef(!1),y=l.useRef({}),k=async()=>{if(!v.current){v.current=!0,Object.keys(y.current||{}).length||i(!0),c(null);try{const{data:$,error:S}=await x.from("sports").select("id,name");if(S)throw S;const P=new Map(($||[]).map(M=>[M.name,M.id])),F=fs.filter(M=>P.has(M.name)).map(M=>({...M,sportId:P.get(M.name)})),V=await Promise.all(F.map(async M=>{const{data:D,error:b}=await x.from("v_queue_slots").select("slot, order_idx, match_id, stage, group_name").eq("sport_id",M.sportId);if(b)throw b;const d=Object.fromEntries((D||[]).map(h=>[h.slot,h])),f=(D||[]).map(h=>h.match_id).filter(Boolean);let N={};if(f.length){const{data:h}=await x.from("matches").select(`
                id, order_idx, stage, group_name, status, starts_at, updated_at, venue, meta,
                home_score, away_score,
                home:home_team_id ( id, name, logo_url, color ),
                away:away_team_id ( id, name, logo_url, color ),
                sport:sport_id ( id, name )
              `).in("id",f),T=(h||[]).map(u=>{const j=u.home&&typeof u.home=="object"?{...u.home,logo_url:ye(u.home.logo_url)}:u.home,G=u.away&&typeof u.away=="object"?{...u.away,logo_url:ye(u.away.logo_url)}:u.away;return{...u,home:j,away:G}});N=Object.fromEntries(T.map(u=>[u.id,u]))}if(!d?.live?.match_id){const{data:h,error:T}=await x.from("matches").select(`
                id, order_idx, stage, group_name, status, starts_at, updated_at, venue, meta,
                home_score, away_score,
                home:home_team_id ( id, name, logo_url, color ),
                away:away_team_id ( id, name, logo_url, color ),
                sport:sport_id ( id, name )
              `).eq("sport_id",M.sportId).in("status",["ongoing","paused"]).limit(6);if(!T&&h?.length){const u=h.slice().sort((I,H)=>{const _=O=>O==="ongoing"?1:O==="paused"?2:9,R=_(I.status)-_(H.status);return R!==0?R:new Date(H.updated_at||H.starts_at||0)-new Date(I.updated_at||I.starts_at||0)})[0],j=u.home&&typeof u.home=="object"?{...u.home,logo_url:ye(u.home.logo_url)}:u.home,G=u.away&&typeof u.away=="object"?{...u.away,logo_url:ye(u.away.logo_url)}:u.away,w={...u,home:j,away:G};N[w.id]=w,d.live={slot:"live",match_id:w.id,order_idx:w.order_idx,stage:w.stage,group_name:w.group_name}}}const C=[d.call?.match_id,d.next?.match_id].filter(Boolean),{data:q}=await x.from("matches").select(`
              id, order_idx, stage, group_name, status,
              home:home_team_id ( id, name, logo_url, color ),
              away:away_team_id ( id, name, logo_url, color )
            `).eq("sport_id",M.sportId).eq("status","scheduled").not("order_idx","is",null).order("order_idx",{ascending:!0}).limit(10),g=(q||[]).filter(h=>!C.includes(h.id)).slice(0,6).map(h=>({id:h.id,order_idx:h.order_idx,stage:h.stage,group_name:h.group_name,home:h.home?{...h.home,logo_url:ye(h.home.logo_url)}:null,away:h.away?{...h.away,logo_url:ye(h.away.logo_url)}:null}));return[M.key,{...M,slots:d,details:N,compactUpcoming:g}]})),L=Object.fromEntries(V);y.current=L,t(L)}catch($){c(`Falha ao carregar a Home: ${$.message||$}`)}finally{i(!1),v.current=!1}}},E=l.useCallback($=>{if(!$?.id)return!1;let S=!1;return t(P=>{let F=!1;const V={...P};for(const[L,M]of Object.entries(P)){if(!M)continue;let D=!1,b=M.details;const d=M.details?.[$.id];if(d){const N={...d,status:$.status??d.status,starts_at:$.starts_at??d.starts_at,updated_at:$.updated_at??d.updated_at,home_score:typeof $.home_score=="number"?$.home_score:d.home_score,away_score:typeof $.away_score=="number"?$.away_score:d.away_score,meta:$.meta??d.meta,stage:$.stage??d.stage,group_name:$.group_name??d.group_name,order_idx:$.order_idx??d.order_idx,venue:$.venue??d.venue};b={...M.details,[$.id]:N},D=!0}let f=M.compactUpcoming;if(Array.isArray(M.compactUpcoming)&&M.compactUpcoming.length){let N=!1;const C=M.compactUpcoming.map(q=>q.id!==$.id?q:(N=!0,{...q,stage:$.stage??q.stage,group_name:$.group_name??q.group_name,order_idx:$.order_idx??q.order_idx}));N&&(f=C,D=!0)}D&&(V[L]={...M,details:b,compactUpcoming:f},F=!0)}return F?(S=!0,y.current=V,V):P}),S},[]);l.useEffect(()=>{m.current=!0,k();const $=setInterval(()=>r(Date.now()),1e3),S=x.channel("home-central").on("postgres_changes",{event:"*",schema:"public",table:"matches"},P=>{if(!m.current)return;const F=P?.eventType||P?.type,V=P?.new;F==="UPDATE"&&V?.id&&E(V)||k()}).on("postgres_changes",{event:"*",schema:"public",table:"match_events"},()=>m.current&&k()).subscribe();return()=>{m.current=!1,clearInterval($),x.removeChannel(S)}},[]);const A=l.useMemo(()=>fs.map($=>$.key).filter($=>s[$]),[s]);return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Central do Evento"})]}),e.jsxs("button",{onClick:k,className:"inline-flex items-center gap-2 rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Recarregar agora",children:[e.jsx(sa,{className:"h-4 w-4"}),"Atualizar"]})]}),n&&e.jsx("div",{className:"mb-5 rounded-xl border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-800",children:n}),a?e.jsx(ja,{}):e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:A.map($=>e.jsx(ya,{block:s[$],now:o},$))}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function ya({block:s,now:t}){const{label:a,callText:i,slots:n,details:c,compactUpcoming:o}=s||{},r=n?.live?.match_id?c?.[n.live.match_id]:null,m=n?.call?.match_id?c?.[n.call.match_id]:null,v=n?.next?.match_id?c?.[n.next.match_id]:null;return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between gap-3 p-4 sm:p-5",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-lg font-semibold",children:a})})}),e.jsx("div",{className:"px-4 sm:px-5",children:e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-red-800",children:[e.jsx(Jt,{className:"h-4 w-4"}),r?e.jsxs(X,{to:`/match/${r.id}`,className:"hover:underline",children:[r.status==="paused"?"Pausado":"Ao vivo"," — Jogo ",r.order_idx,r.group_name?` • Grupo ${r.group_name}`:""]}):e.jsx("span",{children:"Ao vivo"})]}),r?.stage?e.jsx(ss,{stage:r.stage}):e.jsx("span",{className:"text-xs text-red-700/70",children:"Aguardando…"})]}),r?e.jsx(ba,{match:r,now:t}):e.jsx("div",{className:"text-sm text-gray-600",children:"Nenhuma partida ao vivo no momento."})]})}),e.jsx("div",{className:"px-4 pb-4 sm:px-5 sm:pb-5",children:e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(bs,{tone:"amber",icon:e.jsx(Yt,{className:"h-4 w-4"}),title:"Próxima partida",subtitle:i,match:m}),e.jsx(bs,{tone:"emerald",icon:e.jsx(zt,{className:"h-4 w-4"}),title:"Jogo seguinte",subtitle:"Na sequência:",match:v})]})}),o?.length?e.jsxs("div",{className:"border-t px-4 py-3 sm:px-5",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-gray-800",children:"Agendados (próximos)"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:o.map(y=>e.jsxs(X,{to:`/match/${y.id}`,className:"flex items-center justify-between rounded-lg border bg-gray-50 px-3 py-2 hover:bg-gray-100",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"truncate text-sm font-medium text-gray-900",children:["Jogo ",y.order_idx,y.group_name?` • Grupo ${y.group_name}`:""]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-gray-700",children:[e.jsx(Be,{team:y.home,size:20,allowLink:!1}),e.jsx("span",{className:"text-gray-400",children:"x"}),e.jsx(Be,{team:y.away,size:20,align:"right",allowLink:!1})]})]}),e.jsx("div",{className:"ml-3 shrink-0",children:e.jsx(ss,{stage:y.stage})})]},y.id))})]}):null]})}function ss({stage:s}){const t=ma(s);return t?e.jsx("span",{className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-semibold tracking-wide text-gray-700",children:t}):null}function ba({match:s,now:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),i=s.status!=="scheduled",n=Number(s?.home_score??0),c=Number(s?.away_score??0),o=a?ys(s,"home"):0,r=a?ys(s,"away"):0,m=s?.status==="ongoing"||s?.status==="paused",v=a?Number(s?.meta?.home_points_set??0):0,y=a?Number(s?.meta?.away_points_set??0):0,k=a&&(m||v>0||y>0);return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl bg-white p-3 shadow-sm hover:bg-gray-50 relative overflow-hidden",children:[e.jsx(xa,{status:s.status}),e.jsxs("div",{className:"mb-2 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.group_name?e.jsxs("span",{children:["Grupo ",s.group_name]}):e.jsx("span",{}),s.venue?e.jsxs("span",{className:"text-gray-400",children:["• ",s.venue]}):null]}),(s.status==="ongoing"||s.status==="paused")&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",pa(s,t)]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(js,{team:s.home,align:"left"}),e.jsxs("div",{className:"shrink-0 text-center",children:[a&&e.jsxs("div",{className:"text-[11px] font-semibold text-gray-600 tabular-nums",children:[o," ",e.jsx("span",{className:"text-gray-400",children:"sets"})," ",r]}),i?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xl font-bold tabular-nums",children:[k?v:n," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",k?y:c]})}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"})]}),e.jsx(js,{team:s.away,align:"right"})]})]})}function bs({tone:s,icon:t,title:a,subtitle:i,match:n}){const c=s==="amber"?"border-amber-200 bg-amber-50":s==="emerald"?"border-emerald-200 bg-emerald-50":"border-gray-200 bg-gray-50";return e.jsxs("div",{className:`rounded-xl border ${c} p-3 sm:p-4`,children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[t,e.jsx("span",{children:a})]}),n?.stage?e.jsx(ss,{stage:n.stage}):null]}),e.jsx("div",{className:"text-xs text-gray-600",children:i}),e.jsx("div",{className:"mt-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.jsxs(X,{to:`/match/${n.id}`,className:"hover:underline",children:["Jogo ",n.order_idx,n.group_name?` • Grupo ${n.group_name}`:""]})}),e.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[e.jsx(Be,{team:n.home}),e.jsx("span",{className:"px-1 text-gray-400",children:"x"}),e.jsx(Be,{team:n.away,align:"right"})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-gray-500 flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:n.venue||""}),e.jsxs(X,{to:`/match/${n.id}`,className:"inline-flex items-center gap-1 text-blue-600 hover:underline",children:["Ver partida ",e.jsx(Hs,{className:"h-3.5 w-3.5"})]})]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Aguardando…"})})]})}function Be({team:s,size:t=24,align:a="left",allowLink:i=!0}){const n=e.jsxs(e.Fragment,{children:[e.jsx(se,{team:s||{name:"A definir"},size:t}),e.jsx("span",{className:`truncate text-sm ${a==="right"?"text-right":""}`,children:s?.name||"A definir"})]});return!i||!s?.id?e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${a==="right"?"justify-end":""}`,children:n}):e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 ${a==="right"?"justify-end":""} hover:underline`,title:s?.name,onClick:c=>c.stopPropagation(),children:n})}function js({team:s,align:t="left"}){return e.jsxs("div",{className:`flex items-center ${t==="right"?"justify-end":""} gap-2 min-w-0 flex-1`,children:[t!=="right"&&e.jsx(se,{team:s||{name:"A definir"},size:36}),s?.id?e.jsx(X,{to:`/team/${s.id}`,className:`truncate text-sm font-medium hover:underline ${t==="right"?"text-right":"text-left"}`,title:s?.name,onClick:a=>a.stopPropagation(),children:s?.name||"A definir"}):e.jsx("span",{className:`truncate text-sm ${t==="right"?"text-right text-gray-400":"text-gray-400"}`,children:"A definir"}),t==="right"&&e.jsx(se,{team:s||{name:"A definir"},size:36})]})}function ja(){return e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:Array.from({length:4}).map((s,t)=>e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("div",{className:"mb-3 h-6 w-40 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"mb-3 h-24 animate-pulse rounded bg-red-100/60"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsx("div",{className:"h-20 animate-pulse rounded bg-amber-100/60"}),e.jsx("div",{className:"h-20 animate-pulse rounded bg-emerald-100/60"})]}),e.jsx("div",{className:"mt-3 h-16 animate-pulse rounded bg-gray-100"})]},t))})}function ye(s){const t=ha(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null}const _a="Futsal",Na="⚽",wa="team-logos",va="America/Sao_Paulo",Sa={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Qs=s=>s?Sa[s]||s:"",$a=new Set(["grupos","grupo","groups","group","group stage","group_stage","fase de grupos","fase-de-grupos"]),Ca=new Set(["finished","encerrado","finalizado","completed","complete","cancelado","cancelled","canceled","walkover","wo"]),Ws=s=>s==null?"":String(s).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().trim();function Aa(s){if(!s)return!1;const t=Ws(s.stage);if(t)return $a.has(t);const a=String(s?.group_name??"").trim();return!a||a==="-"?!1:!!(/^grupo\s+/i.test(a)||/^[a-z0-9]$/i.test(a))}const ka=s=>Ca.has(Ws(s));function Ys(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function ts(s){const t=Ys(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:va,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const Fe=s=>{const t=Ys(s);return t?t.getTime():Number.POSITIVE_INFINITY},et=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Ea=s=>typeof s=="string"&&!et(s)&&s.trim()!=="";function Ta(s){if(!s)return null;if(et(s))return s;if(Ea(s)){const{data:t}=x.storage.from(wa).getPublicUrl(s);return t?.publicUrl||null}return null}const be=s=>{const t=Ta(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};let Pa=class extends Ve.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Futsal ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}};function st({order_idx:s,stage:t,group_name:a}){const i=[];return s!=null&&String(s).length&&i.push(`Jogo ${s}`),a?i.push(`Grupo ${a}`):t&&i.push(Qs(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:i.join(" • ")||"—"})}function as({team:s,align:t="left",badge:a=28}){const i=(()=>{const r=s?.name;if(typeof r=="string")return r;if(r&&typeof r=="object"&&"name"in r)return String(r.name);try{return String(r??"A definir")}catch{return"A definir"}})(),n=!!s?.id,c=!n&&i==="A definir",o=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:i},size:a}),e.jsxs("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:[i,c?e.jsx(Ks,{className:"inline-block ml-1 w-4 h-4 text-gray-400"}):null]}),t==="right"?e.jsx(se,{team:{...s||{},name:i},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:r=>r.stopPropagation(),title:i,children:o}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:o})}function $e({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),i=s?.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},c=i?.id?i:{name:i?.name||"A definir"},o=s?.status&&s.status!=="scheduled",r=Number(s?.home_score??0),m=Number(s?.away_score??0),v=({value:E})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:o?E:"-"})]}),y=({team:E,align:A,score:$})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${A==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(as,{team:E,align:A})}),e.jsx(v,{value:$})]}),k=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(st,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(y,{team:n,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(y,{team:c,align:"right",score:m})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ts(s.starts_at):s?.venue||""}),o?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",m]}):null]})]});return s?.id?e.jsx(X,{to:`/match/${s.id}`,className:"block",children:k}):e.jsx("div",{className:"block",children:k})}function _s({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),i=Number(s?.away_score??0);return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(st,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(as,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs("span",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",i]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(as,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ts(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",ts(s.updated_at)]}):null]})]})}function Fa(s,t){const a=Number(s.points??0),i=Number(t.points??0);if(i!==a)return i-a;const n=Number(s.wins??0),c=Number(t.wins??0);if(c!==n)return c-n;const o=Number(s.goal_difference??Number(s.goals_for??0)-Number(s.goals_against??0)),r=Number(t.goal_difference??Number(t.goals_for??0)-Number(t.goals_against??0));if(r!==o)return r-o;const m=Number(s.goals_for??0),v=Number(t.goals_for??0);return v!==m?v-m:String(s.team_id).localeCompare(String(t.team_id))}function Re(s,t){return(t.points??0)-(s.points??0)||(t.wins??0)-(s.wins??0)||(t.goal_difference??0)-(s.goal_difference??0)||(t.goals_for??0)-(s.goals_for??0)||String(s.team_id).localeCompare(String(t.team_id))}function Ra(s,t={}){if(!Array.isArray(s)||s.length===0)return[];const a=r=>{const m=t[r.team_id];return m?{id:r.team_id,name:String(m.name??r.team_name??"—"),color:m.color,logo_url:m.logo_url}:{id:r.team_id,name:String(r.team_name??"—")}},i=new Map;for(const r of s){const m=r.group_name||"-";i.has(m)||i.set(m,[]),i.get(m).push(r)}for(const r of i.keys())i.get(r).sort(Re);const n=[],c=[];for(const[r,m]of i)m[0]&&n.push({group:r,row:m[0]}),m[1]&&c.push({group:r,row:m[1]});n.sort((r,m)=>Re(r.row,m.row)),c.sort((r,m)=>Re(r.row,m.row));const o=n.length;if(o>=4){const r=n.slice(0,4);return[{stage:"semi",home:a(r[0].row),away:a(r[3].row)},{stage:"semi",home:a(r[1].row),away:a(r[2].row)}]}else{if(o===3)return c.length?[{stage:"semi",home:a(n[0].row),away:a(c[0].row)},{stage:"semi",home:a(n[1].row),away:a(n[2].row)}]:[];if(o===2){if(c.length<2)return[];const r=[n[0].row,n[1].row,c[0].row,c[1].row].sort(Re);return[{stage:"semi",home:a(r[0]),away:a(r[3])},{stage:"semi",home:a(r[1]),away:a(r[2])}]}}return[]}function Ma({standings:s,teamsById:t}){const a=l.useMemo(()=>{const n={};for(const r of s||[]){const m=r.group_name||"-";n[m]||(n[m]=[]),n[m].push(r)}const c=new Set,o={};for(const r in t){const m=t[r],v=m.group_name||"-";c.add(v),o[v]||(o[v]=[]),o[v].push(m)}for(const r of c){const m=new Set((n[r]||[]).map(k=>String(k.team_id))),y=(o[r]||[]).filter(k=>!m.has(String(k.id))).map(k=>({group_name:r,team_id:k.id,team_name:k.name,matches_played:0,wins:0,draws:0,losses:0,goals_for:0,goals_against:0,goal_difference:0,points:0}));n[r]=[...n[r]||[],...y],n[r].sort(Fa),n[r]=n[r].map((k,E)=>({...k,rank:E+1}))}return n},[s,t]),i=Object.keys(a).sort();return i.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:i.map(n=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",n]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"E"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[n].map(c=>{const o=t[c.team_id]&&typeof t[c.team_id]=="object"?t[c.team_id]:{id:c.team_id,name:String(c.team_name??t[c.team_id]?.name??"—")},r={...o,name:typeof o.name=="string"?o.name:String(o.name??"—")};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:c.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${r.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:r,size:20}),e.jsx("span",{className:"truncate",children:r.name})]})}),e.jsx("td",{className:"py-1 text-center",children:c.matches_played}),e.jsx("td",{className:"py-1 text-center",children:c.wins}),e.jsx("td",{className:"py-1 text-center",children:c.draws}),e.jsx("td",{className:"py-1 text-center",children:c.losses}),e.jsx("td",{className:"py-1 text-center",children:c.goals_for}),e.jsx("td",{className:"py-1 text-center",children:c.goals_against}),e.jsx("td",{className:"py-1 text-center",children:c.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:c.points})]},`${n}-${c.team_id}`)})})]}),e.jsx("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:"Critérios: Pontos, Vitórias, Saldo de Gols, Gols Pró."})]},n))})}function qa(s){const t=c=>(s||[]).filter(o=>o.stage===c).sort((o,r)=>(Number(o?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(r?.order_idx)||Number.MAX_SAFE_INTEGER)),a=t("semi"),i=t("final"),n=t("3lugar");return{semis:a,final:i[0],third:n[0]}}function Ia(){const[s,t]=l.useState(null),[a,i]=l.useState({}),[n,c]=l.useState([]),[o,r]=l.useState([]),[m,v]=l.useState(!0),[y,k]=l.useState("todos"),[E,A]=l.useState("todos"),$=l.useRef(null),S=l.useRef(null),P=l.useCallback(async()=>{try{const{data:u,error:j}=await x.from("sports").select("id").eq("name","Futsal").maybeSingle();if(j)throw j;u?.id?t(u.id):(console.warn("⚠️ Esporte 'Futsal' não encontrado na tabela sports."),t(null))}catch(u){console.error("Exceção loadSportId:",u),t(null)}},[]),F=l.useCallback(async u=>{try{if(u){const w=await x.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",u);if(!w.error&&Array.isArray(w.data)&&w.data.length>0){const I={};for(const H of w.data)I[H.id]={...H,name:String(H.name??"—"),logo_url:be(H.logo_url),group_name:H.group_name??"-"};i(I);return}}const j=await x.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").eq("sport.name","Futsal");if(j.error)throw j.error;const G={};for(const w of j.data||[])G[w.id]={...w,name:String(w.name??"—"),logo_url:be(w.logo_url),group_name:w.group_name??"-"};i(G)}catch(j){console.error("Exceção loadTeams:",j),i({})}},[]),V=l.useCallback(async u=>{try{if(u){const I=await x.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points").eq("sport_id",u).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!I.error&&Array.isArray(I.data)&&I.data.length>0){c(I.data);return}}const j=await x.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points, sport:sport_id!inner(name)").eq("sport.name","Futsal").order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!j.error&&Array.isArray(j.data)&&j.data.length>0){c(j.data.map(({sport:I,...H})=>H));return}if(u){const I=await x.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, draws, losses,
            goals_for, goals_against, goal_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",u).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!I.error&&Array.isArray(I.data)&&I.data.length>0){c(I.data.map(H=>({...H,team_name:H.team?.name})));return}}const w=((await x.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, draws, losses,
          goals_for, goals_against, goal_difference, points,
          team:teams!standings_team_id_fkey(name),
          sport:sport_id!inner(name)
        `).eq("sport.name","Futsal").order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(I=>({...I,team_name:I.team?.name}));c(w)}catch(j){console.error("Exceção loadStandings:",j),c([])}},[]),L=l.useCallback(async u=>{try{let j=[];if(u){const{data:I,error:H}=await x.from("match_detail_view").select(`
            id, sport_id, order_idx,
            stage, round, group_name, starts_at, updated_at, venue, status,
            home_team_id, home_team_name, home_team_color, home_team_logo,
            away_team_id, away_team_name, away_team_color, away_team_logo,
            home_score, away_score
          `).eq("sport_id",u);!H&&Array.isArray(I)&&I.length&&(j=I.map(_=>({id:_.id,sport_id:_.sport_id,order_idx:_.order_idx,stage:_.stage,round:_.round,group_name:_.group_name,starts_at:_.starts_at,updated_at:_.updated_at,venue:_.venue,status:_.status,home_score:_.home_score,away_score:_.away_score,home:_.home_team_id?{id:_.home_team_id,name:String(_.home_team_name??"A definir"),color:_.home_team_color,logo_url:be(_.home_team_logo)}:null,away:_.away_team_id?{id:_.away_team_id,name:String(_.away_team_name??"A definir"),color:_.away_team_color,logo_url:be(_.away_team_logo)}:null})))}if(!j.length){const{data:I,error:H}=await x.from("matches").select(`
            id, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score, order_idx,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color ),
            sport:sport_id!inner(name)
          `).eq("sport.name","Futsal");if(H)throw H;j=(I||[]).map(_=>({..._,order_idx:_.order_idx??_.round??_.id,home:_.home?{..._.home,name:String(_.home.name??"A definir"),logo_url:be(_.home.logo_url)}:null,away:_.away?{..._.away,name:String(_.away.name??"A definir"),logo_url:be(_.away.logo_url)}:null}))}const G={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6},w=I=>Number.isFinite(Number(I?.order_idx))?Number(I.order_idx):Number.MAX_SAFE_INTEGER;j.sort((I,H)=>(G[I.stage]??99)-(G[H.stage]??99)||w(I)-w(H)),r(j)}catch(j){console.error("Exceção loadMatches:",j),r([])}},[]),M=l.useCallback(async(u,{skeleton:j=!1}={})=>{j&&v(!0);try{await Promise.all([F(u),V(u),L(u)])}finally{v(!1)}},[F,V,L]);l.useEffect(()=>{P()},[P]),l.useEffect(()=>{if(!s){v(!1);return}if(M(s,{skeleton:!0}),$.current){try{x.removeChannel($.current)}catch{}$.current=null}const u=x.channel("futsal-hub").on("postgres_changes",s?{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`}:{event:"*",schema:"public",table:"matches"},()=>{S.current&&clearTimeout(S.current),S.current=setTimeout(()=>M(s,{skeleton:!1}),200)}).on("postgres_changes",{event:"*",schema:"public",table:"standings"},()=>{S.current&&clearTimeout(S.current),S.current=setTimeout(()=>M(s,{skeleton:!1}),200)}).subscribe();return $.current=u,()=>{if(S.current&&(clearTimeout(S.current),S.current=null),$.current){try{x.removeChannel($.current)}catch{}$.current=null}}},[s,M]);const D=l.useMemo(()=>!!(n?.length||(o||[]).some(u=>!!u.group_name)||Object.values(a||{}).some(u=>!!u.group_name)),[n,o,a]),b=l.useMemo(()=>{const u=(o||[]).filter(Aa);return u.length?u.every(j=>ka(j?.status)):!0},[o]),d=l.useMemo(()=>qa(o),[o]),f=d.semis||[],N=l.useMemo(()=>b?Ra(n,a):[],[b,n,a]),C=l.useMemo(()=>f.length?f:N,[f,N]),q=l.useMemo(()=>{const u=new Set;return(o||[]).forEach(j=>j.group_name&&u.add(j.group_name)),(n||[]).forEach(j=>j.group_name&&u.add(j.group_name)),Object.values(a||{}).forEach(j=>j.group_name&&u.add(j.group_name)),["todos",...Array.from(u).sort()]},[o,n,a]),g=l.useMemo(()=>{const u=new Set;(o||[]).forEach(w=>w.stage&&u.add(w.stage));const j=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(u).sort((w,I)=>j.indexOf(w)+100-(j.indexOf(I)+100))]},[o]),h=l.useMemo(()=>{let u=(o||[]).filter(j=>j.status!=="scheduled"?!1:j.group_name?!0:j.home?.id&&j.away?.id);return y!=="todos"&&(u=u.filter(j=>j.group_name===y)),E!=="todos"&&(u=u.filter(j=>j.stage===E)),u.sort((j,G)=>Fe(j.starts_at)-Fe(G.starts_at)),u},[o,y,E]),T=l.useMemo(()=>{const u=(o||[]).filter(j=>j.status==="finished");return u.sort((j,G)=>Fe(G.updated_at||G.starts_at||0)-Fe(j.updated_at||j.starts_at||0)),u.slice(0,12)},[o]);return e.jsx(Pa,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Na}),e.jsx("h2",{className:"text-2xl font-bold",children:_a})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"classificação"})," → ",e.jsx("strong",{children:"chaveamento"})," →"," ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),m?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((u,j)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},j))})]}):e.jsxs(e.Fragment,{children:[D&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Ma,{standings:n,teamsById:a})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),C?.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:C.map((u,j)=>e.jsx($e,{match:u},`s-${u?.id??j}`))})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("p",{className:"text-xs text-gray-500",children:b?"Aguardando definição oficial dos confrontos.":"Confrontos aparecem aqui assim que todos os jogos da fase de grupos terminarem."}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:2}).map((u,j)=>e.jsx($e,{placeholder:{home:"A definir",away:"A definir"}},`s-ph-${j}`))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),d.final?e.jsx($e,{match:d.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx($e,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]}),d.third?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"3º lugar"}),e.jsx($e,{match:d.third})]}):null]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:y,onChange:u=>k(u.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:q.map(u=>e.jsx("option",{value:u,children:u==="todos"?"Todos":`Grupo ${u}`},u))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:E,onChange:u=>A(u.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:g.map(u=>e.jsx("option",{value:u,children:u==="todos"?"Todas":Qs(u)},u))})]}),h.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:h.map((u,j)=>e.jsx(_s,{match:u},u.id??`sched-${j}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),T.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:T.map((u,j)=>e.jsx(_s,{match:u},u.id??`fin-${j}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas com ",e.jsx("strong",{children:"10 minutos corridos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo e o melhor 2º colocado avançam para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," saldo de gols."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor do grupo A × Vencedor do grupo B; Vencedor do grupo C × Melhor 2º colocado."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substituições:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desperdício de tempo:"})," pode ser acrescido ao final do jogo, a critério do árbitro."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Goleiro-linha:"})," permitido."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Expulsão:"})," o time fica com um jogador a menos por 2 minutos ou até sofrer um gol."]})]})})]})]})]})})}const Ga="Vôlei",Oa="🏐",La="team-logos",Da="America/Sao_Paulo",Ba={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},tt=s=>s?Ba[s]||s:"",Ce=["Vôlei","Volei","Voleibol"];function at(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function rs(s){const t=at(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:Da,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const je=s=>{const t=at(s);return t?t.getTime():Number.POSITIVE_INFINITY},rt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Va=s=>typeof s=="string"&&!rt(s)&&s.trim()!=="";function za(s){if(!s)return null;if(rt(s))return s;if(Va(s)){const{data:t}=x.storage.from(La).getPublicUrl(s);return t?.publicUrl||null}return null}const ns=s=>{const t=za(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};let Ua=class extends Ve.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Vôlei ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}};function nt({order_idx:s,stage:t,group_name:a}){const i=[];return s!=null&&String(s).length&&i.push(`Jogo ${s}`),a?i.push(`Grupo ${a}`):t&&i.push(tt(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:i.join(" • ")||"—"})}function os({team:s,align:t="left",badge:a=28}){const i=(()=>{const o=s?.name;if(typeof o=="string")return o;if(o&&typeof o=="object"&&"name"in o)return String(o.name);try{return String(o??"A definir")}catch{return"A definir"}})(),n=!!s?.id,c=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:i},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:i}),t==="right"?e.jsx(se,{team:{...s||{},name:i},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:o=>o.stopPropagation(),title:i,children:c}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:c})}function Me({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),i=s?.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},c=i?.id?i:{name:i?.name||"A definir"},o=s&&s.status!=="scheduled",r=Number(s?.home_score??0),m=Number(s?.away_score??0),v=Number(s?.meta?.home_sets??0),y=Number(s?.meta?.away_sets??0),k=s?.status==="ongoing"||s?.status==="paused",E=Number(s?.meta?.home_points_set??0),A=Number(s?.meta?.away_points_set??0),S=v>0||y>0||o,P=k?"Pts (set)":"Pontos",F=k?E:r,V=k?A:m,L=({label:b,value:d,visible:f})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-2.5 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:b}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:f?d:"-"})]}),M=({team:b,align:d,sets:f,score:N})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${d==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(os,{team:b,align:d})}),e.jsxs("div",{className:"flex items-center gap-2",children:[S?e.jsx(L,{label:"Sets",value:f,visible:S}):null,e.jsx(L,{label:P,value:N,visible:o})]})]}),D=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(nt,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(M,{team:n,align:"left",sets:v,score:F}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(M,{team:c,align:"right",sets:y,score:V})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?rs(s.starts_at):s?.venue||""}),o?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:["Sets ",v," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",y]}):null]})]});return s?.id?e.jsx(X,{to:`/match/${s.id}`,className:"block",children:D}):D}function Ns({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),i=Number(s?.away_score??0),n=Number(s?.meta?.home_sets??0),c=Number(s?.meta?.away_sets??0),o=s?.status==="ongoing"||s?.status==="paused",r=Number(s?.meta?.home_points_set??0),m=Number(s?.meta?.away_points_set??0),v=t&&(n>0||c>0),y=o?r:a,k=o?m:i;return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(nt,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(os,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs(e.Fragment,{children:[v?e.jsxs("div",{className:"text-[11px] font-medium tabular-nums text-gray-600 mb-0.5",children:["Sets: ",n," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",c]}):null,e.jsxs("div",{className:"text-base font-bold tabular-nums",children:[y," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",k]})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(os,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?rs(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",rs(s.updated_at)]}):null]})]})}function Te(s,t){return(t.points??0)-(s.points??0)||(t.sv??0)-(s.sv??0)||(s.sp??0)-(t.sp??0)||(t.point_difference??(t.pf??0)-(t.pa??0))-(s.point_difference??(s.pf??0)-(s.pa??0))||(t.pf??0)-(s.pf??0)||String(s.team_id).localeCompare(String(t.team_id))}function Ja(s){if(!Array.isArray(s)||s.length===0)return[];const t=s.map(o=>({...o,group_name:de(o.group_name)})).filter(o=>o.group_name&&o.group_name!=="-"),a=new Map;for(const o of t){const r=o.group_name;a.has(r)||a.set(r,[]),a.get(r).push(o)}for(const o of a.keys())a.get(o).sort((r,m)=>(r.rank??999)-(m.rank??999));const i=[],n=[];for(const[o,r]of a)r[0]&&i.push({group:o,...r[0]}),r[1]&&n.push({group:o,...r[1]});i.sort(Te),n.sort(Te);const c=i.length;if(c>=4){const o=i.slice(0,4);return[{stage:"semi",home:o[0],away:o[3]},{stage:"semi",home:o[1],away:o[2]}]}else if(c===3){if(!n.length)return[];const o=n[0];return[{stage:"semi",home:i[0],away:o},{stage:"semi",home:i[1],away:i[2]}]}else if(c===2){if(n.length<2)return[];const o=[...i,n[0],n[1]].sort(Te);return[{stage:"semi",home:o[0],away:o[3]},{stage:"semi",home:o[1],away:o[2]}]}return[]}function Ha({standings:s,teamsById:t}){const a=l.useMemo(()=>{const n={};for(const c of s||[]){const o=c.group_name||"-";n[o]||(n[o]=[]),n[o].push(c)}for(const c of Object.keys(n))n[c].sort((o,r)=>(o.rank??999)-(r.rank??999));return n},[s]),i=Object.keys(a).sort();return i.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:i.map(n=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",n]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"SV"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"SP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"PF"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"PC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[n].map(c=>{const o=t[c.team_id]||{id:c.team_id,name:c.team_name||"—"},r=Number(c.point_difference??(c.pf??0)-(c.pa??0));return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:c.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${o.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:{...o,logo_url:ns(o.logo_url)},size:20}),e.jsx("span",{className:"truncate",children:o.name})]})}),e.jsx("td",{className:"py-1 text-center",children:c.matches_played}),e.jsx("td",{className:"py-1 text-center",children:c.wins}),e.jsx("td",{className:"py-1 text-center",children:c.losses}),e.jsx("td",{className:"py-1 text-center",children:c.sv}),e.jsx("td",{className:"py-1 text-center",children:c.sp}),e.jsx("td",{className:"py-1 text-center",children:c.pf}),e.jsx("td",{className:"py-1 text-center",children:c.pa}),e.jsx("td",{className:"py-1 text-center",children:r}),e.jsx("td",{className:"py-1 text-center font-semibold",children:c.points})]},`${n}-${c.team_id}`)})})]}),e.jsxs("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:["Critérios/colunas: ",e.jsx("strong",{children:"#"})," (posição), ",e.jsx("strong",{children:"Time"}),", ",e.jsx("strong",{children:"P"})," (jogos), ",e.jsx("strong",{children:"V"})," (vitórias), ",e.jsx("strong",{children:"D"})," (derrotas), ",e.jsx("strong",{children:"SV"})," (sets vencidos), ",e.jsx("strong",{children:"SP"})," (sets perdidos), ",e.jsx("strong",{children:"PF"})," (pontos feitos), ",e.jsx("strong",{children:"PC"})," (pontos contra), ",e.jsx("strong",{children:"+/-"})," (saldo de pontos), ",e.jsx("strong",{children:"Pts"})," (pontos na tabela)."]})]},n))})}const ot=s=>typeof s=="string"?s.trim().toLowerCase():"",Ka=s=>{const t=ot(s);return t==="semifinal"||t==="semi-final"||t==="semis"?"semi":t==="3º"||t==="3º lugar"||t==="terceiro"||t==="3-lugar"?"3lugar":t},Xa=s=>{const t=ot(s);return t==="encerrado"||t==="finalizado"?"finished":t==="agendado"||t==="programado"?"scheduled":t||"scheduled"},de=s=>{if(!s)return"-";const t=String(s).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toUpperCase();if(!t)return"-";const a=t.match(/^GRUPO\s+([A-Z0-9]+)$/);return a?a[1]:t};function ws(s,t){const a=new Map,i=(m,v)=>`${m}::${v}`,n=(m,v)=>{const y=i(m,v);return a.has(y)||a.set(y,{group_name:m,team_id:v,team_name:t?.[v]?.name??"—",matches_played:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0,points:0}),a.get(y)},c=new Set;for(const m of s||[]){const v=de(m?.group_name)||"-",y=m?.home?.id,k=m?.away?.id;y&&(n(v,y),c.add(y)),k&&(n(v,k),c.add(k))}for(const m of s||[]){if(m?.status!=="finished")continue;const v=de(m?.group_name)||"-",y=m?.home?.id,k=m?.away?.id;if(!y||!k)continue;const E=n(v,y),A=n(v,k),$=Number(m?.meta?.home_sets??0),S=Number(m?.meta?.away_sets??0),P=Number(m?.home_score??0),F=Number(m?.away_score??0);let V=!1,L=!1;$!==S?(V=$>S,L=!V):P!==F&&(V=P>F,L=!V),E.matches_played++,A.matches_played++,E.sv+=$,E.sp+=S,E.pf+=P,E.pa+=F,A.sv+=S,A.sp+=$,A.pf+=F,A.pa+=P,V?(E.wins++,E.points+=3,A.losses++):L&&(A.wins++,A.points+=3,E.losses++)}for(const m of Object.keys(t||{})){const v=Number(m);if(c.has(v)||c.has(m))continue;const y=de(t[m]?.group_name);y&&y!=="-"&&n(y,m)}const o={};for(const m of a.values())m.point_difference=Number(m.pf)-Number(m.pa),(o[m.group_name]||=[]).push(m);const r=[];for(const m of Object.keys(o).sort())o[m].sort(Te),o[m].forEach((v,y)=>r.push({...v,rank:y+1}));return r}function Za(){const[s,t]=l.useState(null),[a,i]=l.useState({}),n=l.useRef({});l.useEffect(()=>{n.current=a},[a]);const[c,o]=l.useState([]),[r,m]=l.useState([]),[v,y]=l.useState(!0),[k,E]=l.useState("todos"),[A,$]=l.useState("todos"),S=l.useRef(null),P=l.useRef(null),F=l.useCallback(async()=>{try{const{data:g,error:h}=await x.from("sports").select("id, name").in("name",Ce).limit(1);if(h)throw h;g&&g[0]?.id?t(g[0].id):(console.warn("⚠️ Esporte Vôlei não encontrado em 'sports' (nomes tentados:",Ce.join(", "),")"),t(null))}catch(g){console.error("Exceção loadSportId:",g),t(null)}},[]),V=l.useCallback(async g=>{try{if(g){const u=await x.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",g);if(!u.error&&Array.isArray(u.data)&&u.data.length>0){const j={};for(const G of u.data)j[G.id]={...G,name:String(G.name??"—"),logo_url:ns(G.logo_url)};i(j),n.current=j;return}}const h=await x.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").in("sport.name",Ce);if(h.error)throw h.error;const T={};for(const u of h.data||[])T[u.id]={...u,name:String(u.name??"—"),logo_url:ns(u.logo_url)};i(T),n.current=T}catch(h){console.error("Exceção loadTeams:",h),i({}),n.current={}}},[]),L=l.useCallback(async g=>{try{if(g){const u=await x.from("standings_volei_view").select("group_name, rank, team_id, team_name, matches_played, wins, losses, sv, sp, pf, pa, point_difference, points").eq("sport_id",g).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!u.error&&Array.isArray(u.data)&&u.data.length>0){console.info("[Vôlei] standings via VIEW/sport_id:",u.data.length),o(u.data);return}}if(g){const u=await x.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, losses,
            sv, sp, pf, pa, point_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",g).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0}),j=(u.data||[]).map(G=>({...G,team_name:G.team?.name,sv:Number(G.sv??0),sp:Number(G.sp??0),pf:Number(G.pf??0),pa:Number(G.pa??0),point_difference:Number(G.point_difference??(G.pf??0)-(G.pa??0))}));if(!u.error&&j.length>0){console.info("[Vôlei] standings via TABLE/sport_id:",j.length),o(j);return}}const T=((await x.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, losses,
          sv, sp, pf, pa, point_difference, points,
          team:teams!inner(name, id),
          sport:sport_id!inner(name, id)
        `).in("sport.name",Ce).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(u=>({...u,team_name:u.team?.name,sv:Number(u.sv??0),sp:Number(u.sp??0),pf:Number(u.pf??0),pa:Number(u.pa??0),point_difference:Number(u.point_difference??(u.pf??0)-(u.pa??0))}));console.info("[Vôlei] standings via TABLE/join por nome:",T.length,"— esportes possíveis:",Ce),o(T)}catch(h){console.error("Exceção loadStandings (vôlei):",h),o([])}},[]),M=l.useCallback(async g=>{try{if(!g){m([]);return}const{data:h,error:T}=await x.from("matches").select(`
          id, sport_id,
          stage, round, group_name, starts_at, updated_at, venue, status, meta,
          home_team_id, away_team_id, home_score, away_score, order_idx
        `).eq("sport_id",g);if(T)throw T;const u=w=>w?{...n.current[w]||{},id:w,name:String(n.current[w]?.name??"A definir")}:null,j=(h||[]).map(w=>{const I=Number.isFinite(Number(w.order_idx))?Number(w.order_idx):null,H=Number.isFinite(Number(w.order_idx))?Number(w.order_idx):Number.isFinite(Number(w.round))?Number(w.round):Number.MAX_SAFE_INTEGER;return{id:w.id,sport_id:w.sport_id,order_idx:I,_sortKey:H,stage:Ka(w.stage),round:w.round,group_name:w.group_name,starts_at:w.starts_at,updated_at:w.updated_at,venue:w.venue,status:Xa(w.status),meta:w.meta,home_score:w.home_score,away_score:w.away_score,home:u(w.home_team_id),away:u(w.away_team_id)}}),G={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6};j.sort((w,I)=>(G[w.stage]??99)-(G[I.stage]??99)||w._sortKey-I._sortKey||je(w.starts_at)-je(I.starts_at)||w.id-I.id),m(j),console.info("[Vôlei] matches carregados:",j.length)}catch(h){console.error("Exceção loadMatches (vôlei):",h),m([])}},[]),D=l.useCallback(async(g,{skeleton:h=!1}={})=>{h&&y(!0);try{await V(g),await Promise.all([L(g),M(g)])}finally{y(!1)}},[V,L,M]);l.useEffect(()=>{F()},[F]),l.useEffect(()=>{if(!s){y(!1);return}if(D(s,{skeleton:!0}),S.current){try{x.removeChannel(S.current)}catch{}S.current=null}const g=()=>{P.current&&clearTimeout(P.current),P.current=setTimeout(()=>D(s,{skeleton:!1}),1e3)},h=x.channel(`volei-hub-${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},g).on("postgres_changes",{event:"UPDATE",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},g).on("postgres_changes",{event:"DELETE",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},g).subscribe();return S.current=h,()=>{if(P.current&&(clearTimeout(P.current),P.current=null),S.current){try{x.removeChannel(S.current)}catch{}S.current=null}}},[s,D]),l.useEffect(()=>{if(!v){const g=ws(r,n.current);g.length&&o(g)}},[v,r,a]),l.useEffect(()=>{if(!v&&c.length===0&&r.length>0){const g=ws(r,n.current);g.length&&(console.info("[Vôlei] standings derivadas de matches:",g.length),o(g))}},[v,c.length,r]),l.useEffect(()=>{if(!c)return;const g=new Set(c.map(_=>String(_.team_id))),T=Object.keys(n.current||{}).filter(_=>!g.has(String(_)));if(T.length===0)return;const u=new Map;for(const _ of r||[]){const R=de(_?.group_name);if(!R)continue;const O=J=>{if(!J)return;const W=String(J),ne=u.get(W)||{};ne[R]=(ne[R]||0)+1,u.set(W,ne)};O(_?.home?.id),O(_?.away?.id)}const j=_=>{const R=u.get(String(_))||{},O=Object.entries(R).sort((J,W)=>W[1]-J[1])[0];return O?O[0]:"-"},G=T.map(_=>{const R=n.current[_]||{};return{group_name:(R.group_name?de(R.group_name):null)||j(_)||"-",team_id:isNaN(Number(_))?_:Number(_),team_name:R.name||"—",matches_played:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0,point_difference:0,points:0}}),w=[...c,...G],I={};for(const _ of w){const R=_.group_name||"-",O=Number(_.point_difference??(_.pf??0)-(_.pa??0));(I[R]||=[]).push({..._,point_difference:O})}const H=[];for(const _ of Object.keys(I).sort())I[_].sort(Te),I[_].forEach((R,O)=>H.push({...R,rank:O+1}));o(H)},[c,r,a]);const b=c.length>0,d=l.useMemo(()=>{const g=j=>(r||[]).filter(G=>G.stage===j).sort((G,w)=>(Number(G?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(w?.order_idx)||Number.MAX_SAFE_INTEGER)),h=g("semi"),T=g("final"),u=g("3lugar");return{semis:h,final:T[0],third:u[0]}},[r]),f=l.useMemo(()=>Ja(c),[c]),N=d.semis?.length?d.semis:f||[];l.useMemo(()=>{const g=new Set;return(r||[]).forEach(h=>{const T=de(h.group_name);T&&T!=="-"&&g.add(T)}),["todos",...Array.from(g).sort()]},[r]),l.useMemo(()=>{const g=new Set;(r||[]).forEach(u=>u.stage&&g.add(u.stage));const h=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(g).sort((u,j)=>h.indexOf(u)+100-(h.indexOf(j)+100))]},[r]);const C=l.useMemo(()=>{const g=(r||[]).some(T=>T.stage==="grupos"&&T.status!=="finished");let h=(r||[]).filter(T=>T.status==="scheduled"&&(g?T.stage==="grupos":!0));return k!=="todos"&&(h=h.filter(T=>de(T.group_name)===k)),A!=="todos"&&(h=h.filter(T=>T.stage===A)),h.sort((T,u)=>je(T.starts_at)-je(u.starts_at)||(T.order_idx??1)-(u.order_idx??1)),h},[r,k,A]),q=l.useMemo(()=>{const g=(r||[]).filter(h=>h.status==="finished");return g.sort((h,T)=>je(T.updated_at||T.starts_at||0)-je(h.updated_at||h.starts_at||0)),g.slice(0,12)},[r]);return e.jsx(Ua,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Oa}),e.jsx("h2",{className:"text-2xl font-bold",children:Ga})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Classificação por ",e.jsx("strong",{children:"sets"})," (3 pts por vitória). Empate em sets desempata por ",e.jsx("strong",{children:"pontos do placar"}),"."]})]}),v?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((g,h)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},h))})]}):e.jsxs(e.Fragment,{children:[b&&(()=>{const g=(c||[]).filter(h=>de(h.group_name)!=="-");return g.length?e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Ha,{standings:g,teamsById:a})]}):null})(),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(N.length,2)}).map((g,h)=>{const T=N[h],u=T?void 0:{home:"A definir",away:"A definir"};return e.jsx(Me,{match:T,placeholder:u},`s-${T?.id??h}`)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),d.final?e.jsx(Me,{match:d.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(Me,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]}),d.third?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"3º lugar"}),e.jsx(Me,{match:d.third})]}):null]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:k,onChange:g=>E(g.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:["todos",...new Set((r||[]).map(g=>g.group_name).filter(Boolean)).values()].map(g=>e.jsx("option",{value:g,children:g==="todos"?"Todos":`Grupo ${g}`},g))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:A,onChange:g=>$(g.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:["todos",...new Set((r||[]).map(g=>g.stage).filter(Boolean)).values()].map(g=>e.jsx("option",{value:g,children:g==="todos"?"Todas":tt(g)},g))})]}),C.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:C.map((g,h)=>e.jsx(Ns,{match:g},g.id??`sched-${h}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),q.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:q.map((g,h)=>e.jsx(Ns,{match:g},g.id??`fin-${h}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas com ",e.jsx("strong",{children:"um set de 15 pontos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Vitória:"})," é necessário ter ",e.jsx("strong",{children:"dois pontos de vantagem"})," para vencer a partida."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo e o melhor 2º colocado avançam para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," confronto direto; se houver 3 empates, será utilizado o diferencial de pontos."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor do grupo A × Vencedor do grupo B; Vencedor do grupo C × Melhor 2º colocado."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substituições:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Rodízio:"})," obrigatório."]})]})})]})]})]})})}const Qa="FIFA",Wa="🎮⚽",Ya="team-logos",er="America/Sao_Paulo",sr={r32:"Pré-oitavas",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar","1º":"1ª fase","2º":"2ª fase","3º":"3ª fase","4º":"4ª fase"},vs={r32:1,oitavas:2,quartas:3,semi:4,final:5,"3lugar":5},it=s=>s?sr[s]||s:"",qe=s=>vs[s]??vs[String(s||"").toLowerCase()]??99;function tr(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function ar(s){const t=tr(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:er,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const lt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),rr=s=>typeof s=="string"&&!lt(s)&&s.trim()!=="";function nr(s){if(!s)return null;if(lt(s))return s;if(rr(s)){const{data:t}=x.storage.from(Ya).getPublicUrl(s);return t?.publicUrl||null}return null}const Ie=s=>{const t=nr(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null},or={17:[1,2],18:[3,4],19:[5,6],20:[7,8],21:[9,10],22:[11,12],23:[13,14],24:[15,16],25:[17,18],26:[19,20],27:[21,22],28:[23,24],29:[25,26],30:[27,28],31:[29,30]},ir={32:[29,30]},lr=(s,t)=>t==="3lugar"?ir[s]||null:or[s]||null;function cr({order_idx:s,stage:t}){const a=[];return s!=null&&String(s).length&&a.push(`Jogo ${s}`),t&&a.push(it(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:a.join(" • ")||"—"})}function dr({team:s,align:t="left",badge:a=28}){const i=(()=>{const o=s?.name;if(typeof o=="string")return o;if(o&&typeof o=="object"&&"name"in o)return String(o.name);try{return String(o??"A definir")}catch{return"A definir"}})(),n=!!s?.id,c=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:i},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:i}),t==="right"?e.jsx(se,{team:{...s||{},name:i},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:o=>o.stopPropagation(),title:i,children:c}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:c})}function mr({match:s,placeholders:t}){const a=s.home||(t?.home?{name:t.home}:null),i=s.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},c=i?.id?i:{name:i?.name||"A definir"},o=s?.status&&s.status!=="scheduled",r=Number(s?.home_score??0),m=Number(s?.away_score??0),v=({value:k})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:o?k:"-"})]}),y=({team:k,align:E,score:A})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${E==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(dr,{team:k,align:E})}),e.jsx(v,{value:A})]});return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(cr,{order_idx:s.order_idx,stage:s.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(y,{team:n,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(y,{team:c,align:"right",score:m})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.starts_at?ar(s.starts_at):s.venue||""}),o?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",m]}):null]})]})}function ur(){const[s,t]=l.useState(null),[a,i]=l.useState([]),[n,c]=l.useState(!0),o=l.useRef(null),r=l.useRef(!1),m=l.useCallback(async()=>{const{data:A,error:$}=await x.from("sports").select("id").eq("name","FIFA").maybeSingle();if($){console.error("Erro ao carregar sport id:",$);return}A?.id&&t(A.id)},[]),v=l.useCallback(async A=>{try{const{data:$,error:S}=await x.from("match_detail_view").select(`
          id, sport_id, order_idx,
          stage, round, group_name, starts_at, updated_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score
        `).eq("sport_id",A);let P=[];if(!S&&$?.length)P=$.map(F=>({id:F.id,sport_id:F.sport_id,order_idx:F.order_idx,stage:F.stage,round:F.round,group_name:F.group_name,starts_at:F.starts_at,updated_at:F.updated_at,venue:F.venue,status:F.status,home_score:F.home_score,away_score:F.away_score,home:F.home_team_id?{id:F.home_team_id,name:String(F.home_team_name??"A definir"),color:F.home_team_color,logo_url:Ie(F.home_team_logo)}:null,away:F.away_team_id?{id:F.away_team_id,name:String(F.away_team_name??"A definir"),color:F.away_team_color,logo_url:Ie(F.away_team_logo)}:null}));else{const{data:F,error:V}=await x.from("matches").select(`
            id, order_idx, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("sport_id",A);if(V)throw V;P=(F||[]).map(L=>({...L,home:L.home&&typeof L.home=="object"?{...L.home,name:String(L.home.name??"A definir"),logo_url:Ie(L.home.logo_url)}:L.home,away:L.away&&typeof L.away=="object"?{...L.away,name:String(L.away.name??"A definir"),logo_url:Ie(L.away.logo_url)}:L.away}))}P.sort((F,V)=>{const L=qe(F.stage)-qe(V.stage);return L!==0?L:(F.order_idx??9999)-(V.order_idx??9999)}),i(P)}catch($){console.error("Exceção loadMatches:",$),i([])}},[]),y=l.useCallback(async A=>{if(!r.current){r.current=!0,c(!0);try{await v(A)}finally{c(!1),r.current=!1}}},[v]);l.useEffect(()=>{m()},[m]),l.useEffect(()=>{if(!s)return;if(y(s),o.current){try{x.removeChannel(o.current)}catch{}o.current=null}const A=x.channel(`fifa-hub-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},()=>{y(s)}).subscribe();return o.current=A,()=>{if(o.current){try{x.removeChannel(o.current)}catch{}o.current=null}}},[s,y]);const k=l.useCallback((A,$)=>{const S=lr(A,$);return $==="3lugar"&&S?{home:`Perdedor J${S[0]}`,away:`Perdedor J${S[1]}`}:S?{home:`Vencedor J${S[0]}`,away:`Vencedor J${S[1]}`}:null},[]),E=l.useMemo(()=>{const A={};for(const S of a){const P=S.stage||"—";A[P]||(A[P]=[]),A[P].push(S)}return Object.keys(A).sort((S,P)=>qe(S)-qe(P)).map(S=>({stage:S,items:A[S].sort((P,F)=>(P.order_idx??0)-(F.order_idx??0))}))},[a]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Wa}),e.jsx("h2",{className:"text-2xl font-bold",children:Qa})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"chaveamento"})," completo (com placeholders) → ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),n?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((A,$)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},$))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),E.map(({stage:A,items:$})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:it(A)||"Fase"}),$.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:$.map(S=>e.jsx(mr,{match:S,placeholders:k(Number(S.order_idx),S.stage)},S.id))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem confrontos nesta fase."})]},A))]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," torneio de ",e.jsx("strong",{children:"mata-mata"})," (eliminação simples)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estrutura:"})," fases iniciais → oitavas/quartas → semifinais → final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Partidas:"})," jogo único por confronto."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate:"})," prorrogação e/ou pênaltis conforme necessário."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Configurações do console:"})," duração, times e regras definidas pela organização."]})]})})]})]})]})}const He="Pebolim",gr="🎯",hr="team-logos",pr="America/Sao_Paulo",xr={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},ct=s=>s?xr[s]||s:"";function dt(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function is(s){const t=dt(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:pr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const Ge=s=>{const t=dt(s);return t?t.getTime():Number.POSITIVE_INFINITY},mt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),fr=s=>typeof s=="string"&&!mt(s)&&s.trim()!=="";function yr(s){if(!s)return null;if(mt(s))return s;if(fr(s)){const{data:t}=x.storage.from(hr).getPublicUrl(s);return t?.publicUrl||null}return null}const Ae=s=>{const t=yr(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};function ut({order_idx:s,stage:t,group_name:a}){const i=[];return s!=null&&String(s).length&&i.push(`Jogo ${s}`),a?i.push(`Grupo ${a}`):t&&i.push(ct(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:i.join(" • ")||"—"})}function ls({team:s,align:t="left",badge:a=28}){const i=(()=>{const r=s?.name;if(typeof r=="string")return r;if(r&&typeof r=="object"&&"name"in r)return String(r.name);try{return String(r??"A definir")}catch{return"A definir"}})(),n=!!s?.id,c=!n&&i==="A definir",o=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:i},size:a}),e.jsxs("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:[i,c?e.jsx(Ks,{className:"inline-block ml-1 w-4 h-4 text-gray-400"}):null]}),t==="right"?e.jsx(se,{team:{...s||{},name:i},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:r=>r.stopPropagation(),title:i,children:o}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:o})}function Ss({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),i=Number(s?.away_score??0);return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(ut,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(ls,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs("span",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",i]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(ls,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?is(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",is(s.updated_at)]}):null]})]})}function ke({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),i=s?.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},c=i?.id?i:{name:i?.name||"A definir"},o=s&&s.status!=="scheduled",r=Number(s?.home_score??0),m=Number(s?.away_score??0),v=({value:E})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:o?E:"-"})]}),y=({team:E,align:A,score:$})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${A==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(ls,{team:E,align:A})}),e.jsx(v,{value:$})]}),k=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(ut,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(y,{team:n,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(y,{team:c,align:"right",score:m})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?is(s.starts_at):s?.venue||""}),o?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",m]}):null]})]});return s?.id?e.jsx(X,{to:`/match/${s.id}`,className:"block",children:k}):k}const cs=s=>3*Number(s.wins??0)+Number(s.draws??0);function br(s,t){const a=cs(s),i=cs(t);if(i!==a)return i-a;const n=Number(s.wins??0),c=Number(t.wins??0);if(c!==n)return c-n;const o=Number(s.goal_difference??Number(s.goals_for??0)-Number(s.goals_against??0)),r=Number(t.goal_difference??Number(t.goals_for??0)-Number(t.goals_against??0));if(r!==o)return r-o;const m=Number(s.goals_for??0),v=Number(t.goals_for??0);return v!==m?v-m:String(s.team_id).localeCompare(String(t.team_id))}function jr({standings:s,teamsById:t,sportId:a}){const i=l.useMemo(()=>{const o=k=>String(k??"-").trim().toUpperCase(),r={},m=new Set;for(const k of s||[]){const E=o(k.group_name);r[E]||(r[E]=[]),r[E].push({...k,group_name:E}),m.add(String(k.team_id))}const v={};for(const k in t){const E=t[k];if(a&&E&&E.sport_id&&String(E.sport_id)!==String(a))continue;const A=o(E.group_name);v[A]||(v[A]=[]),v[A].push(E)}const y=Object.keys(r).length?Object.keys(r):Object.keys(v);for(const k of y){const E=r[k]||[],A=(v[k]||[]).filter(S=>!m.has(String(S.id))).map(S=>({group_name:k,team_id:S.id,team_name:S.name,matches_played:0,wins:0,draws:0,losses:0,goals_for:0,goals_against:0,goal_difference:0})),$=[...E,...A].sort(br).map((S,P)=>({...S,rank:P+1}));r[k]=$}return r},[s,t,a]),n=l.useMemo(()=>{const o=new Map;(s||[]).forEach(m=>o.set(String(m.team_id),String(m.group_name??"-")));const r=[];return Object.values(t||{}).forEach(m=>{const v=o.get(String(m.id)),y=String(m.group_name??"-");v&&v!==y&&r.push({id:m.id,name:m.name,teamG:y,sidG:v})}),r},[s,t]),c=Object.keys(i).sort();return c.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[n.length?e.jsx("div",{className:"md:col-span-3",children:e.jsxs("div",{className:"rounded-md border border-amber-200 bg-amber-50 p-2 text-xs text-amber-800",children:[n.length," time(s) com grupo divergente entre ",e.jsx("em",{children:"teams"})," e ",e.jsx("em",{children:"standings"}),". A UI já ignora isso, mas vale ajustar no banco."]})}):null,c.map(o=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",o]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"E"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:i[o].map(r=>{const m=t[r.team_id]&&typeof t[r.team_id]=="object"?t[r.team_id]:{id:r.team_id,name:String(r.team_name??t[r.team_id]?.name??"—")},v={...m,name:typeof m.name=="string"?m.name:String(m.name??"—")};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:r.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${v.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:v,size:20}),e.jsx("span",{className:"truncate",children:v.name})]})}),e.jsx("td",{className:"py-1 text-center",children:r.matches_played}),e.jsx("td",{className:"py-1 text-center",children:r.wins}),e.jsx("td",{className:"py-1 text-center",children:r.draws}),e.jsx("td",{className:"py-1 text-center",children:r.losses}),e.jsx("td",{className:"py-1 text-center",children:r.goals_for}),e.jsx("td",{className:"py-1 text-center",children:r.goals_against}),e.jsx("td",{className:"py-1 text-center",children:r.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:cs(r)})]},`${o}-${r.team_id}`)})})]}),e.jsx("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:"Critérios: Pontos, Vitórias, Saldo de Gols, Gols Pró."})]},o))]})}function _r(s){const t=r=>(s||[]).filter(m=>m.stage===r).sort((m,v)=>(Number(m?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(v?.order_idx)||Number.MAX_SAFE_INTEGER)),a=t("oitavas"),i=t("quartas"),n=t("semi"),c=t("final"),o=t("3lugar");return{oitavas:a,quartas:i,semis:n,final:c[0],third:o[0]}}function Nr(s,t){if(!Array.isArray(s)||s.length===0){const o=(r,m)=>({home:{name:`1º Grupo ${r}`},away:{name:`1º Grupo ${m}`}});return{quarters:[o("A","B"),o("C","D"),o("E","F"),o("G","H")],semis:[{home:{name:"Vencedor Quartas 1"},away:{name:"Vencedor Quartas 2"}},{home:{name:"Vencedor Quartas 3"},away:{name:"Vencedor Quartas 4"}}]}}const a={};for(const o of"ABCDEFGH".split("")){const r=s.find(m=>m.group_name===o&&m.rank===1);r&&(a[o]={id:r.team_id,name:r.team_name||t[r.team_id]?.name||"—",logo_url:t[r.team_id]?.logo_url,color:t[r.team_id]?.color})}const i=(o,r)=>({home:a[o]||{name:`1º Grupo ${o}`},away:a[r]||{name:`1º Grupo ${r}`}});return{quarters:[i("A","B"),i("C","D"),i("E","F"),i("G","H")],semis:[{home:{name:"Vencedor Quartas 1"},away:{name:"Vencedor Quartas 2"}},{home:{name:"Vencedor Quartas 3"},away:{name:"Vencedor Quartas 4"}}]}}class wr extends Ve.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Pebolim ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}}const gt=s=>typeof s=="string"?s.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toLowerCase():"",$s=s=>{const t=gt(s);return t==="semifinal"||t==="semi-final"||t==="semis"?"semi":t==="3º lugar"||t==="3lugar"||t==="3-lugar"||t==="terceiro"?"3lugar":t},Cs=s=>{const t=gt(s);return t==="agendado"||t==="programado"||t==="scheduled"?"scheduled":t==="ao vivo"||t==="andamento"||t==="live"||t==="ongoing"?"ongoing":t==="pausado"||t==="paused"?"paused":t==="encerrado"||t==="finalizado"||t==="finished"?"finished":t||"scheduled"};function vr(){const[s,t]=l.useState(null),[a,i]=l.useState({}),n=l.useRef({});l.useEffect(()=>{n.current=a},[a]);const[c,o]=l.useState([]),[r,m]=l.useState([]),[v,y]=l.useState(!0),[k,E]=l.useState("todos"),[A,$]=l.useState("todos"),S=l.useRef(null),P=l.useRef(null),F=l.useCallback(async()=>{try{const{data:g,error:h}=await x.from("sports").select("id").eq("name",He).maybeSingle();h&&console.error("Erro ao carregar sport id:",h),t(g?.id??null)}catch(g){console.error("Exceção loadSportId:",g),t(null)}},[]),V=l.useCallback(async g=>{try{if(g){const h=await x.from("teams").select("id, name, logo_url, color, group_name, sport_id").eq("sport_id",g);if(!h.error&&Array.isArray(h.data)&&h.data.length){const T={};for(const u of h.data)T[u.id]={...u,name:String(u.name??"—"),logo_url:Ae(u.logo_url),group_name:u.group_name??"-",sport_id:u.sport_id??g};i(T),n.current=T;return}}i({})}catch(h){console.error("Exceção loadTeams:",h),i({})}},[]),L=l.useCallback(async g=>{try{if(g){const{data:u,error:j}=await x.from("standings_view").select(`
            sport_id, group_name, rank, team_id, team_name,
            matches_played, wins, draws, losses,
            goals_for, goals_against, goal_difference, points
          `).eq("sport_id",g).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(j)throw j;if(Array.isArray(u)&&u.length>0){o(u);return}}const h=await x.from("standings_view").select(`
          sport_id, group_name, rank, team_id, team_name,
          matches_played, wins, draws, losses,
          goals_for, goals_against, goal_difference, points
        `);if(h.error)throw h.error;const T=Array.isArray(h.data)?h.data:[];o(g?T.filter(u=>String(u.sport_id)===String(g)):T)}catch(h){console.error("Exceção loadStandings:",h),o([])}},[]),M=l.useCallback(async g=>{try{let h=[];if(g){const{data:j,error:G}=await x.from("match_detail_view").select(`
            id, sport_id, order_idx,
            stage, round, group_name, starts_at, updated_at, venue, status,
            home_team_id, home_team_name, home_team_color, home_team_logo,
            away_team_id, away_team_name, away_team_color, away_team_logo,
            home_score, away_score
          `).eq("sport_id",g);!G&&Array.isArray(j)&&j.length&&(h=j.map(w=>({id:w.id,sport_id:w.sport_id,order_idx:w.order_idx,stage:$s(w.stage),round:w.round,group_name:w.group_name,starts_at:w.starts_at,updated_at:w.updated_at,venue:w.venue,status:Cs(w.status),home_score:w.home_score,away_score:w.away_score,home:w.home_team_id?{id:w.home_team_id,name:String(w.home_team_name??"A definir"),color:w.home_team_color,logo_url:Ae(w.home_team_logo)}:null,away:w.away_team_id?{id:w.away_team_id,name:String(w.away_team_name??"A definir"),color:w.away_team_color,logo_url:Ae(w.away_team_logo)}:null})))}if(!h.length){const{data:j,error:G}=await x.from("matches").select(`
            id, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score, order_idx,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color ),
            sport:sport_id!inner(name)
          `).eq("sport.name",He);if(G)throw G;h=(j||[]).map(w=>({id:w.id,order_idx:Number.isFinite(Number(w.order_idx))?Number(w.order_idx):null,stage:$s(w.stage),round:w.round,group_name:w.group_name,starts_at:w.starts_at,updated_at:w.updated_at,venue:w.venue,status:Cs(w.status),home_score:w.home_score,away_score:w.away_score,home:w.home?{...w.home,name:String(w.home.name??"A definir"),logo_url:Ae(w.home.logo_url)}:null,away:w.away?{...w.away,name:String(w.away.name??"A definir"),logo_url:Ae(w.away.logo_url)}:null}))}const T={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6},u=j=>Number.isFinite(Number(j?.order_idx))?Number(j.order_idx):Number.MAX_SAFE_INTEGER;h.sort((j,G)=>(T[j.stage]??99)-(T[G.stage]??99)||u(j)-u(G)),m(h)}catch(h){console.error("Exceção loadMatches (pebolim):",h),m([])}},[]),D=l.useCallback(async(g,{skeleton:h=!1}={})=>{h&&y(!0);try{await V(g),await Promise.all([L(g),M(g)])}finally{y(!1)}},[V,L,M]);l.useEffect(()=>{F()},[F]),l.useEffect(()=>{if(s){if(D(s,{skeleton:!0}),S.current){try{x.removeChannel(S.current)}catch{}S.current=null}if(s){const g=()=>{P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{Promise.all([L(s),M(s)]).catch(T=>console.error(T))},400)},h=x.channel(`pebolim-hub-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},g).on("postgres_changes",{event:"*",schema:"public",table:"standings",filter:`sport_id=eq.${s}`},g).subscribe();S.current=h}return()=>{if(P.current&&(clearTimeout(P.current),P.current=null),S.current){try{x.removeChannel(S.current)}catch{}S.current=null}}}},[s,D]),l.useMemo(()=>!!(c?.length||(r||[]).some(g=>!!g.group_name)||Object.values(a||{}).some(g=>!!g.group_name)),[c,r,a]);const b=l.useMemo(()=>_r(r),[r]),d=l.useMemo(()=>Nr(c,a),[c,a]),f=l.useMemo(()=>{const g=new Set;return(r||[]).forEach(h=>h.group_name&&g.add(h.group_name)),(c||[]).forEach(h=>h.group_name&&g.add(h.group_name)),Object.values(a||{}).forEach(h=>h.group_name&&g.add(h.group_name)),["todos",...Array.from(g).sort()]},[r,c,a]),N=l.useMemo(()=>{const g=new Set;(r||[]).forEach(u=>u.stage&&g.add(u.stage));const h=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(g).sort((u,j)=>h.indexOf(u)+100-(h.indexOf(j)+100))]},[r]),C=l.useMemo(()=>{let g=(r||[]).filter(h=>h.status!=="scheduled"?!1:h.group_name?!0:h.home?.id&&h.away?.id);return k!=="todos"&&(g=g.filter(h=>h.group_name===k)),A!=="todos"&&(g=g.filter(h=>h.stage===A)),g.sort((h,T)=>{const u=Ge(h.starts_at),j=Ge(T.starts_at);return(Number.isFinite(u-j)?u-j:0)||Number(h.order_idx??Number.MAX_SAFE_INTEGER)-Number(T.order_idx??Number.MAX_SAFE_INTEGER)||h.id-T.id}),g},[r,k,A]),q=l.useMemo(()=>{const g=(r||[]).filter(h=>h.status==="finished");return g.sort((h,T)=>Ge(T.updated_at||T.starts_at||0)-Ge(h.updated_at||h.starts_at||0)),g.slice(0,12)},[r]);return e.jsx(wr,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:gr}),e.jsx("h2",{className:"text-2xl font-bold",children:He})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"classificação"})," (se houver grupos) → ",e.jsx("strong",{children:"chaveamento"})," →"," ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),v?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((g,h)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},h))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(jr,{standings:c,teamsById:a,sportId:s})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),b.oitavas?.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Oitavas de final"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:b.oitavas.map((g,h)=>e.jsx(ke,{match:g},`o-${g?.id??h}`))})]}):null,b.quartas?.length||d?.quarters?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Quartas de final"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(b.quartas?.length||0,d?.quarters?.length||0,4)}).map((g,h)=>{const T=b.quartas?.[h],u=d?.quarters?.[h];return e.jsx(ke,{match:T,placeholder:u},`q-${T?.id??h}`)})})]}):null,b.semis?.length||d?.semis?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(b.semis?.length||0,d?.semis?.length||0,2)}).map((g,h)=>{const T=b.semis?.[h],u=d?.semis?.[h];return e.jsx(ke,{match:T,placeholder:u},`s-${T?.id??h}`)})})]}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),b.final?e.jsx(ke,{match:b.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(ke,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:k,onChange:g=>E(g.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:f.map(g=>e.jsx("option",{value:g,children:g==="todos"?"Todos":`Grupo ${g}`},g))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:A,onChange:g=>$(g.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:N.map(g=>e.jsx("option",{value:g,children:g==="todos"?"Todas":ct(g)},g))})]}),C.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:C.map((g,h)=>e.jsx(Ss,{match:g},g.id??`sched-${h}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),q.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:q.map((g,h)=>e.jsx(Ss,{match:g},g.id??`fin-${h}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas em ",e.jsx("strong",{children:"1 rodada de 4 gols"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (8 grupos de 3 duplas) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo avança para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," saldo de gols."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," quatro quartas de final, duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Quartas de final:"})," Vencedor do grupo A × Vencedor do grupo B = Vencedor 1; Vencedor do grupo C × Vencedor do grupo D = Vencedor 2; Vencedor do grupo E × Vencedor do grupo F = Vencedor 3; Vencedor do grupo G × Vencedor do grupo H = Vencedor 4."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor 1 × Vencedor 2; Vencedor 3 × Vencedor 4."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Duplas:"})," não podem ser substituídas durante o torneio."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"WO:"})," em caso de não comparecimento de um ou mais integrantes, a dupla perde por WO. Atrasos de até 3 minutos são tolerados."]})]})})]})]})]})})}const Sr="team-logos";function ht(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function $r(s){return typeof s=="string"&&!ht(s)&&s.trim()!==""}function Ke(s){if(!s)return null;if(ht(s))return s;if($r(s)){const{data:t}=x.storage.from(Sr).getPublicUrl(s);return t?.publicUrl||null}return null}const Cr={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Ar={grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},kr="America/Sao_Paulo";function Er(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:kr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function Tr(s){return s?Ar[s]||s[0]?.toUpperCase()+s.slice(1):""}function Pr(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),n=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(n<0)return"0:00";const c=Math.floor(n/1e3),o=Math.floor(c/60),r=c%60;return`${o}:${r.toString().padStart(2,"0")}`}function Fr({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Xe({match:s,currentTimestamp:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),i=Number(s?.meta?.home_sets??0),n=Number(s?.meta?.away_sets??0),c=i>0||n>0,o=a||c,r=s?.status==="ongoing"||s?.status==="paused",m=s?.status&&s.status!=="scheduled",v=Number(s?.home_score??0),y=Number(s?.away_score??0),k=a?Number(s?.meta?.home_points_set??0):0,E=a?Number(s?.meta?.away_points_set??0):0,A=a&&(r||k>0||E>0),$=r?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(X,{to:`/match/${s.id}`,className:`block bg-white border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden ${$}`,children:[e.jsx(Fr,{status:s.status}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.sport?.name}),s.group_name?` • Grupo ${s.group_name}`:"",s.stage?` • ${Tr(s.stage)}`:"",s.round?` • J${s.round}`:"",r&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",Pr(s,t)]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[11px] font-medium ${s.status==="ongoing"?"bg-green-100 text-green-700":s.status==="paused"?"bg-yellow-100 text-yellow-700":s.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:Cr[s.status]||s.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(se,{team:s.home||{name:"A definir"},size:24}),e.jsx("span",{className:"font-medium truncate text-sm",children:s.home?.name||"A definir"})]}),e.jsxs("div",{className:"text-center px-3",children:[o&&e.jsx("div",{className:"text-xs font-semibold tabular-nums mb-1",children:e.jsxs("span",{className:`${m?"":"text-gray-400"}`,children:["Sets: ",i," x ",n]})}),m?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-lg font-bold tabular-nums",children:[A?k:v," x ",A?E:y]})}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx("span",{className:"font-medium truncate text-sm text-right",children:s.away?.name||"A definir"}),e.jsx(se,{team:s.away||{name:"A definir"},size:24})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center justify-between",children:[e.jsx("span",{children:s.starts_at?Er(s.starts_at):"Data a definir"}),s.venue&&e.jsx("span",{children:s.venue})]})]})}function As(){const{id:s}=zs(),[t,a]=l.useState(null),[i,n]=l.useState([]),[c,o]=l.useState([]),[r,m]=l.useState(!0),[v,y]=l.useState(Date.now()),k=l.useRef(null),E=l.useRef(null),A=async()=>{m(!0);try{const{data:S,error:P}=await x.from("teams").select("id, name, logo_url, color").eq("id",s).maybeSingle();if(P){console.error("Erro ao carregar time:",P);return}if(S){const D={...S,logo_url:(()=>{const b=Ke(S.logo_url);return b?`${b}${b.includes("?")?"&":"?"}v=1`:null})()};a(D)}const{data:F,error:V}=await x.from("players").select("id, name, number").eq("team_id",s).order("number",{ascending:!0,nullsFirst:!0}).order("name");!V&&F&&n(F);const{data:L,error:M}=await x.from("matches").select(`
          id, stage, round, group_name, starts_at, venue, status, 
          home_score, away_score, meta, updated_at,
          sport:sport_id ( id, name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `).or(`home_team_id.eq.${s},away_team_id.eq.${s}`).order("starts_at",{ascending:!1});if(!M&&L){const D=L.map(b=>{const d=b.home&&typeof b.home=="object"?{...b.home,logo_url:(()=>{const N=Ke(b.home.logo_url);return N?`${N}${N.includes("?")?"&":"?"}v=1`:null})()}:b.home,f=b.away&&typeof b.away=="object"?{...b.away,logo_url:(()=>{const N=Ke(b.away.logo_url);return N?`${N}${N.includes("?")?"&":"?"}v=1`:null})()}:b.away;return{...b,home:d,away:f}});o(D)}}finally{m(!1)}};l.useEffect(()=>{A(),E.current=setInterval(()=>{y(Date.now())},1e3),k.current&&(x.removeChannel(k.current),k.current=null);const S=x.channel(`team-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>A()).on("postgres_changes",{event:"*",schema:"public",table:"teams",filter:`id=eq.${s}`},()=>A()).on("postgres_changes",{event:"*",schema:"public",table:"players",filter:`team_id=eq.${s}`},()=>A()).subscribe();return k.current=S,()=>{E.current&&clearInterval(E.current),k.current&&x.removeChannel(k.current),k.current=null}},[s]);const $=l.useMemo(()=>{const S={ongoing:[],paused:[],scheduled:[],finished:[]};return c.forEach(P=>{S[P.status]?S[P.status].push(P):S.finished.push(P)}),S},[c]);return r?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"})]})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(se,{team:t,size:64}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.name}),e.jsxs("p",{className:"text-gray-500",children:[c.length," partida",c.length!==1?"s":""," registrada",c.length!==1?"s":""]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Convocação"}),i.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"space-y-2",children:i.map(S=>e.jsxs("li",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"font-medium",children:S.name}),e.jsx("span",{className:"text-gray-500 text-sm tabular-nums",children:S.number?`#${S.number}`:"—"})]},S.id))})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Estatísticas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:$.ongoing.length+$.paused.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ao vivo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:$.scheduled.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Agendadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:$.finished.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Finalizadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Jogadores"})]})]})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Partidas"}),c.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma partida registrada."}):e.jsxs("div",{className:"space-y-4",children:[($.ongoing.length>0||$.paused.length>0)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"🔴 Ao vivo"}),e.jsx("div",{className:"space-y-2",children:[...$.ongoing,...$.paused].map(S=>e.jsx(Xe,{match:S,currentTimestamp:v},S.id))})]}),$.scheduled.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"📅 Próximas partidas"}),e.jsx("div",{className:"space-y-2",children:$.scheduled.map(S=>e.jsx(Xe,{match:S,currentTimestamp:v},S.id))})]}),$.finished.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"✅ Finalizadas"}),e.jsx("div",{className:"space-y-2",children:$.finished.slice(0,5).map(S=>e.jsx(Xe,{match:S,currentTimestamp:v},S.id))}),$.finished.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["... e mais ",$.finished.length-5," partida",$.finished.length-5!==1?"s":""]})]})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-600",children:"Time não encontrado"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"O time solicitado não existe ou foi removido."})]})}const pt={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Rr={r32:"Pré-oitavas",grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Mr="team-logos";function xt(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function qr(s){return typeof s=="string"&&!xt(s)&&s.trim()!==""}function Oe(s){if(!s)return null;if(xt(s))return s;if(qr(s)){const{data:t}=x.storage.from(Mr).getPublicUrl(s);return t?.publicUrl||null}return null}const Ir="America/Sao_Paulo";function ve(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Ir,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function ft(s){return s?Rr[s]||s[0]?.toUpperCase()+s.slice(1):""}function Gr({order_idx:s,stage:t,group_name:a}){const i=[];return s&&i.push(`Jogo ${s}`),a&&i.push(`Grupo ${a}`),i.join(" • ")}function yt(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=s.starts_at?new Date(s.starts_at):null,i=s.status==="paused"?new Date(s.updated_at||Date.now()):new Date(t||Date.now());if(!a)return"0:00";const n=i-a;if(n<0)return"0:00";const c=Math.floor(n/1e3),o=Math.floor(c/60),r=c%60;return`${o}:${r.toString().padStart(2,"0")}`}function Or({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-2xl`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Lr({status:s,meta:t,starts_at:a,updated_at:i,currentTimestamp:n}){const c="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] font-semibold tracking-wide border",o=s==="ongoing"?"bg-green-50 text-green-700 border-green-200":s==="paused"?"bg-amber-50 text-amber-700 border-amber-200":s==="finished"?"bg-gray-100 text-gray-700 border-gray-200":"bg-blue-50 text-blue-700 border-blue-200",r=t?.clock||t?.time||t?.minute,m=s==="ongoing"||s==="paused",v=s==="scheduled"?a?` • ${ve(a)}`:"":s==="finished"?i?` • ${ve(i)}`:"":r?` • ${r}`:"";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`${c} ${o}`,children:[pt[s]||s,v?e.jsx("span",{children:v}):null]}),m&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",yt({status:s,starts_at:a,updated_at:i},n)]})]})}function Dr({stage:s}){if(!s)return null;const t=ft(s);return e.jsx("span",{className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-semibold tracking-wide text-gray-700",children:t})}function ks({team:s,align:t="left",badgeSize:a=48}){const i=!!s?.id,n=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:s||{name:"A definir"},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${i?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:s?.name||"A definir",children:s?.name||"A definir"}),t==="right"?e.jsx(se,{team:s||{name:"A definir"},size:a}):null]});return i?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-3 hover:underline ${t==="right"?"justify-end":""}`,onClick:c=>c.stopPropagation(),title:s?.name,children:n}):e.jsx("div",{className:`min-w-0 flex items-center gap-3 ${t==="right"?"justify-end":""}`,children:n})}function Es({title:s,players:t}){return e.jsxs("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:s}),t.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"text-sm divide-y",children:t.map(a=>e.jsxs("li",{className:"flex items-center justify-between py-1.5",children:[e.jsx("span",{className:"truncate",children:a.name}),e.jsx("span",{className:"inline-block w-8 text-right tabular-nums text-gray-500",children:a.number??""})]},a.id))})]})}function Ts(){const{id:s}=zs(),[t,a]=l.useState(null),[i,n]=l.useState([]),[c,o]=l.useState([]),[r,m]=l.useState(!0),[v,y]=l.useState(null),[k,E]=l.useState(Date.now()),A=l.useRef(null),$=l.useRef(null),S=l.useRef(!1),P=l.useMemo(()=>(t?.sport?.name||"").toLowerCase().includes("volei"),[t?.sport?.name]),F=l.useCallback(async()=>{if(!(!s||S.current)){S.current=!0,m(!0),y(null);try{const{data:j,error:G}=await x.from("match_detail_view").select(`
          id, sport_id, sport_name, stage, round, group_name, starts_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score, order_idx, created_at, updated_at
        `).eq("id",s).maybeSingle();let w=null;if(!G&&j){w={id:j.id,sport:{id:j.sport_id,name:j.sport_name},stage:j.stage,round:j.round,group_name:j.group_name,starts_at:j.starts_at,updated_at:j.updated_at,venue:j.venue,status:j.status,order_idx:j.order_idx,meta:null,home_score:j.home_score,away_score:j.away_score,home:{id:j.home_team_id,name:j.home_team_name,color:j.home_team_color,logo_url:(()=>{const O=Oe(j.home_team_logo);return O?`${O}${O.includes("?")?"&":"?"}v=1`:null})()},away:{id:j.away_team_id,name:j.away_team_name,color:j.away_team_color,logo_url:(()=>{const O=Oe(j.away_team_logo);return O?`${O}${O.includes("?")?"&":"?"}v=1`:null})()}};const{data:R}=await x.from("matches").select("meta").eq("id",s).maybeSingle();R?.meta&&(w.meta=R.meta)}else{const{data:R,error:O}=await x.from("matches").select(`
            id,
            sport:sport_id ( id, name ),
            stage, round, group_name, starts_at, updated_at, venue, status, meta, order_idx,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("id",s).maybeSingle();if(O)throw O;R&&(w={...R,home:R.home&&typeof R.home=="object"?{...R.home,logo_url:(()=>{const J=Oe(R.home.logo_url);return J?`${J}${J.includes("?")?"&":"?"}v=1`:null})()}:R.home,away:R.away&&typeof R.away=="object"?{...R.away,logo_url:(()=>{const J=Oe(R.away.logo_url);return J?`${J}${J.includes("?")?"&":"?"}v=1`:null})()}:R.away})}if(!w)throw new Error("Partida não encontrada");a(w);const I=[];w?.home?.id?I.push(x.from("players").select("id, name, number").eq("team_id",w.home.id).order("number",{ascending:!0,nullsFirst:!0}).order("name")):I.push(Promise.resolve({data:[]})),w?.away?.id?I.push(x.from("players").select("id, name, number").eq("team_id",w.away.id).order("number",{ascending:!0,nullsFirst:!0}).order("name")):I.push(Promise.resolve({data:[]}));const[H,_]=await Promise.all(I);n(H.data||[]),o(_.data||[])}catch(j){console.error("Error loading match:",j),y(j.message||"Erro ao carregar partida")}finally{m(!1),S.current=!1}}},[s]);l.useEffect(()=>{if(!s)return;F(),$.current&&clearInterval($.current),$.current=setInterval(()=>{E(Date.now())},1e3),A.current&&(x.removeChannel(A.current),A.current=null);const j=x.channel(`match-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`id=eq.${s}`},G=>{const w=G?.new;w&&a(I=>I&&{...I,status:w.status??I.status,starts_at:w.starts_at??I.starts_at,updated_at:w.updated_at??I.updated_at,home_score:typeof w.home_score=="number"?w.home_score:I.home_score,away_score:typeof w.away_score=="number"?w.away_score:I.away_score,meta:w.meta??I.meta})}).on("postgres_changes",{event:"*",schema:"public",table:"match_events",filter:`match_id=eq.${s}`},()=>F()).subscribe();return A.current=j,()=>{$.current&&(clearInterval($.current),$.current=null),A.current&&(x.removeChannel(A.current),A.current=null)}},[s,F]);const V=l.useMemo(()=>t?Gr(t):"",[t]),L=t?.home,M=t?.away,D=Number(t?.meta?.home_sets??0),b=Number(t?.meta?.away_sets??0),d=D>0||b>0,f=P||d,N=t?.status==="ongoing"||t?.status==="paused",C=t?.status&&t.status!=="scheduled",q=Number(t?.home_score??0),g=Number(t?.away_score??0),h=P?Number(t?.meta?.home_points_set??0):0,T=P?Number(t?.meta?.away_points_set??0):0,u=P&&(N||h>0||T>0);return v?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚠️"}),e.jsx("p",{className:"text-lg text-red-600 mb-2",children:"Erro ao carregar partida"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:v}),e.jsx("button",{onClick:()=>{y(null),F()},className:"bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700",children:"Tentar novamente"})]}):r||!t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-44 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-36 w-full bg-gray-100 rounded-2xl animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-56 bg-gray-100 rounded-2xl animate-pulse"}),e.jsx("div",{className:"h-56 bg-gray-100 rounded-2xl animate-pulse"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(Lr,{status:t.status,meta:t.meta,starts_at:t.starts_at,updated_at:t.updated_at,currentTimestamp:k}),t.stage?e.jsx(Dr,{stage:t.stage}):null,V&&e.jsx("div",{className:"text-xs text-gray-600","aria-label":"Detalhes",children:V})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.starts_at?ve(t.starts_at):null,t.venue?e.jsx("span",{className:"ml-2",children:t.venue}):null]})]}),e.jsxs("div",{className:`relative overflow-hidden rounded-2xl border p-4 sm:p-5 shadow-sm ${N?t.status==="ongoing"?"border-blue-200":"border-amber-200":"border-gray-200"}`,children:[e.jsx(Or,{status:t.status}),e.jsx("div",{className:"pointer-events-none absolute -top-24 -right-24 h-64 w-64 rounded-full bg-gradient-to-br from-blue-50 to-indigo-50 blur-3xl"}),e.jsx("div",{className:"pointer-events-none absolute -bottom-24 -left-24 h-64 w-64 rounded-full bg-gradient-to-tr from-pink-50 to-rose-50 blur-3xl"}),e.jsxs("div",{className:"relative grid grid-cols-1 items-center gap-4 sm:grid-cols-3",children:[e.jsx("div",{className:"min-w-0",children:e.jsx(ks,{team:L,badgeSize:56})}),e.jsxs("div",{className:"text-center",children:[f?e.jsx("div",{className:"mb-1 flex items-center justify-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center rounded-full border border-gray-200 bg-white px-2 py-0.5 text-[11px] font-semibold text-gray-700",children:["Sets ",e.jsx("span",{className:"ml-1 tabular-nums",children:D}),e.jsx("span",{className:"mx-1 text-gray-400",children:"x"}),e.jsx("span",{className:"tabular-nums",children:b})]})}):null,C?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-4xl font-extrabold tabular-nums leading-none sm:text-5xl",children:[u?h:q," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",u?T:g]})}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"}),e.jsxs("div",{className:"mt-1 text-[11px] text-gray-500",children:[pt[t.status]||t.status,N?e.jsxs("span",{className:"ml-2",children:["🕐 ",yt(t,k)]}):null,t.meta?.clock?e.jsx("span",{className:"ml-2",children:t.meta.clock}):null]})]}),e.jsx("div",{className:"min-w-0 sm:text-right",children:e.jsx(ks,{team:M,align:"right",badgeSize:56})})]}),P?e.jsxs("div",{className:"relative mt-3 text-[11px] text-gray-500",children:["Vôlei: partidas em ",e.jsx("strong",{children:"um set de 15 pontos"})," (2 pontos de vantagem para vencer)."]}):null]}),e.jsxs("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("div",{className:"text-[11px] font-semibold text-gray-500 mb-2",children:"Detalhes"}),e.jsxs("ul",{className:"text-sm grid sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Modalidade:"})," ",e.jsx("span",{className:"font-medium",children:t?.sport?.name||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Fase:"})," ",e.jsx("span",{className:"font-medium",children:ft(t.stage)||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Grupo:"})," ",e.jsx("span",{className:"font-medium",children:t.group_name||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Jogo nº:"})," ",e.jsx("span",{className:"font-medium",children:t.order_idx??"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Início:"})," ",e.jsx("span",{className:"font-medium",children:t.starts_at?ve(t.starts_at):"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Local:"})," ",e.jsx("span",{className:"font-medium",children:t.venue||"—"})]}),t.updated_at&&e.jsxs("li",{className:"sm:col-span-2",children:[e.jsx("span",{className:"text-gray-500",children:"Última atualização:"})," ",e.jsx("span",{className:"font-medium",children:ve(t.updated_at)})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(Es,{title:`Convocação — ${L?.name||"A definir"}`,players:i}),e.jsx(Es,{title:`Convocação — ${M?.name||"A definir"}`,players:c})]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.status==="finished"&&t.updated_at?`Encerrado em ${ve(t.updated_at)}`:null}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function Ps(){const s=me(),t=ds(),{user:a,updatePassword:i}=ms(),[n,c]=l.useState(""),[o,r]=l.useState(""),[m,v]=l.useState(!1),[y,k]=l.useState(null),[E,A]=l.useState(null),$=l.useMemo(()=>{const F=new URLSearchParams(t.search).get("redirect");return F&&F.startsWith("/")?F:"/"},[t.search]);l.useEffect(()=>{console.log("SetPassword mounted, user:",a?.id)},[a]);const S=async P=>{if(P.preventDefault(),console.log("🔥 FORM SUBMITTED - START"),!m){if(v(!0),A(null),k(null),!n||n.length<8){A("A senha deve ter pelo menos 8 caracteres."),v(!1);return}if(n!==o){A("As senhas não coincidem."),v(!1);return}try{console.log("🚀 Starting password update...");const{error:F}=await i(n);if(F){console.error("Password update error:",F),A(`Erro ao atualizar senha: ${F.message}`),v(!1);return}console.log("✅ Password updated successfully"),k("Senha definida com sucesso!"),setTimeout(()=>{console.log("🎯 Navigating after password set"),v(!1),s($,{replace:!0})},1e3)}catch(F){console.error("Unexpected error:",F),A(`Erro inesperado: ${F.message}`),v(!1)}}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full mx-auto bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Bem-vindo!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Defina sua senha para continuar"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Email: ",a?.email]})]}),y&&e.jsx("p",{className:"mb-3 text-green-700 text-center",children:y}),E&&e.jsx("p",{className:"mb-3 text-red-700 text-center",children:E}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nova senha"}),e.jsx("input",{type:"password",placeholder:"Mínimo 8 caracteres",className:"w-full p-3 border border-gray-300 rounded-md",value:n,onChange:P=>c(P.target.value),required:!0,disabled:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirme a senha"}),e.jsx("input",{type:"password",placeholder:"Digite a senha novamente",className:"w-full p-3 border border-gray-300 rounded-md",value:o,onChange:P=>r(P.target.value),required:!0,disabled:m})]}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-blue-600 text-white py-3 rounded-md font-medium hover:bg-blue-700 disabled:opacity-50",children:m?"Configurando perfil...":"Definir senha"})]})]})})}function Br(){const s=me(),t=a=>{s(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Painel do Administrador"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecione uma área para gerenciar."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("button",{onClick:()=>t("/admin/elencos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"👥"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Elencos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Criar time, editar elenco (jogadores) e logo."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]}),e.jsxs("button",{onClick:()=>t("/admin/campeonatos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"🏆"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Campeonatos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Configurar modalidades, grupos e fases."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]}),e.jsxs("button",{onClick:()=>t("/admin/partidas"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"⏱️"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Partidas"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Iniciar/encerrar jogos e atualizar placar em tempo real."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]})]})]})}function Vr(){const s=me(),[t]=St(),a=t.get("redirect")||"/",i=t.get("reason"),[n,c]=l.useState(""),[o,r]=l.useState(""),[m,v]=l.useState(!1),[y,k]=l.useState(null);l.useEffect(()=>{i==="forbidden"&&k("Faça login para acessar a página solicitada.")},[i]);async function E(A){if(A.preventDefault(),!m){v(!0),k(null);try{const{error:$}=await x.auth.signInWithPassword({email:n.trim(),password:o});if($){k("Email ou senha incorretos."),v(!1);return}s(a,{replace:!0})}catch($){console.error("Login error:",$),k("Erro inesperado durante o login."),v(!1)}}}return e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Login"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Email"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full p-2 border rounded",value:n,onChange:A=>c(A.target.value),autoComplete:"email",required:!0})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Senha"}),e.jsx("input",{type:"password",placeholder:"Senha",className:"w-full p-2 border rounded",value:o,onChange:A=>r(A.target.value),autoComplete:"current-password",required:!0})]}),y&&e.jsx("p",{className:"text-red-600 text-sm",children:y}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-blue-600 text-white py-2 rounded disabled:opacity-50 hover:bg-blue-700 transition-colors",children:m?"Entrando...":"Entrar"})]})]})}const Ee="team-logos",Fs=5,Ze=["image/png","image/jpeg","image/webp"],zr=["oitavas","quartas","semi","final","3lugar"];function Ur(){const[s,t]=l.useState([]),[a,i]=l.useState({}),[n,c]=l.useState([]),[o,r]=l.useState(!1),[m,v]=l.useState({name:"",sport_id:""}),[y,k]=l.useState(null),[E,A]=l.useState([]),[$,S]=l.useState(0),[P,F]=l.useState([]),[V,L]=l.useState({}),[M,D]=l.useState({}),b=async()=>{const{data:_}=await x.from("sports").select("id,name").order("name");t(_||[]);const R={};(_||[]).forEach(O=>R[O.id]=O.name),i(R),!m.sport_id&&_?.length&&v(O=>({...O,sport_id:_[0].id}))},d=async()=>{let _=x.from("teams").select("id,name,group_name,sport_id,logo_url").order("name");P.length>0&&(_=_.in("sport_id",P));const{data:R}=await _;c(R||[]);const O=(R||[]).map(J=>J.id);O.length?await Promise.all([f(O),N(R)]):(L({}),D({}))},f=async _=>{if(!_?.length)return;const{data:R}=await x.from("players").select("id, team_id").in("team_id",_),O={};(R||[]).forEach(J=>{O[J.team_id]=(O[J.team_id]||0)+1}),_.forEach(J=>{J in O||(O[J]=0)}),L(O)},N=async _=>{const R=Array.from(new Set((_||[]).map(W=>W.sport_id)));if(R.length===0){D({});return}const{data:O}=await x.from("matches").select("sport_id, stage, home_team_id, away_team_id").in("sport_id",R).in("stage",zr),J={};(O||[]).forEach(W=>{W.home_team_id&&W.away_team_id&&(J[W.sport_id]=!0)}),R.forEach(W=>{W in J||(J[W]=!1)}),D(J)},C=async _=>{const{data:R}=await x.from("players").select("id,name,number").eq("team_id",_).order("name");A(R||[]),L(O=>({...O,[_]:(R||[]).length}))};l.useEffect(()=>{b()},[]),l.useEffect(()=>{d()},[P]);const q=_=>{const{data:R}=x.storage.from(Ee).getPublicUrl(_);return R?.publicUrl||""},g=_=>{if(!_)return null;const R=_.indexOf(`/storage/v1/object/public/${Ee}/`);return R===-1?null:_.substring(R+`/storage/v1/object/public/${Ee}/`.length)},h=async _=>{if(_.preventDefault(),!m.name||!m.sport_id)return;r(!0);const{error:R}=await x.from("teams").insert({name:m.name.trim(),sport_id:m.sport_id});r(!1),R?alert("Erro ao criar time: "+R.message):(v({name:"",sport_id:m.sport_id}),d())},T=async _=>{if(confirm(`⚠️ Atenção!

Se você remover o time "${_.name}", TODO o campeonato da modalidade será resetado e o histórico de jogos será apagado.

Deseja realmente continuar?`)){r(!0);try{const O=g(_.logo_url);O&&await x.storage.from(Ee).remove([O]).catch(()=>{});const{error:J}=await x.rpc("reset_sport",{p_sport_id:_.sport_id});if(J)throw J;const{error:W}=await x.from("teams").delete().eq("id",_.id);if(W)throw W;y?.id===_.id&&(k(null),A([])),await d(),alert(`Time "${_.name}" removido.

O campeonato da modalidade foi resetado. Configure novamente os grupos e partidas antes de prosseguir.`)}catch(O){alert("Erro ao remover: "+O.message)}finally{r(!1)}}},u=async _=>{if(!y?.id||!_)return;r(!0);const{error:R}=await x.from("players").insert({team_id:y.id,name:_.trim()});r(!1),R?alert("Erro ao adicionar jogador: "+R.message):C(y.id)},j=async _=>{if(!y?.id)return;r(!0);const{error:R}=await x.from("players").delete().eq("id",_);r(!1),R?alert("Erro ao remover jogador: "+R.message):C(y.id)},G=async(_,R)=>{if(!(!_?.id||!R)){if(!Ze.includes(R.type)){alert("Formato inválido. Use PNG, JPG ou WEBP.");return}if(R.size>Fs*1024*1024){alert(`Arquivo grande demais. Máximo ${Fs} MB.`);return}r(!0);try{const O=R.type==="image/png"?"png":R.type==="image/webp"?"webp":"jpg",J=`teams/${_.id}.${O}`,{error:W}=await x.storage.from(Ee).upload(J,R,{upsert:!0,cacheControl:"3600",contentType:R.type});if(W)throw W;const ne=q(J),{error:he}=await x.from("teams").update({logo_url:ne}).eq("id",_.id);if(he)throw he;if(await d(),y?.id===_.id){const ie=(await x.from("teams").select("id,name,logo_url").eq("id",_.id).maybeSingle()).data;ie&&k(ze=>({...ze,...ie}))}S(ie=>ie+1)}catch(O){alert("Erro ao enviar logo: "+O.message)}finally{r(!1)}}},w=P.length===0||P.length===s.length,I=()=>{F(_=>w?[]:s.map(R=>R.id))},H=e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{onClick:I,className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${w?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:"Todos"}),s.map(_=>{const R=P.length===0?!0:P.includes(_.id);return e.jsx("button",{onClick:()=>F(O=>O.length===0?[_.id]:O.includes(_.id)?O.filter(J=>J!==_.id):[...O,_.id]),className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${R?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:_.name},_.id)})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:"Elencos"}),H,y&&e.jsxs("section",{className:"rounded-lg border bg-white shadow-sm",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Rs,{src:y.logo_url,alt:y.name,size:40,version:$}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:y.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a[y.sport_id]," • ",E.length," jogadores"]})]})]}),e.jsx("button",{onClick:()=>{k(null),A([])},className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",title:"Fechar",children:"✕"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 cursor-pointer text-sm font-medium transition-colors",children:["📷 Atualizar Logo",e.jsx("input",{type:"file",accept:Ze.join(","),className:"hidden",onChange:_=>{const R=_.target.files?.[0];R&&G(y,R),_.target.value=""},disabled:o})]})}),e.jsx(Jr,{disabled:o,onAdd:u}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Jogadores"}),E.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:"Nenhum jogador no elenco"}),e.jsx("p",{className:"text-xs mt-1",children:"Adicione jogadores usando o formulário acima"})]}):e.jsx("div",{className:"grid gap-2",children:E.map(_=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-gray-50",children:[e.jsx("span",{className:"font-medium",children:_.name}),e.jsx("button",{className:"px-3 py-1 text-sm rounded-lg border border-red-300 text-red-600 hover:bg-red-50 transition-colors",onClick:()=>j(_.id),disabled:o,children:"Remover"})]},_.id))})]})]})]}),e.jsxs("section",{className:"rounded-lg border bg-white shadow-sm",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsx("h3",{className:"font-semibold text-lg",children:"Novo Time"})}),e.jsxs("form",{onSubmit:h,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome do time"}),e.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:m.name,onChange:_=>v(R=>({...R,name:_.target.value})),placeholder:"Ex.: A1 — Águias",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Esporte"}),e.jsx("select",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:m.sport_id,onChange:_=>v(R=>({...R,sport_id:_.target.value})),children:s.map(_=>e.jsx("option",{value:_.id,children:_.name},_.id))})]})]}),e.jsx("button",{type:"submit",disabled:o,className:"w-full bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:o?"Salvando…":"Criar Time"})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Times Cadastrados (",n.length,")"]}),n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 border rounded-lg",children:[e.jsx("p",{className:"text-sm",children:"Nenhum time cadastrado"}),e.jsx("p",{className:"text-xs mt-1",children:"Crie seu primeiro time usando o formulário acima"})]}):e.jsx("div",{className:"grid gap-3",children:n.map(_=>{const R=a[_.sport_id]||"—",O=V[_.id]??0,J=O>0,W=!!M[_.sport_id],ne=_.group_name?`Grupo ${_.group_name}`:W?"Sem grupo (não aplicável)":"Sem grupo";return e.jsx("div",{className:"border rounded-lg bg-white shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(Rs,{src:_.logo_url,alt:_.name,size:48,version:$}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-lg truncate",children:_.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:R}),e.jsxs("span",{className:"text-sm text-gray-600",children:["• ",ne]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[W&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-800 text-xs font-medium",children:"Chaveamento configurado"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Elenco: "," ",e.jsxs("span",{className:J?"text-gray-900 font-medium":"text-red-600 font-medium",children:[O," ",O===1?"jogador":"jogadores"]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("label",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 cursor-pointer text-sm font-medium transition-colors",children:["📷 Logo",e.jsx("input",{type:"file",accept:Ze.join(","),className:"hidden",onChange:he=>{const ie=he.target.files?.[0];ie&&G(_,ie),he.target.value=""},disabled:o})]}),e.jsx("button",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50 font-medium transition-colors text-sm",onClick:()=>{k(_),C(_.id),window.scrollTo({top:0,behavior:"smooth"})},children:"👥 Elenco"}),e.jsx("button",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-red-300 text-red-600 hover:bg-red-50 font-medium transition-colors text-sm",onClick:()=>T(_),disabled:o,children:"🗑️ Remover"})]})]})},_.id)})})]})]})}function Jr({disabled:s,onAdd:t}){const[a,i]=l.useState("");return e.jsxs("form",{onSubmit:n=>{n.preventDefault(),t(a),i("")},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adicionar Jogador"}),e.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nome do jogador",value:a,onChange:n=>i(n.target.value),required:!0})]}),e.jsx("button",{type:"submit",disabled:s,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?"Adicionando...":"Adicionar Jogador"})]})}function Hr(s){if(!s)return"?";const t=s.trim().split(" ");return t.length===1?t[0][0]?.toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}function Kr(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function Rs({src:s,alt:t,size:a=32,version:i=0}){const[n,c]=l.useState(!1),o=l.useMemo(()=>{if(!s)return null;const r=s.includes("?")?"&":"?";return`${s}${r}v=${i}`},[s,i]);return e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 bg-white flex items-center justify-center flex-shrink-0",style:{width:a,height:a},children:[o?e.jsx("img",{src:o,alt:t||"logo",className:`w-full h-full object-cover ${n?"opacity-100":"opacity-0"} transition-opacity duration-200`,loading:"lazy",onLoad:()=>c(!0),onError:()=>c(!1)}):null,!o||!n?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white font-bold uppercase",style:{backgroundColor:Kr(t||"T"),fontSize:a*.35},children:Hr(t)}):null]})}const Ms={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},qs={ongoing:1,paused:2,scheduled:3,finished:4},Xr="team-logos",bt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Zr=s=>typeof s=="string"&&!bt(s)&&s.trim()!=="",Is=s=>{if(!s)return null;if(bt(s))return s;if(Zr(s)){const{data:t}=x.storage.from(Xr).getPublicUrl(s);return t?.publicUrl||null}return null},Le=(s="")=>s.toString().trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase();function Qr(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=s.starts_at?new Date(s.starts_at):new Date,n=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(!Number.isFinite(n)||n<0)return"0:00";const c=Math.floor(n/1e3),o=Math.floor(c/60),r=c%60;return`${o}:${r.toString().padStart(2,"0")}`}function Wr({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}const _e=s=>Number.isFinite(Number(s?.order_idx))?Number(s.order_idx):Number.isFinite(Number(s?.round))?Number(s.round):Number(s?.id??Number.MAX_SAFE_INTEGER),Yr=s=>s.status==="scheduled"&&!!(s.home?.id&&s.away?.id);function en(){const[s,t]=l.useState([]),[a,i]=l.useState([]),[n,c]=l.useState(null),[o,r]=l.useState(null),[m,v]=l.useState(!0),[y,k]=l.useState({}),[E,A]=l.useState(null),[$,S]=l.useState(null),[P,F]=l.useState(Date.now()),[V,L]=l.useState(typeof navigator<"u"?navigator.onLine:!0),[M,D]=l.useState(!1),[b,d]=l.useState(null),f=l.useRef(null),N=l.useRef(!0),C=l.useRef(null);l.useEffect(()=>{if(!$)return;const p=setTimeout(()=>S(null),8e3);return()=>clearTimeout(p)},[$]),l.useEffect(()=>{const p=()=>L(!0),z=()=>L(!1);return window.addEventListener("online",p),window.addEventListener("offline",z),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",z)}},[]);const q=(p,z)=>k(B=>({...B,[p]:z})),g=async()=>{const{data:p,error:z}=await x.auth.getSession();return z?(console.error("getSession error:",z),S(z.message||"Falha ao obter sessão de usuário."),null):p?.session||null},h=async()=>{try{await x.auth.getUser();const{data:p,error:z}=await x.rpc("is_admin");if(z)throw z;A(!!p)}catch(p){console.error("is_admin() error:",p),A(!1)}},T=async()=>{const{data:p,error:z}=await x.from("sports").select("name").order("name");if(z){console.error("loadSports error:",z);return}const B=Array.from(new Set((p||[]).map(U=>U.name).filter(Boolean)));i(B.map(U=>({key:Le(U),name:U})))},u=async({showSkeleton:p=!1}={})=>{if(N.current){p&&v(!0);try{let z=x.from("matches").select(`
          id, stage, round, group_name, order_idx, starts_at, venue, created_at, updated_at,
          status, home_score, away_score, meta,
          sport_id,
          home_team_id, away_team_id,
          sport:sport_id ( name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `);o&&(z=z.eq("status",o)),z=z.or(["group_name.not.is.null","stage.eq.r32","and(home_team_id.not.is.null,away_team_id.not.is.null)"].join(","));const{data:B,error:U}=await z;if(U)console.error("loadMatches error:",U),N.current&&S(U.message||"Falha ao carregar partidas.");else{let Z=(B||[]).map(K=>{const Q=K.home&&typeof K.home=="object"?{...K.home,logo_url:(()=>{const oe=Is(K.home.logo_url);return oe?`${oe}${oe.includes("?")?"&":"?"}v=1`:null})()}:K.home,le=K.away&&typeof K.away=="object"?{...K.away,logo_url:(()=>{const oe=Is(K.away.logo_url);return oe?`${oe}${oe.includes("?")?"&":"?"}v=1`:null})()}:K.away,pe=K?.sport?.name||"";return{...K,home:Q,away:le,_sportKey:Le(pe)}});n&&(Z=Z.filter(K=>K._sportKey===n));const Y=Z.sort((K,Q)=>{const le=qs[K.status]||999,pe=qs[Q.status]||999;return le!==pe?le-pe:_e(K)-_e(Q)});N.current&&t(Y)}}finally{N.current&&p&&v(!1)}}};l.useEffect(()=>{N.current=!0,(async()=>{await g(),await h(),await T(),await u({showSkeleton:!0})})(),C.current=setInterval(()=>{N.current&&F(Date.now())},1e3);const{data:z}=x.auth.onAuthStateChange(async(B,U)=>{N.current&&(A(null),await h(),U?(await T(),await u({showSkeleton:!0})):t([]))});return()=>{N.current=!1,C.current&&clearInterval(C.current),z?.subscription?.unsubscribe?.(),f.current&&(x.removeChannel(f.current),f.current=null)}},[]),l.useEffect(()=>{if(!N.current)return;u({showSkeleton:!1}),f.current&&(x.removeChannel(f.current),f.current=null);const p=x.channel("admin-matches").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>{setTimeout(()=>{N.current&&u({showSkeleton:!1})},200)}).subscribe();return f.current=p,()=>{f.current&&(x.removeChannel(f.current),f.current=null)}},[n,o]);const j=l.useMemo(()=>{const p=new Map;for(const B of s){const U=B?.sport_id?String(B.sport_id):"unknown";p.has(U)||p.set(U,[]),p.get(U).push(B)}const z=new Set;for(const[B,U]of p.entries()){if(B==="unknown"||U.some(K=>K.status==="ongoing"||K.status==="paused"))continue;const Y=U.filter(Yr);Y.length&&(Y.sort((K,Q)=>_e(K)-_e(Q)),z.add(Y[0].id))}return z},[s]),G=async(p,z)=>{q(p,!0),S(null);const B=s;t(U=>U.map(Z=>Z.id===p?{...Z,...z}:Z));try{const{error:U}=await x.from("matches").update(z).eq("id",p);if(U)throw new Error(`Falha ao atualizar: ${U.message}`);return setTimeout(()=>{N.current&&u({showSkeleton:!1})},600),!0}catch(U){return t(B),S(U.message||"Erro ao atualizar partida."),!1}finally{q(p,!1)}},w=async(p,z,B)=>{if(p.status==="scheduled")return;const Z=Le(p?.sport?.name||"").includes("volei"),Y=p.meta||{},K=Z?`${z}_points_set`:`${z}_score`;let Q=Math.max(0,Number((Z?Y[K]:p[K])||0));B==="inc"&&(Q+=1),B==="dec"&&(Q=Math.max(0,Q-1)),B==="reset"&&(Q=0),Z?await G(p.id,{meta:{...Y,[K]:Q}}):await G(p.id,{[K]:Q})},I=(p,z)=>Math.max(0,Number(p?.meta?.[`${z}_points_set`]||0)),H=(p,z)=>{const B=p.meta||{};return Math.max(0,Number(B[z==="home"?"home_sets":"away_sets"]||0))},_=p=>{const z=Number(p?.meta?.rules?.points_to_win_set??15),B=Number(p?.meta?.rules?.win_by??2),U=I(p,"home"),Z=I(p,"away"),Y=Math.max(U,Z),K=Math.abs(U-Z);return Y>=z&&K>=B},R=async(p,{force:z=!1}={})=>{if(p.status==="scheduled")return;const B=p.meta||{},U=I(p,"home"),Z=I(p,"away"),Y=Array.isArray(B.sets)?B.sets:[];if(!z&&!_(p)){S("Para finalizar o set: mínimo 15 pontos e 2 de vantagem (ajustável em meta.rules). Clique novamente para forçar.");return}const K=U>Z?!0:Z>U?!1:null,Q={...B,sets:[...Y,{h:U,a:Z,at:new Date().toISOString()}],home_sets:H(p,"home")+(K===!0?1:0),away_sets:H(p,"away")+(K===!1?1:0),home_points_set:0,away_points_set:0};await G(p.id,{meta:Q,home_score:Math.max(0,Number(p.home_score||0))+U,away_score:Math.max(0,Number(p.away_score||0))+Z,updated_at:new Date().toISOString()})},O=async(p,z,B)=>{if(p.status==="scheduled")return;const U=p.meta||{},Z=z==="home"?"home_sets":"away_sets";let Y=Math.max(0,Number(U[Z]||0));B==="inc"&&(Y+=1),B==="dec"&&(Y=Math.max(0,Y-1)),B==="reset"&&(Y=0),await G(p.id,{meta:{...U,[Z]:Y}})},J=async(p,z)=>{const B=new Date().toISOString(),U={status:z,updated_at:B};return z==="ongoing"&&p.status==="scheduled"&&!p.starts_at&&(U.starts_at=B),await G(p.id,U)},W=async p=>{const z=I(p,"home"),B=I(p,"away");if(z>0||B>0){const U=p.meta||{};await G(p.id,{meta:{...U,home_points_set:0,away_points_set:0},home_score:Math.max(0,Number(p.home_score||0))+z,away_score:Math.max(0,Number(p.away_score||0))+B})}return await J(p,"finished")},ne=async p=>{S(null);const z=p?.sport_id?String(p.sport_id):null;if(!z){S("Partida sem modalidade válida (sport_id ausente).");return}try{const{data:B,error:U}=await x.from("matches").select("id,status,group_name,order_idx,round,home_team_id,away_team_id,sport_id").eq("sport_id",z);if(U)throw U;if(!B)throw new Error("Falha ao validar ordem.");if(B.some(Q=>Q.status==="ongoing"||Q.status==="paused"))throw new Error("Já existe uma partida em andamento/pausada nesta modalidade. Encerre-a antes de iniciar outra.");const Y=B.filter(Q=>Q.status==="scheduled"&&!!(Q.home_team_id&&Q.away_team_id));if(!Y.length)throw new Error("Não há partidas elegíveis para iniciar.");if(Y.sort((Q,le)=>_e(Q)-_e(le)),Y[0].id!==p.id)throw new Error("Você só pode iniciar o próximo jogo da fila.");await J(p,"ongoing")}catch(B){console.error("tryStartMatch error:",B),S(B.message||"Não foi possível iniciar a partida (ordem restrita).")}},he=async p=>await ne(p),ie=async p=>await J(p,"paused"),ze=async p=>await J(p,"ongoing");return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Gerenciar Partidas"}),!V&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded mb-4",children:"⚠️ Você está offline. As alterações serão sincronizadas quando a conexão for restaurada."}),E===!1&&e.jsxs("div",{className:"text-sm p-3 rounded bg-red-50 border border-red-200 text-red-700",children:["Você não está autenticado como ",e.jsx("strong",{children:"admin"}),". As ações podem ser bloqueadas."]}),$&&e.jsxs("div",{className:"text-sm p-3 rounded bg-yellow-50 border border-yellow-200 text-yellow-800 flex items-start gap-3",children:[e.jsx("div",{className:"flex-1 whitespace-pre-wrap",children:String($)}),e.jsx("button",{onClick:()=>S(null),className:"text-xs px-2 py-1 rounded border border-yellow-300 hover:bg-yellow-100",children:"Fechar"})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Modalidade:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>c(null),className:`px-2 py-1 rounded text-xs ${n?"bg-gray-100 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:"Todas"}),a.map(p=>e.jsx("button",{onClick:()=>c(p.key),className:`px-2 py-1 rounded text-xs ${n===p.key?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:p.name},p.key))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>r(null),className:`px-2 py-1 rounded text-xs ${o?"bg-gray-100 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:"Todos"}),Object.entries(Ms).map(([p,z])=>e.jsx("button",{onClick:()=>r(p),className:`px-2 py-1 rounded text-xs ${o===p?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:z},p))]})]})]}),m?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((p,z)=>e.jsx("div",{className:"h-32 bg-gray-100 rounded animate-pulse"},z))}):s.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma partida encontrada."}):e.jsx("ul",{className:"space-y-4",children:s.map(p=>{const B=Le(p?.sport?.name||"").includes("volei"),U=B?H(p,"home"):0,Z=B?H(p,"away"):0,Y=B?I(p,"home"):null,K=B?I(p,"away"):null,Q=!p.group_name,le=!!(p.home?.id&&p.away?.id),pe=le,oe=p.status==="ongoing"||p.status==="paused",jt=oe?p.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200",Ue=j.has(p.id);return e.jsxs("li",{className:`border rounded-lg p-3 sm:p-4 flex flex-col gap-3 bg-white shadow-sm relative overflow-hidden ${jt}`,children:[e.jsx(Wr,{status:p.status}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-500 flex flex-wrap items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-medium",children:p.sport?.name}),p.group_name&&e.jsxs("span",{children:["· Grupo ",p.group_name]}),p.stage&&e.jsxs("span",{children:["· ",p.stage==="semi"?"Semifinal":p.stage==="3lugar"?"3º lugar":p.stage==="r32"?"Pré-oitavas":p.stage]}),p.round&&e.jsxs("span",{children:["· J",p.round]}),oe&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",Qr(p,P)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[p.status==="scheduled"&&Ue&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-indigo-100 text-indigo-700 uppercase tracking-wide",children:"Próximo na ordem"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded self-start sm:self-auto ${p.status==="ongoing"?"bg-green-100 text-green-700":p.status==="paused"?"bg-yellow-100 text-yellow-700":p.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:Ms[p.status]||p.status})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4",children:[e.jsx(Gs,{align:"left",team:p.home,score:p.home_score,onInc:()=>w(p,"home","inc"),onDec:()=>w(p,"home","dec"),onReset:()=>w(p,"home","reset"),sets:B?U:null,setPoints:B?Y:null,onSetInc:B&&M?()=>O(p,"home","inc"):void 0,onSetDec:B&&M?()=>O(p,"home","dec"):void 0,onSetReset:B&&M?()=>O(p,"home","reset"):void 0,disabled:y[p.id]||p.status==="scheduled"}),e.jsx(Gs,{align:"right",team:p.away,score:p.away_score,onInc:()=>w(p,"away","inc"),onDec:()=>w(p,"away","dec"),onReset:()=>w(p,"away","reset"),sets:B?Z:null,setPoints:B?K:null,onSetInc:B&&M?()=>O(p,"away","inc"):void 0,onSetDec:B&&M?()=>O(p,"away","dec"):void 0,onSetReset:B&&M?()=>O(p,"away","reset"):void 0,disabled:y[p.id]||p.status==="scheduled"})]}),B&&e.jsx("button",{onClick:()=>D(fe=>!fe),className:"text-[10px] px-2 py-0.5 rounded border border-gray-300 hover:bg-gray-50 self-start",children:M?"Fechar edição de sets":"Editar sets manualmente"}),B&&(Y>0||K>0)&&e.jsx("button",{onClick:async()=>{if(b===p.id){const fe=_(p);d(null),await R(p,{force:!fe})}else d(p.id),setTimeout(()=>d(fe=>fe===p.id?null:fe),3e3)},disabled:y[p.id]||p.status==="scheduled",className:`px-3 py-1 text-xs rounded ${b===p.id?"bg-red-600":"bg-purple-600"} text-white hover:opacity-90 disabled:opacity-50`,title:"Soma os pontos do set aos totais (PF/PA) e incrementa o set do vencedor.",children:b===p.id?"Confirmar finalizar set":"Finalizar set"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[p.status==="scheduled"&&e.jsx("button",{onClick:()=>he(p),disabled:y[p.id]||!pe||!Ue,className:"px-3 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",title:pe?Ue?"Iniciar próximo jogo da ordem.":"Aguarde: apenas o próximo jogo da ordem pode iniciar.":"Defina as duas equipes antes de iniciar.",children:"Iniciar"}),p.status==="ongoing"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ie(p),disabled:y[p.id],className:"px-3 py-1 text-xs rounded bg-yellow-500 text-white hover:bg-yellow-600 disabled:opacity-50",children:"Pausar"}),e.jsx("button",{onClick:()=>W(p),disabled:y[p.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),p.status==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ze(p),disabled:y[p.id],className:"px-3 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:"Retomar"}),e.jsx("button",{onClick:()=>W(p),disabled:y[p.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),p.status==="finished"&&e.jsx("span",{className:"text-xs text-gray-500 self-center",children:"Partida encerrada (resultado editável)."})]})]},p.id)})}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% {
            transform: translateX(-100%);
          }
          50% {
            transform: translateX(200%);
          }
          100% {
            transform: translateX(-100%);
          }
        }
      `})]})}function Gs({team:s,score:t,onInc:a,onDec:i,onReset:n,sets:c,setPoints:o,onSetInc:r,onSetDec:m,onSetReset:v,disabled:y,align:k="left"}){const E=k==="right",A=typeof o=="number"?"Pontos do set":"Pontos",$=Number(typeof o=="number"?o||0:t||0),S=!!(r||m||v),P=({label:L,value:M})=>{const D=Number.isFinite(M)?M:"-";return e.jsxs("div",{className:"flex min-w-[70px] flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-2.5 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:L}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:D})]})},F=E?"justify-end":"justify-start",V=E?"text-right":"text-left";return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-gray-50/80 p-3 shadow-sm space-y-4",children:[e.jsxs("div",{className:`flex flex-wrap items-center justify-between gap-3 ${E?"flex-row-reverse":""}`,children:[e.jsxs("div",{className:`flex min-w-0 items-center gap-2 ${E?"flex-row-reverse text-right":""}`,children:[e.jsx(se,{team:s||{name:"A definir"},size:28}),e.jsx("span",{className:"text-sm font-medium truncate",children:s?.name||"A definir"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${E?"flex-row-reverse":""}`,children:[typeof c=="number"?e.jsx(P,{label:"Sets",value:Number(c||0)}):null,e.jsx(P,{label:A,value:$})]})]}),typeof c=="number"?e.jsxs("div",{className:`space-y-2 ${V}`,children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:"Controle de sets"}),e.jsxs("div",{className:`flex flex-wrap gap-2 ${F}`,children:[e.jsx("button",{type:"button",onClick:m,disabled:y||!S,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"-"}),e.jsx("button",{type:"button",onClick:r,disabled:y||!S,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"+"}),e.jsx("button",{type:"button",onClick:v,disabled:y||!S,className:"flex items-center justify-center rounded-lg bg-red-500 px-3 py-1 text-xs font-semibold text-white transition hover:bg-red-600 disabled:opacity-40",title:"Zerar sets",children:"Zerar"})]})]}):null,e.jsxs("div",{className:`space-y-2 ${V}`,children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:A}),e.jsxs("div",{className:`flex flex-wrap gap-2 ${F}`,children:[e.jsx("button",{type:"button",onClick:i,disabled:y,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"-"}),e.jsx("button",{type:"button",onClick:a,disabled:y,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"+"}),e.jsx("button",{type:"button",onClick:n,disabled:y,className:"flex items-center justify-center rounded-lg bg-red-500 px-3 py-1 text-xs font-semibold text-white transition hover:bg-red-600 disabled:opacity-40",title:typeof o=="number"?"Zerar pontos do set":"Zerar pontos",children:"Zerar"})]})]})]})}const xe={pebolim:{name:"Pebolim",required:24,path:"/admin/campeonatos/pebolim",variant:"1v3_1v2_3v2"},fifa:{name:"FIFA",required:32,path:"/admin/campeonatos/fifa"},futsal:{name:"Futsal",required:9,path:"/admin/campeonatos/futsal",variant:"1v3_1v2_3v2"},volei:{name:"Vôlei",required:9,path:"/admin/campeonatos/volei",variant:"1v2_1v3_2v3"}},sn={Pebolim:"pebolim",FIFA:"fifa",Futsal:"futsal",Volei:"volei",Vôlei:"volei"},tn=(s="")=>s.trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),Os=({children:s,tone:t="gray"})=>e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium border ${t==="green"?"bg-green-50 text-green-700 border-green-200":t==="amber"?"bg-amber-50 text-amber-700 border-amber-200":t==="red"?"bg-red-50 text-red-700 border-red-200":t==="blue"?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:s}),Ls=({children:s,className:t=""})=>e.jsx("div",{className:`rounded-2xl border border-gray-200 bg-white shadow-sm ${t}`,children:s}),an=({title:s,subtitle:t,right:a})=>e.jsxs("div",{className:"flex items-start justify-between gap-3 p-4 sm:p-5",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:s}),t&&e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t})]}),a]}),Qe=({children:s,className:t="",...a})=>e.jsx("button",{className:`inline-flex w-full items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-gray-200 disabled:text-gray-500 ${t}`,...a,children:s}),De=({children:s,className:t="",...a})=>e.jsx("button",{className:`inline-flex w-full items-center justify-center gap-2 rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60 ${t}`,...a,children:s});function rn(){const s=me(),[t,a]=l.useState(!0),[i,n]=l.useState(null),[c,o]=l.useState([]),[r,m]=l.useState({}),[v,y]=l.useState({}),[k,E]=l.useState(null),[A,$]=l.useState(null),S=async()=>{a(!0),n(null);try{const{data:b,error:d}=await x.from("sports").select("id,name").order("name",{ascending:!0});if(d)throw d;const f=b.map(C=>({id:C.id,name:C.name,key:sn[C.name?.trim()]||tn(C.name)}));o(f);const N=await Promise.all(f.map(async C=>{const[q,g,h,T]=await Promise.all([x.from("teams").select("id",{count:"exact",head:!0}).eq("sport_id",C.id),x.from("teams").select("id, name, group_name, seed_in_group").eq("sport_id",C.id).not("group_name","is",null),x.from("matches").select("id",{count:"exact",head:!0}).eq("sport_id",C.id),x.from("standings").select("id",{count:"exact",head:!0}).eq("sport_id",C.id)]),u=q?.count??0,j=h?.count??0,G=T?.count??0,w=nn(g?.data||[]),{data:I}=await x.from("v_queue_slots").select("slot, order_idx, match_id, stage, group_name").eq("sport_id",C.id);let H={};const _=(I||[]).map(R=>R.match_id).filter(Boolean);if(_.length){const{data:R}=await x.from("match_detail_view").select("id, home_team_name, away_team_name").in("id",_);H=Object.fromEntries((R||[]).map(O=>[O.id,O]))}return[C.key,{sportId:C.id,sportName:C.name,teamCount:u,groupsMeta:w,matchesCount:j,standingsCount:G,hasAny:(j||G||w.total||0)>0,queueSlots:I||[],queueDetails:H}]}));m(Object.fromEntries(N))}catch(b){n(`Falha ao carregar: ${b.message||b}`)}finally{a(!1)}};l.useEffect(()=>{S();const b=x.channel("tournaments-queue").on("postgres_changes",{event:"*",schema:"public",table:"matches"},S).subscribe();return()=>x.removeChannel(b)},[]);const P=b=>{const d=r[b];if(!d)return!1;if(b==="fifa")return d.teamCount===xe.fifa.required;const f=b==="pebolim"?8:3,N=Object.values(d.groupsMeta.byGroup||{}),C=N.length===f&&N.every(g=>g.members.length===3),q=N.every(g=>ln(g.members.map(h=>h.seed_in_group),[1,2,3]));return C&&q},F=(b,d)=>y(f=>({...f,[b]:d})),V=b=>$({key:b,name:xe[b].name}),L=async b=>{const d=r[b];if(!d)return;const f=d.sportId;F(b,!0),n(null),$(null);try{if(b==="fifa"){const{error:N}=await x.rpc("fifa_preserve_order_and_reset_played",{p_reset_played:!0});if(N)throw N}else{const{data:N}=await x.from("matches").select("id").eq("sport_id",f),C=(N||[]).map(h=>h.id);C.length&&await x.from("match_events").delete().in("match_id",C),await x.from("matches").delete().eq("sport_id",f),await x.from("standings").delete().eq("sport_id",f);const q=xe[b]?.variant||"1v3_1v2_3v2",{error:g}=await x.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:f,p_variant:q});if(g)throw g}n(`Campeonato de ${xe[b].name} gerado com sucesso (ordem fixa).`),await S()}catch(N){n(`Falha ao gerar partidas: ${N.message||N}`)}finally{F(b,!1)}},M=b=>E({key:b,name:xe[b].name}),D=async b=>{const d=r[b];if(d){F(b,!0);try{const{data:f}=await x.from("matches").select("id").eq("sport_id",d.sportId),N=(f||[]).map(C=>C.id);N.length&&await x.from("match_events").delete().in("match_id",N),await x.from("matches").delete().eq("sport_id",d.sportId),await x.from("standings").delete().eq("sport_id",d.sportId),await x.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",d.sportId),n(`Campeonato de ${xe[b].name} foi reiniciado.`),E(null),await S()}catch(f){n(`Falha ao reiniciar: ${f.message||f}`)}finally{F(b,!1)}}};return e.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Gerenciar Campeonatos"})]}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Configure grupos, gere as partidas na ordem definida e opere os cartões: ",e.jsx("strong",{children:"Ao vivo"}),", ",e.jsx("strong",{children:"⚠️ Compareçam"})," e ",e.jsx("strong",{children:"Próximo jogo"}),"."]})]}),i&&e.jsx("div",{className:"mb-4 rounded-xl border border-blue-200 bg-blue-50 px-3 py-2 text-sm text-blue-800",children:i}),t?e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Array.from({length:4}).map((b,d)=>e.jsxs(Ls,{className:"p-4",children:[e.jsx("div",{className:"h-6 w-32 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"mt-3 h-4 w-56 animate-pulse rounded bg-gray-100"}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-9 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"h-9 animate-pulse rounded bg-gray-100"})]})]},d))}):e.jsx("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:c.map(b=>{const d=b.key,f=xe[d];if(!f)return null;const N=r[d]||{},C=N.teamCount===f.required,q=!!N.hasAny,g=P(d);return e.jsxs(Ls,{children:[e.jsx(an,{title:f.name,subtitle:`Times: ${N.teamCount??0} / ${f.required}`,right:q?e.jsx(Os,{tone:"amber",children:"Existe"}):e.jsx(Os,{tone:C?"green":"gray",children:C?"Pronto":"Aguardando times"})}),e.jsx("div",{className:"px-4 sm:px-5",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Xt,{className:"h-4 w-4"})," Partidas: ",e.jsx("strong",{className:"ml-1",children:N.matchesCount??0})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(xs,{className:"h-4 w-4"})," Grupos definidos: ",e.jsx("strong",{className:"ml-1",children:N.groupsMeta.countGroups||0})]}),d!=="fifa"&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(oa,{className:"h-4 w-4"})," Seeds válidos: ",e.jsx("strong",{className:"ml-1",children:N.groupsMeta.seedsOk?"Sim":"Não"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-4 sm:grid-cols-2 sm:p-5",children:[e.jsxs(Qe,{disabled:!C||q,onClick:()=>s(f.path),children:[e.jsx(xs,{className:"h-4 w-4"})," Configurar & Agrupar"]}),e.jsxs(De,{className:"text-red-600 border-red-600 hover:bg-red-50",disabled:v[d]||(d==="fifa"?!C:!g),onClick:()=>V(d),children:[v[d]?e.jsx(Qt,{className:"h-4 w-4 animate-spin"}):e.jsx(aa,{className:"h-4 w-4"}),"Gerar Partidas (ordem fixa)"]}),e.jsxs(De,{className:"sm:col-span-2",onClick:()=>M(d),disabled:!q,children:[e.jsx(la,{className:"h-4 w-4"})," Apagar & Reiniciar"]})]}),e.jsx("div",{className:"px-4 pb-4 sm:px-5 sm:pb-5",children:e.jsx("div",{className:"rounded-xl border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 divide-y sm:grid-cols-3 sm:divide-x sm:divide-y-0",children:[We(N,"live"),We(N,"call"),We(N,"next")]})})})]},d)})}),k&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>E(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Reiniciar ",k.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Isso apagará ",e.jsx("strong",{children:"todas"})," as partidas, eventos e a classificação, e limpará os grupos."]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-2",children:[e.jsx(De,{onClick:()=>E(null),children:"Cancelar"}),e.jsx(Qe,{onClick:()=>D(k.key),children:"Confirmar"})]})]})]}),A&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>$(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Gerar Partidas para ",A.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Isso apagará ",e.jsx("strong",{children:"todas"})," as partidas, eventos e a classificação, e limpará os grupos antes de gerar novas partidas."]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-2",children:[e.jsx(De,{onClick:()=>$(null),children:"Cancelar"}),e.jsx(Qe,{onClick:()=>L(A.key),children:"Confirmar"})]})]})]})]})}function nn(s){const t={};for(const c of s)t[c.group_name]||(t[c.group_name]={members:[]}),t[c.group_name].members.push({id:c.id,name:c.name,seed_in_group:c.seed_in_group});const a=Object.keys(t).sort(on),i=a.length;let n=!0;for(const c of a){const o=new Set(t[c].members.map(m=>m.seed_in_group));o.has(1)&&o.has(2)&&o.has(3)&&o.size===3||(n=!1)}return{byGroup:t,groups:a,countGroups:i,total:s.length,seedsOk:n}}function on(s,t){const a=s&&s[s.length-1]||"z",i=t&&t[t.length-1]||"z";return a<i?-1:a>i?1:0}function ln(s=[],t=[]){const a=new Set(s),i=new Set(t);if(a.size!==i.size)return!1;for(const n of a)if(!i.has(n))return!1;return!0}function We(s,t){const a=t==="live"?"Ao vivo":t==="call"?"⚠️ Compareçam":"Próximo jogo",i=t==="live"?"bg-red-50 border-red-200":t==="call"?"bg-amber-50 border-amber-200":"bg-emerald-50 border-emerald-200",n=(s.queueSlots||[]).find(o=>o.slot===t),c=n?.match_id?s.queueDetails?.[n.match_id]:null;return e.jsx("div",{className:"p-3 sm:p-4",children:e.jsxs("div",{className:`rounded-xl border p-3 sm:p-4 ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:a}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Hs,{className:"h-3.5 w-3.5"}),"#",n?.order_idx??"–"]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[c?e.jsxs("div",{className:"font-medium text-gray-900",children:[c.home_team_name," ",e.jsx("span",{className:"text-gray-500",children:"x"})," ",c.away_team_name]}):e.jsx("div",{className:"text-gray-500",children:"Aguardando…"}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[n?.stage?e.jsx("span",{className:"mr-2",children:n.stage}):null,n?.group_name?e.jsxs("span",{children:["Grupo ",n.group_name]}):null]})]})]})})}const ce=["A","B","C"],Ne=3;function cn(){const[s,t]=l.useState([]),[a,i]=l.useState({A:[],B:[],C:[]}),[n,c]=l.useState(new Set),[o,r]=l.useState(!0),[m,v]=l.useState(!1),[y,k]=l.useState(null),E=l.useRef(!1),A=l.useRef(!0),$=me(),S=l.useMemo(()=>{const f=new Map;return s.forEach(N=>f.set(N.id,N)),f},[s]),P=async()=>{if(!E.current){E.current=!0,r(!0);try{const{data:f,error:N}=await x.from("sports").select("id").eq("name","Futsal").maybeSingle();if(N||!f?.id){alert("Erro ao buscar a modalidade Futsal.");return}k(f.id);const{data:C,error:q}=await x.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",f.id).order("name");if(q){alert("Erro ao carregar times de Futsal.");return}t(C||[]);const g={A:[],B:[],C:[]},h=(C||[]).reduce((T,u)=>(ce.includes(u.group_name)&&(T[u.group_name]=T[u.group_name]||[]).push(u),T),{});ce.forEach(T=>{const u=(h[T]||[]).sort((j,G)=>{const w=j.seed_in_group??999,I=G.seed_in_group??999;return w!==I?w-I:j.name.localeCompare(G.name)});g[T]=u.map(j=>j.id)}),i(g)}finally{r(!1),E.current=!1}}};l.useEffect(()=>{A.current=!0,P();const f=x.channel("futsal-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{A.current&&!E.current&&P()}).subscribe();return()=>{A.current=!1,x.removeChannel(f)}},[]);const F=l.useMemo(()=>new Set(ce.flatMap(f=>a[f])),[a]),V=l.useMemo(()=>s.filter(f=>!F.has(f.id)),[s,F]),L=f=>{c(N=>{const C=new Set(N);return C.has(f)?C.delete(f):C.add(f),C})},M=f=>{const N=Array.from(n);if(!N.length){alert("Selecione ao menos 1 time.");return}if(a[f].length+N.length>Ne){alert(`O grupo ${f} não pode ter mais de ${Ne} times.`),c(new Set);return}i(C=>{const q={...C};for(const g of N){for(const h of ce)q[h]=q[h].filter(T=>T!==g);q[f]=[...q[f],g]}return q}),c(new Set)},D=f=>{i(N=>{const C={...N};for(const q of ce)C[q]=C[q].filter(g=>g!==f);return C})},b=ce.every(f=>a[f].length===Ne),d=async()=>{if(!b){alert("Complete todos os grupos antes de confirmar!");return}if(!y){alert("Modalidade Futsal não encontrada.");return}try{v(!0),await x.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",y);for(const N of ce){const C=a[N];if(C.length){await x.from("teams").update({group_name:N}).in("id",C);for(let q=0;q<C.length;q++)await x.from("teams").update({seed_in_group:q+1}).eq("id",C[q])}}await x.rpc("seed_initial_standings",{p_sport_name:"Futsal",p_reset:!0}),await x.rpc("rebuild_standings",{p_sport_name:"Futsal"});const{error:f}=await x.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:y,p_variant:"1v3_1v2_3v2"});if(f){alert("Erro ao gerar jogos de grupos: "+f.message);return}await x.rpc("maybe_create_knockout",{p_sport_name:"Futsal"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>$("/admin/campeonatos"),1200)}catch(f){alert("Erro ao salvar: "+(f?.message||String(f)))}finally{v(!1)}};return o?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Futsal"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. Ao confirmar, os grupos são salvos com"," ",e.jsx("strong",{children:"seed_in_group = 1,2,3"}),", e os jogos são gerados via RPC na"," ",e.jsx("strong",{children:"ordem exata"})," (fila global por ",e.jsx("code",{children:"order_idx"}),"). Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:P,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),V.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:V.map(f=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(f.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>L(f.id),title:f.name,children:[e.jsx(Ds,{team:f}),e.jsx("span",{className:"truncate",children:f.name})]},f.id))})]}),ce.map(f=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",f]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[f].length===Ne?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[f].length,"/",Ne]})]}),e.jsx("button",{onClick:()=>M(f),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[f].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[f].map((N,C)=>{const q=S.get(N);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>D(N),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:C+1}),e.jsx(Ds,{team:q}),e.jsx("span",{className:"truncate",title:q?.name,children:q?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},N)})})})]},f))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:ce.map(f=>`${f}(${a[f].length}/${Ne})`).join(", ")}),e.jsx("button",{onClick:d,disabled:!b||m,className:`px-6 py-2 rounded font-semibold transition ${b&&!m?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:m?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Ds({team:s}){const t=dn(s?.name),a=s?.color||mn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function dn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function mn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const ae=["A","B","C"],ge=3;function un(){const[s,t]=l.useState([]),[a,i]=l.useState({A:[],B:[],C:[]}),[n,c]=l.useState(new Set),[o,r]=l.useState(!0),[m,v]=l.useState(!1),[y,k]=l.useState(null),E=l.useRef(!1),A=l.useRef(!0),$=me(),S=async()=>{if(!E.current){E.current=!0,r(!0);try{const{data:d,error:f}=await x.from("sports").select("id").eq("name","Volei").maybeSingle();if(f||!d?.id){alert("Erro ao buscar a modalidade Vôlei.");return}k(d.id);const{data:N,error:C}=await x.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",d.id).order("name");if(C){alert("Erro ao carregar times de Vôlei.");return}t(N||[]);const q={A:[],B:[],C:[]},g={A:[],B:[],C:[]};(N||[]).forEach(h=>{h.group_name&&ae.includes(h.group_name)&&g[h.group_name].push(h)}),ae.forEach(h=>{const T=(g[h]||[]).sort((u,j)=>{const G=u.seed_in_group??999,w=j.seed_in_group??999;return G!==w?G-w:u.name.localeCompare(j.name)});q[h]=T.map(u=>u.id)}),i(q)}finally{r(!1),E.current=!1}}};l.useEffect(()=>{A.current=!0,S();const d=x.channel("volei-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{A.current&&!E.current&&S()}).subscribe();return()=>{A.current=!1,x.removeChannel(d)}},[]);const P=l.useMemo(()=>new Set(ae.flatMap(d=>a[d])),[a]),F=l.useMemo(()=>s.filter(d=>!P.has(d.id)),[s,P]),V=d=>{c(f=>{const N=new Set(f);return N.has(d)?N.delete(d):N.add(d),N})},L=d=>{const f=Array.from(n);if(!f.length){alert("Selecione ao menos 1 time.");return}if(a[d].length+f.length>ge){alert(`O grupo ${d} não pode ter mais de ${ge} times.`),c(new Set);return}i(N=>{const C={...N};for(const q of f){for(const g of ae)C[g]=C[g].filter(h=>h!==q);C[d]=[...C[d],q]}return C}),c(new Set)},M=d=>{i(f=>{const N={...f};for(const C of ae)N[C]=N[C].filter(q=>q!==d);return N})},D=ae.every(d=>a[d].length===ge),b=async()=>{if(!D){alert("Complete todos os grupos antes de confirmar!");return}if(!y){alert("Modalidade Vôlei não encontrada.");return}try{v(!0),await x.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",y);for(const f of ae){const N=a[f];if(N.length){await x.from("teams").update({group_name:f}).in("id",N);for(let C=0;C<N.length;C++)await x.from("teams").update({seed_in_group:C+1}).eq("id",N[C])}}await x.rpc("seed_initial_standings",{p_sport_name:"Volei",p_reset:!0}),await x.rpc("rebuild_standings",{p_sport_name:"Volei"});const{error:d}=await x.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:y,p_variant:"1v2_1v3_2v3"});if(d){alert("Erro ao gerar jogos de grupos: "+d.message);return}await x.rpc("maybe_create_knockout",{p_sport_name:"Volei"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>$("/admin/campeonatos"),1200)}catch(d){alert("Erro ao salvar: "+(d?.message||String(d)))}finally{v(!1)}};return o?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Vôlei"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. Ao confirmar, salvamos"," ",e.jsx("strong",{children:"group_name"})," e ",e.jsx("strong",{children:"seed_in_group = 1,2,3"})," conforme a ordem e geramos os jogos via RPC na ",e.jsx("strong",{children:"ordem exata"}),". Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:S,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),F.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:F.map(d=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(d.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>V(d.id),title:d.name,children:[e.jsx(Bs,{team:d}),e.jsx("span",{className:"truncate",children:d.name})]},d.id))})]}),ae.map(d=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",d]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[d].length===ge?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[d].length,"/",ge]})]}),e.jsx("button",{onClick:()=>L(d),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[d].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[d].map((f,N)=>{const C=s.find(q=>q.id===f);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>M(f),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:N+1}),e.jsx(Bs,{team:C}),e.jsx("span",{className:"truncate",title:C?.name,children:C?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},f)})})})]},d))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:ae.map(d=>`${d}(${a[d].length}/${ge})`).join(", ")}),e.jsx("button",{onClick:b,disabled:!ae.every(d=>a[d].length===ge)||m,className:`px-6 py-2 rounded font-semibold transition ${ae.every(d=>a[d].length===ge)&&!m?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:m?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Bs({team:s}){const t=gn(s?.name),a=s?.color||hn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function gn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function hn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const Ye=16;function pn(){const[s,t]=l.useState([]),[a,i]=l.useState(Array.from({length:Ye},()=>({home:null,away:null}))),[n,c]=l.useState(new Set),[o,r]=l.useState(!0),[m,v]=l.useState(!1),[y,k]=l.useState(null),E=me(),A=async()=>{r(!0);try{const{data:b,error:d}=await x.from("sports").select("id").eq("name","FIFA").maybeSingle();if(d||!b?.id){alert("Erro ao localizar a modalidade FIFA."),r(!1);return}k(b.id);const{data:f,error:N}=await x.from("teams").select("id, name, logo_url, color").eq("sport_id",b.id).order("name");N?alert("Erro ao carregar times do FIFA."):t(f||[])}finally{r(!1)}};l.useEffect(()=>{A()},[]);const $=l.useMemo(()=>new Set(a.flatMap(b=>[b.home,b.away]).filter(Boolean)),[a]),S=l.useMemo(()=>s.filter(b=>!$.has(b.id)),[s,$]),P=b=>{c(d=>{const f=new Set(d);return f.has(b)?f.delete(b):f.add(b),f})},F=(b,d)=>{const f=Array.from(n);if(f.length===0){alert("Selecione um time para alocar.");return}if(f.length>1){alert("Selecione apenas 1 time por vez."),c(new Set);return}const N=f[0];i(C=>{const q=C[b];if(q[d])return alert(`O slot ${d==="home"?"A":"B"} do Jogo ${b+1} já está ocupado.`),C;const g=[...C];return g[b]={...q,[d]:N},g}),c(new Set)},V=(b,d)=>{i(f=>{const N=[...f];return N[b]={...N[b],[d]:null},N})},L=a.length===Ye&&a.every(b=>b.home&&b.away),M=async()=>{if(!L){alert("Todos os confrontos precisam ter 2 times.");return}if(!y){alert("Modalidade FIFA não encontrada.");return}try{v(!0);const{count:b}=await x.from("matches").select("*",{count:"exact",head:!0}).eq("sport_id",y);if((b??0)>0){if(!window.confirm("Já existe um campeonato de FIFA. Criar um novo vai apagar jogos e classificação existentes. Deseja continuar?"))return;const{data:C}=await x.from("matches").select("id").eq("sport_id",y),q=(C||[]).map(g=>g.id);q.length&&await x.from("match_events").delete().in("match_id",q),await x.from("matches").delete().eq("sport_id",y),await x.from("standings").delete().eq("sport_id",y)}await x.from("teams").update({group_name:null}).eq("sport_id",y);const d=a.map((N,C)=>({sport_id:y,stage:"r32",round:C+1,order_idx:C+1,status:"scheduled",home_team_id:N.home,away_team_id:N.away,venue:"Console FIFA"})),{error:f}=await x.from("matches").insert(d);if(f){alert("Erro ao criar os jogos: "+f.message);return}await x.from("matches").insert(Array.from({length:8}).map((N,C)=>({sport_id:y,stage:"oitavas",round:C+1,order_idx:16+(C+1),status:"scheduled"}))),await x.from("matches").insert(Array.from({length:4}).map((N,C)=>({sport_id:y,stage:"quartas",round:C+1,order_idx:24+(C+1),status:"scheduled"}))),await x.from("matches").insert([{sport_id:y,stage:"semi",round:1,order_idx:29,status:"scheduled"},{sport_id:y,stage:"semi",round:2,order_idx:30,status:"scheduled"},{sport_id:y,stage:"final",round:1,order_idx:31,status:"scheduled"},{sport_id:y,stage:"3lugar",round:1,order_idx:32,status:"scheduled"}]),await x.rpc("seed_initial_standings",{p_sport_name:"FIFA",p_reset:!0}),alert(`✅ Chaveamento criado com sucesso!

Voltando para a tela de campeonatos…`),setTimeout(()=>E("/admin/campeonatos"),1200)}catch(b){alert("Erro ao salvar: "+(b?.message||String(b)))}finally{v(!1)}},D=async()=>{if(!y){alert("Modalidade FIFA não encontrada.");return}if(s.length!==32){alert("É necessário ter exatamente 32 times cadastrados no FIFA para gerar automaticamente.");return}try{v(!0);const{error:b}=await x.rpc("fifa_seed_32_bracket",{p_sport_name:"FIFA",p_reset:!1});if(b)throw b;alert(`✅ Partidas do FIFA geradas com sucesso!

Voltando para a tela de campeonatos…`),setTimeout(()=>E("/admin/campeonatos"),1200)}catch(b){console.error("Erro ao gerar partidas FIFA:",b),alert("Erro ao gerar partidas: "+(b?.message||String(b)))}finally{v(!1)}};return o?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de FIFA"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Monte as pré-oitavas (16 jogos). Ao confirmar, os jogos entram como ",e.jsx("strong",{children:"scheduled"})," com"," ",e.jsx("strong",{children:"order_idx"})," fixo: assim, o Jogo 1 aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:D,disabled:m||!y,title:"Gera automaticamente J1..J16, placeholders J17..J28",className:`text-xs px-3 py-1 rounded border transition ${m?"opacity-60 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Gerar automaticamente (RPC)"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),S.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"grid grid-cols-2 gap-2",children:S.map(b=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(b.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>P(b.id),title:b.name,children:[e.jsx(es,{team:b}),e.jsx("span",{className:"truncate",children:b.name})]},b.id))})]}),e.jsxs("div",{className:"border rounded p-4 overflow-y-auto max-h-[32rem]",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Confrontos (pré-oitavas)"}),e.jsx("ul",{className:"space-y-4",children:a.map((b,d)=>{const f=s.find(C=>C.id===b.home),N=s.find(C=>C.id===b.away);return e.jsxs("li",{className:"flex flex-col gap-1 border rounded p-2 bg-gray-50",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:["Jogo ",d+1]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 flex-1",children:f?e.jsxs(e.Fragment,{children:[e.jsx(es,{team:f}),e.jsx("span",{className:"truncate",title:f.name,children:f.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>V(d,"home"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>F(d,"home"),children:"Adicionar time A"})}),e.jsx("span",{className:"font-bold",children:"vs"}),e.jsx("div",{className:"flex items-center gap-2 flex-1",children:N?e.jsxs(e.Fragment,{children:[e.jsx(es,{team:N}),e.jsx("span",{className:"truncate",title:N.name,children:N.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>V(d,"away"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>F(d,"away"),children:"Adicionar time B"})})]})]},d)})})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:L?e.jsxs("span",{className:"text-green-700",children:["Todos os ",Ye," confrontos estão prontos!"]}):e.jsxs("span",{children:["Restam ",32-$.size," times para alocar."]})}),e.jsx("button",{onClick:M,disabled:!L||m,className:`px-6 py-3 rounded font-semibold transition ${L&&!m?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:m?"Processando...":"Confirmar chaveamento"})]})]})}function es({team:s}){const t=xn(s?.name),a=s?.color||fn(s?.name||"T");return e.jsx("div",{className:"w-7 h-7 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function xn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function fn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const re=["A","B","C","D","E","F","G","H"],we=3;function yn(){const[s,t]=l.useState([]),[a,i]=l.useState(re.reduce((d,f)=>({...d,[f]:[]}),{})),[n,c]=l.useState(new Set),[o,r]=l.useState(!0),[m,v]=l.useState(!1),[y,k]=l.useState(null),E=l.useRef(!1),A=l.useRef(!0),$=me(),S=async()=>{if(!E.current){E.current=!0,r(!0);try{const{data:d,error:f}=await x.from("sports").select("id").eq("name","Pebolim").maybeSingle();if(f||!d?.id){alert("Erro ao buscar a modalidade Pebolim.");return}k(d.id);const{data:N,error:C}=await x.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",d.id).order("name");if(C){alert("Erro ao carregar times de Pebolim.");return}t(N||[]);const q=re.reduce((h,T)=>({...h,[T]:[]}),{}),g=(N||[]).reduce((h,T)=>(re.includes(T.group_name)&&(h[T.group_name]=h[T.group_name]||[]).push(T),h),{});re.forEach(h=>{const T=(g[h]||[]).sort((u,j)=>{const G=u.seed_in_group??999,w=j.seed_in_group??999;return G!==w?G-w:u.name.localeCompare(j.name)});q[h]=T.map(u=>u.id)}),i(q)}finally{r(!1),E.current=!1}}};l.useEffect(()=>{A.current=!0,S();const d=x.channel("pebolim-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{A.current&&!E.current&&S()}).subscribe();return()=>{A.current=!1,x.removeChannel(d)}},[]);const P=l.useMemo(()=>new Set(re.flatMap(d=>a[d])),[a]),F=l.useMemo(()=>s.filter(d=>!P.has(d.id)),[s,P]),V=d=>{c(f=>{const N=new Set(f);return N.has(d)?N.delete(d):N.add(d),N})},L=d=>{const f=Array.from(n);if(!f.length){alert("Selecione ao menos 1 time.");return}if(a[d].length+f.length>we){alert(`O grupo ${d} não pode ter mais de ${we} times.`),c(new Set);return}i(N=>{const C={...N};for(const q of f){for(const g of re)C[g]=C[g].filter(h=>h!==q);C[d]=[...C[d],q]}return C}),c(new Set)},M=d=>{i(f=>{const N={...f};for(const C of re)N[C]=N[C].filter(q=>q!==d);return N})},D=re.every(d=>a[d].length===we),b=async()=>{if(!D){alert("Complete todos os grupos antes de confirmar!");return}if(!y){alert("Modalidade Pebolim não encontrada.");return}try{v(!0),await x.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",y);for(const f of re){const N=a[f];if(N.length){await x.from("teams").update({group_name:f}).in("id",N);for(let C=0;C<N.length;C++)await x.from("teams").update({seed_in_group:C+1}).eq("id",N[C])}}await x.rpc("seed_initial_standings",{p_sport_name:"Pebolim",p_reset:!0}),await x.rpc("rebuild_standings",{p_sport_name:"Pebolim"});const{error:d}=await x.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:y,p_variant:"1v3_1v2_3v2"});if(d){alert("Erro ao gerar jogos de grupos: "+d.message);return}await x.rpc("maybe_create_knockout",{p_sport_name:"Pebolim"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>$("/admin/campeonatos"),1200)}catch(d){alert("Erro ao salvar: "+(d?.message||String(d)))}finally{v(!1)}};return o?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Pebolim"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 24 times em 8 grupos de 3. Ao confirmar, salvamos"," ",e.jsx("strong",{children:"group_name"})," e ",e.jsx("strong",{children:"seed_in_group = 1,2,3"})," conforme a ordem e geramos os jogos via RPC na ",e.jsx("strong",{children:"ordem exata"}),". Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:S,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),F.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:F.map(d=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(d.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>V(d.id),title:d.name,children:[e.jsx(Vs,{team:d}),e.jsx("span",{className:"truncate",children:d.name})]},d.id))})]}),re.map(d=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",d]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[d].length===we?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[d].length,"/",we]})]}),e.jsx("button",{onClick:()=>L(d),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[d].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[d].map((f,N)=>{const C=s.find(q=>q.id===f);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>M(f),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:N+1}),e.jsx(Vs,{team:C}),e.jsx("span",{className:"truncate",title:C?.name,children:C?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},f)})})})]},d))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:re.map(d=>`${d}(${a[d].length}/${we})`).join(", ")}),e.jsx("button",{onClick:b,disabled:!D||m,className:`px-6 py-2 rounded font-semibold transition ${D&&!m?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:m?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Vs({team:s}){const t=bn(s?.name),a=s?.color||jn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function bn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function jn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function _n(){return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})})}function Nn(){const{session:s,isAdmin:t,ready:a,signOut:i,needsPasswordSetup:n}=ms();ds();const c=me();if(!a)return e.jsx(_n,{});if(n)return e.jsx(Ps,{});const o=async()=>{try{await i(),c("/",{replace:!0})}catch(r){console.error("Error during signout:",r)}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"bg-blue-600 text-white sticky top-0 z-50 shadow-md",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx(X,{to:"/",className:"hover:opacity-90 transition-opacity",children:e.jsx("img",{src:"/logo-copa-influence.png",alt:"Copa Influence",className:"h-12 md:h-16 w-auto"})}),e.jsx("div",{className:"text-sm",children:s?e.jsxs("div",{className:"flex items-center gap-2",children:[s.user?.email&&e.jsx("span",{className:"text-white/80 text-xs hidden sm:inline",children:s.user.email}),e.jsx("button",{onClick:o,className:"hover:underline transition-colors hover:text-white/80 text-xs sm:text-sm",children:"Sair"})]}):e.jsx(X,{to:"/login",className:"hover:underline transition-colors hover:text-white/80 text-xs sm:text-sm",children:"Entrar"})})]}),e.jsx("div",{className:"border-t border-white/20 py-2",children:e.jsxs("nav",{className:"flex items-center justify-center gap-1 sm:gap-3 text-xs sm:text-sm overflow-x-auto",children:[e.jsx(X,{to:"/",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Home"}),e.jsx(X,{to:"/futsal",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Futsal"}),e.jsx(X,{to:"/volei",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Vôlei"}),e.jsx(X,{to:"/fifa",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"FIFA"}),e.jsx(X,{to:"/pebolim",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Pebolim"}),t&&e.jsx(X,{to:"/admin",className:"bg-white/15 hover:bg-white/25 transition-colors px-2 py-1 rounded text-xs whitespace-nowrap ml-1 sm:ml-2",children:"Admin"})]})})]})}),e.jsx("main",{className:"flex-1 container mx-auto p-4",children:e.jsxs($t,{children:[e.jsx(ee,{path:"/",element:e.jsx(fa,{})}),e.jsx(ee,{path:"/futsal",element:e.jsx(Ia,{})}),e.jsx(ee,{path:"/volei",element:e.jsx(Za,{})}),e.jsx(ee,{path:"/fifa",element:e.jsx(ur,{})}),e.jsx(ee,{path:"/pebolim",element:e.jsx(vr,{})}),e.jsx(ee,{path:"/team/:id",element:e.jsx(As,{})}),e.jsx(ee,{path:"/times/:id",element:e.jsx(As,{})}),e.jsx(ee,{path:"/match/:id",element:e.jsx(Ts,{})}),e.jsx(ee,{path:"/partida/:id",element:e.jsx(Ts,{})}),e.jsx(ee,{path:"/set-password",element:e.jsx(Ps,{})}),e.jsx(ee,{path:"/login",element:e.jsx(Vr,{})}),e.jsx(ee,{path:"/admin",element:e.jsx(ue,{children:e.jsx(Br,{})})}),e.jsx(ee,{path:"/admin/elencos",element:e.jsx(ue,{children:e.jsx(Ur,{})})}),e.jsx(ee,{path:"/admin/partidas",element:e.jsx(ue,{children:e.jsx(en,{})})}),e.jsx(ee,{path:"/admin/campeonatos",element:e.jsx(ue,{children:e.jsx(rn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/futsal",element:e.jsx(ue,{children:e.jsx(cn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/volei",element:e.jsx(ue,{children:e.jsx(un,{})})}),e.jsx(ee,{path:"/admin/campeonatos/fifa",element:e.jsx(ue,{children:e.jsx(pn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/pebolim",element:e.jsx(ue,{children:e.jsx(yn,{})})}),e.jsx(ee,{path:"*",element:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"404 - Página não encontrada"}),e.jsx(X,{to:"/",className:"text-blue-600 hover:underline",children:"Voltar ao início"})]})})]})}),e.jsx("footer",{className:"bg-gray-200 p-4 text-center text-xs text-gray-700 mt-auto",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("p",{children:["© ",new Date().getFullYear()," Copa Influence"]}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Desenvolvido para a comunidade da igreja"})]})})]})}Ft.createRoot(document.getElementById("root")).render(e.jsx(Ve.StrictMode,{children:e.jsx(Ct,{children:e.jsx(qt,{children:e.jsx(Nn,{})})})}));
