import{r as St,b as $t,a as Ct,c,u as gs,N as At,L as W,R as Ke,d as Ks,e as fe,f as Et,h as kt,i as re,B as Tt}from"./vendor-vbeBnipd.js";import{c as Pt}from"./supabase-BfEApigK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function a(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=a(o);fetch(o.href,l)}})();var Xe={exports:{}},ke={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ps;function Ft(){if(ps)return ke;ps=1;var s=St(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function n(r,m,w){var j,E={},T=null,_=null;w!==void 0&&(T=""+w),m.key!==void 0&&(T=""+m.key),m.ref!==void 0&&(_=m.ref);for(j in m)i.call(m,j)&&!l.hasOwnProperty(j)&&(E[j]=m[j]);if(r&&r.defaultProps)for(j in m=r.defaultProps,m)E[j]===void 0&&(E[j]=m[j]);return{$$typeof:t,type:r,key:T,ref:_,props:E,_owner:o.current}}return ke.Fragment=a,ke.jsx=n,ke.jsxs=n,ke}var xs;function Mt(){return xs||(xs=1,Xe.exports=Ft()),Xe.exports}var e=Mt(),Ie={},fs;function Rt(){if(fs)return Ie;fs=1;var s=$t();return Ie.createRoot=s.createRoot,Ie.hydrateRoot=s.hydrateRoot,Ie}var qt=Rt();const It=Ct(qt),Gt="https://cifdtjfrekucrmapewoj.supabase.co",Lt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpZmR0amZyZWt1Y3JtYXBld29qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTM2OTAsImV4cCI6MjA3MzU2OTY5MH0.h4cP9OeroEa4XEQsOrdgy8L-fewT--DC2AtUk9ipJAA",f=Pt(Gt,Lt),Xs=c.createContext({session:null,user:null,isAdmin:!1,needsPasswordSetup:!1,ready:!1,loading:!1,signIn:async()=>({data:null,error:null}),signOut:async()=>({error:null}),updatePassword:async()=>({data:null,error:null}),refreshAuth:async()=>{}});function hs(){return c.useContext(Xs)}function Ot({children:s}){const[t,a]=c.useState(null),[i,o]=c.useState(!1),[l,n]=c.useState(!1),[r,m]=c.useState(!1),[w,j]=c.useState(!0),E=c.useRef(!0),T=c.useRef(0),_=I=>I?.user_metadata?.password_set===!0;c.useEffect(()=>{E.current=!0,(async()=>{try{j(!0);const{data:D,error:b}=await f.auth.getSession();if(b)throw b;const d=D?.session??null;if(!E.current)return;a(d),n(d?.user?!_(d.user):!1),m(!0),j(!1),d?.user?.id?$(d):o(!1)}catch(D){if(console.error("Auth init error:",D),!E.current)return;a(null),o(!1),n(!1),m(!0),j(!1)}})();const{data:I}=f.auth.onAuthStateChange(async(D,b)=>{E.current&&(a(b??null),b?.user?(n(!_(b.user)),b.user.id?$(b):o(!1)):(o(!1),n(!1)))});return()=>{E.current=!1,I?.subscription?.unsubscribe?.()}},[]);const $=async I=>{const D=++T.current;try{if(!I?.user?.id){E.current&&D===T.current&&o(!1);return}const{data:d,error:x}=await f.rpc("is_admin");E.current&&D===T.current&&o(!!d&&!x)}catch(b){console.error("checkAdmin error:",b),E.current&&D===T.current&&o(!1)}},S=async(I,D)=>{const b=await f.auth.signInWithPassword({email:I,password:D});return b.data?.session?.user?.id&&!b.error&&(a(b.data.session),n(!_(b.data.session.user)),$(b.data.session)),b},P=async()=>{const{error:I}=await f.auth.signOut();return I||(a(null),o(!1),n(!1)),{error:I}},k=async I=>{const{data:D,error:b}=await f.auth.updateUser({password:I,data:{password_set:!0}});if(!b){n(!1);const{data:d}=await f.auth.getSession();a(d?.session??null)}return{data:D,error:b}},V=async()=>{const{data:I}=await f.auth.getSession(),D=I?.session??null;a(D),D?.user?.id?(n(!_(D.user)),$(D)):(o(!1),n(!1))},L={session:t,user:t?.user??null,isAdmin:i,needsPasswordSetup:l,ready:r,loading:w,signIn:S,signOut:P,updatePassword:k,refreshAuth:V};return e.jsx(Xs.Provider,{value:L,children:s})}function je({children:s}){const{ready:t,session:a,isAdmin:i}=hs(),o=gs();if(!t)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Verificando permissões..."})]})});if(!a||!i){const l=encodeURIComponent(o.pathname+o.search);return e.jsx(At,{to:`/login?redirect=${l}&reason=forbidden`,replace:!0})}return s}function ne({team:s={},size:t=24,className:a=""}){const[i,o]=c.useState(!1),l=c.useMemo(()=>{const m=s?.logo_url;return typeof m=="string"&&m.trim()&&!i?m:null},[s?.logo_url,i]),n=c.useMemo(()=>{const m=String(s?.name??"").trim();if(!m)return"•";const w=m.match(new RegExp("\\p{L}","u"));return(w?w[0]:m[0]).toUpperCase()},[s?.name]),r={width:t,height:t};return e.jsx("span",{className:`inline-flex items-center justify-center rounded border border-gray-200 bg-white overflow-hidden ${a}`,style:r,title:s?.name,children:l?e.jsx("img",{src:l,alt:s?.name||"Logo",className:"w-full h-full object-cover",onError:()=>o(!0),draggable:!1}):e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-gray-600 select-none",children:n})})}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Bt=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,a,i)=>i?i.toUpperCase():a.toLowerCase()),ys=s=>{const t=Bt(s);return t.charAt(0).toUpperCase()+t.slice(1)},Zs=(...s)=>s.filter((t,a,i)=>!!t&&t.trim()!==""&&i.indexOf(t)===a).join(" ").trim(),Vt=s=>{for(const t in s)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ut={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=c.forwardRef(({color:s="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:i,className:o="",children:l,iconNode:n,...r},m)=>c.createElement("svg",{ref:m,...Ut,width:t,height:t,stroke:s,strokeWidth:i?Number(a)*24/Number(t):a,className:Zs("lucide",o),...!l&&!Vt(r)&&{"aria-hidden":"true"},...r},[...n.map(([w,j])=>c.createElement(w,j)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=(s,t)=>{const a=c.forwardRef(({className:i,...o},l)=>c.createElement(zt,{ref:l,iconNode:t,className:Zs(`lucide-${Dt(ys(s))}`,`lucide-${s}`,i),...o}));return a.displayName=ys(s),a};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ht=de("chevron-right",Jt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],Xt=de("chevrons-right",Kt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Qt=de("circle-play",Zt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Qs=de("circle-question-mark",Wt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],ea=de("list-checks",Yt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ta=de("loader-circle",sa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],ra=de("megaphone",aa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],oa=de("refresh-cw",na);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],la=de("rotate-cw",ia);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],bs=de("settings",ca);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],ma=de("shield-alert",da);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],ga=de("trash-2",ua);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ha=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],Ws=de("trophy",ha),Ze=[{name:"Volei",label:"Vôlei",key:"volei",callText:"⚠️ Compareçam à quadra de Vôlei:"},{name:"FIFA",label:"FIFA",key:"fifa",callText:"⚠️ Compareçam à área do console:"},{name:"Futsal",label:"Futsal",key:"futsal",callText:"⚠️ Compareçam à quadra de Futsal:"},{name:"Pebolim",label:"Pebolim",key:"pebolim",callText:"⚠️ Compareçam à mesa de pebolim:"}],pa={r32:"PRÉ-OITAVAS",grupos:"GRUPOS",oitavas:"OITAVAS",quartas:"QUARTAS",semi:"SEMI",final:"FINAL","3lugar":"3º LUGAR"};function xa(s){return s?pa[s]||String(s).toUpperCase():null}const fa="team-logos";function Ys(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function ya(s){return typeof s=="string"&&!Ys(s)&&s.trim()!==""}function ba(s){if(!s)return null;if(Ys(s))return s;if(ya(s)){const{data:t}=f.storage.from(fa).getPublicUrl(s);return t?.publicUrl||null}return null}function et(s){if(!s)return!1;const t=s.slots||{},a=["live","call","next"].some(o=>Array.isArray(t?.[o])&&t[o].some(l=>!!l?.match_id)),i=Array.isArray(s.compactUpcoming)&&s.compactUpcoming.length>0;return a||i}function ja(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),o=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(o<0)return"0:00";const l=Math.floor(o/1e3),n=Math.floor(l/60),r=l%60;return`${n}:${r.toString().padStart(2,"0")}`}function js(s,t){const a=s?.meta||{};return Math.max(0,Number(a[t==="home"?"home_sets":"away_sets"]||0))}function _a({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Na(){const[s,t]=c.useState({}),[a,i]=c.useState(!0),[o,l]=c.useState(null),[n,r]=c.useState(Date.now()),m=c.useRef(!0),w=c.useRef(!1),j=c.useRef({}),E=async()=>{if(!w.current){w.current=!0,Object.keys(j.current||{}).length||i(!0),l(null);try{const{data:$,error:S}=await f.from("sports").select("id,name");if(S)throw S;const P=new Map(($||[]).map(I=>[I.name,I.id])),k=Ze.filter(I=>P.has(I.name)).map(I=>({...I,sportId:P.get(I.name)})),V=await Promise.all(k.map(async I=>{const{data:D,error:b}=await f.from("v_queue_slots_v2").select("slot, lane_idx, lane_code, order_idx, match_id, stage, group_name").eq("sport_id",I.sportId);if(b)throw b;const d={live:[],call:[],next:[]};(D||[]).forEach(A=>{d[A.slot]&&d[A.slot].push(A)}),Object.keys(d).forEach(A=>{d[A].sort((g,y)=>(g.lane_idx??0)-(y.lane_idx??0))});const x=(D||[]).map(A=>A.match_id).filter(Boolean);let v={};if(x.length){const{data:A}=await f.from("matches").select(`
                id, order_idx, stage, group_name, status, starts_at, updated_at, venue, meta,
                home_score, away_score,
                home:home_team_id ( id, name, logo_url, color ),
                away:away_team_id ( id, name, logo_url, color ),
                sport:sport_id ( id, name )
              `).in("id",x),g=(A||[]).map(y=>{const R=y.home&&typeof y.home=="object"?{...y.home,logo_url:we(y.home.logo_url)}:y.home,N=y.away&&typeof y.away=="object"?{...y.away,logo_url:we(y.away.logo_url)}:y.away;return{...y,home:R,away:N}});v=Object.fromEntries(g.map(y=>[y.id,y]))}if(!(d.live||[]).some(A=>A?.match_id)){const{data:A,error:g}=await f.from("matches").select(`
                id, order_idx, stage, group_name, status, starts_at, updated_at, venue, meta,
                home_score, away_score,
                home:home_team_id ( id, name, logo_url, color ),
                away:away_team_id ( id, name, logo_url, color ),
                sport:sport_id ( id, name )
              `).eq("sport_id",I.sportId).in("status",["ongoing","paused"]).limit(6);!g&&A?.length&&(A.slice().sort((R,N)=>{const G=q=>q==="ongoing"?1:q==="paused"?2:9,z=G(R.status)-G(N.status);return z!==0?z:new Date(N.updated_at||N.starts_at||0)-new Date(R.updated_at||R.starts_at||0)}).slice(0,2).forEach(R=>{const N=R.home&&typeof R.home=="object"?{...R.home,logo_url:we(R.home.logo_url)}:R.home,G=R.away&&typeof R.away=="object"?{...R.away,logo_url:we(R.away.logo_url)}:R.away,z={...R,home:N,away:G};v[z.id]=z,d.live||(d.live=[]);const q=d.live.findIndex(J=>!J?.match_id);if(q!==-1){const J=d.live[q]||{};d.live[q]={...J,slot:"live",match_id:z.id,order_idx:z.order_idx,stage:z.stage,group_name:z.group_name}}else{const J=d.live.length,Z=J<26?String.fromCharCode(65+J):`${J+1}`;d.live.push({slot:"live",lane_idx:J,lane_code:Z,match_id:z.id,order_idx:z.order_idx,stage:z.stage,group_name:z.group_name})}}),d.live.sort((R,N)=>(R.lane_idx??0)-(N.lane_idx??0)))}const M=[...(d.call||[]).map(A=>A.match_id),...(d.next||[]).map(A=>A.match_id)].filter(Boolean),{data:u}=await f.from("matches").select(`
              id, order_idx, stage, group_name, status,
              home:home_team_id ( id, name, logo_url, color ),
              away:away_team_id ( id, name, logo_url, color )
            `).eq("sport_id",I.sportId).eq("status","scheduled").not("order_idx","is",null).order("order_idx",{ascending:!0}).limit(10),p=(u||[]).filter(A=>!M.includes(A.id)).slice(0,6).map(A=>({id:A.id,order_idx:A.order_idx,stage:A.stage,group_name:A.group_name,home:A.home?{...A.home,logo_url:we(A.home.logo_url)}:null,away:A.away?{...A.away,logo_url:we(A.away.logo_url)}:null}));return[I.key,{...I,slots:d,details:v,compactUpcoming:p}]})),L=Object.fromEntries(V);j.current=L,t(L)}catch($){l(`Falha ao carregar a Home: ${$.message||$}`)}finally{i(!1),w.current=!1}}},T=c.useCallback($=>{if(!$?.id)return!1;let S=!1,P=!1;return t(k=>{let V=!1;const L={...k};for(const[I,D]of Object.entries(k)){if(!D)continue;let b=!1,d=D.details;const x=D.details?.[$.id];if(x){const C=$.status??x.status,M=$.order_idx??x.order_idx,u=$.stage??x.stage,p=$.group_name??x.group_name;(C!==x.status||M!==x.order_idx||u!==x.stage||p!==x.group_name)&&(S=!0);const g={...x,status:C,starts_at:$.starts_at??x.starts_at,updated_at:$.updated_at??x.updated_at,home_score:typeof $.home_score=="number"?$.home_score:x.home_score,away_score:typeof $.away_score=="number"?$.away_score:x.away_score,meta:$.meta??x.meta,stage:u,group_name:p,order_idx:M,venue:$.venue??x.venue};d={...D.details,[$.id]:g},b=!0,P=!0}let v=D.compactUpcoming;if(Array.isArray(D.compactUpcoming)&&D.compactUpcoming.length){let C=!1;const M=D.compactUpcoming.map(u=>u.id!==$.id?u:(C=!0,{...u,stage:$.stage??u.stage,group_name:$.group_name??u.group_name,order_idx:$.order_idx??u.order_idx}));C&&(v=M,b=!0)}b&&(L[I]={...D,details:d,compactUpcoming:v},V=!0)}return V?(j.current=L,L):k}),S?!1:P},[]);c.useEffect(()=>{m.current=!0,E();const $=setInterval(()=>r(Date.now()),1e3),S=f.channel("home-central").on("postgres_changes",{event:"*",schema:"public",table:"matches"},P=>{if(!m.current)return;const k=P?.eventType||P?.type,V=P?.new;k==="UPDATE"&&V?.id&&T(V)||E()}).on("postgres_changes",{event:"*",schema:"public",table:"match_events"},()=>m.current&&E()).subscribe();return()=>{m.current=!1,clearInterval($),f.removeChannel(S)}},[]);const _=c.useMemo(()=>{const $=new Map(Ze.map((k,V)=>[k.key,V])),P=Ze.map(k=>k.key).filter(k=>s[k]).map(k=>({key:k,index:$.get(k)??0,hasMatches:et(s[k])}));return P.sort((k,V)=>k.hasMatches!==V.hasMatches?k.hasMatches?-1:1:k.index-V.index),P.map(k=>k.key)},[s]);return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Central do Evento"})]}),e.jsxs("button",{onClick:E,className:"inline-flex items-center gap-2 rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Recarregar agora",children:[e.jsx(oa,{className:"h-4 w-4"}),"Atualizar"]})]}),o&&e.jsx("div",{className:"mb-5 rounded-xl border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-800",children:o}),a?e.jsx(Sa,{}):e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:_.map($=>e.jsx(va,{block:s[$],now:n},$))}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function va({block:s,now:t}){const{label:a,callText:i,slots:o,details:l,compactUpcoming:n}=s||{},r=(o?.live||[]).map(_=>({row:_,match:l?.[_.match_id]})).filter(_=>_.match),m=(o?.call||[]).map(_=>({row:_,match:l?.[_.match_id]})).filter(_=>_.match),w=(o?.next||[]).map(_=>({row:_,match:l?.[_.match_id]})).filter(_=>_.match),j=r[0]?.match,E=r[0]?.row,T=et(s);return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between gap-3 p-4 sm:p-5",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-lg font-semibold",children:a})})}),T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-4 sm:px-5",children:e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-red-800",children:[e.jsx(Qt,{className:"h-4 w-4"}),j?e.jsxs(W,{to:`/match/${j.id}`,className:"hover:underline",children:[j.status==="paused"?"Pausado":"Ao vivo"," — Jogo ",j.order_idx,E?.lane_code?` • Fila ${E.lane_code}`:"",j.group_name?` • Grupo ${j.group_name}`:""]}):e.jsx("span",{children:"Ao vivo"})]}),j?.stage?e.jsx(_s,{stage:j.stage}):e.jsx("span",{className:"text-xs text-red-700/70",children:"Aguardando…"})]}),r.length?e.jsx("div",{className:"space-y-2",children:r.map(({row:_,match:$})=>e.jsxs("div",{className:"rounded-lg bg-white p-2 border",children:[e.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-gray-600",children:[_.lane_code?`Fila ${_.lane_code}`:"",$.group_name?` • Grupo ${$.group_name}`:""]}),e.jsx(wa,{match:$,now:t})]},`live-${_.lane_idx??$.id}`))}):e.jsx("div",{className:"text-sm text-gray-600",children:"Nenhuma partida ao vivo no momento."})]})}),e.jsx("div",{className:"px-4 pb-4 sm:px-5 sm:pb-5",children:e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(Ns,{tone:"amber",icon:e.jsx(ra,{className:"h-4 w-4"}),title:"Próxima partida",subtitle:i,items:m}),e.jsx(Ns,{tone:"emerald",icon:e.jsx(Xt,{className:"h-4 w-4"}),title:"Jogo seguinte",subtitle:"Na sequência:",items:w})]})}),n?.length?e.jsxs("div",{className:"border-t px-4 py-3 sm:px-5",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-gray-800",children:"Agendados (próximos)"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:n.map(_=>e.jsxs(W,{to:`/match/${_.id}`,className:"flex items-center justify-between rounded-lg border bg-gray-50 px-3 py-2 hover:bg-gray-100",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"truncate text-sm font-medium text-gray-900",children:["Jogo ",_.order_idx,_.group_name?` • Grupo ${_.group_name}`:""]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-gray-700",children:[e.jsx(He,{team:_.home,size:20,allowLink:!1}),e.jsx("span",{className:"text-gray-400",children:"x"}),e.jsx(He,{team:_.away,size:20,align:"right",allowLink:!1})]})]}),e.jsx("div",{className:"ml-3 shrink-0",children:e.jsx(_s,{stage:_.stage})})]},_.id))})]}):null]}):e.jsx("div",{className:"px-4 pb-5 sm:px-5",children:e.jsx("div",{className:"rounded-xl border border-red-400 bg-red-100 px-4 py-6 text-center text-sm font-semibold text-red-800",children:"Nenhum jogo agendado dessa modalidade"})})]})}function _s({stage:s}){const t=xa(s);return t?e.jsx("span",{className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-semibold tracking-wide text-gray-700",children:t}):null}function wa({match:s,now:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),i=s.status!=="scheduled",o=Number(s?.home_score??0),l=Number(s?.away_score??0),n=a?js(s,"home"):0,r=a?js(s,"away"):0,m=s?.status==="ongoing"||s?.status==="paused",w=a?Number(s?.meta?.home_points_set??0):0,j=a?Number(s?.meta?.away_points_set??0):0,E=a&&(m||w>0||j>0);return e.jsxs(W,{to:`/match/${s.id}`,className:"block rounded-xl bg-white p-3 shadow-sm hover:bg-gray-50 relative overflow-hidden",children:[e.jsx(_a,{status:s.status}),e.jsxs("div",{className:"mb-2 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.group_name?e.jsxs("span",{children:["Grupo ",s.group_name]}):e.jsx("span",{}),s.venue?e.jsxs("span",{className:"text-gray-400",children:["• ",s.venue]}):null]}),(s.status==="ongoing"||s.status==="paused")&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",ja(s,t)]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(vs,{team:s.home,align:"left"}),e.jsxs("div",{className:"shrink-0 text-center",children:[a&&e.jsxs("div",{className:"text-[11px] font-semibold text-gray-600 tabular-nums",children:[n," ",e.jsx("span",{className:"text-gray-400",children:"sets"})," ",r]}),i?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-xl font-bold tabular-nums",children:[E?w:o," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",E?j:l]})}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"})]}),e.jsx(vs,{team:s.away,align:"right"})]})]})}function Ns({tone:s,icon:t,title:a,subtitle:i,items:o}){const l=s==="amber"?"border-amber-200 bg-amber-50":s==="emerald"?"border-emerald-200 bg-emerald-50":"border-gray-200 bg-gray-50";return e.jsxs("div",{className:`rounded-xl border ${l} p-3 sm:p-4`,children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[t,e.jsx("span",{children:a})]}),e.jsx("span",{className:"text-xs text-gray-500",children:o?.length?`${o.length} fila(s)`:""})]}),e.jsx("div",{className:"text-xs text-gray-600",children:i}),e.jsx("div",{className:"mt-2 space-y-2",children:o?.length?o.map(({row:n,match:r})=>e.jsxs("div",{className:"rounded-lg bg-white/70 p-2 border",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-[11px] text-gray-600",children:[e.jsxs("span",{className:"font-semibold",children:[n.lane_code?`Fila ${n.lane_code}`:"",r.group_name?` • Grupo ${r.group_name}`:""]}),e.jsxs("span",{className:"text-gray-500",children:["#",n.order_idx??"–"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(He,{team:r.home}),e.jsx("span",{className:"px-1 text-gray-400",children:"x"}),e.jsx(He,{team:r.away,align:"right"})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:r.venue||""}),e.jsxs(W,{to:`/match/${r.id}`,className:"inline-flex items-center gap-1 text-blue-600 hover:underline",children:["Ver partida ",e.jsx(Ht,{className:"h-3.5 w-3.5"})]})]})]},`q-${n.slot}-${n.lane_idx??r.id}`)):e.jsx("div",{className:"text-sm text-gray-500",children:"Aguardando…"})})]})}function He({team:s,size:t=24,align:a="left",allowLink:i=!0}){const o=e.jsxs(e.Fragment,{children:[e.jsx(ne,{team:s||{name:"A definir"},size:t}),e.jsx("span",{className:`truncate text-sm ${a==="right"?"text-right":""}`,children:s?.name||"A definir"})]});return!i||!s?.id?e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${a==="right"?"justify-end":""}`,children:o}):e.jsx(W,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 ${a==="right"?"justify-end":""} hover:underline`,title:s?.name,onClick:l=>l.stopPropagation(),children:o})}function vs({team:s,align:t="left"}){return e.jsxs("div",{className:`flex items-center ${t==="right"?"justify-end":""} gap-2 min-w-0 flex-1`,children:[t!=="right"&&e.jsx(ne,{team:s||{name:"A definir"},size:36}),s?.id?e.jsx(W,{to:`/team/${s.id}`,className:`truncate text-sm font-medium hover:underline ${t==="right"?"text-right":"text-left"}`,title:s?.name,onClick:a=>a.stopPropagation(),children:s?.name||"A definir"}):e.jsx("span",{className:`truncate text-sm ${t==="right"?"text-right text-gray-400":"text-gray-400"}`,children:"A definir"}),t==="right"&&e.jsx(ne,{team:s||{name:"A definir"},size:36})]})}function Sa(){return e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:Array.from({length:4}).map((s,t)=>e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("div",{className:"mb-3 h-6 w-40 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"mb-3 h-24 animate-pulse rounded bg-red-100/60"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsx("div",{className:"h-20 animate-pulse rounded bg-amber-100/60"}),e.jsx("div",{className:"h-20 animate-pulse rounded bg-emerald-100/60"})]}),e.jsx("div",{className:"mt-3 h-16 animate-pulse rounded bg-gray-100"})]},t))})}function we(s){const t=ba(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null}const $a="Futsal",Ca="⚽",Aa="team-logos",Ea="America/Sao_Paulo",ka={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},st=s=>s?ka[s]||s:"",Ta=new Set(["grupos","grupo","groups","group","group stage","group_stage","fase de grupos","fase-de-grupos"]),Pa=new Set(["finished","encerrado","finalizado","completed","complete","cancelado","cancelled","canceled","walkover","wo"]),tt=s=>s==null?"":String(s).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().trim();function Fa(s){if(!s)return!1;const t=tt(s.stage);if(t)return Ta.has(t);const a=String(s?.group_name??"").trim();return!a||a==="-"?!1:!!(/^grupo\s+/i.test(a)||/^[a-z0-9]$/i.test(a))}const Ma=s=>Pa.has(tt(s));function at(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function ns(s){const t=at(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:Ea,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const Ge=s=>{const t=at(s);return t?t.getTime():Number.POSITIVE_INFINITY},rt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Ra=s=>typeof s=="string"&&!rt(s)&&s.trim()!=="";function qa(s){if(!s)return null;if(rt(s))return s;if(Ra(s)){const{data:t}=f.storage.from(Aa).getPublicUrl(s);return t?.publicUrl||null}return null}const Se=s=>{const t=qa(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};let Ia=class extends Ke.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Futsal ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}};function nt({order_idx:s,stage:t,group_name:a}){const i=[];return s!=null&&String(s).length&&i.push(`Jogo ${s}`),a?i.push(`Grupo ${a}`):t&&i.push(st(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:i.join(" • ")||"—"})}function os({team:s,align:t="left",badge:a=28}){const i=(()=>{const r=s?.name;if(typeof r=="string")return r;if(r&&typeof r=="object"&&"name"in r)return String(r.name);try{return String(r??"A definir")}catch{return"A definir"}})(),o=!!s?.id,l=!o&&i==="A definir",n=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(ne,{team:{...s||{},name:i},size:a}),e.jsxs("span",{className:`block truncate text-base sm:text-lg font-semibold ${o?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:[i,l?e.jsx(Qs,{className:"inline-block ml-1 w-4 h-4 text-gray-400"}):null]}),t==="right"?e.jsx(ne,{team:{...s||{},name:i},size:a}):null]});return o?e.jsx(W,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:r=>r.stopPropagation(),title:i,children:n}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:n})}function Te({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),i=s?.away||(t?.away?{name:t.away}:null),o=a?.id?a:{name:a?.name||"A definir"},l=i?.id?i:{name:i?.name||"A definir"},n=s?.status&&s.status!=="scheduled",r=Number(s?.home_score??0),m=Number(s?.away_score??0),w=({value:T})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:n?T:"-"})]}),j=({team:T,align:_,score:$})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${_==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(os,{team:T,align:_})}),e.jsx(w,{value:$})]}),E=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(nt,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(j,{team:o,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(j,{team:l,align:"right",score:m})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ns(s.starts_at):s?.venue||""}),n?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",m]}):null]})]});return s?.id?e.jsx(W,{to:`/match/${s.id}`,className:"block",children:E}):e.jsx("div",{className:"block",children:E})}function ws({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),i=Number(s?.away_score??0);return e.jsxs(W,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(nt,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(os,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs("span",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",i]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(os,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ns(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",ns(s.updated_at)]}):null]})]})}function Ga(s,t){const a=Number(s.points??0),i=Number(t.points??0);if(i!==a)return i-a;const o=Number(s.wins??0),l=Number(t.wins??0);if(l!==o)return l-o;const n=Number(s.goal_difference??Number(s.goals_for??0)-Number(s.goals_against??0)),r=Number(t.goal_difference??Number(t.goals_for??0)-Number(t.goals_against??0));if(r!==n)return r-n;const m=Number(s.goals_for??0),w=Number(t.goals_for??0);return w!==m?w-m:String(s.team_id).localeCompare(String(t.team_id))}function Le(s,t){return(t.points??0)-(s.points??0)||(t.wins??0)-(s.wins??0)||(t.goal_difference??0)-(s.goal_difference??0)||(t.goals_for??0)-(s.goals_for??0)||String(s.team_id).localeCompare(String(t.team_id))}function La(s,t={}){if(!Array.isArray(s)||s.length===0)return[];const a=r=>{const m=t[r.team_id];return m?{id:r.team_id,name:String(m.name??r.team_name??"—"),color:m.color,logo_url:m.logo_url}:{id:r.team_id,name:String(r.team_name??"—")}},i=new Map;for(const r of s){const m=r.group_name||"-";i.has(m)||i.set(m,[]),i.get(m).push(r)}for(const r of i.keys())i.get(r).sort(Le);const o=[],l=[];for(const[r,m]of i)m[0]&&o.push({group:r,row:m[0]}),m[1]&&l.push({group:r,row:m[1]});o.sort((r,m)=>Le(r.row,m.row)),l.sort((r,m)=>Le(r.row,m.row));const n=o.length;if(n>=4){const r=o.slice(0,4);return[{stage:"semi",home:a(r[0].row),away:a(r[3].row)},{stage:"semi",home:a(r[1].row),away:a(r[2].row)}]}else{if(n===3)return l.length?[{stage:"semi",home:a(o[0].row),away:a(l[0].row)},{stage:"semi",home:a(o[1].row),away:a(o[2].row)}]:[];if(n===2){if(l.length<2)return[];const r=[o[0].row,o[1].row,l[0].row,l[1].row].sort(Le);return[{stage:"semi",home:a(r[0]),away:a(r[3])},{stage:"semi",home:a(r[1]),away:a(r[2])}]}}return[]}function Oa({standings:s,teamsById:t}){const a=c.useMemo(()=>{const o={};for(const r of s||[]){const m=r.group_name||"-";o[m]||(o[m]=[]),o[m].push(r)}const l=new Set,n={};for(const r in t){const m=t[r],w=m.group_name||"-";l.add(w),n[w]||(n[w]=[]),n[w].push(m)}for(const r of l){const m=new Set((o[r]||[]).map(E=>String(E.team_id))),j=(n[r]||[]).filter(E=>!m.has(String(E.id))).map(E=>({group_name:r,team_id:E.id,team_name:E.name,matches_played:0,wins:0,draws:0,losses:0,goals_for:0,goals_against:0,goal_difference:0,points:0}));o[r]=[...o[r]||[],...j],o[r].sort(Ga),o[r]=o[r].map((E,T)=>({...E,rank:T+1}))}return o},[s,t]),i=Object.keys(a).sort();return i.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:i.map(o=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",o]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"E"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[o].map(l=>{const n=t[l.team_id]&&typeof t[l.team_id]=="object"?t[l.team_id]:{id:l.team_id,name:String(l.team_name??t[l.team_id]?.name??"—")},r={...n,name:typeof n.name=="string"?n.name:String(n.name??"—")};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:l.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(W,{to:`/team/${r.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(ne,{team:r,size:20}),e.jsx("span",{className:"truncate",children:r.name})]})}),e.jsx("td",{className:"py-1 text-center",children:l.matches_played}),e.jsx("td",{className:"py-1 text-center",children:l.wins}),e.jsx("td",{className:"py-1 text-center",children:l.draws}),e.jsx("td",{className:"py-1 text-center",children:l.losses}),e.jsx("td",{className:"py-1 text-center",children:l.goals_for}),e.jsx("td",{className:"py-1 text-center",children:l.goals_against}),e.jsx("td",{className:"py-1 text-center",children:l.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:l.points})]},`${o}-${l.team_id}`)})})]}),e.jsx("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:"Critérios: Pontos, Vitórias, Saldo de Gols, Gols Pró."})]},o))})}function Da(s){const t=l=>(s||[]).filter(n=>n.stage===l).sort((n,r)=>(Number(n?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(r?.order_idx)||Number.MAX_SAFE_INTEGER)),a=t("semi"),i=t("final"),o=t("3lugar");return{semis:a,final:i[0],third:o[0]}}function Ba(){const[s,t]=c.useState(null),[a,i]=c.useState({}),[o,l]=c.useState([]),[n,r]=c.useState([]),[m,w]=c.useState(!0),[j,E]=c.useState("todos"),[T,_]=c.useState("todos"),$=c.useRef(null),S=c.useRef(null),P=c.useCallback(async()=>{try{const{data:g,error:y}=await f.from("sports").select("id").eq("name","Futsal").maybeSingle();if(y)throw y;g?.id?t(g.id):(console.warn("⚠️ Esporte 'Futsal' não encontrado na tabela sports."),t(null))}catch(g){console.error("Exceção loadSportId:",g),t(null)}},[]),k=c.useCallback(async g=>{try{if(g){const N=await f.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",g);if(!N.error&&Array.isArray(N.data)&&N.data.length>0){const G={};for(const z of N.data)G[z.id]={...z,name:String(z.name??"—"),logo_url:Se(z.logo_url),group_name:z.group_name??"-"};i(G);return}}const y=await f.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").eq("sport.name","Futsal");if(y.error)throw y.error;const R={};for(const N of y.data||[])R[N.id]={...N,name:String(N.name??"—"),logo_url:Se(N.logo_url),group_name:N.group_name??"-"};i(R)}catch(y){console.error("Exceção loadTeams:",y),i({})}},[]),V=c.useCallback(async g=>{try{if(g){const G=await f.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points").eq("sport_id",g).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!G.error&&Array.isArray(G.data)&&G.data.length>0){l(G.data);return}}const y=await f.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points, sport:sport_id!inner(name)").eq("sport.name","Futsal").order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!y.error&&Array.isArray(y.data)&&y.data.length>0){l(y.data.map(({sport:G,...z})=>z));return}if(g){const G=await f.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, draws, losses,
            goals_for, goals_against, goal_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",g).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!G.error&&Array.isArray(G.data)&&G.data.length>0){l(G.data.map(z=>({...z,team_name:z.team?.name})));return}}const N=((await f.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, draws, losses,
          goals_for, goals_against, goal_difference, points,
          team:teams!standings_team_id_fkey(name),
          sport:sport_id!inner(name)
        `).eq("sport.name","Futsal").order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(G=>({...G,team_name:G.team?.name}));l(N)}catch(y){console.error("Exceção loadStandings:",y),l([])}},[]),L=c.useCallback(async g=>{try{let y=[];if(g){const{data:G,error:z}=await f.from("match_detail_view").select(`
            id, sport_id, order_idx,
            stage, round, group_name, starts_at, updated_at, venue, status,
            home_team_id, home_team_name, home_team_color, home_team_logo,
            away_team_id, away_team_name, away_team_color, away_team_logo,
            home_score, away_score
          `).eq("sport_id",g);!z&&Array.isArray(G)&&G.length&&(y=G.map(q=>({id:q.id,sport_id:q.sport_id,order_idx:q.order_idx,stage:q.stage,round:q.round,group_name:q.group_name,starts_at:q.starts_at,updated_at:q.updated_at,venue:q.venue,status:q.status,home_score:q.home_score,away_score:q.away_score,home:q.home_team_id?{id:q.home_team_id,name:String(q.home_team_name??"A definir"),color:q.home_team_color,logo_url:Se(q.home_team_logo)}:null,away:q.away_team_id?{id:q.away_team_id,name:String(q.away_team_name??"A definir"),color:q.away_team_color,logo_url:Se(q.away_team_logo)}:null})))}if(!y.length){const{data:G,error:z}=await f.from("matches").select(`
            id, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score, order_idx,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color ),
            sport:sport_id!inner(name)
          `).eq("sport.name","Futsal");if(z)throw z;y=(G||[]).map(q=>({...q,order_idx:q.order_idx??q.round??q.id,home:q.home?{...q.home,name:String(q.home.name??"A definir"),logo_url:Se(q.home.logo_url)}:null,away:q.away?{...q.away,name:String(q.away.name??"A definir"),logo_url:Se(q.away.logo_url)}:null}))}const R={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6},N=G=>Number.isFinite(Number(G?.order_idx))?Number(G.order_idx):Number.MAX_SAFE_INTEGER;y.sort((G,z)=>(R[G.stage]??99)-(R[z.stage]??99)||N(G)-N(z)),r(y)}catch(y){console.error("Exceção loadMatches:",y),r([])}},[]),I=c.useCallback(async(g,{skeleton:y=!1}={})=>{y&&w(!0);try{await Promise.all([k(g),V(g),L(g)])}finally{w(!1)}},[k,V,L]);c.useEffect(()=>{P()},[P]),c.useEffect(()=>{if(!s){w(!1);return}if(I(s,{skeleton:!0}),$.current){try{f.removeChannel($.current)}catch{}$.current=null}const g=f.channel("futsal-hub").on("postgres_changes",s?{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`}:{event:"*",schema:"public",table:"matches"},()=>{S.current&&clearTimeout(S.current),S.current=setTimeout(()=>I(s,{skeleton:!1}),200)}).on("postgres_changes",{event:"*",schema:"public",table:"standings"},()=>{S.current&&clearTimeout(S.current),S.current=setTimeout(()=>I(s,{skeleton:!1}),200)}).subscribe();return $.current=g,()=>{if(S.current&&(clearTimeout(S.current),S.current=null),$.current){try{f.removeChannel($.current)}catch{}$.current=null}}},[s,I]);const D=c.useMemo(()=>!!(o?.length||(n||[]).some(g=>!!g.group_name)||Object.values(a||{}).some(g=>!!g.group_name)),[o,n,a]),b=c.useMemo(()=>{const g=(n||[]).filter(Fa);return g.length?g.every(y=>Ma(y?.status)):!0},[n]),d=c.useMemo(()=>Da(n),[n]),x=d.semis||[],v=c.useMemo(()=>b?La(o,a):[],[b,o,a]),C=c.useMemo(()=>x.length?x:v,[x,v]),M=c.useMemo(()=>{const g=new Set;return(n||[]).forEach(y=>y.group_name&&g.add(y.group_name)),(o||[]).forEach(y=>y.group_name&&g.add(y.group_name)),Object.values(a||{}).forEach(y=>y.group_name&&g.add(y.group_name)),["todos",...Array.from(g).sort()]},[n,o,a]),u=c.useMemo(()=>{const g=new Set;(n||[]).forEach(N=>N.stage&&g.add(N.stage));const y=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(g).sort((N,G)=>y.indexOf(N)+100-(y.indexOf(G)+100))]},[n]),p=c.useMemo(()=>{let g=(n||[]).filter(y=>y.status!=="scheduled"?!1:y.group_name?!0:y.home?.id&&y.away?.id);return j!=="todos"&&(g=g.filter(y=>y.group_name===j)),T!=="todos"&&(g=g.filter(y=>y.stage===T)),g.sort((y,R)=>Ge(y.starts_at)-Ge(R.starts_at)),g},[n,j,T]),A=c.useMemo(()=>{const g=(n||[]).filter(y=>y.status==="finished");return g.sort((y,R)=>Ge(R.updated_at||R.starts_at||0)-Ge(y.updated_at||y.starts_at||0)),g.slice(0,12)},[n]);return e.jsx(Ia,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Ca}),e.jsx("h2",{className:"text-2xl font-bold",children:$a})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"classificação"})," → ",e.jsx("strong",{children:"chaveamento"})," →"," ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),m?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((g,y)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},y))})]}):e.jsxs(e.Fragment,{children:[D&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Oa,{standings:o,teamsById:a})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),C?.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:C.map((g,y)=>e.jsx(Te,{match:g},`s-${g?.id??y}`))})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("p",{className:"text-xs text-gray-500",children:b?"Aguardando definição oficial dos confrontos.":"Confrontos aparecem aqui assim que todos os jogos da fase de grupos terminarem."}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:2}).map((g,y)=>e.jsx(Te,{placeholder:{home:"A definir",away:"A definir"}},`s-ph-${y}`))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),d.final?e.jsx(Te,{match:d.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(Te,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]}),d.third?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"3º lugar"}),e.jsx(Te,{match:d.third})]}):null]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:j,onChange:g=>E(g.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:M.map(g=>e.jsx("option",{value:g,children:g==="todos"?"Todos":`Grupo ${g}`},g))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:T,onChange:g=>_(g.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:u.map(g=>e.jsx("option",{value:g,children:g==="todos"?"Todas":st(g)},g))})]}),p.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:p.map((g,y)=>e.jsx(ws,{match:g},g.id??`sched-${y}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),A.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:A.map((g,y)=>e.jsx(ws,{match:g},g.id??`fin-${y}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas com ",e.jsx("strong",{children:"10 minutos corridos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo e o melhor 2º colocado avançam para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," saldo de gols."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor do grupo A × Vencedor do grupo B; Vencedor do grupo C × Melhor 2º colocado."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substituições:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desperdício de tempo:"})," pode ser acrescido ao final do jogo, a critério do árbitro."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Goleiro-linha:"})," permitido."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Expulsão:"})," o time fica com um jogador a menos por 2 minutos ou até sofrer um gol."]})]})})]})]})]})})}const Va="Vôlei",Ua="🏐",za="team-logos",Ja="America/Sao_Paulo",Ha={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},ot=s=>s?Ha[s]||s:"",Pe=["Vôlei","Volei","Voleibol"];function it(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function is(s){const t=it(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:Ja,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const $e=s=>{const t=it(s);return t?t.getTime():Number.POSITIVE_INFINITY},lt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Ka=s=>typeof s=="string"&&!lt(s)&&s.trim()!=="";function Xa(s){if(!s)return null;if(lt(s))return s;if(Ka(s)){const{data:t}=f.storage.from(za).getPublicUrl(s);return t?.publicUrl||null}return null}const ls=s=>{const t=Xa(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};let Za=class extends Ke.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Vôlei ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}};function ct({order_idx:s,stage:t,group_name:a}){const i=[];return s!=null&&String(s).length&&i.push(`Jogo ${s}`),a?i.push(`Grupo ${a}`):t&&i.push(ot(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:i.join(" • ")||"—"})}function cs({team:s,align:t="left",badge:a=28}){const i=(()=>{const n=s?.name;if(typeof n=="string")return n;if(n&&typeof n=="object"&&"name"in n)return String(n.name);try{return String(n??"A definir")}catch{return"A definir"}})(),o=!!s?.id,l=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(ne,{team:{...s||{},name:i},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${o?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:i}),t==="right"?e.jsx(ne,{team:{...s||{},name:i},size:a}):null]});return o?e.jsx(W,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:n=>n.stopPropagation(),title:i,children:l}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:l})}function Oe({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),i=s?.away||(t?.away?{name:t.away}:null),o=a?.id?a:{name:a?.name||"A definir"},l=i?.id?i:{name:i?.name||"A definir"},n=s&&s.status!=="scheduled",r=Number(s?.home_score??0),m=Number(s?.away_score??0),w=Number(s?.meta?.home_sets??0),j=Number(s?.meta?.away_sets??0),E=s?.status==="ongoing"||s?.status==="paused",T=Number(s?.meta?.home_points_set??0),_=Number(s?.meta?.away_points_set??0),S=w>0||j>0||n,P=E?"Pts (set)":"Pontos",k=E?T:r,V=E?_:m,L=({label:b,value:d,visible:x})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-2.5 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:b}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:x?d:"-"})]}),I=({team:b,align:d,sets:x,score:v})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${d==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(cs,{team:b,align:d})}),e.jsxs("div",{className:"flex items-center gap-2",children:[S?e.jsx(L,{label:"Sets",value:x,visible:S}):null,e.jsx(L,{label:P,value:v,visible:n})]})]}),D=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(ct,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(I,{team:o,align:"left",sets:w,score:k}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(I,{team:l,align:"right",sets:j,score:V})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?is(s.starts_at):s?.venue||""}),n?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:["Sets ",w," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",j]}):null]})]});return s?.id?e.jsx(W,{to:`/match/${s.id}`,className:"block",children:D}):D}function Ss({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),i=Number(s?.away_score??0),o=Number(s?.meta?.home_sets??0),l=Number(s?.meta?.away_sets??0),n=s?.status==="ongoing"||s?.status==="paused",r=Number(s?.meta?.home_points_set??0),m=Number(s?.meta?.away_points_set??0),w=t&&(o>0||l>0),j=n?r:a,E=n?m:i;return e.jsxs(W,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(ct,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(cs,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs(e.Fragment,{children:[w?e.jsxs("div",{className:"text-[11px] font-medium tabular-nums text-gray-600 mb-0.5",children:["Sets: ",o," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",l]}):null,e.jsxs("div",{className:"text-base font-bold tabular-nums",children:[j," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",E]})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(cs,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?is(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",is(s.updated_at)]}):null]})]})}function qe(s,t){return(t.points??0)-(s.points??0)||(t.sv??0)-(s.sv??0)||(s.sp??0)-(t.sp??0)||(t.point_difference??(t.pf??0)-(t.pa??0))-(s.point_difference??(s.pf??0)-(s.pa??0))||(t.pf??0)-(s.pf??0)||String(s.team_id).localeCompare(String(t.team_id))}function Qa(s){if(!Array.isArray(s)||s.length===0)return[];const t=s.map(n=>({...n,group_name:xe(n.group_name)})).filter(n=>n.group_name&&n.group_name!=="-"),a=new Map;for(const n of t){const r=n.group_name;a.has(r)||a.set(r,[]),a.get(r).push(n)}for(const n of a.keys())a.get(n).sort((r,m)=>(r.rank??999)-(m.rank??999));const i=[],o=[];for(const[n,r]of a)r[0]&&i.push({group:n,...r[0]}),r[1]&&o.push({group:n,...r[1]});i.sort(qe),o.sort(qe);const l=i.length;if(l>=4){const n=i.slice(0,4);return[{stage:"semi",home:n[0],away:n[3]},{stage:"semi",home:n[1],away:n[2]}]}else if(l===3){if(!o.length)return[];const n=o[0];return[{stage:"semi",home:i[0],away:n},{stage:"semi",home:i[1],away:i[2]}]}else if(l===2){if(o.length<2)return[];const n=[...i,o[0],o[1]].sort(qe);return[{stage:"semi",home:n[0],away:n[3]},{stage:"semi",home:n[1],away:n[2]}]}return[]}function Wa({standings:s,teamsById:t}){const a=c.useMemo(()=>{const o={};for(const l of s||[]){const n=l.group_name||"-";o[n]||(o[n]=[]),o[n].push(l)}for(const l of Object.keys(o))o[l].sort((n,r)=>(n.rank??999)-(r.rank??999));return o},[s]),i=Object.keys(a).sort();return i.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:i.map(o=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",o]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"SV"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"SP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"PF"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"PC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[o].map(l=>{const n=t[l.team_id]||{id:l.team_id,name:l.team_name||"—"},r=Number(l.point_difference??(l.pf??0)-(l.pa??0));return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:l.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(W,{to:`/team/${n.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(ne,{team:{...n,logo_url:ls(n.logo_url)},size:20}),e.jsx("span",{className:"truncate",children:n.name})]})}),e.jsx("td",{className:"py-1 text-center",children:l.matches_played}),e.jsx("td",{className:"py-1 text-center",children:l.wins}),e.jsx("td",{className:"py-1 text-center",children:l.losses}),e.jsx("td",{className:"py-1 text-center",children:l.sv}),e.jsx("td",{className:"py-1 text-center",children:l.sp}),e.jsx("td",{className:"py-1 text-center",children:l.pf}),e.jsx("td",{className:"py-1 text-center",children:l.pa}),e.jsx("td",{className:"py-1 text-center",children:r}),e.jsx("td",{className:"py-1 text-center font-semibold",children:l.points})]},`${o}-${l.team_id}`)})})]}),e.jsxs("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:["Critérios/colunas: ",e.jsx("strong",{children:"#"})," (posição), ",e.jsx("strong",{children:"Time"}),", ",e.jsx("strong",{children:"P"})," (jogos), ",e.jsx("strong",{children:"V"})," (vitórias), ",e.jsx("strong",{children:"D"})," (derrotas), ",e.jsx("strong",{children:"SV"})," (sets vencidos), ",e.jsx("strong",{children:"SP"})," (sets perdidos), ",e.jsx("strong",{children:"PF"})," (pontos feitos), ",e.jsx("strong",{children:"PC"})," (pontos contra), ",e.jsx("strong",{children:"+/-"})," (saldo de pontos), ",e.jsx("strong",{children:"Pts"})," (pontos na tabela)."]})]},o))})}const dt=s=>typeof s=="string"?s.trim().toLowerCase():"",Ya=s=>{const t=dt(s);return t==="semifinal"||t==="semi-final"||t==="semis"?"semi":t==="3º"||t==="3º lugar"||t==="terceiro"||t==="3-lugar"?"3lugar":t},er=s=>{const t=dt(s);return t==="encerrado"||t==="finalizado"?"finished":t==="agendado"||t==="programado"?"scheduled":t||"scheduled"},xe=s=>{if(!s)return"-";const t=String(s).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toUpperCase();if(!t)return"-";const a=t.match(/^GRUPO\s+([A-Z0-9]+)$/);return a?a[1]:t};function $s(s,t){const a=new Map,i=(m,w)=>`${m}::${w}`,o=(m,w)=>{const j=i(m,w);return a.has(j)||a.set(j,{group_name:m,team_id:w,team_name:t?.[w]?.name??"—",matches_played:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0,points:0}),a.get(j)},l=new Set;for(const m of s||[]){const w=xe(m?.group_name)||"-",j=m?.home?.id,E=m?.away?.id;j&&(o(w,j),l.add(j)),E&&(o(w,E),l.add(E))}for(const m of s||[]){if(m?.status!=="finished")continue;const w=xe(m?.group_name)||"-",j=m?.home?.id,E=m?.away?.id;if(!j||!E)continue;const T=o(w,j),_=o(w,E),$=Number(m?.meta?.home_sets??0),S=Number(m?.meta?.away_sets??0),P=Number(m?.home_score??0),k=Number(m?.away_score??0);let V=!1,L=!1;$!==S?(V=$>S,L=!V):P!==k&&(V=P>k,L=!V),T.matches_played++,_.matches_played++,T.sv+=$,T.sp+=S,T.pf+=P,T.pa+=k,_.sv+=S,_.sp+=$,_.pf+=k,_.pa+=P,V?(T.wins++,T.points+=3,_.losses++):L&&(_.wins++,_.points+=3,T.losses++)}for(const m of Object.keys(t||{})){const w=Number(m);if(l.has(w)||l.has(m))continue;const j=xe(t[m]?.group_name);j&&j!=="-"&&o(j,m)}const n={};for(const m of a.values())m.point_difference=Number(m.pf)-Number(m.pa),(n[m.group_name]||=[]).push(m);const r=[];for(const m of Object.keys(n).sort())n[m].sort(qe),n[m].forEach((w,j)=>r.push({...w,rank:j+1}));return r}function sr(){const[s,t]=c.useState(null),[a,i]=c.useState({}),o=c.useRef({});c.useEffect(()=>{o.current=a},[a]);const[l,n]=c.useState([]),[r,m]=c.useState([]),[w,j]=c.useState(!0),[E,T]=c.useState("todos"),[_,$]=c.useState("todos"),S=c.useRef(null),P=c.useRef(null),k=c.useCallback(async()=>{try{const{data:u,error:p}=await f.from("sports").select("id, name").in("name",Pe).limit(1);if(p)throw p;u&&u[0]?.id?t(u[0].id):(console.warn("⚠️ Esporte Vôlei não encontrado em 'sports' (nomes tentados:",Pe.join(", "),")"),t(null))}catch(u){console.error("Exceção loadSportId:",u),t(null)}},[]),V=c.useCallback(async u=>{try{if(u){const g=await f.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",u);if(!g.error&&Array.isArray(g.data)&&g.data.length>0){const y={};for(const R of g.data)y[R.id]={...R,name:String(R.name??"—"),logo_url:ls(R.logo_url)};i(y),o.current=y;return}}const p=await f.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").in("sport.name",Pe);if(p.error)throw p.error;const A={};for(const g of p.data||[])A[g.id]={...g,name:String(g.name??"—"),logo_url:ls(g.logo_url)};i(A),o.current=A}catch(p){console.error("Exceção loadTeams:",p),i({}),o.current={}}},[]),L=c.useCallback(async u=>{try{if(u){const g=await f.from("standings_volei_view").select("group_name, rank, team_id, team_name, matches_played, wins, losses, sv, sp, pf, pa, point_difference, points").eq("sport_id",u).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!g.error&&Array.isArray(g.data)&&g.data.length>0){console.info("[Vôlei] standings via VIEW/sport_id:",g.data.length),n(g.data);return}}if(u){const g=await f.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, losses,
            sv, sp, pf, pa, point_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",u).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0}),y=(g.data||[]).map(R=>({...R,team_name:R.team?.name,sv:Number(R.sv??0),sp:Number(R.sp??0),pf:Number(R.pf??0),pa:Number(R.pa??0),point_difference:Number(R.point_difference??(R.pf??0)-(R.pa??0))}));if(!g.error&&y.length>0){console.info("[Vôlei] standings via TABLE/sport_id:",y.length),n(y);return}}const A=((await f.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, losses,
          sv, sp, pf, pa, point_difference, points,
          team:teams!inner(name, id),
          sport:sport_id!inner(name, id)
        `).in("sport.name",Pe).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(g=>({...g,team_name:g.team?.name,sv:Number(g.sv??0),sp:Number(g.sp??0),pf:Number(g.pf??0),pa:Number(g.pa??0),point_difference:Number(g.point_difference??(g.pf??0)-(g.pa??0))}));console.info("[Vôlei] standings via TABLE/join por nome:",A.length,"— esportes possíveis:",Pe),n(A)}catch(p){console.error("Exceção loadStandings (vôlei):",p),n([])}},[]),I=c.useCallback(async u=>{try{if(!u){m([]);return}const{data:p,error:A}=await f.from("matches").select(`
          id, sport_id,
          stage, round, group_name, starts_at, updated_at, venue, status, meta,
          home_team_id, away_team_id, home_score, away_score, order_idx
        `).eq("sport_id",u);if(A)throw A;const g=N=>N?{...o.current[N]||{},id:N,name:String(o.current[N]?.name??"A definir")}:null,y=(p||[]).map(N=>{const G=Number.isFinite(Number(N.order_idx))?Number(N.order_idx):null,z=Number.isFinite(Number(N.order_idx))?Number(N.order_idx):Number.isFinite(Number(N.round))?Number(N.round):Number.MAX_SAFE_INTEGER;return{id:N.id,sport_id:N.sport_id,order_idx:G,_sortKey:z,stage:Ya(N.stage),round:N.round,group_name:N.group_name,starts_at:N.starts_at,updated_at:N.updated_at,venue:N.venue,status:er(N.status),meta:N.meta,home_score:N.home_score,away_score:N.away_score,home:g(N.home_team_id),away:g(N.away_team_id)}}),R={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6};y.sort((N,G)=>(R[N.stage]??99)-(R[G.stage]??99)||N._sortKey-G._sortKey||$e(N.starts_at)-$e(G.starts_at)||N.id-G.id),m(y),console.info("[Vôlei] matches carregados:",y.length)}catch(p){console.error("Exceção loadMatches (vôlei):",p),m([])}},[]),D=c.useCallback(async(u,{skeleton:p=!1}={})=>{p&&j(!0);try{await V(u),await Promise.all([L(u),I(u)])}finally{j(!1)}},[V,L,I]);c.useEffect(()=>{k()},[k]),c.useEffect(()=>{if(!s){j(!1);return}if(D(s,{skeleton:!0}),S.current){try{f.removeChannel(S.current)}catch{}S.current=null}const u=()=>{P.current&&clearTimeout(P.current),P.current=setTimeout(()=>D(s,{skeleton:!1}),1e3)},p=f.channel(`volei-hub-${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},u).on("postgres_changes",{event:"UPDATE",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},u).on("postgres_changes",{event:"DELETE",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},u).subscribe();return S.current=p,()=>{if(P.current&&(clearTimeout(P.current),P.current=null),S.current){try{f.removeChannel(S.current)}catch{}S.current=null}}},[s,D]),c.useEffect(()=>{if(!w){const u=$s(r,o.current);u.length&&n(u)}},[w,r,a]),c.useEffect(()=>{if(!w&&l.length===0&&r.length>0){const u=$s(r,o.current);u.length&&(console.info("[Vôlei] standings derivadas de matches:",u.length),n(u))}},[w,l.length,r]),c.useEffect(()=>{if(!l)return;const u=new Set(l.map(q=>String(q.team_id))),A=Object.keys(o.current||{}).filter(q=>!u.has(String(q)));if(A.length===0)return;const g=new Map;for(const q of r||[]){const J=xe(q?.group_name);if(!J)continue;const Z=oe=>{if(!oe)return;const he=String(oe),me=g.get(he)||{};me[J]=(me[J]||0)+1,g.set(he,me)};Z(q?.home?.id),Z(q?.away?.id)}const y=q=>{const J=g.get(String(q))||{},Z=Object.entries(J).sort((oe,he)=>he[1]-oe[1])[0];return Z?Z[0]:"-"},R=A.map(q=>{const J=o.current[q]||{};return{group_name:(J.group_name?xe(J.group_name):null)||y(q)||"-",team_id:isNaN(Number(q))?q:Number(q),team_name:J.name||"—",matches_played:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0,point_difference:0,points:0}}),N=[...l,...R],G={};for(const q of N){const J=q.group_name||"-",Z=Number(q.point_difference??(q.pf??0)-(q.pa??0));(G[J]||=[]).push({...q,point_difference:Z})}const z=[];for(const q of Object.keys(G).sort())G[q].sort(qe),G[q].forEach((J,Z)=>z.push({...J,rank:Z+1}));n(z)},[l,r,a]);const b=l.length>0,d=c.useMemo(()=>{const u=y=>(r||[]).filter(R=>R.stage===y).sort((R,N)=>(Number(R?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(N?.order_idx)||Number.MAX_SAFE_INTEGER)),p=u("semi"),A=u("final"),g=u("3lugar");return{semis:p,final:A[0],third:g[0]}},[r]),x=c.useMemo(()=>Qa(l),[l]),v=d.semis?.length?d.semis:x||[];c.useMemo(()=>{const u=new Set;return(r||[]).forEach(p=>{const A=xe(p.group_name);A&&A!=="-"&&u.add(A)}),["todos",...Array.from(u).sort()]},[r]),c.useMemo(()=>{const u=new Set;(r||[]).forEach(g=>g.stage&&u.add(g.stage));const p=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(u).sort((g,y)=>p.indexOf(g)+100-(p.indexOf(y)+100))]},[r]);const C=c.useMemo(()=>{const u=(r||[]).some(A=>A.stage==="grupos"&&A.status!=="finished");let p=(r||[]).filter(A=>A.status==="scheduled"&&(u?A.stage==="grupos":!0));return E!=="todos"&&(p=p.filter(A=>xe(A.group_name)===E)),_!=="todos"&&(p=p.filter(A=>A.stage===_)),p.sort((A,g)=>$e(A.starts_at)-$e(g.starts_at)||(A.order_idx??1)-(g.order_idx??1)),p},[r,E,_]),M=c.useMemo(()=>{const u=(r||[]).filter(p=>p.status==="finished");return u.sort((p,A)=>$e(A.updated_at||A.starts_at||0)-$e(p.updated_at||p.starts_at||0)),u.slice(0,12)},[r]);return e.jsx(Za,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Ua}),e.jsx("h2",{className:"text-2xl font-bold",children:Va})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Classificação por ",e.jsx("strong",{children:"sets"})," (3 pts por vitória). Empate em sets desempata por ",e.jsx("strong",{children:"pontos do placar"}),"."]})]}),w?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((u,p)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},p))})]}):e.jsxs(e.Fragment,{children:[b&&(()=>{const u=(l||[]).filter(p=>xe(p.group_name)!=="-");return u.length?e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Wa,{standings:u,teamsById:a})]}):null})(),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(v.length,2)}).map((u,p)=>{const A=v[p],g=A?void 0:{home:"A definir",away:"A definir"};return e.jsx(Oe,{match:A,placeholder:g},`s-${A?.id??p}`)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),d.final?e.jsx(Oe,{match:d.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(Oe,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]}),d.third?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"3º lugar"}),e.jsx(Oe,{match:d.third})]}):null]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:E,onChange:u=>T(u.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:["todos",...new Set((r||[]).map(u=>u.group_name).filter(Boolean)).values()].map(u=>e.jsx("option",{value:u,children:u==="todos"?"Todos":`Grupo ${u}`},u))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:_,onChange:u=>$(u.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:["todos",...new Set((r||[]).map(u=>u.stage).filter(Boolean)).values()].map(u=>e.jsx("option",{value:u,children:u==="todos"?"Todas":ot(u)},u))})]}),C.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:C.map((u,p)=>e.jsx(Ss,{match:u},u.id??`sched-${p}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),M.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:M.map((u,p)=>e.jsx(Ss,{match:u},u.id??`fin-${p}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas com ",e.jsx("strong",{children:"um set de 15 pontos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Vitória:"})," é necessário ter ",e.jsx("strong",{children:"dois pontos de vantagem"})," para vencer a partida."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo e o melhor 2º colocado avançam para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," confronto direto; se houver 3 empates, será utilizado o diferencial de pontos."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor do grupo A × Vencedor do grupo B; Vencedor do grupo C × Melhor 2º colocado."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substituições:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Rodízio:"})," obrigatório."]})]})})]})]})]})})}const tr="FIFA",ar="🎮⚽",rr="team-logos",nr="America/Sao_Paulo",or={r32:"Pré-oitavas",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar","1º":"1ª fase","2º":"2ª fase","3º":"3ª fase","4º":"4ª fase"},Cs={r32:1,oitavas:2,quartas:3,semi:4,final:5,"3lugar":5},mt=s=>s?or[s]||s:"",De=s=>Cs[s]??Cs[String(s||"").toLowerCase()]??99;function ir(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function lr(s){const t=ir(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:nr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const ut=s=>typeof s=="string"&&/^https?:\/\//i.test(s),cr=s=>typeof s=="string"&&!ut(s)&&s.trim()!=="";function dr(s){if(!s)return null;if(ut(s))return s;if(cr(s)){const{data:t}=f.storage.from(rr).getPublicUrl(s);return t?.publicUrl||null}return null}const Be=s=>{const t=dr(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null},mr={17:[1,2],18:[3,4],19:[5,6],20:[7,8],21:[9,10],22:[11,12],23:[13,14],24:[15,16],25:[17,18],26:[19,20],27:[21,22],28:[23,24],29:[25,26],30:[27,28],31:[29,30]},ur={32:[29,30]},gr=(s,t)=>t==="3lugar"?ur[s]||null:mr[s]||null;function hr({order_idx:s,stage:t}){const a=[];return s!=null&&String(s).length&&a.push(`Jogo ${s}`),t&&a.push(mt(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:a.join(" • ")||"—"})}function pr({team:s,align:t="left",badge:a=28}){const i=(()=>{const n=s?.name;if(typeof n=="string")return n;if(n&&typeof n=="object"&&"name"in n)return String(n.name);try{return String(n??"A definir")}catch{return"A definir"}})(),o=!!s?.id,l=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(ne,{team:{...s||{},name:i},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${o?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:i}),t==="right"?e.jsx(ne,{team:{...s||{},name:i},size:a}):null]});return o?e.jsx(W,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:n=>n.stopPropagation(),title:i,children:l}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:l})}function xr({match:s,placeholders:t}){const a=s.home||(t?.home?{name:t.home}:null),i=s.away||(t?.away?{name:t.away}:null),o=a?.id?a:{name:a?.name||"A definir"},l=i?.id?i:{name:i?.name||"A definir"},n=s?.status&&s.status!=="scheduled",r=Number(s?.home_score??0),m=Number(s?.away_score??0),w=({value:E})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:n?E:"-"})]}),j=({team:E,align:T,score:_})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${T==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(pr,{team:E,align:T})}),e.jsx(w,{value:_})]});return e.jsxs(W,{to:`/match/${s.id}`,className:"block rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(hr,{order_idx:s.order_idx,stage:s.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(j,{team:o,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(j,{team:l,align:"right",score:m})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.starts_at?lr(s.starts_at):s.venue||""}),n?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",m]}):null]})]})}function fr(){const[s,t]=c.useState(null),[a,i]=c.useState([]),[o,l]=c.useState(!0),n=c.useRef(null),r=c.useRef(!1),m=c.useCallback(async()=>{const{data:_,error:$}=await f.from("sports").select("id").eq("name","FIFA").maybeSingle();if($){console.error("Erro ao carregar sport id:",$);return}_?.id&&t(_.id)},[]),w=c.useCallback(async _=>{try{const{data:$,error:S}=await f.from("match_detail_view").select(`
          id, sport_id, order_idx,
          stage, round, group_name, starts_at, updated_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score
        `).eq("sport_id",_);let P=[];if(!S&&$?.length)P=$.map(k=>({id:k.id,sport_id:k.sport_id,order_idx:k.order_idx,stage:k.stage,round:k.round,group_name:k.group_name,starts_at:k.starts_at,updated_at:k.updated_at,venue:k.venue,status:k.status,home_score:k.home_score,away_score:k.away_score,home:k.home_team_id?{id:k.home_team_id,name:String(k.home_team_name??"A definir"),color:k.home_team_color,logo_url:Be(k.home_team_logo)}:null,away:k.away_team_id?{id:k.away_team_id,name:String(k.away_team_name??"A definir"),color:k.away_team_color,logo_url:Be(k.away_team_logo)}:null}));else{const{data:k,error:V}=await f.from("matches").select(`
            id, order_idx, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("sport_id",_);if(V)throw V;P=(k||[]).map(L=>({...L,home:L.home&&typeof L.home=="object"?{...L.home,name:String(L.home.name??"A definir"),logo_url:Be(L.home.logo_url)}:L.home,away:L.away&&typeof L.away=="object"?{...L.away,name:String(L.away.name??"A definir"),logo_url:Be(L.away.logo_url)}:L.away}))}P.sort((k,V)=>{const L=De(k.stage)-De(V.stage);return L!==0?L:(k.order_idx??9999)-(V.order_idx??9999)}),i(P)}catch($){console.error("Exceção loadMatches:",$),i([])}},[]),j=c.useCallback(async _=>{if(!r.current){r.current=!0,l(!0);try{await w(_)}finally{l(!1),r.current=!1}}},[w]);c.useEffect(()=>{m()},[m]),c.useEffect(()=>{if(!s)return;if(j(s),n.current){try{f.removeChannel(n.current)}catch{}n.current=null}const _=f.channel(`fifa-hub-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},()=>{j(s)}).subscribe();return n.current=_,()=>{if(n.current){try{f.removeChannel(n.current)}catch{}n.current=null}}},[s,j]);const E=c.useCallback((_,$)=>{const S=gr(_,$);return $==="3lugar"&&S?{home:`Perdedor J${S[0]}`,away:`Perdedor J${S[1]}`}:S?{home:`Vencedor J${S[0]}`,away:`Vencedor J${S[1]}`}:null},[]),T=c.useMemo(()=>{const _={};for(const S of a){const P=S.stage||"—";_[P]||(_[P]=[]),_[P].push(S)}return Object.keys(_).sort((S,P)=>De(S)-De(P)).map(S=>({stage:S,items:_[S].sort((P,k)=>(P.order_idx??0)-(k.order_idx??0))}))},[a]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:ar}),e.jsx("h2",{className:"text-2xl font-bold",children:tr})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"chaveamento"})," completo (com placeholders) → ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),o?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((_,$)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},$))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),T.map(({stage:_,items:$})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:mt(_)||"Fase"}),$.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:$.map(S=>e.jsx(xr,{match:S,placeholders:E(Number(S.order_idx),S.stage)},S.id))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem confrontos nesta fase."})]},_))]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," torneio de ",e.jsx("strong",{children:"mata-mata"})," (eliminação simples)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estrutura:"})," fases iniciais → oitavas/quartas → semifinais → final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Partidas:"})," jogo único por confronto."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate:"})," prorrogação e/ou pênaltis conforme necessário."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Configurações do console:"})," duração, times e regras definidas pela organização."]})]})})]})]})]})}const Qe="Pebolim",yr="🎯",br="team-logos",jr="America/Sao_Paulo",_r={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},gt=s=>s?_r[s]||s:"";function ht(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function ds(s){const t=ht(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:jr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const Ve=s=>{const t=ht(s);return t?t.getTime():Number.POSITIVE_INFINITY},pt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Nr=s=>typeof s=="string"&&!pt(s)&&s.trim()!=="";function vr(s){if(!s)return null;if(pt(s))return s;if(Nr(s)){const{data:t}=f.storage.from(br).getPublicUrl(s);return t?.publicUrl||null}return null}const Fe=s=>{const t=vr(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};function xt({order_idx:s,stage:t,group_name:a}){const i=[];return s!=null&&String(s).length&&i.push(`Jogo ${s}`),a?i.push(`Grupo ${a}`):t&&i.push(gt(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:i.join(" • ")||"—"})}function ms({team:s,align:t="left",badge:a=28}){const i=(()=>{const r=s?.name;if(typeof r=="string")return r;if(r&&typeof r=="object"&&"name"in r)return String(r.name);try{return String(r??"A definir")}catch{return"A definir"}})(),o=!!s?.id,l=!o&&i==="A definir",n=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(ne,{team:{...s||{},name:i},size:a}),e.jsxs("span",{className:`block truncate text-base sm:text-lg font-semibold ${o?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:i,children:[i,l?e.jsx(Qs,{className:"inline-block ml-1 w-4 h-4 text-gray-400"}):null]}),t==="right"?e.jsx(ne,{team:{...s||{},name:i},size:a}):null]});return o?e.jsx(W,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:r=>r.stopPropagation(),title:i,children:n}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:n})}function As({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),i=Number(s?.away_score??0);return e.jsxs(W,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(xt,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(ms,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs("span",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",i]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(ms,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ds(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",ds(s.updated_at)]}):null]})]})}function Me({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),i=s?.away||(t?.away?{name:t.away}:null),o=a?.id?a:{name:a?.name||"A definir"},l=i?.id?i:{name:i?.name||"A definir"},n=s&&s.status!=="scheduled",r=Number(s?.home_score??0),m=Number(s?.away_score??0),w=({value:T})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:n?T:"-"})]}),j=({team:T,align:_,score:$})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${_==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(ms,{team:T,align:_})}),e.jsx(w,{value:$})]}),E=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(xt,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(j,{team:o,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(j,{team:l,align:"right",score:m})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ds(s.starts_at):s?.venue||""}),n?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",m]}):null]})]});return s?.id?e.jsx(W,{to:`/match/${s.id}`,className:"block",children:E}):E}const us=s=>3*Number(s.wins??0)+Number(s.draws??0);function wr(s,t){const a=us(s),i=us(t);if(i!==a)return i-a;const o=Number(s.wins??0),l=Number(t.wins??0);if(l!==o)return l-o;const n=Number(s.goal_difference??Number(s.goals_for??0)-Number(s.goals_against??0)),r=Number(t.goal_difference??Number(t.goals_for??0)-Number(t.goals_against??0));if(r!==n)return r-n;const m=Number(s.goals_for??0),w=Number(t.goals_for??0);return w!==m?w-m:String(s.team_id).localeCompare(String(t.team_id))}function Sr({standings:s,teamsById:t,sportId:a}){const i=c.useMemo(()=>{const n=E=>String(E??"-").trim().toUpperCase(),r={},m=new Set;for(const E of s||[]){const T=n(E.group_name);r[T]||(r[T]=[]),r[T].push({...E,group_name:T}),m.add(String(E.team_id))}const w={};for(const E in t){const T=t[E];if(a&&T&&T.sport_id&&String(T.sport_id)!==String(a))continue;const _=n(T.group_name);w[_]||(w[_]=[]),w[_].push(T)}const j=Object.keys(r).length?Object.keys(r):Object.keys(w);for(const E of j){const T=r[E]||[],_=(w[E]||[]).filter(S=>!m.has(String(S.id))).map(S=>({group_name:E,team_id:S.id,team_name:S.name,matches_played:0,wins:0,draws:0,losses:0,goals_for:0,goals_against:0,goal_difference:0})),$=[...T,..._].sort(wr).map((S,P)=>({...S,rank:P+1}));r[E]=$}return r},[s,t,a]),o=c.useMemo(()=>{const n=new Map;(s||[]).forEach(m=>n.set(String(m.team_id),String(m.group_name??"-")));const r=[];return Object.values(t||{}).forEach(m=>{const w=n.get(String(m.id)),j=String(m.group_name??"-");w&&w!==j&&r.push({id:m.id,name:m.name,teamG:j,sidG:w})}),r},[s,t]),l=Object.keys(i).sort();return l.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[o.length?e.jsx("div",{className:"md:col-span-3",children:e.jsxs("div",{className:"rounded-md border border-amber-200 bg-amber-50 p-2 text-xs text-amber-800",children:[o.length," time(s) com grupo divergente entre ",e.jsx("em",{children:"teams"})," e ",e.jsx("em",{children:"standings"}),". A UI já ignora isso, mas vale ajustar no banco."]})}):null,l.map(n=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",n]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"E"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:i[n].map(r=>{const m=t[r.team_id]&&typeof t[r.team_id]=="object"?t[r.team_id]:{id:r.team_id,name:String(r.team_name??t[r.team_id]?.name??"—")},w={...m,name:typeof m.name=="string"?m.name:String(m.name??"—")};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:r.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(W,{to:`/team/${w.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(ne,{team:w,size:20}),e.jsx("span",{className:"truncate",children:w.name})]})}),e.jsx("td",{className:"py-1 text-center",children:r.matches_played}),e.jsx("td",{className:"py-1 text-center",children:r.wins}),e.jsx("td",{className:"py-1 text-center",children:r.draws}),e.jsx("td",{className:"py-1 text-center",children:r.losses}),e.jsx("td",{className:"py-1 text-center",children:r.goals_for}),e.jsx("td",{className:"py-1 text-center",children:r.goals_against}),e.jsx("td",{className:"py-1 text-center",children:r.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:us(r)})]},`${n}-${r.team_id}`)})})]}),e.jsx("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:"Critérios: Pontos, Vitórias, Saldo de Gols, Gols Pró."})]},n))]})}function $r(s){const t=r=>(s||[]).filter(m=>m.stage===r).sort((m,w)=>(Number(m?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(w?.order_idx)||Number.MAX_SAFE_INTEGER)),a=t("oitavas"),i=t("quartas"),o=t("semi"),l=t("final"),n=t("3lugar");return{oitavas:a,quartas:i,semis:o,final:l[0],third:n[0]}}function Cr(s,t){if(!Array.isArray(s)||s.length===0){const n=(r,m)=>({home:{name:`1º Grupo ${r}`},away:{name:`1º Grupo ${m}`}});return{quarters:[n("A","B"),n("C","D"),n("E","F"),n("G","H")],semis:[{home:{name:"Vencedor Quartas 1"},away:{name:"Vencedor Quartas 2"}},{home:{name:"Vencedor Quartas 3"},away:{name:"Vencedor Quartas 4"}}]}}const a={};for(const n of"ABCDEFGH".split("")){const r=s.find(m=>m.group_name===n&&m.rank===1);r&&(a[n]={id:r.team_id,name:r.team_name||t[r.team_id]?.name||"—",logo_url:t[r.team_id]?.logo_url,color:t[r.team_id]?.color})}const i=(n,r)=>({home:a[n]||{name:`1º Grupo ${n}`},away:a[r]||{name:`1º Grupo ${r}`}});return{quarters:[i("A","B"),i("C","D"),i("E","F"),i("G","H")],semis:[{home:{name:"Vencedor Quartas 1"},away:{name:"Vencedor Quartas 2"}},{home:{name:"Vencedor Quartas 3"},away:{name:"Vencedor Quartas 4"}}]}}class Ar extends Ke.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Pebolim ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}}const ft=s=>typeof s=="string"?s.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toLowerCase():"",Es=s=>{const t=ft(s);return t==="semifinal"||t==="semi-final"||t==="semis"?"semi":t==="3º lugar"||t==="3lugar"||t==="3-lugar"||t==="terceiro"?"3lugar":t},ks=s=>{const t=ft(s);return t==="agendado"||t==="programado"||t==="scheduled"?"scheduled":t==="ao vivo"||t==="andamento"||t==="live"||t==="ongoing"?"ongoing":t==="pausado"||t==="paused"?"paused":t==="encerrado"||t==="finalizado"||t==="finished"?"finished":t||"scheduled"};function Er(){const[s,t]=c.useState(null),[a,i]=c.useState({}),o=c.useRef({});c.useEffect(()=>{o.current=a},[a]);const[l,n]=c.useState([]),[r,m]=c.useState([]),[w,j]=c.useState(!0),[E,T]=c.useState("todos"),[_,$]=c.useState("todos"),S=c.useRef(null),P=c.useRef(null),k=c.useCallback(async()=>{try{const{data:u,error:p}=await f.from("sports").select("id").eq("name",Qe).maybeSingle();p&&console.error("Erro ao carregar sport id:",p),t(u?.id??null)}catch(u){console.error("Exceção loadSportId:",u),t(null)}},[]),V=c.useCallback(async u=>{try{if(u){const p=await f.from("teams").select("id, name, logo_url, color, group_name, sport_id").eq("sport_id",u);if(!p.error&&Array.isArray(p.data)&&p.data.length){const A={};for(const g of p.data)A[g.id]={...g,name:String(g.name??"—"),logo_url:Fe(g.logo_url),group_name:g.group_name??"-",sport_id:g.sport_id??u};i(A),o.current=A;return}}i({})}catch(p){console.error("Exceção loadTeams:",p),i({})}},[]),L=c.useCallback(async u=>{try{if(u){const{data:g,error:y}=await f.from("standings_view").select(`
            sport_id, group_name, rank, team_id, team_name,
            matches_played, wins, draws, losses,
            goals_for, goals_against, goal_difference, points
          `).eq("sport_id",u).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(y)throw y;if(Array.isArray(g)&&g.length>0){n(g);return}}const p=await f.from("standings_view").select(`
          sport_id, group_name, rank, team_id, team_name,
          matches_played, wins, draws, losses,
          goals_for, goals_against, goal_difference, points
        `);if(p.error)throw p.error;const A=Array.isArray(p.data)?p.data:[];n(u?A.filter(g=>String(g.sport_id)===String(u)):A)}catch(p){console.error("Exceção loadStandings:",p),n([])}},[]),I=c.useCallback(async u=>{try{let p=[];if(u){const{data:y,error:R}=await f.from("match_detail_view").select(`
            id, sport_id, order_idx,
            stage, round, group_name, starts_at, updated_at, venue, status,
            home_team_id, home_team_name, home_team_color, home_team_logo,
            away_team_id, away_team_name, away_team_color, away_team_logo,
            home_score, away_score
          `).eq("sport_id",u);!R&&Array.isArray(y)&&y.length&&(p=y.map(N=>({id:N.id,sport_id:N.sport_id,order_idx:N.order_idx,stage:Es(N.stage),round:N.round,group_name:N.group_name,starts_at:N.starts_at,updated_at:N.updated_at,venue:N.venue,status:ks(N.status),home_score:N.home_score,away_score:N.away_score,home:N.home_team_id?{id:N.home_team_id,name:String(N.home_team_name??"A definir"),color:N.home_team_color,logo_url:Fe(N.home_team_logo)}:null,away:N.away_team_id?{id:N.away_team_id,name:String(N.away_team_name??"A definir"),color:N.away_team_color,logo_url:Fe(N.away_team_logo)}:null})))}if(!p.length){const{data:y,error:R}=await f.from("matches").select(`
            id, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score, order_idx,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color ),
            sport:sport_id!inner(name)
          `).eq("sport.name",Qe);if(R)throw R;p=(y||[]).map(N=>({id:N.id,order_idx:Number.isFinite(Number(N.order_idx))?Number(N.order_idx):null,stage:Es(N.stage),round:N.round,group_name:N.group_name,starts_at:N.starts_at,updated_at:N.updated_at,venue:N.venue,status:ks(N.status),home_score:N.home_score,away_score:N.away_score,home:N.home?{...N.home,name:String(N.home.name??"A definir"),logo_url:Fe(N.home.logo_url)}:null,away:N.away?{...N.away,name:String(N.away.name??"A definir"),logo_url:Fe(N.away.logo_url)}:null}))}const A={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6},g=y=>Number.isFinite(Number(y?.order_idx))?Number(y.order_idx):Number.MAX_SAFE_INTEGER;p.sort((y,R)=>(A[y.stage]??99)-(A[R.stage]??99)||g(y)-g(R)),m(p)}catch(p){console.error("Exceção loadMatches (pebolim):",p),m([])}},[]),D=c.useCallback(async(u,{skeleton:p=!1}={})=>{p&&j(!0);try{await V(u),await Promise.all([L(u),I(u)])}finally{j(!1)}},[V,L,I]);c.useEffect(()=>{k()},[k]),c.useEffect(()=>{if(s){if(D(s,{skeleton:!0}),S.current){try{f.removeChannel(S.current)}catch{}S.current=null}if(s){const u=()=>{P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{Promise.all([L(s),I(s)]).catch(A=>console.error(A))},400)},p=f.channel(`pebolim-hub-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},u).on("postgres_changes",{event:"*",schema:"public",table:"standings",filter:`sport_id=eq.${s}`},u).subscribe();S.current=p}return()=>{if(P.current&&(clearTimeout(P.current),P.current=null),S.current){try{f.removeChannel(S.current)}catch{}S.current=null}}}},[s,D]),c.useMemo(()=>!!(l?.length||(r||[]).some(u=>!!u.group_name)||Object.values(a||{}).some(u=>!!u.group_name)),[l,r,a]);const b=c.useMemo(()=>$r(r),[r]),d=c.useMemo(()=>Cr(l,a),[l,a]),x=c.useMemo(()=>{const u=new Set;return(r||[]).forEach(p=>p.group_name&&u.add(p.group_name)),(l||[]).forEach(p=>p.group_name&&u.add(p.group_name)),Object.values(a||{}).forEach(p=>p.group_name&&u.add(p.group_name)),["todos",...Array.from(u).sort()]},[r,l,a]),v=c.useMemo(()=>{const u=new Set;(r||[]).forEach(g=>g.stage&&u.add(g.stage));const p=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(u).sort((g,y)=>p.indexOf(g)+100-(p.indexOf(y)+100))]},[r]),C=c.useMemo(()=>{let u=(r||[]).filter(p=>p.status!=="scheduled"?!1:p.group_name?!0:p.home?.id&&p.away?.id);return E!=="todos"&&(u=u.filter(p=>p.group_name===E)),_!=="todos"&&(u=u.filter(p=>p.stage===_)),u.sort((p,A)=>{const g=Ve(p.starts_at),y=Ve(A.starts_at);return(Number.isFinite(g-y)?g-y:0)||Number(p.order_idx??Number.MAX_SAFE_INTEGER)-Number(A.order_idx??Number.MAX_SAFE_INTEGER)||p.id-A.id}),u},[r,E,_]),M=c.useMemo(()=>{const u=(r||[]).filter(p=>p.status==="finished");return u.sort((p,A)=>Ve(A.updated_at||A.starts_at||0)-Ve(p.updated_at||p.starts_at||0)),u.slice(0,12)},[r]);return e.jsx(Ar,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:yr}),e.jsx("h2",{className:"text-2xl font-bold",children:Qe})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"classificação"})," (se houver grupos) → ",e.jsx("strong",{children:"chaveamento"})," →"," ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),w?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((u,p)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},p))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Sr,{standings:l,teamsById:a,sportId:s})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),b.oitavas?.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Oitavas de final"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:b.oitavas.map((u,p)=>e.jsx(Me,{match:u},`o-${u?.id??p}`))})]}):null,b.quartas?.length||d?.quarters?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Quartas de final"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(b.quartas?.length||0,d?.quarters?.length||0,4)}).map((u,p)=>{const A=b.quartas?.[p],g=d?.quarters?.[p];return e.jsx(Me,{match:A,placeholder:g},`q-${A?.id??p}`)})})]}):null,b.semis?.length||d?.semis?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(b.semis?.length||0,d?.semis?.length||0,2)}).map((u,p)=>{const A=b.semis?.[p],g=d?.semis?.[p];return e.jsx(Me,{match:A,placeholder:g},`s-${A?.id??p}`)})})]}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),b.final?e.jsx(Me,{match:b.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(Me,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:E,onChange:u=>T(u.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:x.map(u=>e.jsx("option",{value:u,children:u==="todos"?"Todos":`Grupo ${u}`},u))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:_,onChange:u=>$(u.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:v.map(u=>e.jsx("option",{value:u,children:u==="todos"?"Todas":gt(u)},u))})]}),C.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:C.map((u,p)=>e.jsx(As,{match:u},u.id??`sched-${p}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),M.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:M.map((u,p)=>e.jsx(As,{match:u},u.id??`fin-${p}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas em ",e.jsx("strong",{children:"1 rodada de 4 gols"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (8 grupos de 3 duplas) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo avança para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," saldo de gols."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," quatro quartas de final, duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Quartas de final:"})," Vencedor do grupo A × Vencedor do grupo B = Vencedor 1; Vencedor do grupo C × Vencedor do grupo D = Vencedor 2; Vencedor do grupo E × Vencedor do grupo F = Vencedor 3; Vencedor do grupo G × Vencedor do grupo H = Vencedor 4."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor 1 × Vencedor 2; Vencedor 3 × Vencedor 4."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Duplas:"})," não podem ser substituídas durante o torneio."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"WO:"})," em caso de não comparecimento de um ou mais integrantes, a dupla perde por WO. Atrasos de até 3 minutos são tolerados."]})]})})]})]})]})})}const kr="team-logos";function yt(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Tr(s){return typeof s=="string"&&!yt(s)&&s.trim()!==""}function We(s){if(!s)return null;if(yt(s))return s;if(Tr(s)){const{data:t}=f.storage.from(kr).getPublicUrl(s);return t?.publicUrl||null}return null}const Pr={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Fr={grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Mr="America/Sao_Paulo";function Rr(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Mr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function qr(s){return s?Fr[s]||s[0]?.toUpperCase()+s.slice(1):""}function Ir(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),o=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(o<0)return"0:00";const l=Math.floor(o/1e3),n=Math.floor(l/60),r=l%60;return`${n}:${r.toString().padStart(2,"0")}`}function Gr({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Ye({match:s,currentTimestamp:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),i=Number(s?.meta?.home_sets??0),o=Number(s?.meta?.away_sets??0),l=i>0||o>0,n=a||l,r=s?.status==="ongoing"||s?.status==="paused",m=s?.status&&s.status!=="scheduled",w=Number(s?.home_score??0),j=Number(s?.away_score??0),E=a?Number(s?.meta?.home_points_set??0):0,T=a?Number(s?.meta?.away_points_set??0):0,_=a&&(r||E>0||T>0),$=r?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(W,{to:`/match/${s.id}`,className:`block bg-white border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden ${$}`,children:[e.jsx(Gr,{status:s.status}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.sport?.name}),s.group_name?` • Grupo ${s.group_name}`:"",s.stage?` • ${qr(s.stage)}`:"",s.round?` • J${s.round}`:"",r&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",Ir(s,t)]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[11px] font-medium ${s.status==="ongoing"?"bg-green-100 text-green-700":s.status==="paused"?"bg-yellow-100 text-yellow-700":s.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:Pr[s.status]||s.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(ne,{team:s.home||{name:"A definir"},size:24}),e.jsx("span",{className:"font-medium truncate text-sm",children:s.home?.name||"A definir"})]}),e.jsxs("div",{className:"text-center px-3",children:[n&&e.jsx("div",{className:"text-xs font-semibold tabular-nums mb-1",children:e.jsxs("span",{className:`${m?"":"text-gray-400"}`,children:["Sets: ",i," x ",o]})}),m?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-lg font-bold tabular-nums",children:[_?E:w," x ",_?T:j]})}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx("span",{className:"font-medium truncate text-sm text-right",children:s.away?.name||"A definir"}),e.jsx(ne,{team:s.away||{name:"A definir"},size:24})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center justify-between",children:[e.jsx("span",{children:s.starts_at?Rr(s.starts_at):"Data a definir"}),s.venue&&e.jsx("span",{children:s.venue})]})]})}function Ts(){const{id:s}=Ks(),[t,a]=c.useState(null),[i,o]=c.useState([]),[l,n]=c.useState([]),[r,m]=c.useState(!0),[w,j]=c.useState(Date.now()),E=c.useRef(null),T=c.useRef(null),_=async()=>{m(!0);try{const{data:S,error:P}=await f.from("teams").select("id, name, logo_url, color").eq("id",s).maybeSingle();if(P){console.error("Erro ao carregar time:",P);return}if(S){const D={...S,logo_url:(()=>{const b=We(S.logo_url);return b?`${b}${b.includes("?")?"&":"?"}v=1`:null})()};a(D)}const{data:k,error:V}=await f.from("players").select("id, name, number").eq("team_id",s).order("number",{ascending:!0,nullsFirst:!0}).order("name");!V&&k&&o(k);const{data:L,error:I}=await f.from("matches").select(`
          id, stage, round, group_name, starts_at, venue, status, 
          home_score, away_score, meta, updated_at,
          sport:sport_id ( id, name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `).or(`home_team_id.eq.${s},away_team_id.eq.${s}`).order("starts_at",{ascending:!1});if(!I&&L){const D=L.map(b=>{const d=b.home&&typeof b.home=="object"?{...b.home,logo_url:(()=>{const v=We(b.home.logo_url);return v?`${v}${v.includes("?")?"&":"?"}v=1`:null})()}:b.home,x=b.away&&typeof b.away=="object"?{...b.away,logo_url:(()=>{const v=We(b.away.logo_url);return v?`${v}${v.includes("?")?"&":"?"}v=1`:null})()}:b.away;return{...b,home:d,away:x}});n(D)}}finally{m(!1)}};c.useEffect(()=>{_(),T.current=setInterval(()=>{j(Date.now())},1e3),E.current&&(f.removeChannel(E.current),E.current=null);const S=f.channel(`team-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>_()).on("postgres_changes",{event:"*",schema:"public",table:"teams",filter:`id=eq.${s}`},()=>_()).on("postgres_changes",{event:"*",schema:"public",table:"players",filter:`team_id=eq.${s}`},()=>_()).subscribe();return E.current=S,()=>{T.current&&clearInterval(T.current),E.current&&f.removeChannel(E.current),E.current=null}},[s]);const $=c.useMemo(()=>{const S={ongoing:[],paused:[],scheduled:[],finished:[]};return l.forEach(P=>{S[P.status]?S[P.status].push(P):S.finished.push(P)}),S},[l]);return r?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"})]})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ne,{team:t,size:64}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.name}),e.jsxs("p",{className:"text-gray-500",children:[l.length," partida",l.length!==1?"s":""," registrada",l.length!==1?"s":""]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Convocação"}),i.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"space-y-2",children:i.map(S=>e.jsxs("li",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"font-medium",children:S.name}),e.jsx("span",{className:"text-gray-500 text-sm tabular-nums",children:S.number?`#${S.number}`:"—"})]},S.id))})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Estatísticas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:$.ongoing.length+$.paused.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ao vivo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:$.scheduled.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Agendadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:$.finished.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Finalizadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:i.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Jogadores"})]})]})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Partidas"}),l.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma partida registrada."}):e.jsxs("div",{className:"space-y-4",children:[($.ongoing.length>0||$.paused.length>0)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"🔴 Ao vivo"}),e.jsx("div",{className:"space-y-2",children:[...$.ongoing,...$.paused].map(S=>e.jsx(Ye,{match:S,currentTimestamp:w},S.id))})]}),$.scheduled.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"📅 Próximas partidas"}),e.jsx("div",{className:"space-y-2",children:$.scheduled.map(S=>e.jsx(Ye,{match:S,currentTimestamp:w},S.id))})]}),$.finished.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"✅ Finalizadas"}),e.jsx("div",{className:"space-y-2",children:$.finished.slice(0,5).map(S=>e.jsx(Ye,{match:S,currentTimestamp:w},S.id))}),$.finished.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["... e mais ",$.finished.length-5," partida",$.finished.length-5!==1?"s":""]})]})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-600",children:"Time não encontrado"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"O time solicitado não existe ou foi removido."})]})}const bt={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Lr={r32:"Pré-oitavas",grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Or="team-logos";function jt(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Dr(s){return typeof s=="string"&&!jt(s)&&s.trim()!==""}function Ue(s){if(!s)return null;if(jt(s))return s;if(Dr(s)){const{data:t}=f.storage.from(Or).getPublicUrl(s);return t?.publicUrl||null}return null}const Br="America/Sao_Paulo";function Ee(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Br,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function _t(s){return s?Lr[s]||s[0]?.toUpperCase()+s.slice(1):""}function Vr({order_idx:s,stage:t,group_name:a}){const i=[];return s&&i.push(`Jogo ${s}`),a&&i.push(`Grupo ${a}`),i.join(" • ")}function Nt(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=s.starts_at?new Date(s.starts_at):null,i=s.status==="paused"?new Date(s.updated_at||Date.now()):new Date(t||Date.now());if(!a)return"0:00";const o=i-a;if(o<0)return"0:00";const l=Math.floor(o/1e3),n=Math.floor(l/60),r=l%60;return`${n}:${r.toString().padStart(2,"0")}`}function Ur({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-2xl`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function zr({status:s,meta:t,starts_at:a,updated_at:i,currentTimestamp:o}){const l="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] font-semibold tracking-wide border",n=s==="ongoing"?"bg-green-50 text-green-700 border-green-200":s==="paused"?"bg-amber-50 text-amber-700 border-amber-200":s==="finished"?"bg-gray-100 text-gray-700 border-gray-200":"bg-blue-50 text-blue-700 border-blue-200",r=t?.clock||t?.time||t?.minute,m=s==="ongoing"||s==="paused",w=s==="scheduled"?a?` • ${Ee(a)}`:"":s==="finished"?i?` • ${Ee(i)}`:"":r?` • ${r}`:"";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`${l} ${n}`,children:[bt[s]||s,w?e.jsx("span",{children:w}):null]}),m&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",Nt({status:s,starts_at:a,updated_at:i},o)]})]})}function Jr({stage:s}){if(!s)return null;const t=_t(s);return e.jsx("span",{className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-semibold tracking-wide text-gray-700",children:t})}function Ps({team:s,align:t="left",badgeSize:a=48}){const i=!!s?.id,o=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(ne,{team:s||{name:"A definir"},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${i?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:s?.name||"A definir",children:s?.name||"A definir"}),t==="right"?e.jsx(ne,{team:s||{name:"A definir"},size:a}):null]});return i?e.jsx(W,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-3 hover:underline ${t==="right"?"justify-end":""}`,onClick:l=>l.stopPropagation(),title:s?.name,children:o}):e.jsx("div",{className:`min-w-0 flex items-center gap-3 ${t==="right"?"justify-end":""}`,children:o})}function Fs({title:s,players:t}){return e.jsxs("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:s}),t.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"text-sm divide-y",children:t.map(a=>e.jsxs("li",{className:"flex items-center justify-between py-1.5",children:[e.jsx("span",{className:"truncate",children:a.name}),e.jsx("span",{className:"inline-block w-8 text-right tabular-nums text-gray-500",children:a.number??""})]},a.id))})]})}function Ms(){const{id:s}=Ks(),[t,a]=c.useState(null),[i,o]=c.useState([]),[l,n]=c.useState([]),[r,m]=c.useState(!0),[w,j]=c.useState(null),[E,T]=c.useState(Date.now()),_=c.useRef(null),$=c.useRef(null),S=c.useRef(!1),P=c.useMemo(()=>(t?.sport?.name||"").toLowerCase().includes("volei"),[t?.sport?.name]),k=c.useCallback(async()=>{if(!(!s||S.current)){S.current=!0,m(!0),j(null);try{const{data:y,error:R}=await f.from("match_detail_view").select(`
          id, sport_id, sport_name, stage, round, group_name, starts_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score, order_idx, created_at, updated_at
        `).eq("id",s).maybeSingle();let N=null;if(!R&&y){N={id:y.id,sport:{id:y.sport_id,name:y.sport_name},stage:y.stage,round:y.round,group_name:y.group_name,starts_at:y.starts_at,updated_at:y.updated_at,venue:y.venue,status:y.status,order_idx:y.order_idx,meta:null,home_score:y.home_score,away_score:y.away_score,home:{id:y.home_team_id,name:y.home_team_name,color:y.home_team_color,logo_url:(()=>{const Z=Ue(y.home_team_logo);return Z?`${Z}${Z.includes("?")?"&":"?"}v=1`:null})()},away:{id:y.away_team_id,name:y.away_team_name,color:y.away_team_color,logo_url:(()=>{const Z=Ue(y.away_team_logo);return Z?`${Z}${Z.includes("?")?"&":"?"}v=1`:null})()}};const{data:J}=await f.from("matches").select("meta").eq("id",s).maybeSingle();J?.meta&&(N.meta=J.meta)}else{const{data:J,error:Z}=await f.from("matches").select(`
            id,
            sport:sport_id ( id, name ),
            stage, round, group_name, starts_at, updated_at, venue, status, meta, order_idx,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("id",s).maybeSingle();if(Z)throw Z;J&&(N={...J,home:J.home&&typeof J.home=="object"?{...J.home,logo_url:(()=>{const oe=Ue(J.home.logo_url);return oe?`${oe}${oe.includes("?")?"&":"?"}v=1`:null})()}:J.home,away:J.away&&typeof J.away=="object"?{...J.away,logo_url:(()=>{const oe=Ue(J.away.logo_url);return oe?`${oe}${oe.includes("?")?"&":"?"}v=1`:null})()}:J.away})}if(!N)throw new Error("Partida não encontrada");a(N);const G=[];N?.home?.id?G.push(f.from("players").select("id, name, number").eq("team_id",N.home.id).order("number",{ascending:!0,nullsFirst:!0}).order("name")):G.push(Promise.resolve({data:[]})),N?.away?.id?G.push(f.from("players").select("id, name, number").eq("team_id",N.away.id).order("number",{ascending:!0,nullsFirst:!0}).order("name")):G.push(Promise.resolve({data:[]}));const[z,q]=await Promise.all(G);o(z.data||[]),n(q.data||[])}catch(y){console.error("Error loading match:",y),j(y.message||"Erro ao carregar partida")}finally{m(!1),S.current=!1}}},[s]);c.useEffect(()=>{if(!s)return;k(),$.current&&clearInterval($.current),$.current=setInterval(()=>{T(Date.now())},1e3),_.current&&(f.removeChannel(_.current),_.current=null);const y=f.channel(`match-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`id=eq.${s}`},R=>{const N=R?.new;N&&a(G=>G&&{...G,status:N.status??G.status,starts_at:N.starts_at??G.starts_at,updated_at:N.updated_at??G.updated_at,home_score:typeof N.home_score=="number"?N.home_score:G.home_score,away_score:typeof N.away_score=="number"?N.away_score:G.away_score,meta:N.meta??G.meta})}).on("postgres_changes",{event:"*",schema:"public",table:"match_events",filter:`match_id=eq.${s}`},()=>k()).subscribe();return _.current=y,()=>{$.current&&(clearInterval($.current),$.current=null),_.current&&(f.removeChannel(_.current),_.current=null)}},[s,k]);const V=c.useMemo(()=>t?Vr(t):"",[t]),L=t?.home,I=t?.away,D=Number(t?.meta?.home_sets??0),b=Number(t?.meta?.away_sets??0),d=D>0||b>0,x=P||d,v=t?.status==="ongoing"||t?.status==="paused",C=t?.status&&t.status!=="scheduled",M=Number(t?.home_score??0),u=Number(t?.away_score??0),p=P?Number(t?.meta?.home_points_set??0):0,A=P?Number(t?.meta?.away_points_set??0):0,g=P&&(v||p>0||A>0);return w?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚠️"}),e.jsx("p",{className:"text-lg text-red-600 mb-2",children:"Erro ao carregar partida"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:w}),e.jsx("button",{onClick:()=>{j(null),k()},className:"bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700",children:"Tentar novamente"})]}):r||!t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-44 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-36 w-full bg-gray-100 rounded-2xl animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-56 bg-gray-100 rounded-2xl animate-pulse"}),e.jsx("div",{className:"h-56 bg-gray-100 rounded-2xl animate-pulse"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(zr,{status:t.status,meta:t.meta,starts_at:t.starts_at,updated_at:t.updated_at,currentTimestamp:E}),t.stage?e.jsx(Jr,{stage:t.stage}):null,V&&e.jsx("div",{className:"text-xs text-gray-600","aria-label":"Detalhes",children:V})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.starts_at?Ee(t.starts_at):null,t.venue?e.jsx("span",{className:"ml-2",children:t.venue}):null]})]}),e.jsxs("div",{className:`relative overflow-hidden rounded-2xl border p-4 sm:p-5 shadow-sm ${v?t.status==="ongoing"?"border-blue-200":"border-amber-200":"border-gray-200"}`,children:[e.jsx(Ur,{status:t.status}),e.jsx("div",{className:"pointer-events-none absolute -top-24 -right-24 h-64 w-64 rounded-full bg-gradient-to-br from-blue-50 to-indigo-50 blur-3xl"}),e.jsx("div",{className:"pointer-events-none absolute -bottom-24 -left-24 h-64 w-64 rounded-full bg-gradient-to-tr from-pink-50 to-rose-50 blur-3xl"}),e.jsxs("div",{className:"relative grid grid-cols-1 items-center gap-4 sm:grid-cols-3",children:[e.jsx("div",{className:"min-w-0",children:e.jsx(Ps,{team:L,badgeSize:56})}),e.jsxs("div",{className:"text-center",children:[x?e.jsx("div",{className:"mb-1 flex items-center justify-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center rounded-full border border-gray-200 bg-white px-2 py-0.5 text-[11px] font-semibold text-gray-700",children:["Sets ",e.jsx("span",{className:"ml-1 tabular-nums",children:D}),e.jsx("span",{className:"mx-1 text-gray-400",children:"x"}),e.jsx("span",{className:"tabular-nums",children:b})]})}):null,C?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-4xl font-extrabold tabular-nums leading-none sm:text-5xl",children:[g?p:M," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",g?A:u]})}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"}),e.jsxs("div",{className:"mt-1 text-[11px] text-gray-500",children:[bt[t.status]||t.status,v?e.jsxs("span",{className:"ml-2",children:["🕐 ",Nt(t,E)]}):null,t.meta?.clock?e.jsx("span",{className:"ml-2",children:t.meta.clock}):null]})]}),e.jsx("div",{className:"min-w-0 sm:text-right",children:e.jsx(Ps,{team:I,align:"right",badgeSize:56})})]}),P?e.jsxs("div",{className:"relative mt-3 text-[11px] text-gray-500",children:["Vôlei: partidas em ",e.jsx("strong",{children:"um set de 15 pontos"})," (2 pontos de vantagem para vencer)."]}):null]}),e.jsxs("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("div",{className:"text-[11px] font-semibold text-gray-500 mb-2",children:"Detalhes"}),e.jsxs("ul",{className:"text-sm grid sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Modalidade:"})," ",e.jsx("span",{className:"font-medium",children:t?.sport?.name||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Fase:"})," ",e.jsx("span",{className:"font-medium",children:_t(t.stage)||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Grupo:"})," ",e.jsx("span",{className:"font-medium",children:t.group_name||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Jogo nº:"})," ",e.jsx("span",{className:"font-medium",children:t.order_idx??"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Início:"})," ",e.jsx("span",{className:"font-medium",children:t.starts_at?Ee(t.starts_at):"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Local:"})," ",e.jsx("span",{className:"font-medium",children:t.venue||"—"})]}),t.updated_at&&e.jsxs("li",{className:"sm:col-span-2",children:[e.jsx("span",{className:"text-gray-500",children:"Última atualização:"})," ",e.jsx("span",{className:"font-medium",children:Ee(t.updated_at)})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(Fs,{title:`Convocação — ${L?.name||"A definir"}`,players:i}),e.jsx(Fs,{title:`Convocação — ${I?.name||"A definir"}`,players:l})]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.status==="finished"&&t.updated_at?`Encerrado em ${Ee(t.updated_at)}`:null}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function Rs(){const s=fe(),t=gs(),{user:a,updatePassword:i}=hs(),[o,l]=c.useState(""),[n,r]=c.useState(""),[m,w]=c.useState(!1),[j,E]=c.useState(null),[T,_]=c.useState(null),$=c.useMemo(()=>{const k=new URLSearchParams(t.search).get("redirect");return k&&k.startsWith("/")?k:"/"},[t.search]);c.useEffect(()=>{console.log("SetPassword mounted, user:",a?.id)},[a]);const S=async P=>{if(P.preventDefault(),console.log("🔥 FORM SUBMITTED - START"),!m){if(w(!0),_(null),E(null),!o||o.length<8){_("A senha deve ter pelo menos 8 caracteres."),w(!1);return}if(o!==n){_("As senhas não coincidem."),w(!1);return}try{console.log("🚀 Starting password update...");const{error:k}=await i(o);if(k){console.error("Password update error:",k),_(`Erro ao atualizar senha: ${k.message}`),w(!1);return}console.log("✅ Password updated successfully"),E("Senha definida com sucesso!"),setTimeout(()=>{console.log("🎯 Navigating after password set"),w(!1),s($,{replace:!0})},1e3)}catch(k){console.error("Unexpected error:",k),_(`Erro inesperado: ${k.message}`),w(!1)}}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full mx-auto bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Bem-vindo!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Defina sua senha para continuar"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Email: ",a?.email]})]}),j&&e.jsx("p",{className:"mb-3 text-green-700 text-center",children:j}),T&&e.jsx("p",{className:"mb-3 text-red-700 text-center",children:T}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nova senha"}),e.jsx("input",{type:"password",placeholder:"Mínimo 8 caracteres",className:"w-full p-3 border border-gray-300 rounded-md",value:o,onChange:P=>l(P.target.value),required:!0,disabled:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirme a senha"}),e.jsx("input",{type:"password",placeholder:"Digite a senha novamente",className:"w-full p-3 border border-gray-300 rounded-md",value:n,onChange:P=>r(P.target.value),required:!0,disabled:m})]}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-blue-600 text-white py-3 rounded-md font-medium hover:bg-blue-700 disabled:opacity-50",children:m?"Configurando perfil...":"Definir senha"})]})]})})}function Hr(){const s=fe(),t=a=>{s(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Painel do Administrador"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecione uma área para gerenciar."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("button",{onClick:()=>t("/admin/elencos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"👥"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Elencos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Criar time, editar elenco (jogadores) e logo."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]}),e.jsxs("button",{onClick:()=>t("/admin/campeonatos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"🏆"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Campeonatos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Configurar modalidades, grupos e fases."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]}),e.jsxs("button",{onClick:()=>t("/admin/partidas"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"⏱️"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Partidas"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Iniciar/encerrar jogos e atualizar placar em tempo real."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]})]})]})}function Kr(){const s=fe(),[t]=Et(),a=t.get("redirect")||"/",i=t.get("reason"),[o,l]=c.useState(""),[n,r]=c.useState(""),[m,w]=c.useState(!1),[j,E]=c.useState(null);c.useEffect(()=>{i==="forbidden"&&E("Faça login para acessar a página solicitada.")},[i]);async function T(_){if(_.preventDefault(),!m){w(!0),E(null);try{const{error:$}=await f.auth.signInWithPassword({email:o.trim(),password:n});if($){E("Email ou senha incorretos."),w(!1);return}s(a,{replace:!0})}catch($){console.error("Login error:",$),E("Erro inesperado durante o login."),w(!1)}}}return e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Login"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Email"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full p-2 border rounded",value:o,onChange:_=>l(_.target.value),autoComplete:"email",required:!0})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Senha"}),e.jsx("input",{type:"password",placeholder:"Senha",className:"w-full p-2 border rounded",value:n,onChange:_=>r(_.target.value),autoComplete:"current-password",required:!0})]}),j&&e.jsx("p",{className:"text-red-600 text-sm",children:j}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-blue-600 text-white py-2 rounded disabled:opacity-50 hover:bg-blue-700 transition-colors",children:m?"Entrando...":"Entrar"})]})]})}const Re="team-logos",qs=5,es=["image/png","image/jpeg","image/webp"],Xr=["oitavas","quartas","semi","final","3lugar"];function Zr(){const[s,t]=c.useState([]),[a,i]=c.useState({}),[o,l]=c.useState([]),[n,r]=c.useState(!1),[m,w]=c.useState({name:"",sport_id:""}),[j,E]=c.useState(null),[T,_]=c.useState([]),[$,S]=c.useState(0),[P,k]=c.useState([]),[V,L]=c.useState({}),[I,D]=c.useState({}),[b,d]=c.useState(null),[x,v]=c.useState(""),C=async()=>{const{data:F}=await f.from("sports").select("id,name").order("name");t(F||[]);const U={};(F||[]).forEach(K=>U[K.id]=K.name),i(U),!m.sport_id&&F?.length&&w(K=>({...K,sport_id:F[0].id}))},M=async()=>{let F=f.from("teams").select("id,name,group_name,sport_id,logo_url").order("name");P.length>0&&(F=F.in("sport_id",P));const{data:U}=await F;l(U||[]);const K=(U||[]).map(Q=>Q.id);K.length?await Promise.all([u(K),p(U)]):(L({}),D({}))},u=async F=>{if(!F?.length)return;const{data:U}=await f.from("players").select("id, team_id").in("team_id",F),K={};(U||[]).forEach(Q=>{K[Q.team_id]=(K[Q.team_id]||0)+1}),F.forEach(Q=>{Q in K||(K[Q]=0)}),L(K)},p=async F=>{const U=Array.from(new Set((F||[]).map(se=>se.sport_id)));if(U.length===0){D({});return}const{data:K}=await f.from("matches").select("sport_id, stage, home_team_id, away_team_id").in("sport_id",U).in("stage",Xr),Q={};(K||[]).forEach(se=>{se.home_team_id&&se.away_team_id&&(Q[se.sport_id]=!0)}),U.forEach(se=>{se in Q||(Q[se]=!1)}),D(Q)},A=async F=>{const{data:U}=await f.from("players").select("id,name,number").eq("team_id",F).order("name");_(U||[]),L(K=>({...K,[F]:(U||[]).length}))};c.useEffect(()=>{C()},[]),c.useEffect(()=>{M()},[P]);const g=F=>{const{data:U}=f.storage.from(Re).getPublicUrl(F);return U?.publicUrl||""},y=F=>{if(!F)return null;const U=F.indexOf(`/storage/v1/object/public/${Re}/`);return U===-1?null:F.substring(U+`/storage/v1/object/public/${Re}/`.length)},R=async F=>{if(F.preventDefault(),!m.name||!m.sport_id)return;r(!0);const{error:U}=await f.from("teams").insert({name:m.name.trim(),sport_id:m.sport_id});r(!1),U?alert("Erro ao criar time: "+U.message):(w({name:"",sport_id:m.sport_id}),M())},N=async F=>{if(confirm(`⚠️ Atenção!

Se você remover o time "${F.name}", TODO o campeonato da modalidade será resetado e o histórico de jogos será apagado.

Deseja realmente continuar?`)){r(!0);try{const K=y(F.logo_url);K&&await f.storage.from(Re).remove([K]).catch(()=>{});const{error:Q}=await f.rpc("reset_sport",{p_sport_id:F.sport_id});if(Q)throw Q;const{error:se}=await f.from("teams").delete().eq("id",F.id);if(se)throw se;j?.id===F.id&&(E(null),_([])),b===F.id&&z(),await M(),alert(`Time "${F.name}" removido.

O campeonato da modalidade foi resetado. Configure novamente os grupos e partidas antes de prosseguir.`)}catch(K){alert("Erro ao remover: "+K.message)}finally{r(!1)}}},G=F=>{n||(d(F.id),v(F.name))},z=()=>{d(null),v("")},q=async()=>{const F=b,U=x.trim();if(!F)return;if(!U){alert("O nome não pode ficar vazio.");return}const K=o.find(Q=>Q.id===F);if(K&&K.name===U){z();return}r(!0);try{const{error:Q}=await f.from("teams").update({name:U}).eq("id",F);if(Q)throw Q;l(se=>se.map(h=>h.id===F?{...h,name:U}:h)),j?.id===F&&E(se=>se&&{...se,name:U}),z()}catch(Q){alert("Erro ao renomear: "+Q.message)}finally{r(!1)}},J=async F=>{if(!j?.id||!F)return;r(!0);const{error:U}=await f.from("players").insert({team_id:j.id,name:F.trim()});r(!1),U?alert("Erro ao adicionar jogador: "+U.message):A(j.id)},Z=async F=>{if(!j?.id)return;r(!0);const{error:U}=await f.from("players").delete().eq("id",F);r(!1),U?alert("Erro ao remover jogador: "+U.message):A(j.id)},oe=async(F,U)=>{if(!(!F?.id||!U)){if(!es.includes(U.type)){alert("Formato inválido. Use PNG, JPG ou WEBP.");return}if(U.size>qs*1024*1024){alert(`Arquivo grande demais. Máximo ${qs} MB.`);return}r(!0);try{const K=U.type==="image/png"?"png":U.type==="image/webp"?"webp":"jpg",Q=`teams/${F.id}.${K}`,{error:se}=await f.storage.from(Re).upload(Q,U,{upsert:!0,cacheControl:"3600",contentType:U.type});if(se)throw se;const h=g(Q),{error:B}=await f.from("teams").update({logo_url:h}).eq("id",F.id);if(B)throw B;if(await M(),j?.id===F.id){const O=(await f.from("teams").select("id,name,logo_url").eq("id",F.id).maybeSingle()).data;O&&E(H=>({...H,...O}))}S(O=>O+1)}catch(K){alert("Erro ao enviar logo: "+K.message)}finally{r(!1)}}},he=P.length===0||P.length===s.length,me=()=>{k(F=>he?[]:s.map(U=>U.id))},ve=e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{onClick:me,className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${he?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:"Todos"}),s.map(F=>{const U=P.length===0?!0:P.includes(F.id);return e.jsx("button",{onClick:()=>k(K=>K.length===0?[F.id]:K.includes(F.id)?K.filter(Q=>Q!==F.id):[...K,F.id]),className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${U?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:F.name},F.id)})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:"Elencos"}),ve,j&&e.jsxs("section",{className:"rounded-lg border bg-white shadow-sm",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Is,{src:j.logo_url,alt:j.name,size:40,version:$}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:j.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a[j.sport_id]," • ",T.length," jogadores"]})]})]}),e.jsx("button",{onClick:()=>{E(null),_([])},className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",title:"Fechar",children:"✕"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 cursor-pointer text-sm font-medium transition-colors",children:["📷 Atualizar Logo",e.jsx("input",{type:"file",accept:es.join(","),className:"hidden",onChange:F=>{const U=F.target.files?.[0];U&&oe(j,U),F.target.value=""},disabled:n})]})}),e.jsx(Qr,{disabled:n,onAdd:J}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Jogadores"}),T.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:"Nenhum jogador no elenco"}),e.jsx("p",{className:"text-xs mt-1",children:"Adicione jogadores usando o formulário acima"})]}):e.jsx("div",{className:"grid gap-2",children:T.map(F=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-gray-50",children:[e.jsx("span",{className:"font-medium",children:F.name}),e.jsx("button",{className:"px-3 py-1 text-sm rounded-lg border border-red-300 text-red-600 hover:bg-red-50 transition-colors",onClick:()=>Z(F.id),disabled:n,children:"Remover"})]},F.id))})]})]})]}),e.jsxs("section",{className:"rounded-lg border bg-white shadow-sm",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsx("h3",{className:"font-semibold text-lg",children:"Novo Time"})}),e.jsxs("form",{onSubmit:R,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome do time"}),e.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:m.name,onChange:F=>w(U=>({...U,name:F.target.value})),placeholder:"Ex.: A1 — Águias",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Esporte"}),e.jsx("select",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:m.sport_id,onChange:F=>w(U=>({...U,sport_id:F.target.value})),children:s.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))})]})]}),e.jsx("button",{type:"submit",disabled:n,className:"w-full bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:n?"Salvando…":"Criar Time"})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Times Cadastrados (",o.length,")"]}),o.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 border rounded-lg",children:[e.jsx("p",{className:"text-sm",children:"Nenhum time cadastrado"}),e.jsx("p",{className:"text-xs mt-1",children:"Crie seu primeiro time usando o formulário acima"})]}):e.jsx("div",{className:"grid gap-3",children:o.map(F=>{const U=a[F.sport_id]||"—",K=V[F.id]??0,Q=K>0,se=!!I[F.sport_id],h=F.group_name?`Grupo ${F.group_name}`:se?"Sem grupo (não aplicável)":"Sem grupo";return e.jsx("div",{className:"border rounded-lg bg-white shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(Is,{src:F.logo_url,alt:F.name,size:48,version:$}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-lg truncate",children:F.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:U}),e.jsxs("span",{className:"text-sm text-gray-600",children:["• ",h]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[se&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-800 text-xs font-medium",children:"Chaveamento configurado"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Elenco: "," ",e.jsxs("span",{className:Q?"text-gray-900 font-medium":"text-red-600 font-medium",children:[K," ",K===1?"jogador":"jogadores"]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("label",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 cursor-pointer text-sm font-medium transition-colors",children:["📷 Logo",e.jsx("input",{type:"file",accept:es.join(","),className:"hidden",onChange:B=>{const O=B.target.files?.[0];O&&oe(F,O),B.target.value=""},disabled:n})]}),e.jsx("button",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50 font-medium transition-colors text-sm",onClick:()=>{E(F),A(F.id),window.scrollTo({top:0,behavior:"smooth"})},children:"👥 Elenco"}),e.jsx("button",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-red-300 text-red-600 hover:bg-red-50 font-medium transition-colors text-sm",onClick:()=>N(F),disabled:n,children:"🗑️ Remover"})]}),b!==F.id?e.jsx("div",{className:"mt-2",children:e.jsx("button",{className:"px-3 py-2 rounded-lg border border-yellow-300 text-yellow-700 hover:bg-yellow-50 font-medium transition-colors text-sm",onClick:()=>G(F),disabled:n,children:"✏️ Renomear"})}):e.jsxs("form",{onSubmit:B=>{B.preventDefault(),q()},className:"mt-2 flex gap-2 items-center",children:[e.jsx("input",{className:"flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:x,onChange:B=>v(B.target.value),placeholder:"Novo nome do time",maxLength:60,disabled:n}),e.jsx("button",{type:"submit",className:"px-3 py-2 rounded-lg border border-green-300 text-green-700 hover:bg-green-50 font-medium text-sm",disabled:n,children:"Salvar"}),e.jsx("button",{type:"button",className:"px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium text-sm",onClick:z,disabled:n,children:"Cancelar"})]})]})},F.id)})})]})]})}function Qr({disabled:s,onAdd:t}){const[a,i]=c.useState("");return e.jsxs("form",{onSubmit:o=>{o.preventDefault(),t(a),i("")},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adicionar Jogador"}),e.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nome do jogador",value:a,onChange:o=>i(o.target.value),required:!0})]}),e.jsx("button",{type:"submit",disabled:s,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?"Adicionando...":"Adicionar Jogador"})]})}function Wr(s){if(!s)return"?";const t=s.trim().split(" ");return t.length===1?t[0][0]?.toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}function Yr(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function Is({src:s,alt:t,size:a=32,version:i=0}){const[o,l]=c.useState(!1),n=c.useMemo(()=>{if(!s)return null;const r=s.includes("?")?"&":"?";return`${s}${r}v=${i}`},[s,i]);return e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 bg-white flex items-center justify-center flex-shrink-0",style:{width:a,height:a},children:[n?e.jsx("img",{src:n,alt:t||"logo",className:`w-full h-full object-cover ${o?"opacity-100":"opacity-0"} transition-opacity duration-200`,loading:"lazy",onLoad:()=>l(!0),onError:()=>l(!1)}):null,!n||!o?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white font-bold uppercase",style:{backgroundColor:Yr(t||"T"),fontSize:a*.35},children:Wr(t)}):null]})}const Gs={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Ls={ongoing:1,paused:2,scheduled:3,finished:4},en="team-logos",vt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),sn=s=>typeof s=="string"&&!vt(s)&&s.trim()!=="",Os=s=>{if(!s)return null;if(vt(s))return s;if(sn(s)){const{data:t}=f.storage.from(en).getPublicUrl(s);return t?.publicUrl||null}return null},ze=(s="")=>s.toString().trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase();function tn(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=s.starts_at?new Date(s.starts_at):new Date,o=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(!Number.isFinite(o)||o<0)return"0:00";const l=Math.floor(o/1e3),n=Math.floor(l/60),r=l%60;return`${n}:${r.toString().padStart(2,"0")}`}function an({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",i=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${i} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}const Ds=s=>Number.isFinite(Number(s?.order_idx))?Number(s.order_idx):Number.isFinite(Number(s?.round))?Number(s.round):Number(s?.id??Number.MAX_SAFE_INTEGER);function rn(){const[s,t]=c.useState([]),[a,i]=c.useState([]),[o,l]=c.useState(null),[n,r]=c.useState(null),[m,w]=c.useState(!0),[j,E]=c.useState({}),[T,_]=c.useState(null),[$,S]=c.useState(null),[P,k]=c.useState(Date.now()),[V,L]=c.useState(typeof navigator<"u"?navigator.onLine:!0),[I,D]=c.useState(!1),[b,d]=c.useState(null),[x,v]=c.useState({}),C=c.useRef(null),M=c.useRef(!0),u=c.useRef(null);c.useEffect(()=>{if(!$)return;const h=setTimeout(()=>S(null),8e3);return()=>clearTimeout(h)},[$]),c.useEffect(()=>{const h=()=>L(!0),B=()=>L(!1);return window.addEventListener("online",h),window.addEventListener("offline",B),()=>{window.removeEventListener("online",h),window.removeEventListener("offline",B)}},[]);const p=(h,B)=>E(O=>({...O,[h]:B})),A=async()=>{const{data:h,error:B}=await f.auth.getSession();return B?(console.error("getSession error:",B),S(B.message||"Falha ao obter sessão de usuário."),null):h?.session||null},g=async()=>{try{await f.auth.getUser();const{data:h,error:B}=await f.rpc("is_admin");if(B)throw B;_(!!h)}catch(h){console.error("is_admin() error:",h),_(!1)}},y=async()=>{const{data:h,error:B}=await f.from("sports").select("name").order("name");if(B){console.error("loadSports error:",B);return}const O=Array.from(new Set((h||[]).map(H=>H.name).filter(Boolean)));i(O.map(H=>({key:ze(H),name:H})))},R=async()=>{const{data:h}=await f.from("sport_capacity").select("sport_id, max_live"),B=Object.fromEntries((h||[]).map(O=>[String(O.sport_id),Number(O.max_live||1)]));v(B)},N=async({showSkeleton:h=!1}={})=>{if(M.current){h&&w(!0);try{let B=f.from("matches").select(`
          id, stage, round, group_name, order_idx, starts_at, venue, created_at, updated_at,
          status, home_score, away_score, meta,
          sport_id,
          home_team_id, away_team_id,
          sport:sport_id ( name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `);n&&(B=B.eq("status",n)),B=B.or(["group_name.not.is.null","stage.eq.r32","and(home_team_id.not.is.null,away_team_id.not.is.null)"].join(","));const{data:O,error:H}=await B;if(H)console.error("loadMatches error:",H),M.current&&S(H.message||"Falha ao carregar partidas.");else{let Y=(O||[]).map(X=>{const ae=X.home&&typeof X.home=="object"?{...X.home,logo_url:(()=>{const ce=Os(X.home.logo_url);return ce?`${ce}${ce.includes("?")?"&":"?"}v=1`:null})()}:X.home,ee=X.away&&typeof X.away=="object"?{...X.away,logo_url:(()=>{const ce=Os(X.away.logo_url);return ce?`${ce}${ce.includes("?")?"&":"?"}v=1`:null})()}:X.away,le=X?.sport?.name||"";return{...X,home:ae,away:ee,_sportKey:ze(le)}});o&&(Y=Y.filter(X=>X._sportKey===o));const te=Y.sort((X,ae)=>{const ee=Ls[X.status]||999,le=Ls[ae.status]||999;return ee!==le?ee-le:Ds(X)-Ds(ae)});M.current&&t(te)}}finally{M.current&&h&&w(!1)}}};c.useEffect(()=>{M.current=!0,(async()=>{await A(),await g(),await y(),await R(),await N({showSkeleton:!0})})(),u.current=setInterval(()=>{M.current&&k(Date.now())},1e3);const{data:B}=f.auth.onAuthStateChange(async(O,H)=>{M.current&&(_(null),await g(),H?(await y(),await R(),await N({showSkeleton:!0})):t([]))});return()=>{M.current=!1,u.current&&clearInterval(u.current),B?.subscription?.unsubscribe?.(),C.current&&(f.removeChannel(C.current),C.current=null)}},[]),c.useEffect(()=>{if(!M.current)return;N({showSkeleton:!1}),C.current&&(f.removeChannel(C.current),C.current=null);const h=f.channel("admin-matches").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>{setTimeout(()=>{M.current&&N({showSkeleton:!1})},200)}).subscribe();return C.current=h,()=>{C.current&&(f.removeChannel(C.current),C.current=null)}},[o,n]);const G=c.useMemo(()=>{const h=new Map;for(const O of s){const H=O?.sport_id?String(O.sport_id):"unknown";h.has(H)||h.set(H,[]),h.get(H).push(O)}const B=new Set;for(const[O,H]of h.entries()){if(O==="unknown")continue;const Y=Number(x[O]||1),te=H.filter(ee=>ee.status==="ongoing"||ee.status==="paused").length,X=Math.max(Y-te,0);if(X<=0)continue;const ae=H.filter(ee=>ee.status==="scheduled"&&!!(ee.home?.id&&ee.away?.id)).sort((ee,le)=>{const ce=Number.isFinite(Number(ee.order_idx))?Number(ee.order_idx):Number.isFinite(Number(ee.round))?Number(ee.round):Number.MAX_SAFE_INTEGER,ie=Number.isFinite(Number(le.order_idx))?Number(le.order_idx):Number.isFinite(Number(le.round))?Number(le.round):Number.MAX_SAFE_INTEGER;return ce-ie});for(let ee=0;ee<Math.min(X,ae.length);ee++)B.add(ae[ee].id)}return B},[s,x]),z=async(h,B)=>{p(h,!0),S(null);const O=s;t(H=>H.map(Y=>Y.id===h?{...Y,...B}:Y));try{const{error:H}=await f.from("matches").update(B).eq("id",h);if(H)throw new Error(`Falha ao atualizar: ${H.message}`);return setTimeout(()=>{M.current&&N({showSkeleton:!1})},600),!0}catch(H){return t(O),S(H.message||"Erro ao atualizar partida."),!1}finally{p(h,!1)}},q=async(h,B,O)=>{if(h.status==="scheduled")return;const Y=ze(h?.sport?.name||"").includes("volei"),te=h.meta||{},X=Y?`${B}_points_set`:`${B}_score`;let ae=Math.max(0,Number((Y?te[X]:h[X])||0));O==="inc"&&(ae+=1),O==="dec"&&(ae=Math.max(0,ae-1)),O==="reset"&&(ae=0),Y?await z(h.id,{meta:{...te,[X]:ae}}):await z(h.id,{[X]:ae})},J=(h,B)=>Math.max(0,Number(h?.meta?.[`${B}_points_set`]||0)),Z=(h,B)=>{const O=h.meta||{};return Math.max(0,Number(O[B==="home"?"home_sets":"away_sets"]||0))},oe=h=>{const B=Number(h?.meta?.rules?.points_to_win_set??15),O=Number(h?.meta?.rules?.win_by??2),H=J(h,"home"),Y=J(h,"away"),te=Math.max(H,Y),X=Math.abs(H-Y);return te>=B&&X>=O},he=async(h,{force:B=!1}={})=>{if(h.status==="scheduled")return;const O=h.meta||{},H=J(h,"home"),Y=J(h,"away"),te=Array.isArray(O.sets)?O.sets:[];if(!B&&!oe(h)){S("Para finalizar o set: mínimo 15 pontos e 2 de vantagem (ajustável em meta.rules). Clique novamente para forçar.");return}const X=H>Y?!0:Y>H?!1:null,ae={...O,sets:[...te,{h:H,a:Y,at:new Date().toISOString()}],home_sets:Z(h,"home")+(X===!0?1:0),away_sets:Z(h,"away")+(X===!1?1:0),home_points_set:0,away_points_set:0};await z(h.id,{meta:ae,home_score:Math.max(0,Number(h.home_score||0))+H,away_score:Math.max(0,Number(h.away_score||0))+Y,updated_at:new Date().toISOString()})},me=async(h,B,O)=>{if(h.status==="scheduled")return;const H=h.meta||{},Y=B==="home"?"home_sets":"away_sets";let te=Math.max(0,Number(H[Y]||0));O==="inc"&&(te+=1),O==="dec"&&(te=Math.max(0,te-1)),O==="reset"&&(te=0),await z(h.id,{meta:{...H,[Y]:te}})},ve=async(h,B)=>{const O=new Date().toISOString(),H={status:B,updated_at:O};return B==="ongoing"&&h.status==="scheduled"&&!h.starts_at&&(H.starts_at=O),await z(h.id,H)},F=async h=>{const B=J(h,"home"),O=J(h,"away");if(B>0||O>0){const H=h.meta||{};await z(h.id,{meta:{...H,home_points_set:0,away_points_set:0},home_score:Math.max(0,Number(h.home_score||0))+B,away_score:Math.max(0,Number(h.away_score||0))+O})}return await ve(h,"finished")},U=async h=>{S(null);const B=h?.sport_id?String(h.sport_id):null;if(!B){S("Partida sem modalidade válida (sport_id ausente).");return}try{const{data:O,error:H}=await f.from("sport_capacity").select("max_live").eq("sport_id",B).maybeSingle();if(H)throw H;const Y=Number(O?.max_live||1),{data:te,error:X}=await f.from("matches").select("id,status,order_idx,round,home_team_id,away_team_id").eq("sport_id",B);if(X)throw X;if(!te)throw new Error("Falha ao validar ordem.");const ae=te.filter(ie=>ie.status==="ongoing"||ie.status==="paused").length,ee=Math.max(Y-ae,0);if(ee<=0)throw new Error("Capacidade ao vivo já ocupada nesta modalidade.");const le=te.filter(ie=>ie.status==="scheduled"&&ie.home_team_id&&ie.away_team_id).sort((ie,ye)=>{const be=Number.isFinite(Number(ie.order_idx))?Number(ie.order_idx):Number.isFinite(Number(ie.round))?Number(ie.round):Number.MAX_SAFE_INTEGER,wt=Number.isFinite(Number(ye.order_idx))?Number(ye.order_idx):Number.isFinite(Number(ye.round))?Number(ye.round):Number.MAX_SAFE_INTEGER;return be-wt});if(!new Set(le.slice(0,ee).map(ie=>ie.id)).has(h.id))throw new Error("Aguarde: apenas os próximos da fila podem iniciar.");await ve(h,"ongoing")}catch(O){console.error("tryStartMatch error:",O),S(O.message||"Não foi possível iniciar a partida (ordem/capacidade restrita).")}},K=async h=>await U(h),Q=async h=>await ve(h,"paused"),se=async h=>await ve(h,"ongoing");return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Gerenciar Partidas"}),!V&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded mb-4",children:"⚠️ Você está offline. As alterações serão sincronizadas quando a conexão for restaurada."}),T===!1&&e.jsxs("div",{className:"text-sm p-3 rounded bg-red-50 border border-red-200 text-red-700",children:["Você não está autenticado como ",e.jsx("strong",{children:"admin"}),". As ações podem ser bloqueadas."]}),$&&e.jsxs("div",{className:"text-sm p-3 rounded bg-yellow-50 border border-yellow-200 text-yellow-800 flex items-start gap-3",children:[e.jsx("div",{className:"flex-1 whitespace-pre-wrap",children:String($)}),e.jsx("button",{onClick:()=>S(null),className:"text-xs px-2 py-1 rounded border border-yellow-300 hover:bg-yellow-100",children:"Fechar"})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Modalidade:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>l(null),className:`px-2 py-1 rounded text-xs ${o?"bg-gray-100 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:"Todas"}),a.map(h=>e.jsx("button",{onClick:()=>l(h.key),className:`px-2 py-1 rounded text-xs ${o===h.key?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:h.name},h.key))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>r(null),className:`px-2 py-1 rounded text-xs ${n?"bg-gray-100 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:"Todos"}),Object.entries(Gs).map(([h,B])=>e.jsx("button",{onClick:()=>r(h),className:`px-2 py-1 rounded text-xs ${n===h?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:B},h))]})]})]}),m?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((h,B)=>e.jsx("div",{className:"h-32 bg-gray-100 rounded animate-pulse"},B))}):s.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma partida encontrada."}):e.jsx("ul",{className:"space-y-4",children:s.map(h=>{const O=ze(h?.sport?.name||"").includes("volei"),H=O?Z(h,"home"):0,Y=O?Z(h,"away"):0,te=O?J(h,"home"):null,X=O?J(h,"away"):null,ae=!h.group_name,ee=!!(h.home?.id&&h.away?.id),le=ee,ce=h.status==="ongoing"||h.status==="paused",ie=ce?h.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200",ye=G.has(h.id);return e.jsxs("li",{className:`border rounded-lg p-3 sm:p-4 flex flex-col gap-3 bg-white shadow-sm relative overflow-hidden ${ie}`,children:[e.jsx(an,{status:h.status}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-500 flex flex-wrap items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-medium",children:h.sport?.name}),h.group_name&&e.jsxs("span",{children:["· Grupo ",h.group_name]}),h.stage&&e.jsxs("span",{children:["· ",h.stage==="semi"?"Semifinal":h.stage==="3lugar"?"3º lugar":h.stage==="r32"?"Pré-oitavas":h.stage]}),h.round&&e.jsxs("span",{children:["· J",h.round]}),ce&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",tn(h,P)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h.status==="scheduled"&&ye&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-indigo-100 text-indigo-700 uppercase tracking-wide",children:"Próximo na ordem"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded self-start sm:self-auto ${h.status==="ongoing"?"bg-green-100 text-green-700":h.status==="paused"?"bg-yellow-100 text-yellow-700":h.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:Gs[h.status]||h.status})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4",children:[e.jsx(Bs,{align:"left",team:h.home,score:h.home_score,onInc:()=>q(h,"home","inc"),onDec:()=>q(h,"home","dec"),onReset:()=>q(h,"home","reset"),sets:O?H:null,setPoints:O?te:null,onSetInc:O&&I?()=>me(h,"home","inc"):void 0,onSetDec:O&&I?()=>me(h,"home","dec"):void 0,onSetReset:O&&I?()=>me(h,"home","reset"):void 0,disabled:j[h.id]||h.status==="scheduled"}),e.jsx(Bs,{align:"right",team:h.away,score:h.away_score,onInc:()=>q(h,"away","inc"),onDec:()=>q(h,"away","dec"),onReset:()=>q(h,"away","reset"),sets:O?Y:null,setPoints:O?X:null,onSetInc:O&&I?()=>me(h,"away","inc"):void 0,onSetDec:O&&I?()=>me(h,"away","dec"):void 0,onSetReset:O&&I?()=>me(h,"away","reset"):void 0,disabled:j[h.id]||h.status==="scheduled"})]}),O&&e.jsx("button",{onClick:()=>D(be=>!be),className:"text-[10px] px-2 py-0.5 rounded border border-gray-300 hover:bg-gray-50 self-start",children:I?"Fechar edição de sets":"Editar sets manualmente"}),O&&(te>0||X>0)&&e.jsx("button",{onClick:async()=>{if(b===h.id){const be=oe(h);d(null),await he(h,{force:!be})}else d(h.id),setTimeout(()=>d(be=>be===h.id?null:be),3e3)},disabled:j[h.id]||h.status==="scheduled",className:`px-3 py-1 text-xs rounded ${b===h.id?"bg-red-600":"bg-purple-600"} text-white hover:opacity-90 disabled:opacity-50`,title:"Soma os pontos do set aos totais (PF/PA) e incrementa o set do vencedor.",children:b===h.id?"Confirmar finalizar set":"Finalizar set"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[h.status==="scheduled"&&e.jsx("button",{onClick:()=>K(h),disabled:j[h.id]||!le||!ye,className:"px-3 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",title:le?ye?"Iniciar próximo jogo da ordem.":"Aguarde: apenas o próximo jogo da ordem pode iniciar.":"Defina as duas equipes antes de iniciar.",children:"Iniciar"}),h.status==="ongoing"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Q(h),disabled:j[h.id],className:"px-3 py-1 text-xs rounded bg-yellow-500 text-white hover:bg-yellow-600 disabled:opacity-50",children:"Pausar"}),e.jsx("button",{onClick:()=>F(h),disabled:j[h.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),h.status==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>se(h),disabled:j[h.id],className:"px-3 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:"Retomar"}),e.jsx("button",{onClick:()=>F(h),disabled:j[h.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),h.status==="finished"&&e.jsx("span",{className:"text-xs text-gray-500 self-center",children:"Partida encerrada (resultado editável)."})]})]},h.id)})}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% {
            transform: translateX(-100%);
          }
          50% {
            transform: translateX(200%);
          }
          100% {
            transform: translateX(-100%);
          }
        }
      `})]})}function Bs({team:s,score:t,onInc:a,onDec:i,onReset:o,sets:l,setPoints:n,onSetInc:r,onSetDec:m,onSetReset:w,disabled:j,align:E="left"}){const T=E==="right",_=typeof n=="number"?"Pontos do set":"Pontos",$=Number(typeof n=="number"?n||0:t||0),S=!!(r||m||w),P=({label:L,value:I})=>{const D=Number.isFinite(I)?I:"-";return e.jsxs("div",{className:"flex min-w-[70px] flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-2.5 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:L}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:D})]})},k=T?"justify-end":"justify-start",V=T?"text-right":"text-left";return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-gray-50/80 p-3 shadow-sm space-y-4",children:[e.jsxs("div",{className:`flex flex-wrap items-center justify-between gap-3 ${T?"flex-row-reverse":""}`,children:[e.jsxs("div",{className:`flex min-w-0 items-center gap-2 ${T?"flex-row-reverse text-right":""}`,children:[e.jsx(ne,{team:s||{name:"A definir"},size:28}),e.jsx("span",{className:"text-sm font-medium truncate",children:s?.name||"A definir"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${T?"flex-row-reverse":""}`,children:[typeof l=="number"?e.jsx(P,{label:"Sets",value:Number(l||0)}):null,e.jsx(P,{label:_,value:$})]})]}),typeof l=="number"?e.jsxs("div",{className:`space-y-2 ${V}`,children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:"Controle de sets"}),e.jsxs("div",{className:`flex flex-wrap gap-2 ${k}`,children:[e.jsx("button",{type:"button",onClick:m,disabled:j||!S,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"-"}),e.jsx("button",{type:"button",onClick:r,disabled:j||!S,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"+"}),e.jsx("button",{type:"button",onClick:w,disabled:j||!S,className:"flex items-center justify-center rounded-lg bg-red-500 px-3 py-1 text-xs font-semibold text-white transition hover:bg-red-600 disabled:opacity-40",title:"Zerar sets",children:"Zerar"})]})]}):null,e.jsxs("div",{className:`space-y-2 ${V}`,children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:_}),e.jsxs("div",{className:`flex flex-wrap gap-2 ${k}`,children:[e.jsx("button",{type:"button",onClick:i,disabled:j,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"-"}),e.jsx("button",{type:"button",onClick:a,disabled:j,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"+"}),e.jsx("button",{type:"button",onClick:o,disabled:j,className:"flex items-center justify-center rounded-lg bg-red-500 px-3 py-1 text-xs font-semibold text-white transition hover:bg-red-600 disabled:opacity-40",title:typeof n=="number"?"Zerar pontos do set":"Zerar pontos",children:"Zerar"})]})]})]})}const Ne={pebolim:{name:"Pebolim",required:24,path:"/admin/campeonatos/pebolim",variant:"1v3_1v2_3v2"},fifa:{name:"FIFA",required:32,path:"/admin/campeonatos/fifa"},futsal:{name:"Futsal",required:9,path:"/admin/campeonatos/futsal",variant:"1v3_1v2_3v2"},volei:{name:"Vôlei",required:9,path:"/admin/campeonatos/volei",variant:"1v2_1v3_2v3"}},nn={Pebolim:"pebolim",FIFA:"fifa",Futsal:"futsal",Volei:"volei",Vôlei:"volei"},on=(s="")=>s.trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),Vs=({children:s,tone:t="gray"})=>e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium border ${t==="green"?"bg-green-50 text-green-700 border-green-200":t==="amber"?"bg-amber-50 text-amber-700 border-amber-200":t==="red"?"bg-red-50 text-red-700 border-red-200":t==="blue"?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:s}),Us=({children:s,className:t=""})=>e.jsx("div",{className:`rounded-2xl border border-gray-200 bg-white shadow-sm ${t}`,children:s}),ln=({title:s,subtitle:t,right:a})=>e.jsxs("div",{className:"flex items-start justify-between gap-3 p-4 sm:p-5",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:s}),t&&e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t})]}),a]}),ss=({children:s,className:t="",...a})=>e.jsx("button",{className:`inline-flex w-full items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-gray-200 disabled:text-gray-500 ${t}`,...a,children:s}),Je=({children:s,className:t="",...a})=>e.jsx("button",{className:`inline-flex w-full items-center justify-center gap-2 rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60 ${t}`,...a,children:s});function cn(){const s=fe(),[t,a]=c.useState(!0),[i,o]=c.useState(null),[l,n]=c.useState([]),[r,m]=c.useState({}),[w,j]=c.useState({}),[E,T]=c.useState(null),[_,$]=c.useState(null),S=async()=>{a(!0),o(null);try{const{data:b,error:d}=await f.from("sports").select("id,name").order("name",{ascending:!0});if(d)throw d;const x=b.map(C=>({id:C.id,name:C.name,key:nn[C.name?.trim()]||on(C.name)}));n(x);const v=await Promise.all(x.map(async C=>{const[M,u,p,A]=await Promise.all([f.from("teams").select("id",{count:"exact",head:!0}).eq("sport_id",C.id),f.from("teams").select("id, name, group_name, seed_in_group").eq("sport_id",C.id).not("group_name","is",null),f.from("matches").select("id",{count:"exact",head:!0}).eq("sport_id",C.id),f.from("standings").select("id",{count:"exact",head:!0}).eq("sport_id",C.id)]),g=M?.count??0,y=p?.count??0,R=A?.count??0,N=dn(u?.data||[]),{data:G}=await f.from("v_queue_slots_v2").select("slot, lane_idx, lane_code, order_idx, match_id, stage, group_name").eq("sport_id",C.id);let z={};const q=(G||[]).map(J=>J.match_id).filter(Boolean);if(q.length){const{data:J}=await f.from("match_detail_view").select("id, home_team_name, away_team_name").in("id",q);z=Object.fromEntries((J||[]).map(Z=>[Z.id,Z]))}return[C.key,{sportId:C.id,sportName:C.name,teamCount:g,groupsMeta:N,matchesCount:y,standingsCount:R,hasAny:(y||R||N.total||0)>0,queueSlots:G||[],queueDetails:z}]}));m(Object.fromEntries(v))}catch(b){o(`Falha ao carregar: ${b.message||b}`)}finally{a(!1)}};c.useEffect(()=>{S();const b=f.channel("tournaments-queue").on("postgres_changes",{event:"*",schema:"public",table:"matches"},S).subscribe();return()=>f.removeChannel(b)},[]);const P=b=>{const d=r[b];if(!d)return!1;if(b==="fifa")return d.teamCount===Ne.fifa.required;const x=b==="pebolim"?8:3,v=Object.values(d.groupsMeta.byGroup||{}),C=v.length===x&&v.every(u=>u.members.length===3),M=v.every(u=>un(u.members.map(p=>p.seed_in_group),[1,2,3]));return C&&M},k=(b,d)=>j(x=>({...x,[b]:d})),V=b=>$({key:b,name:Ne[b].name}),L=async b=>{const d=r[b];if(!d)return;const x=d.sportId;k(b,!0),o(null),$(null);try{if(b==="fifa"){const{error:v}=await f.rpc("fifa_preserve_order_and_reset_played",{p_reset_played:!0});if(v)throw v}else{const{data:v}=await f.from("matches").select("id").eq("sport_id",x),C=(v||[]).map(p=>p.id);C.length&&await f.from("match_events").delete().in("match_id",C),await f.from("matches").delete().eq("sport_id",x),await f.from("standings").delete().eq("sport_id",x);const M=Ne[b]?.variant||"1v3_1v2_3v2",{error:u}=await f.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:x,p_variant:M});if(u)throw u}o(`Campeonato de ${Ne[b].name} gerado com sucesso (ordem fixa).`),await S()}catch(v){o(`Falha ao gerar partidas: ${v.message||v}`)}finally{k(b,!1)}},I=b=>T({key:b,name:Ne[b].name}),D=async b=>{const d=r[b];if(d){k(b,!0);try{const{data:x}=await f.from("matches").select("id").eq("sport_id",d.sportId),v=(x||[]).map(C=>C.id);v.length&&await f.from("match_events").delete().in("match_id",v),await f.from("matches").delete().eq("sport_id",d.sportId),await f.from("standings").delete().eq("sport_id",d.sportId),await f.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",d.sportId),o(`Campeonato de ${Ne[b].name} foi reiniciado.`),T(null),await S()}catch(x){o(`Falha ao reiniciar: ${x.message||x}`)}finally{k(b,!1)}}};return e.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Gerenciar Campeonatos"})]}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Configure grupos, gere as partidas na ordem definida e opere os cartões: ",e.jsx("strong",{children:"Ao vivo"}),", ",e.jsx("strong",{children:"⚠️ Compareçam"})," e ",e.jsx("strong",{children:"Próximo jogo"}),"."]})]}),i&&e.jsx("div",{className:"mb-4 rounded-xl border border-blue-200 bg-blue-50 px-3 py-2 text-sm text-blue-800",children:i}),t?e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Array.from({length:4}).map((b,d)=>e.jsxs(Us,{className:"p-4",children:[e.jsx("div",{className:"h-6 w-32 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"mt-3 h-4 w-56 animate-pulse rounded bg-gray-100"}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-9 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"h-9 animate-pulse rounded bg-gray-100"})]})]},d))}):e.jsx("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:l.map(b=>{const d=b.key,x=Ne[d];if(!x)return null;const v=r[d]||{},C=v.teamCount===x.required,M=!!v.hasAny,u=P(d);return e.jsxs(Us,{children:[e.jsx(ln,{title:x.name,subtitle:`Times: ${v.teamCount??0} / ${x.required}`,right:M?e.jsx(Vs,{tone:"amber",children:"Existe"}):e.jsx(Vs,{tone:C?"green":"gray",children:C?"Pronto":"Aguardando times"})}),e.jsx("div",{className:"px-4 sm:px-5",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ea,{className:"h-4 w-4"})," Partidas: ",e.jsx("strong",{className:"ml-1",children:v.matchesCount??0})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(bs,{className:"h-4 w-4"})," Grupos definidos: ",e.jsx("strong",{className:"ml-1",children:v.groupsMeta.countGroups||0})]}),d!=="fifa"&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ma,{className:"h-4 w-4"})," Seeds válidos: ",e.jsx("strong",{className:"ml-1",children:v.groupsMeta.seedsOk?"Sim":"Não"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-4 sm:grid-cols-2 sm:p-5",children:[e.jsxs(ss,{disabled:!C||M,onClick:()=>s(x.path),children:[e.jsx(bs,{className:"h-4 w-4"})," Configurar & Agrupar"]}),e.jsxs(Je,{className:"text-red-600 border-red-600 hover:bg-red-50",disabled:w[d]||(d==="fifa"?!C:!u),onClick:()=>V(d),children:[w[d]?e.jsx(ta,{className:"h-4 w-4 animate-spin"}):e.jsx(la,{className:"h-4 w-4"}),"Gerar Partidas (ordem fixa)"]}),e.jsxs(Je,{className:"sm:col-span-2",onClick:()=>I(d),disabled:!M,children:[e.jsx(ga,{className:"h-4 w-4"})," Apagar & Reiniciar"]})]}),e.jsx("div",{className:"px-4 pb-4 sm:px-5 sm:pb-5",children:e.jsx("div",{className:"rounded-xl border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 divide-y sm:grid-cols-3 sm:divide-x sm:divide-y-0",children:[ts(v,"live"),ts(v,"call"),ts(v,"next")]})})})]},d)})}),E&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>T(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Reiniciar ",E.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Isso apagará ",e.jsx("strong",{children:"todas"})," as partidas, eventos e a classificação, e limpará os grupos."]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-2",children:[e.jsx(Je,{onClick:()=>T(null),children:"Cancelar"}),e.jsx(ss,{onClick:()=>D(E.key),children:"Confirmar"})]})]})]}),_&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>$(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Gerar Partidas para ",_.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Isso apagará ",e.jsx("strong",{children:"todas"})," as partidas, eventos e a classificação, e limpará os grupos antes de gerar novas partidas."]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-2",children:[e.jsx(Je,{onClick:()=>$(null),children:"Cancelar"}),e.jsx(ss,{onClick:()=>L(_.key),children:"Confirmar"})]})]})]})]})}function dn(s){const t={};for(const l of s)t[l.group_name]||(t[l.group_name]={members:[]}),t[l.group_name].members.push({id:l.id,name:l.name,seed_in_group:l.seed_in_group});const a=Object.keys(t).sort(mn),i=a.length;let o=!0;for(const l of a){const n=new Set(t[l].members.map(m=>m.seed_in_group));n.has(1)&&n.has(2)&&n.has(3)&&n.size===3||(o=!1)}return{byGroup:t,groups:a,countGroups:i,total:s.length,seedsOk:o}}function mn(s,t){const a=s&&s[s.length-1]||"z",i=t&&t[t.length-1]||"z";return a<i?-1:a>i?1:0}function un(s=[],t=[]){const a=new Set(s),i=new Set(t);if(a.size!==i.size)return!1;for(const o of a)if(!i.has(o))return!1;return!0}function ts(s,t){const a=t==="live"?"Ao vivo":t==="call"?"⚠️ Compareçam":"Próximo jogo",i=t==="live"?"bg-red-50 border-red-200":t==="call"?"bg-amber-50 border-amber-200":"bg-emerald-50 border-emerald-200",o=(s.queueSlots||[]).filter(l=>l.slot===t);return e.jsx("div",{className:"p-3 sm:p-4",children:e.jsxs("div",{className:`rounded-xl border p-3 sm:p-4 ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:a}),o.length===1?e.jsxs("span",{className:"inline-flex items-center gap-1",children:["#",o[0]?.order_idx??"–"]}):e.jsxs("span",{className:"text-gray-400",children:[o.length||0," filas"]})]}),e.jsx("div",{className:"mt-2 space-y-2",children:o.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"Aguardando…"}):o.map((l,n)=>{const r=l?.match_id?s.queueDetails?.[l.match_id]:null;return e.jsxs("div",{className:"rounded-lg bg-white/70 p-2 border",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{className:"font-medium",children:[l.lane_code?`Fila ${l.lane_code}`:"",l.group_name?` • Grupo ${l.group_name}`:""]}),e.jsxs("span",{className:"text-gray-500",children:["#",l.order_idx??"–"]})]}),r?e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[r.home_team_name," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",r.away_team_name]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Aguardando…"}),l.stage?e.jsx("div",{className:"mt-1 text-[11px] text-gray-500",children:String(l.stage).toUpperCase()}):null]},`${t}-${l.lane_idx??n}`)})})]})})}const pe=["A","B","C"],Ce=3;function gn(){const[s,t]=c.useState([]),[a,i]=c.useState({A:[],B:[],C:[]}),[o,l]=c.useState(new Set),[n,r]=c.useState(!0),[m,w]=c.useState(!1),[j,E]=c.useState(null),T=c.useRef(!1),_=c.useRef(!0),$=fe(),S=c.useMemo(()=>{const x=new Map;return s.forEach(v=>x.set(v.id,v)),x},[s]),P=async()=>{if(!T.current){T.current=!0,r(!0);try{const{data:x,error:v}=await f.from("sports").select("id").eq("name","Futsal").maybeSingle();if(v||!x?.id){alert("Erro ao buscar a modalidade Futsal.");return}E(x.id);const{data:C,error:M}=await f.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",x.id).order("name");if(M){alert("Erro ao carregar times de Futsal.");return}t(C||[]);const u={A:[],B:[],C:[]},p=(C||[]).reduce((A,g)=>(pe.includes(g.group_name)&&(A[g.group_name]=A[g.group_name]||[]).push(g),A),{});pe.forEach(A=>{const g=(p[A]||[]).sort((y,R)=>{const N=y.seed_in_group??999,G=R.seed_in_group??999;return N!==G?N-G:y.name.localeCompare(R.name)});u[A]=g.map(y=>y.id)}),i(u)}finally{r(!1),T.current=!1}}};c.useEffect(()=>{_.current=!0,P();const x=f.channel("futsal-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{_.current&&!T.current&&P()}).subscribe();return()=>{_.current=!1,f.removeChannel(x)}},[]);const k=c.useMemo(()=>new Set(pe.flatMap(x=>a[x])),[a]),V=c.useMemo(()=>s.filter(x=>!k.has(x.id)),[s,k]),L=x=>{l(v=>{const C=new Set(v);return C.has(x)?C.delete(x):C.add(x),C})},I=x=>{const v=Array.from(o);if(!v.length){alert("Selecione ao menos 1 time.");return}if(a[x].length+v.length>Ce){alert(`O grupo ${x} não pode ter mais de ${Ce} times.`),l(new Set);return}i(C=>{const M={...C};for(const u of v){for(const p of pe)M[p]=M[p].filter(A=>A!==u);M[x]=[...M[x],u]}return M}),l(new Set)},D=x=>{i(v=>{const C={...v};for(const M of pe)C[M]=C[M].filter(u=>u!==x);return C})},b=pe.every(x=>a[x].length===Ce),d=async()=>{if(!b){alert("Complete todos os grupos antes de confirmar!");return}if(!j){alert("Modalidade Futsal não encontrada.");return}try{w(!0),await f.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",j);for(const v of pe){const C=a[v];if(C.length){await f.from("teams").update({group_name:v}).in("id",C);for(let M=0;M<C.length;M++)await f.from("teams").update({seed_in_group:M+1}).eq("id",C[M])}}await f.rpc("seed_initial_standings",{p_sport_name:"Futsal",p_reset:!0}),await f.rpc("rebuild_standings",{p_sport_name:"Futsal"});const{error:x}=await f.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:j,p_variant:"1v3_1v2_3v2"});if(x){alert("Erro ao gerar jogos de grupos: "+x.message);return}await f.rpc("maybe_create_knockout",{p_sport_name:"Futsal"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>$("/admin/campeonatos"),1200)}catch(x){alert("Erro ao salvar: "+(x?.message||String(x)))}finally{w(!1)}};return n?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Futsal"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. Ao confirmar, os grupos são salvos com"," ",e.jsx("strong",{children:"seed_in_group = 1,2,3"}),", e os jogos são gerados via RPC na"," ",e.jsx("strong",{children:"ordem exata"})," (fila global por ",e.jsx("code",{children:"order_idx"}),"). Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:P,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),V.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:V.map(x=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${o.has(x.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>L(x.id),title:x.name,children:[e.jsx(zs,{team:x}),e.jsx("span",{className:"truncate",children:x.name})]},x.id))})]}),pe.map(x=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",x]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[x].length===Ce?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[x].length,"/",Ce]})]}),e.jsx("button",{onClick:()=>I(x),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[x].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[x].map((v,C)=>{const M=S.get(v);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>D(v),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:C+1}),e.jsx(zs,{team:M}),e.jsx("span",{className:"truncate",title:M?.name,children:M?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},v)})})})]},x))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:pe.map(x=>`${x}(${a[x].length}/${Ce})`).join(", ")}),e.jsx("button",{onClick:d,disabled:!b||m,className:`px-6 py-2 rounded font-semibold transition ${b&&!m?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:m?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function zs({team:s}){const t=hn(s?.name),a=s?.color||pn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function hn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function pn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const ue=["A","B","C"],_e=3;function xn(){const[s,t]=c.useState([]),[a,i]=c.useState({A:[],B:[],C:[]}),[o,l]=c.useState(new Set),[n,r]=c.useState(!0),[m,w]=c.useState(!1),[j,E]=c.useState(null),T=c.useRef(!1),_=c.useRef(!0),$=fe(),S=async()=>{if(!T.current){T.current=!0,r(!0);try{const{data:d,error:x}=await f.from("sports").select("id").eq("name","Volei").maybeSingle();if(x||!d?.id){alert("Erro ao buscar a modalidade Vôlei.");return}E(d.id);const{data:v,error:C}=await f.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",d.id).order("name");if(C){alert("Erro ao carregar times de Vôlei.");return}t(v||[]);const M={A:[],B:[],C:[]},u={A:[],B:[],C:[]};(v||[]).forEach(p=>{p.group_name&&ue.includes(p.group_name)&&u[p.group_name].push(p)}),ue.forEach(p=>{const A=(u[p]||[]).sort((g,y)=>{const R=g.seed_in_group??999,N=y.seed_in_group??999;return R!==N?R-N:g.name.localeCompare(y.name)});M[p]=A.map(g=>g.id)}),i(M)}finally{r(!1),T.current=!1}}};c.useEffect(()=>{_.current=!0,S();const d=f.channel("volei-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{_.current&&!T.current&&S()}).subscribe();return()=>{_.current=!1,f.removeChannel(d)}},[]);const P=c.useMemo(()=>new Set(ue.flatMap(d=>a[d])),[a]),k=c.useMemo(()=>s.filter(d=>!P.has(d.id)),[s,P]),V=d=>{l(x=>{const v=new Set(x);return v.has(d)?v.delete(d):v.add(d),v})},L=d=>{const x=Array.from(o);if(!x.length){alert("Selecione ao menos 1 time.");return}if(a[d].length+x.length>_e){alert(`O grupo ${d} não pode ter mais de ${_e} times.`),l(new Set);return}i(v=>{const C={...v};for(const M of x){for(const u of ue)C[u]=C[u].filter(p=>p!==M);C[d]=[...C[d],M]}return C}),l(new Set)},I=d=>{i(x=>{const v={...x};for(const C of ue)v[C]=v[C].filter(M=>M!==d);return v})},D=ue.every(d=>a[d].length===_e),b=async()=>{if(!D){alert("Complete todos os grupos antes de confirmar!");return}if(!j){alert("Modalidade Vôlei não encontrada.");return}try{w(!0),await f.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",j);for(const x of ue){const v=a[x];if(v.length){await f.from("teams").update({group_name:x}).in("id",v);for(let C=0;C<v.length;C++)await f.from("teams").update({seed_in_group:C+1}).eq("id",v[C])}}await f.rpc("seed_initial_standings",{p_sport_name:"Volei",p_reset:!0}),await f.rpc("rebuild_standings",{p_sport_name:"Volei"});const{error:d}=await f.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:j,p_variant:"1v2_1v3_2v3"});if(d){alert("Erro ao gerar jogos de grupos: "+d.message);return}await f.rpc("maybe_create_knockout",{p_sport_name:"Volei"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>$("/admin/campeonatos"),1200)}catch(d){alert("Erro ao salvar: "+(d?.message||String(d)))}finally{w(!1)}};return n?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Vôlei"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. Ao confirmar, salvamos"," ",e.jsx("strong",{children:"group_name"})," e ",e.jsx("strong",{children:"seed_in_group = 1,2,3"})," conforme a ordem e geramos os jogos via RPC na ",e.jsx("strong",{children:"ordem exata"}),". Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:S,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),k.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:k.map(d=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${o.has(d.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>V(d.id),title:d.name,children:[e.jsx(Js,{team:d}),e.jsx("span",{className:"truncate",children:d.name})]},d.id))})]}),ue.map(d=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",d]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[d].length===_e?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[d].length,"/",_e]})]}),e.jsx("button",{onClick:()=>L(d),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[d].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[d].map((x,v)=>{const C=s.find(M=>M.id===x);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>I(x),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:v+1}),e.jsx(Js,{team:C}),e.jsx("span",{className:"truncate",title:C?.name,children:C?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},x)})})})]},d))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:ue.map(d=>`${d}(${a[d].length}/${_e})`).join(", ")}),e.jsx("button",{onClick:b,disabled:!ue.every(d=>a[d].length===_e)||m,className:`px-6 py-2 rounded font-semibold transition ${ue.every(d=>a[d].length===_e)&&!m?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:m?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Js({team:s}){const t=fn(s?.name),a=s?.color||yn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function fn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function yn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const as=16;function bn(){const[s,t]=c.useState([]),[a,i]=c.useState(Array.from({length:as},()=>({home:null,away:null}))),[o,l]=c.useState(new Set),[n,r]=c.useState(!0),[m,w]=c.useState(!1),[j,E]=c.useState(null),T=fe(),_=async()=>{r(!0);try{const{data:b,error:d}=await f.from("sports").select("id").eq("name","FIFA").maybeSingle();if(d||!b?.id){alert("Erro ao localizar a modalidade FIFA."),r(!1);return}E(b.id);const{data:x,error:v}=await f.from("teams").select("id, name, logo_url, color").eq("sport_id",b.id).order("name");v?alert("Erro ao carregar times do FIFA."):t(x||[])}finally{r(!1)}};c.useEffect(()=>{_()},[]);const $=c.useMemo(()=>new Set(a.flatMap(b=>[b.home,b.away]).filter(Boolean)),[a]),S=c.useMemo(()=>s.filter(b=>!$.has(b.id)),[s,$]),P=b=>{l(d=>{const x=new Set(d);return x.has(b)?x.delete(b):x.add(b),x})},k=(b,d)=>{const x=Array.from(o);if(x.length===0){alert("Selecione um time para alocar.");return}if(x.length>1){alert("Selecione apenas 1 time por vez."),l(new Set);return}const v=x[0];i(C=>{const M=C[b];if(M[d])return alert(`O slot ${d==="home"?"A":"B"} do Jogo ${b+1} já está ocupado.`),C;const u=[...C];return u[b]={...M,[d]:v},u}),l(new Set)},V=(b,d)=>{i(x=>{const v=[...x];return v[b]={...v[b],[d]:null},v})},L=a.length===as&&a.every(b=>b.home&&b.away),I=async()=>{if(!L){alert("Todos os confrontos precisam ter 2 times.");return}if(!j){alert("Modalidade FIFA não encontrada.");return}try{w(!0);const{count:b}=await f.from("matches").select("*",{count:"exact",head:!0}).eq("sport_id",j);if((b??0)>0){if(!window.confirm("Já existe um campeonato de FIFA. Criar um novo vai apagar jogos e classificação existentes. Deseja continuar?"))return;const{data:C}=await f.from("matches").select("id").eq("sport_id",j),M=(C||[]).map(u=>u.id);M.length&&await f.from("match_events").delete().in("match_id",M),await f.from("matches").delete().eq("sport_id",j),await f.from("standings").delete().eq("sport_id",j)}await f.from("teams").update({group_name:null}).eq("sport_id",j);const d=a.map((v,C)=>({sport_id:j,stage:"r32",round:C+1,order_idx:C+1,status:"scheduled",home_team_id:v.home,away_team_id:v.away,venue:"Console FIFA"})),{error:x}=await f.from("matches").insert(d);if(x){alert("Erro ao criar os jogos: "+x.message);return}await f.from("matches").insert(Array.from({length:8}).map((v,C)=>({sport_id:j,stage:"oitavas",round:C+1,order_idx:16+(C+1),status:"scheduled"}))),await f.from("matches").insert(Array.from({length:4}).map((v,C)=>({sport_id:j,stage:"quartas",round:C+1,order_idx:24+(C+1),status:"scheduled"}))),await f.from("matches").insert([{sport_id:j,stage:"semi",round:1,order_idx:29,status:"scheduled"},{sport_id:j,stage:"semi",round:2,order_idx:30,status:"scheduled"},{sport_id:j,stage:"final",round:1,order_idx:31,status:"scheduled"},{sport_id:j,stage:"3lugar",round:1,order_idx:32,status:"scheduled"}]),await f.rpc("seed_initial_standings",{p_sport_name:"FIFA",p_reset:!0}),alert(`✅ Chaveamento criado com sucesso!

Voltando para a tela de campeonatos…`),setTimeout(()=>T("/admin/campeonatos"),1200)}catch(b){alert("Erro ao salvar: "+(b?.message||String(b)))}finally{w(!1)}},D=async()=>{if(!j){alert("Modalidade FIFA não encontrada.");return}if(s.length!==32){alert("É necessário ter exatamente 32 times cadastrados no FIFA para gerar automaticamente.");return}try{w(!0);const{error:b}=await f.rpc("fifa_seed_32_bracket",{p_sport_name:"FIFA",p_reset:!1});if(b)throw b;alert(`✅ Partidas do FIFA geradas com sucesso!

Voltando para a tela de campeonatos…`),setTimeout(()=>T("/admin/campeonatos"),1200)}catch(b){console.error("Erro ao gerar partidas FIFA:",b),alert("Erro ao gerar partidas: "+(b?.message||String(b)))}finally{w(!1)}};return n?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de FIFA"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Monte as pré-oitavas (16 jogos). Ao confirmar, os jogos entram como ",e.jsx("strong",{children:"scheduled"})," com"," ",e.jsx("strong",{children:"order_idx"})," fixo: assim, o Jogo 1 aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:D,disabled:m||!j,title:"Gera automaticamente J1..J16, placeholders J17..J28",className:`text-xs px-3 py-1 rounded border transition ${m?"opacity-60 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Gerar automaticamente (RPC)"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),S.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"grid grid-cols-2 gap-2",children:S.map(b=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${o.has(b.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>P(b.id),title:b.name,children:[e.jsx(rs,{team:b}),e.jsx("span",{className:"truncate",children:b.name})]},b.id))})]}),e.jsxs("div",{className:"border rounded p-4 overflow-y-auto max-h-[32rem]",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Confrontos (pré-oitavas)"}),e.jsx("ul",{className:"space-y-4",children:a.map((b,d)=>{const x=s.find(C=>C.id===b.home),v=s.find(C=>C.id===b.away);return e.jsxs("li",{className:"flex flex-col gap-1 border rounded p-2 bg-gray-50",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:["Jogo ",d+1]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 flex-1",children:x?e.jsxs(e.Fragment,{children:[e.jsx(rs,{team:x}),e.jsx("span",{className:"truncate",title:x.name,children:x.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>V(d,"home"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>k(d,"home"),children:"Adicionar time A"})}),e.jsx("span",{className:"font-bold",children:"vs"}),e.jsx("div",{className:"flex items-center gap-2 flex-1",children:v?e.jsxs(e.Fragment,{children:[e.jsx(rs,{team:v}),e.jsx("span",{className:"truncate",title:v.name,children:v.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>V(d,"away"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>k(d,"away"),children:"Adicionar time B"})})]})]},d)})})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:L?e.jsxs("span",{className:"text-green-700",children:["Todos os ",as," confrontos estão prontos!"]}):e.jsxs("span",{children:["Restam ",32-$.size," times para alocar."]})}),e.jsx("button",{onClick:I,disabled:!L||m,className:`px-6 py-3 rounded font-semibold transition ${L&&!m?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:m?"Processando...":"Confirmar chaveamento"})]})]})}function rs({team:s}){const t=jn(s?.name),a=s?.color||_n(s?.name||"T");return e.jsx("div",{className:"w-7 h-7 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function jn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function _n(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const ge=["A","B","C","D","E","F","G","H"],Ae=3;function Nn(){const[s,t]=c.useState([]),[a,i]=c.useState(ge.reduce((d,x)=>({...d,[x]:[]}),{})),[o,l]=c.useState(new Set),[n,r]=c.useState(!0),[m,w]=c.useState(!1),[j,E]=c.useState(null),T=c.useRef(!1),_=c.useRef(!0),$=fe(),S=async()=>{if(!T.current){T.current=!0,r(!0);try{const{data:d,error:x}=await f.from("sports").select("id").eq("name","Pebolim").maybeSingle();if(x||!d?.id){alert("Erro ao buscar a modalidade Pebolim.");return}E(d.id);const{data:v,error:C}=await f.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",d.id).order("name");if(C){alert("Erro ao carregar times de Pebolim.");return}t(v||[]);const M=ge.reduce((p,A)=>({...p,[A]:[]}),{}),u=(v||[]).reduce((p,A)=>(ge.includes(A.group_name)&&(p[A.group_name]=p[A.group_name]||[]).push(A),p),{});ge.forEach(p=>{const A=(u[p]||[]).sort((g,y)=>{const R=g.seed_in_group??999,N=y.seed_in_group??999;return R!==N?R-N:g.name.localeCompare(y.name)});M[p]=A.map(g=>g.id)}),i(M)}finally{r(!1),T.current=!1}}};c.useEffect(()=>{_.current=!0,S();const d=f.channel("pebolim-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{_.current&&!T.current&&S()}).subscribe();return()=>{_.current=!1,f.removeChannel(d)}},[]);const P=c.useMemo(()=>new Set(ge.flatMap(d=>a[d])),[a]),k=c.useMemo(()=>s.filter(d=>!P.has(d.id)),[s,P]),V=d=>{l(x=>{const v=new Set(x);return v.has(d)?v.delete(d):v.add(d),v})},L=d=>{const x=Array.from(o);if(!x.length){alert("Selecione ao menos 1 time.");return}if(a[d].length+x.length>Ae){alert(`O grupo ${d} não pode ter mais de ${Ae} times.`),l(new Set);return}i(v=>{const C={...v};for(const M of x){for(const u of ge)C[u]=C[u].filter(p=>p!==M);C[d]=[...C[d],M]}return C}),l(new Set)},I=d=>{i(x=>{const v={...x};for(const C of ge)v[C]=v[C].filter(M=>M!==d);return v})},D=ge.every(d=>a[d].length===Ae),b=async()=>{if(!D){alert("Complete todos os grupos antes de confirmar!");return}if(!j){alert("Modalidade Pebolim não encontrada.");return}try{w(!0),await f.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",j);for(const x of ge){const v=a[x];if(v.length){await f.from("teams").update({group_name:x}).in("id",v);for(let C=0;C<v.length;C++)await f.from("teams").update({seed_in_group:C+1}).eq("id",v[C])}}await f.rpc("seed_initial_standings",{p_sport_name:"Pebolim",p_reset:!0}),await f.rpc("rebuild_standings",{p_sport_name:"Pebolim"});const{error:d}=await f.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:j,p_variant:"1v3_1v2_3v2"});if(d){alert("Erro ao gerar jogos de grupos: "+d.message);return}await f.rpc("maybe_create_knockout",{p_sport_name:"Pebolim"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>$("/admin/campeonatos"),1200)}catch(d){alert("Erro ao salvar: "+(d?.message||String(d)))}finally{w(!1)}};return n?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Pebolim"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 24 times em 8 grupos de 3. Ao confirmar, salvamos"," ",e.jsx("strong",{children:"group_name"})," e ",e.jsx("strong",{children:"seed_in_group = 1,2,3"})," conforme a ordem e geramos os jogos via RPC na ",e.jsx("strong",{children:"ordem exata"}),". Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:S,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),k.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:k.map(d=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${o.has(d.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>V(d.id),title:d.name,children:[e.jsx(Hs,{team:d}),e.jsx("span",{className:"truncate",children:d.name})]},d.id))})]}),ge.map(d=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",d]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[d].length===Ae?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[d].length,"/",Ae]})]}),e.jsx("button",{onClick:()=>L(d),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[d].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[d].map((x,v)=>{const C=s.find(M=>M.id===x);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>I(x),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:v+1}),e.jsx(Hs,{team:C}),e.jsx("span",{className:"truncate",title:C?.name,children:C?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},x)})})})]},d))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:ge.map(d=>`${d}(${a[d].length}/${Ae})`).join(", ")}),e.jsx("button",{onClick:b,disabled:!D||m,className:`px-6 py-2 rounded font-semibold transition ${D&&!m?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:m?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Hs({team:s}){const t=vn(s?.name),a=s?.color||wn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function vn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function wn(s){let t=0;for(let i=0;i<s.length;i++)t=s.charCodeAt(i)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function Sn(){return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})})}function $n(){const{session:s,isAdmin:t,ready:a,signOut:i,needsPasswordSetup:o}=hs();gs();const l=fe();if(!a)return e.jsx(Sn,{});if(o)return e.jsx(Rs,{});const n=async()=>{try{await i(),l("/",{replace:!0})}catch(r){console.error("Error during signout:",r)}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"bg-blue-600 text-white sticky top-0 z-50 shadow-md",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx(W,{to:"/",className:"hover:opacity-90 transition-opacity",children:e.jsx("img",{src:"/logo-copa-influence.png",alt:"Copa Influence",className:"h-12 md:h-16 w-auto"})}),e.jsx("div",{className:"text-sm",children:s?e.jsxs("div",{className:"flex items-center gap-2",children:[s.user?.email&&e.jsx("span",{className:"text-white/80 text-xs hidden sm:inline",children:s.user.email}),e.jsx("button",{onClick:n,className:"hover:underline transition-colors hover:text-white/80 text-xs sm:text-sm",children:"Sair"})]}):e.jsx(W,{to:"/login",className:"hover:underline transition-colors hover:text-white/80 text-xs sm:text-sm",children:"Entrar"})})]}),e.jsx("div",{className:"border-t border-white/20 py-2",children:e.jsxs("nav",{className:"flex items-center justify-center gap-1 sm:gap-3 text-xs sm:text-sm overflow-x-auto",children:[e.jsx(W,{to:"/",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Home"}),e.jsx(W,{to:"/futsal",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Futsal"}),e.jsx(W,{to:"/volei",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Vôlei"}),e.jsx(W,{to:"/fifa",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"FIFA"}),e.jsx(W,{to:"/pebolim",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Pebolim"}),t&&e.jsx(W,{to:"/admin",className:"bg-white/15 hover:bg-white/25 transition-colors px-2 py-1 rounded text-xs whitespace-nowrap ml-1 sm:ml-2",children:"Admin"})]})})]})}),e.jsx("main",{className:"flex-1 container mx-auto p-4",children:e.jsxs(kt,{children:[e.jsx(re,{path:"/",element:e.jsx(Na,{})}),e.jsx(re,{path:"/futsal",element:e.jsx(Ba,{})}),e.jsx(re,{path:"/volei",element:e.jsx(sr,{})}),e.jsx(re,{path:"/fifa",element:e.jsx(fr,{})}),e.jsx(re,{path:"/pebolim",element:e.jsx(Er,{})}),e.jsx(re,{path:"/team/:id",element:e.jsx(Ts,{})}),e.jsx(re,{path:"/times/:id",element:e.jsx(Ts,{})}),e.jsx(re,{path:"/match/:id",element:e.jsx(Ms,{})}),e.jsx(re,{path:"/partida/:id",element:e.jsx(Ms,{})}),e.jsx(re,{path:"/set-password",element:e.jsx(Rs,{})}),e.jsx(re,{path:"/login",element:e.jsx(Kr,{})}),e.jsx(re,{path:"/admin",element:e.jsx(je,{children:e.jsx(Hr,{})})}),e.jsx(re,{path:"/admin/elencos",element:e.jsx(je,{children:e.jsx(Zr,{})})}),e.jsx(re,{path:"/admin/partidas",element:e.jsx(je,{children:e.jsx(rn,{})})}),e.jsx(re,{path:"/admin/campeonatos",element:e.jsx(je,{children:e.jsx(cn,{})})}),e.jsx(re,{path:"/admin/campeonatos/futsal",element:e.jsx(je,{children:e.jsx(gn,{})})}),e.jsx(re,{path:"/admin/campeonatos/volei",element:e.jsx(je,{children:e.jsx(xn,{})})}),e.jsx(re,{path:"/admin/campeonatos/fifa",element:e.jsx(je,{children:e.jsx(bn,{})})}),e.jsx(re,{path:"/admin/campeonatos/pebolim",element:e.jsx(je,{children:e.jsx(Nn,{})})}),e.jsx(re,{path:"*",element:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"404 - Página não encontrada"}),e.jsx(W,{to:"/",className:"text-blue-600 hover:underline",children:"Voltar ao início"})]})})]})}),e.jsx("footer",{className:"bg-gray-200 p-4 text-center text-xs text-gray-700 mt-auto",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("p",{children:["© ",new Date().getFullYear()," Copa Influence"]}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Desenvolvido para a comunidade da igreja"})]})})]})}It.createRoot(document.getElementById("root")).render(e.jsx(Ke.StrictMode,{children:e.jsx(Tt,{children:e.jsx(Ot,{children:e.jsx($n,{})})})}));
