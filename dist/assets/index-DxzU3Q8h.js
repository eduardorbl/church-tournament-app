import{r as Nt,b as wt,a as vt,c,u as Vs,N as St,L as X,R as Ve,d as zs,e as me,f as $t,h as Ct,i as ee,B as At}from"./vendor-vbeBnipd.js";import{c as kt}from"./supabase-BfEApigK.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=a(n);fetch(n.href,l)}})();var Je={exports:{}},$e={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ms;function Et(){if(ms)return $e;ms=1;var s=Nt(),t=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function i(r,u,w){var y,k={},C=null,$=null;w!==void 0&&(C=""+w),u.key!==void 0&&(C=""+u.key),u.ref!==void 0&&($=u.ref);for(y in u)o.call(u,y)&&!l.hasOwnProperty(y)&&(k[y]=u[y]);if(r&&r.defaultProps)for(y in u=r.defaultProps,u)k[y]===void 0&&(k[y]=u[y]);return{$$typeof:t,type:r,key:C,ref:$,props:k,_owner:n.current}}return $e.Fragment=a,$e.jsx=i,$e.jsxs=i,$e}var us;function Tt(){return us||(us=1,Je.exports=Et()),Je.exports}var e=Tt(),Fe={},gs;function Pt(){if(gs)return Fe;gs=1;var s=wt();return Fe.createRoot=s.createRoot,Fe.hydrateRoot=s.hydrateRoot,Fe}var Ft=Pt();const Rt=vt(Ft),Mt="https://cifdtjfrekucrmapewoj.supabase.co",qt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpZmR0amZyZWt1Y3JtYXBld29qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc5OTM2OTAsImV4cCI6MjA3MzU2OTY5MH0.h4cP9OeroEa4XEQsOrdgy8L-fewT--DC2AtUk9ipJAA",h=kt(Mt,qt),Us=c.createContext({session:null,isAdmin:!1,needsPasswordSetup:!1,ready:!1,loading:!1,signIn:async()=>({data:null,error:null}),signOut:async()=>({error:null}),updatePassword:async()=>({data:null,error:null}),refreshAuth:async()=>{}});function ds(){return c.useContext(Us)}function It({children:s}){const[t,a]=c.useState(null),[o,n]=c.useState(!1),[l,i]=c.useState(!1),[r,u]=c.useState(!1),[w,y]=c.useState(!0),k=c.useRef(!0),C=c.useRef(0);c.useEffect(()=>{k.current=!0,(async()=>{try{y(!0);const{data:L,error:O}=await h.auth.getSession();if(O)throw O;const A=L?.session??null;if(!k.current)return;a(A),u(!0),y(!1),A?.user?.id?$(A):(n(!1),i(!1))}catch(L){if(console.error("Auth init error:",L),!k.current)return;a(null),n(!1),i(!1),u(!0),y(!1)}})();const{data:M}=h.auth.onAuthStateChange(async(L,O)=>{k.current&&(a(O??null),O?.user?.id?$(O):(n(!1),i(!1)))});return()=>{k.current=!1,M?.subscription?.unsubscribe?.()}},[]);const $=async M=>{const L=++C.current;try{const O=M?.user?.id;if(!O){k.current&&L===C.current&&(n(!1),i(!1));return}const[A,f]=await Promise.allSettled([h.rpc("is_admin"),h.from("user_profiles").select("needs_password_setup").eq("user_id",O).maybeSingle()]);let p=!1;A.status==="fulfilled"?p=!!A.value?.data:console.warn("is_admin RPC falhou:",A.reason);let b=!1;f.status==="fulfilled"?b=!!f.value?.data?.needs_password_setup:console.warn("Leitura de user_profiles falhou (ignorado):",f.reason),k.current&&L===C.current&&(n(p),i(b))}catch(O){console.error("checkAdminAndFlags error:",O),k.current&&L===C.current&&(n(!1),i(!1))}},B={session:t,isAdmin:o,needsPasswordSetup:l,ready:r,loading:w,signIn:async(M,L)=>{const O=await h.auth.signInWithPassword({email:M,password:L});return O.data?.session?.user?.id&&!O.error&&(a(O.data.session),$(O.data.session)),O},signOut:async()=>{const{error:M}=await h.auth.signOut();return M||(a(null),n(!1),i(!1)),{error:M}},updatePassword:async M=>{const{data:L,error:O}=await h.auth.updateUser({password:M});if(!O&&t?.user?.id)try{await h.from("user_profiles").upsert({user_id:t.user.id,needs_password_setup:!1}),i(!1)}catch(A){console.warn("updatePassword: upsert user_profiles falhou (ignorado):",A)}return{data:L,error:O}},refreshAuth:async()=>{const{data:M}=await h.auth.getSession(),L=M?.session??null;a(L),L?.user?.id?$(L):(n(!1),i(!1))}};return e.jsx(Us.Provider,{value:B,children:s})}function ue({children:s}){const{ready:t,session:a,isAdmin:o}=ds(),n=Vs();if(!t)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Verificando permissões..."})]})});if(!a||!o){const l=encodeURIComponent(n.pathname+n.search);return e.jsx(St,{to:`/login?redirect=${l}&reason=forbidden`,replace:!0})}return s}function se({team:s={},size:t=24,className:a=""}){const[o,n]=c.useState(!1),l=c.useMemo(()=>{const u=s?.logo_url;return typeof u=="string"&&u.trim()&&!o?u:null},[s?.logo_url,o]),i=c.useMemo(()=>{const u=String(s?.name??"").trim();if(!u)return"•";const w=u.match(new RegExp("\\p{L}","u"));return(w?w[0]:u[0]).toUpperCase()},[s?.name]),r={width:t,height:t};return e.jsx("span",{className:`inline-flex items-center justify-center rounded border border-gray-200 bg-white overflow-hidden ${a}`,style:r,title:s?.name,children:l?e.jsx("img",{src:l,alt:s?.name||"Logo",className:"w-full h-full object-cover",onError:()=>n(!0),draggable:!1}):e.jsx("span",{className:"text-[10px] sm:text-xs font-bold text-gray-600 select-none",children:i})})}/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ot=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,a,o)=>o?o.toUpperCase():a.toLowerCase()),hs=s=>{const t=Ot(s);return t.charAt(0).toUpperCase()+t.slice(1)},Js=(...s)=>s.filter((t,a,o)=>!!t&&t.trim()!==""&&o.indexOf(t)===a).join(" ").trim(),Lt=s=>{for(const t in s)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Dt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=c.forwardRef(({color:s="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:n="",children:l,iconNode:i,...r},u)=>c.createElement("svg",{ref:u,...Dt,width:t,height:t,stroke:s,strokeWidth:o?Number(a)*24/Number(t):a,className:Js("lucide",n),...!l&&!Lt(r)&&{"aria-hidden":"true"},...r},[...i.map(([w,y])=>c.createElement(w,y)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=(s,t)=>{const a=c.forwardRef(({className:o,...n},l)=>c.createElement(Bt,{ref:l,iconNode:t,className:Js(`lucide-${Gt(hs(s))}`,`lucide-${s}`,o),...n}));return a.displayName=hs(s),a};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Hs=te("chevron-right",Vt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],Ut=te("chevrons-right",zt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ks=te("circle-play",Jt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Xs=te("circle-question-mark",Ht);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=[["path",{d:"M12 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 12 18z",key:"b19h5q"}],["path",{d:"M2 6a2 2 0 0 1 3.414-1.414l6 6a2 2 0 0 1 0 2.828l-6 6A2 2 0 0 1 2 18z",key:"h7h5ge"}]],Xt=te("fast-forward",Kt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],Qt=te("list-checks",Zt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Wt=te("loader-circle",Yt);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ea=[["path",{d:"M11 6a13 13 0 0 0 8.4-2.8A1 1 0 0 1 21 4v12a1 1 0 0 1-1.6.8A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z",key:"q8bfy3"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 6v8",key:"15ugcq"}]],sa=te("megaphone",ea);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ta=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],aa=te("refresh-cw",ta);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],na=te("rotate-cw",ra);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ps=te("settings",oa);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],la=te("shield-alert",ia);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],da=te("trash-2",ca);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],Zs=te("trophy",ma),xs=[{name:"Volei",label:"Vôlei",key:"volei",callText:"⚠️ Compareçam à quadra de Vôlei:"},{name:"Futsal",label:"Futsal",key:"futsal",callText:"⚠️ Compareçam à quadra de Futsal:"},{name:"Pebolim",label:"Pebolim",key:"pebolim",callText:"⚠️ Compareçam à mesa de pebolim:"},{name:"FIFA",label:"FIFA",key:"fifa",callText:"⚠️ Compareçam à área do console:"}],ua={r32:"PRÉ-OITAVAS",grupos:"GRUPOS",oitavas:"OITAVAS",quartas:"QUARTAS",semi:"SEMI",final:"FINAL","3lugar":"3º LUGAR"};function ga(s){return s?ua[s]||String(s).toUpperCase():null}const ha="team-logos";function Qs(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function pa(s){return typeof s=="string"&&!Qs(s)&&s.trim()!==""}function xa(s){if(!s)return null;if(Qs(s))return s;if(pa(s)){const{data:t}=h.storage.from(ha).getPublicUrl(s);return t?.publicUrl||null}return null}function fa(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),n=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(n<0)return"0:00";const l=Math.floor(n/1e3),i=Math.floor(l/60),r=l%60;return`${i}:${r.toString().padStart(2,"0")}`}function fs(s,t){const a=s?.meta||{};return Math.max(0,Number(a[t==="home"?"home_sets":"away_sets"]||0))}function ya({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function ja(){const[s,t]=c.useState({}),[a,o]=c.useState(!0),[n,l]=c.useState(null),[i,r]=c.useState(Date.now()),u=c.useRef(!0),w=c.useRef(!1),y=async()=>{if(!w.current){w.current=!0,o(!0),l(null);try{const{data:C,error:$}=await h.from("sports").select("id,name");if($)throw $;const T=new Map((C||[]).map(P=>[P.name,P.id])),N=xs.filter(P=>T.has(P.name)).map(P=>({...P,sportId:T.get(P.name)})),R=await Promise.all(N.map(async P=>{const{data:B,error:M}=await h.from("v_queue_slots").select("slot, order_idx, match_id, stage, group_name").eq("sport_id",P.sportId);if(M)throw M;const L=Object.fromEntries((B||[]).map(_=>[_.slot,_])),O=(B||[]).map(_=>_.match_id).filter(Boolean);let A={};if(O.length){const{data:_}=await h.from("matches").select(`
                id, order_idx, stage, group_name, status, starts_at, updated_at, venue, meta,
                home_score, away_score,
                home:home_team_id ( id, name, logo_url, color ),
                away:away_team_id ( id, name, logo_url, color ),
                sport:sport_id ( id, name )
              `).in("id",O),F=(_||[]).map(d=>{const m=d.home&&typeof d.home=="object"?{...d.home,logo_url:ye(d.home.logo_url)}:d.home,E=d.away&&typeof d.away=="object"?{...d.away,logo_url:ye(d.away.logo_url)}:d.away;return{...d,home:m,away:E}});A=Object.fromEntries(F.map(d=>[d.id,d]))}if(!L?.live?.match_id){const{data:_,error:F}=await h.from("matches").select(`
                id, order_idx, stage, group_name, status, starts_at, updated_at, venue, meta,
                home_score, away_score,
                home:home_team_id ( id, name, logo_url, color ),
                away:away_team_id ( id, name, logo_url, color ),
                sport:sport_id ( id, name )
              `).eq("sport_id",P.sportId).in("status",["ongoing","paused"]).limit(6);if(!F&&_?.length){const d=_.slice().sort((v,I)=>{const S=U=>U==="ongoing"?1:U==="paused"?2:9,q=S(v.status)-S(I.status);return q!==0?q:new Date(I.updated_at||I.starts_at||0)-new Date(v.updated_at||v.starts_at||0)})[0],m=d.home&&typeof d.home=="object"?{...d.home,logo_url:ye(d.home.logo_url)}:d.home,E=d.away&&typeof d.away=="object"?{...d.away,logo_url:ye(d.away.logo_url)}:d.away,g={...d,home:m,away:E};A[g.id]=g,L.live={slot:"live",match_id:g.id,order_idx:g.order_idx,stage:g.stage,group_name:g.group_name}}}const f=[L.call?.match_id,L.next?.match_id].filter(Boolean),{data:p}=await h.from("matches").select(`
              id, order_idx, stage, group_name, status,
              home:home_team_id ( id, name, logo_url, color ),
              away:away_team_id ( id, name, logo_url, color )
            `).eq("sport_id",P.sportId).eq("status","scheduled").not("order_idx","is",null).order("order_idx",{ascending:!0}).limit(10),b=(p||[]).filter(_=>!f.includes(_.id)).slice(0,6).map(_=>({id:_.id,order_idx:_.order_idx,stage:_.stage,group_name:_.group_name,home:_.home?{..._.home,logo_url:ye(_.home.logo_url)}:null,away:_.away?{..._.away,logo_url:ye(_.away.logo_url)}:null}));return[P.key,{...P,slots:L,details:A,compactUpcoming:b}]}));t(Object.fromEntries(R))}catch(C){l(`Falha ao carregar a Home: ${C.message||C}`)}finally{o(!1),w.current=!1}}};c.useEffect(()=>{u.current=!0,y();const C=setInterval(()=>r(Date.now()),1e3),$=h.channel("home-central").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>u.current&&y()).on("postgres_changes",{event:"*",schema:"public",table:"match_events"},()=>u.current&&y()).subscribe();return()=>{u.current=!1,clearInterval(C),h.removeChannel($)}},[]);const k=c.useMemo(()=>xs.map(C=>C.key).filter(C=>s[C]),[s]);return e.jsxs("div",{className:"mx-auto max-w-7xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Central do Evento"})]}),e.jsxs("button",{onClick:y,className:"inline-flex items-center gap-2 rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",title:"Recarregar agora",children:[e.jsx(aa,{className:"h-4 w-4"}),"Atualizar"]})]}),n&&e.jsx("div",{className:"mb-5 rounded-xl border border-amber-300 bg-amber-50 px-3 py-2 text-sm text-amber-800",children:n}),a?e.jsx(Na,{}):e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:k.map(C=>e.jsx(ba,{block:s[C],now:i},C))}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function ba({block:s,now:t}){const{label:a,callText:o,slots:n,details:l,compactUpcoming:i}=s||{},r=n?.live?.match_id?l?.[n.live.match_id]:null,u=n?.call?.match_id?l?.[n.call.match_id]:null,w=n?.next?.match_id?l?.[n.next.match_id]:null;return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between gap-3 p-4 sm:p-5",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-lg font-semibold",children:a})})}),e.jsx("div",{className:"px-4 sm:px-5",children:e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-red-800",children:[e.jsx(Ks,{className:"h-4 w-4"}),r?e.jsxs(X,{to:`/match/${r.id}`,className:"hover:underline",children:[r.status==="paused"?"Pausado":"Ao vivo"," — Jogo ",r.order_idx,r.group_name?` • Grupo ${r.group_name}`:""]}):e.jsx("span",{children:"Ao vivo"})]}),r?.stage?e.jsx(ss,{stage:r.stage}):e.jsx("span",{className:"text-xs text-red-700/70",children:"Aguardando…"})]}),r?e.jsx(_a,{match:r,now:t}):e.jsx("div",{className:"text-sm text-gray-600",children:"Nenhuma partida ao vivo no momento."})]})}),e.jsx("div",{className:"px-4 pb-4 sm:px-5 sm:pb-5",children:e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(ys,{tone:"amber",icon:e.jsx(sa,{className:"h-4 w-4"}),title:"Próxima partida",subtitle:o,match:u}),e.jsx(ys,{tone:"emerald",icon:e.jsx(Ut,{className:"h-4 w-4"}),title:"Jogo seguinte",subtitle:"Na sequência:",match:w})]})}),i?.length?e.jsxs("div",{className:"border-t px-4 py-3 sm:px-5",children:[e.jsx("div",{className:"mb-2 text-sm font-semibold text-gray-800",children:"Agendados (próximos)"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:i.map(y=>e.jsxs(X,{to:`/match/${y.id}`,className:"flex items-center justify-between rounded-lg border bg-gray-50 px-3 py-2 hover:bg-gray-100",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"truncate text-sm font-medium text-gray-900",children:["Jogo ",y.order_idx,y.group_name?` • Grupo ${y.group_name}`:""]}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-gray-700",children:[e.jsx(Be,{team:y.home,size:20,allowLink:!1}),e.jsx("span",{className:"text-gray-400",children:"x"}),e.jsx(Be,{team:y.away,size:20,align:"right",allowLink:!1})]})]}),e.jsx("div",{className:"ml-3 shrink-0",children:e.jsx(ss,{stage:y.stage})})]},y.id))})]}):null]})}function ss({stage:s}){const t=ga(s);return t?e.jsx("span",{className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-semibold tracking-wide text-gray-700",children:t}):null}function _a({match:s,now:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),o=s.status!=="scheduled",n=Number(s?.home_score??0),l=Number(s?.away_score??0),i=a?fs(s,"home"):0,r=a?fs(s,"away"):0;return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl bg-white p-3 shadow-sm hover:bg-gray-50 relative overflow-hidden",children:[e.jsx(ya,{status:s.status}),e.jsxs("div",{className:"mb-2 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.group_name?e.jsxs("span",{children:["Grupo ",s.group_name]}):e.jsx("span",{}),s.venue?e.jsxs("span",{className:"text-gray-400",children:["• ",s.venue]}):null]}),(s.status==="ongoing"||s.status==="paused")&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",fa(s,t)]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(js,{team:s.home,align:"left"}),e.jsxs("div",{className:"shrink-0 text-center",children:[a&&e.jsxs("div",{className:"text-[11px] font-semibold text-gray-600 tabular-nums",children:[i," ",e.jsx("span",{className:"text-gray-400",children:"sets"})," ",r]}),o?e.jsxs("div",{className:"text-xl font-bold tabular-nums",children:[n," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",l]}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"})]}),e.jsx(js,{team:s.away,align:"right"})]})]})}function ys({tone:s,icon:t,title:a,subtitle:o,match:n}){const l=s==="amber"?"border-amber-200 bg-amber-50":s==="emerald"?"border-emerald-200 bg-emerald-50":"border-gray-200 bg-gray-50";return e.jsxs("div",{className:`rounded-xl border ${l} p-3 sm:p-4`,children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[t,e.jsx("span",{children:a})]}),n?.stage?e.jsx(ss,{stage:n.stage}):null]}),e.jsx("div",{className:"text-xs text-gray-600",children:o}),e.jsx("div",{className:"mt-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.jsxs(X,{to:`/match/${n.id}`,className:"hover:underline",children:["Jogo ",n.order_idx,n.group_name?` • Grupo ${n.group_name}`:""]})}),e.jsxs("div",{className:"mt-1 flex items-center justify-between gap-2",children:[e.jsx(Be,{team:n.home}),e.jsx("span",{className:"px-1 text-gray-400",children:"x"}),e.jsx(Be,{team:n.away,align:"right"})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-gray-500 flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:n.venue||""}),e.jsxs(X,{to:`/match/${n.id}`,className:"inline-flex items-center gap-1 text-blue-600 hover:underline",children:["Ver partida ",e.jsx(Hs,{className:"h-3.5 w-3.5"})]})]})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Aguardando…"})})]})}function Be({team:s,size:t=24,align:a="left",allowLink:o=!0}){const n=e.jsxs(e.Fragment,{children:[e.jsx(se,{team:s||{name:"A definir"},size:t}),e.jsx("span",{className:`truncate text-sm ${a==="right"?"text-right":""}`,children:s?.name||"A definir"})]});return!o||!s?.id?e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${a==="right"?"justify-end":""}`,children:n}):e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 ${a==="right"?"justify-end":""} hover:underline`,title:s?.name,onClick:l=>l.stopPropagation(),children:n})}function js({team:s,align:t="left"}){return e.jsxs("div",{className:`flex items-center ${t==="right"?"justify-end":""} gap-2 min-w-0 flex-1`,children:[t!=="right"&&e.jsx(se,{team:s||{name:"A definir"},size:36}),s?.id?e.jsx(X,{to:`/team/${s.id}`,className:`truncate text-sm font-medium hover:underline ${t==="right"?"text-right":"text-left"}`,title:s?.name,onClick:a=>a.stopPropagation(),children:s?.name||"A definir"}):e.jsx("span",{className:`truncate text-sm ${t==="right"?"text-right text-gray-400":"text-gray-400"}`,children:"A definir"}),t==="right"&&e.jsx(se,{team:s||{name:"A definir"},size:36})]})}function Na(){return e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:Array.from({length:4}).map((s,t)=>e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsx("div",{className:"mb-3 h-6 w-40 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"mb-3 h-24 animate-pulse rounded bg-red-100/60"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsx("div",{className:"h-20 animate-pulse rounded bg-amber-100/60"}),e.jsx("div",{className:"h-20 animate-pulse rounded bg-emerald-100/60"})]}),e.jsx("div",{className:"mt-3 h-16 animate-pulse rounded bg-gray-100"})]},t))})}function ye(s){const t=xa(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null}const wa="Futsal",va="⚽",Sa="team-logos",$a="America/Sao_Paulo",Ca={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Ys=s=>s?Ca[s]||s:"",Aa=new Set(["grupos","grupo","groups","group","group stage","group_stage","fase de grupos","fase-de-grupos"]),ka=new Set(["finished","encerrado","finalizado","completed","complete","cancelado","cancelled","canceled","walkover","wo"]),Ws=s=>s==null?"":String(s).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().trim();function Ea(s){if(!s)return!1;const t=Ws(s.stage);if(t)return Aa.has(t);const a=String(s?.group_name??"").trim();return!a||a==="-"?!1:!!(/^grupo\s+/i.test(a)||/^[a-z0-9]$/i.test(a))}const Ta=s=>ka.has(Ws(s));function et(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function ts(s){const t=et(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:$a,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const Re=s=>{const t=et(s);return t?t.getTime():Number.POSITIVE_INFINITY},st=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Pa=s=>typeof s=="string"&&!st(s)&&s.trim()!=="";function Fa(s){if(!s)return null;if(st(s))return s;if(Pa(s)){const{data:t}=h.storage.from(Sa).getPublicUrl(s);return t?.publicUrl||null}return null}const je=s=>{const t=Fa(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};let Ra=class extends Ve.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Futsal ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}};function tt({order_idx:s,stage:t,group_name:a}){const o=[];return s!=null&&String(s).length&&o.push(`Jogo ${s}`),a?o.push(`Grupo ${a}`):t&&o.push(Ys(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:o.join(" • ")||"—"})}function as({team:s,align:t="left",badge:a=28}){const o=(()=>{const r=s?.name;if(typeof r=="string")return r;if(r&&typeof r=="object"&&"name"in r)return String(r.name);try{return String(r??"A definir")}catch{return"A definir"}})(),n=!!s?.id,l=!n&&o==="A definir",i=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:o},size:a}),e.jsxs("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:o,children:[o,l?e.jsx(Xs,{className:"inline-block ml-1 w-4 h-4 text-gray-400"}):null]}),t==="right"?e.jsx(se,{team:{...s||{},name:o},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:r=>r.stopPropagation(),title:o,children:i}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:i})}function Ce({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),o=s?.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},l=o?.id?o:{name:o?.name||"A definir"},i=s?.status&&s.status!=="scheduled",r=Number(s?.home_score??0),u=Number(s?.away_score??0),w=({value:C})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:i?C:"-"})]}),y=({team:C,align:$,score:T})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${$==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(as,{team:C,align:$})}),e.jsx(w,{value:T})]}),k=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(tt,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(y,{team:n,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(y,{team:l,align:"right",score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ts(s.starts_at):s?.venue||""}),i?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",u]}):null]})]});return s?.id?e.jsx(X,{to:`/match/${s.id}`,className:"block",children:k}):e.jsx("div",{className:"block",children:k})}function bs({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),o=Number(s?.away_score??0);return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(tt,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(as,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs("span",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",o]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(as,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?ts(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",ts(s.updated_at)]}):null]})]})}function Ma(s,t){const a=Number(s.points??0),o=Number(t.points??0);if(o!==a)return o-a;const n=Number(s.wins??0),l=Number(t.wins??0);if(l!==n)return l-n;const i=Number(s.goal_difference??Number(s.goals_for??0)-Number(s.goals_against??0)),r=Number(t.goal_difference??Number(t.goals_for??0)-Number(t.goals_against??0));if(r!==i)return r-i;const u=Number(s.goals_for??0),w=Number(t.goals_for??0);return w!==u?w-u:String(s.team_id).localeCompare(String(t.team_id))}function Me(s,t){return(t.points??0)-(s.points??0)||(t.wins??0)-(s.wins??0)||(t.goal_difference??0)-(s.goal_difference??0)||(t.goals_for??0)-(s.goals_for??0)||String(s.team_id).localeCompare(String(t.team_id))}function qa(s,t={}){if(!Array.isArray(s)||s.length===0)return[];const a=r=>{const u=t[r.team_id];return u?{id:r.team_id,name:String(u.name??r.team_name??"—"),color:u.color,logo_url:u.logo_url}:{id:r.team_id,name:String(r.team_name??"—")}},o=new Map;for(const r of s){const u=r.group_name||"-";o.has(u)||o.set(u,[]),o.get(u).push(r)}for(const r of o.keys())o.get(r).sort(Me);const n=[],l=[];for(const[r,u]of o)u[0]&&n.push({group:r,row:u[0]}),u[1]&&l.push({group:r,row:u[1]});n.sort((r,u)=>Me(r.row,u.row)),l.sort((r,u)=>Me(r.row,u.row));const i=n.length;if(i>=4){const r=n.slice(0,4);return[{stage:"semi",home:a(r[0].row),away:a(r[3].row)},{stage:"semi",home:a(r[1].row),away:a(r[2].row)}]}else{if(i===3)return l.length?[{stage:"semi",home:a(n[0].row),away:a(l[0].row)},{stage:"semi",home:a(n[1].row),away:a(n[2].row)}]:[];if(i===2){if(l.length<2)return[];const r=[n[0].row,n[1].row,l[0].row,l[1].row].sort(Me);return[{stage:"semi",home:a(r[0]),away:a(r[3])},{stage:"semi",home:a(r[1]),away:a(r[2])}]}}return[]}function Ia({standings:s,teamsById:t}){const a=c.useMemo(()=>{const n={};for(const r of s||[]){const u=r.group_name||"-";n[u]||(n[u]=[]),n[u].push(r)}const l=new Set,i={};for(const r in t){const u=t[r],w=u.group_name||"-";l.add(w),i[w]||(i[w]=[]),i[w].push(u)}for(const r of l){const u=new Set((n[r]||[]).map(k=>String(k.team_id))),y=(i[r]||[]).filter(k=>!u.has(String(k.id))).map(k=>({group_name:r,team_id:k.id,team_name:k.name,matches_played:0,wins:0,draws:0,losses:0,goals_for:0,goals_against:0,goal_difference:0,points:0}));n[r]=[...n[r]||[],...y],n[r].sort(Ma),n[r]=n[r].map((k,C)=>({...k,rank:C+1}))}return n},[s,t]),o=Object.keys(a).sort();return o.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:o.map(n=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",n]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"E"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[n].map(l=>{const i=t[l.team_id]&&typeof t[l.team_id]=="object"?t[l.team_id]:{id:l.team_id,name:String(l.team_name??t[l.team_id]?.name??"—")},r={...i,name:typeof i.name=="string"?i.name:String(i.name??"—")};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:l.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${r.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:r,size:20}),e.jsx("span",{className:"truncate",children:r.name})]})}),e.jsx("td",{className:"py-1 text-center",children:l.matches_played}),e.jsx("td",{className:"py-1 text-center",children:l.wins}),e.jsx("td",{className:"py-1 text-center",children:l.draws}),e.jsx("td",{className:"py-1 text-center",children:l.losses}),e.jsx("td",{className:"py-1 text-center",children:l.goals_for}),e.jsx("td",{className:"py-1 text-center",children:l.goals_against}),e.jsx("td",{className:"py-1 text-center",children:l.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:l.points})]},`${n}-${l.team_id}`)})})]}),e.jsx("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:"Critérios: Pontos, Vitórias, Saldo de Gols, Gols Pró."})]},n))})}function Ga(s){const t=l=>(s||[]).filter(i=>i.stage===l).sort((i,r)=>(Number(i?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(r?.order_idx)||Number.MAX_SAFE_INTEGER)),a=t("semi"),o=t("final"),n=t("3lugar");return{semis:a,final:o[0],third:n[0]}}function Oa(){const[s,t]=c.useState(null),[a,o]=c.useState({}),[n,l]=c.useState([]),[i,r]=c.useState([]),[u,w]=c.useState(!0),[y,k]=c.useState("todos"),[C,$]=c.useState("todos"),T=c.useRef(null),N=c.useRef(null),R=c.useCallback(async()=>{try{const{data:g,error:v}=await h.from("sports").select("id").eq("name","Futsal").maybeSingle();if(v)throw v;g?.id?t(g.id):(console.warn("⚠️ Esporte 'Futsal' não encontrado na tabela sports."),t(null))}catch(g){console.error("Exceção loadSportId:",g),t(null)}},[]),P=c.useCallback(async g=>{try{if(g){const S=await h.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",g);if(!S.error&&Array.isArray(S.data)&&S.data.length>0){const q={};for(const U of S.data)q[U.id]={...U,name:String(U.name??"—"),logo_url:je(U.logo_url),group_name:U.group_name??"-"};o(q);return}}const v=await h.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").eq("sport.name","Futsal");if(v.error)throw v.error;const I={};for(const S of v.data||[])I[S.id]={...S,name:String(S.name??"—"),logo_url:je(S.logo_url),group_name:S.group_name??"-"};o(I)}catch(v){console.error("Exceção loadTeams:",v),o({})}},[]),B=c.useCallback(async g=>{try{if(g){const q=await h.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points").eq("sport_id",g).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!q.error&&Array.isArray(q.data)&&q.data.length>0){l(q.data);return}}const v=await h.from("standings_view").select("group_name, rank, team_id, team_name, matches_played, wins, draws, losses, goals_for, goals_against, goal_difference, points, sport:sport_id!inner(name)").eq("sport.name","Futsal").order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!v.error&&Array.isArray(v.data)&&v.data.length>0){l(v.data.map(({sport:q,...U})=>U));return}if(g){const q=await h.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, draws, losses,
            goals_for, goals_against, goal_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",g).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!q.error&&Array.isArray(q.data)&&q.data.length>0){l(q.data.map(U=>({...U,team_name:U.team?.name})));return}}const S=((await h.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, draws, losses,
          goals_for, goals_against, goal_difference, points,
          team:teams!standings_team_id_fkey(name),
          sport:sport_id!inner(name)
        `).eq("sport.name","Futsal").order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(q=>({...q,team_name:q.team?.name}));l(S)}catch(v){console.error("Exceção loadStandings:",v),l([])}},[]),M=c.useCallback(async g=>{try{let v=[];if(g){const{data:q,error:U}=await h.from("match_detail_view").select(`
            id, sport_id, order_idx,
            stage, round, group_name, starts_at, updated_at, venue, status,
            home_team_id, home_team_name, home_team_color, home_team_logo,
            away_team_id, away_team_name, away_team_color, away_team_logo,
            home_score, away_score
          `).eq("sport_id",g);!U&&Array.isArray(q)&&q.length&&(v=q.map(j=>({id:j.id,sport_id:j.sport_id,order_idx:j.order_idx,stage:j.stage,round:j.round,group_name:j.group_name,starts_at:j.starts_at,updated_at:j.updated_at,venue:j.venue,status:j.status,home_score:j.home_score,away_score:j.away_score,home:j.home_team_id?{id:j.home_team_id,name:String(j.home_team_name??"A definir"),color:j.home_team_color,logo_url:je(j.home_team_logo)}:null,away:j.away_team_id?{id:j.away_team_id,name:String(j.away_team_name??"A definir"),color:j.away_team_color,logo_url:je(j.away_team_logo)}:null})))}if(!v.length){const{data:q,error:U}=await h.from("matches").select(`
            id, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score, order_idx,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color ),
            sport:sport_id!inner(name)
          `).eq("sport.name","Futsal");if(U)throw U;v=(q||[]).map(j=>({...j,order_idx:j.order_idx??j.round??j.id,home:j.home?{...j.home,name:String(j.home.name??"A definir"),logo_url:je(j.home.logo_url)}:null,away:j.away?{...j.away,name:String(j.away.name??"A definir"),logo_url:je(j.away.logo_url)}:null}))}const I={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6},S=q=>Number.isFinite(Number(q?.order_idx))?Number(q.order_idx):Number.MAX_SAFE_INTEGER;v.sort((q,U)=>(I[q.stage]??99)-(I[U.stage]??99)||S(q)-S(U)),r(v)}catch(v){console.error("Exceção loadMatches:",v),r([])}},[]),L=c.useCallback(async(g,{skeleton:v=!1}={})=>{v&&w(!0);try{await Promise.all([P(g),B(g),M(g)])}finally{w(!1)}},[P,B,M]);c.useEffect(()=>{R()},[R]),c.useEffect(()=>{if(!s){w(!1);return}if(L(s,{skeleton:!0}),T.current){try{h.removeChannel(T.current)}catch{}T.current=null}const g=h.channel("futsal-hub").on("postgres_changes",s?{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`}:{event:"*",schema:"public",table:"matches"},()=>{N.current&&clearTimeout(N.current),N.current=setTimeout(()=>L(s,{skeleton:!1}),200)}).on("postgres_changes",{event:"*",schema:"public",table:"standings"},()=>{N.current&&clearTimeout(N.current),N.current=setTimeout(()=>L(s,{skeleton:!1}),200)}).subscribe();return T.current=g,()=>{if(N.current&&(clearTimeout(N.current),N.current=null),T.current){try{h.removeChannel(T.current)}catch{}T.current=null}}},[s,L]);const O=c.useMemo(()=>!!(n?.length||(i||[]).some(g=>!!g.group_name)||Object.values(a||{}).some(g=>!!g.group_name)),[n,i,a]),A=c.useMemo(()=>{const g=(i||[]).filter(Ea);return g.length?g.every(v=>Ta(v?.status)):!0},[i]),f=c.useMemo(()=>Ga(i),[i]),p=f.semis||[],b=c.useMemo(()=>A?qa(n,a):[],[A,n,a]),_=c.useMemo(()=>p.length?p:b,[p,b]),F=c.useMemo(()=>{const g=new Set;return(i||[]).forEach(v=>v.group_name&&g.add(v.group_name)),(n||[]).forEach(v=>v.group_name&&g.add(v.group_name)),Object.values(a||{}).forEach(v=>v.group_name&&g.add(v.group_name)),["todos",...Array.from(g).sort()]},[i,n,a]),d=c.useMemo(()=>{const g=new Set;(i||[]).forEach(S=>S.stage&&g.add(S.stage));const v=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(g).sort((S,q)=>v.indexOf(S)+100-(v.indexOf(q)+100))]},[i]),m=c.useMemo(()=>{let g=(i||[]).filter(v=>v.status!=="scheduled"?!1:v.group_name?!0:v.home?.id&&v.away?.id);return y!=="todos"&&(g=g.filter(v=>v.group_name===y)),C!=="todos"&&(g=g.filter(v=>v.stage===C)),g.sort((v,I)=>Re(v.starts_at)-Re(I.starts_at)),g},[i,y,C]),E=c.useMemo(()=>{const g=(i||[]).filter(v=>v.status==="finished");return g.sort((v,I)=>Re(I.updated_at||I.starts_at||0)-Re(v.updated_at||v.starts_at||0)),g.slice(0,12)},[i]);return e.jsx(Ra,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:va}),e.jsx("h2",{className:"text-2xl font-bold",children:wa})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"classificação"})," → ",e.jsx("strong",{children:"chaveamento"})," →"," ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),u?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((g,v)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},v))})]}):e.jsxs(e.Fragment,{children:[O&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Ia,{standings:n,teamsById:a})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),_?.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:_.map((g,v)=>e.jsx(Ce,{match:g},`s-${g?.id??v}`))})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("p",{className:"text-xs text-gray-500",children:A?"Aguardando definição oficial dos confrontos.":"Confrontos aparecem aqui assim que todos os jogos da fase de grupos terminarem."}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:2}).map((g,v)=>e.jsx(Ce,{placeholder:{home:"A definir",away:"A definir"}},`s-ph-${v}`))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),f.final?e.jsx(Ce,{match:f.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(Ce,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]}),f.third?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"3º lugar"}),e.jsx(Ce,{match:f.third})]}):null]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:y,onChange:g=>k(g.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:F.map(g=>e.jsx("option",{value:g,children:g==="todos"?"Todos":`Grupo ${g}`},g))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:C,onChange:g=>$(g.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:d.map(g=>e.jsx("option",{value:g,children:g==="todos"?"Todas":Ys(g)},g))})]}),m.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:m.map((g,v)=>e.jsx(bs,{match:g},g.id??`sched-${v}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),E.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:E.map((g,v)=>e.jsx(bs,{match:g},g.id??`fin-${v}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas com ",e.jsx("strong",{children:"10 minutos corridos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo e o melhor 2º colocado avançam para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," saldo de gols."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor do grupo A × Vencedor do grupo B; Vencedor do grupo C × Melhor 2º colocado."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substituições:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desperdício de tempo:"})," pode ser acrescido ao final do jogo, a critério do árbitro."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Goleiro-linha:"})," permitido."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Expulsão:"})," o time fica com um jogador a menos por 2 minutos ou até sofrer um gol."]})]})})]})]})]})})}const La="Vôlei",Da="🏐",Ba="team-logos",Va="America/Sao_Paulo",za={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},at=s=>s?za[s]||s:"",Ae=["Vôlei","Volei","Voleibol"];function rt(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function rs(s){const t=rt(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:Va,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const be=s=>{const t=rt(s);return t?t.getTime():Number.POSITIVE_INFINITY},nt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Ua=s=>typeof s=="string"&&!nt(s)&&s.trim()!=="";function Ja(s){if(!s)return null;if(nt(s))return s;if(Ua(s)){const{data:t}=h.storage.from(Ba).getPublicUrl(s);return t?.publicUrl||null}return null}const ns=s=>{const t=Ja(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};let Ha=class extends Ve.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Vôlei ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}};function ot({order_idx:s,stage:t,group_name:a}){const o=[];return s!=null&&String(s).length&&o.push(`Jogo ${s}`),a?o.push(`Grupo ${a}`):t&&o.push(at(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:o.join(" • ")||"—"})}function os({team:s,align:t="left",badge:a=28}){const o=(()=>{const i=s?.name;if(typeof i=="string")return i;if(i&&typeof i=="object"&&"name"in i)return String(i.name);try{return String(i??"A definir")}catch{return"A definir"}})(),n=!!s?.id,l=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:o},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:o,children:o}),t==="right"?e.jsx(se,{team:{...s||{},name:o},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:i=>i.stopPropagation(),title:o,children:l}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:l})}function qe({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),o=s?.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},l=o?.id?o:{name:o?.name||"A definir"},i=s&&s.status!=="scheduled",r=Number(s?.home_score??0),u=Number(s?.away_score??0),w=Number(s?.meta?.home_sets??0),y=Number(s?.meta?.away_sets??0),C=w>0||y>0||i,$=({label:R,value:P,visible:B})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-2.5 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:R}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:B?P:"-"})]}),T=({team:R,align:P,sets:B,score:M})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${P==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(os,{team:R,align:P})}),e.jsxs("div",{className:"flex items-center gap-2",children:[C?e.jsx($,{label:"Sets",value:B,visible:C}):null,e.jsx($,{label:"Pontos",value:M,visible:i})]})]}),N=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(ot,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(T,{team:n,align:"left",sets:w,score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(T,{team:l,align:"right",sets:y,score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?rs(s.starts_at):s?.venue||""}),i?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:["Sets ",w," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",y]}):null]})]});return s?.id?e.jsx(X,{to:`/match/${s.id}`,className:"block",children:N}):N}function _s({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),o=Number(s?.away_score??0),n=Number(s?.meta?.home_sets??0),l=Number(s?.meta?.away_sets??0),i=t&&(n>0||l>0);return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(ot,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(os,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs(e.Fragment,{children:[i?e.jsxs("div",{className:"text-[11px] font-medium tabular-nums text-gray-600 mb-0.5",children:["Sets: ",n," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",l]}):null,e.jsxs("div",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",o]})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(os,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?rs(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",rs(s.updated_at)]}):null]})]})}function Pe(s,t){return(t.points??0)-(s.points??0)||(t.sv??0)-(s.sv??0)||(s.sp??0)-(t.sp??0)||(t.point_difference??(t.pf??0)-(t.pa??0))-(s.point_difference??(s.pf??0)-(s.pa??0))||(t.pf??0)-(s.pf??0)||String(s.team_id).localeCompare(String(t.team_id))}function Ka(s){if(!Array.isArray(s)||s.length===0)return[];const t=s.map(i=>({...i,group_name:de(i.group_name)})).filter(i=>i.group_name&&i.group_name!=="-"),a=new Map;for(const i of t){const r=i.group_name;a.has(r)||a.set(r,[]),a.get(r).push(i)}for(const i of a.keys())a.get(i).sort((r,u)=>(r.rank??999)-(u.rank??999));const o=[],n=[];for(const[i,r]of a)r[0]&&o.push({group:i,...r[0]}),r[1]&&n.push({group:i,...r[1]});o.sort(Pe),n.sort(Pe);const l=o.length;if(l>=4){const i=o.slice(0,4);return[{stage:"semi",home:i[0],away:i[3]},{stage:"semi",home:i[1],away:i[2]}]}else if(l===3){if(!n.length)return[];const i=n[0];return[{stage:"semi",home:o[0],away:i},{stage:"semi",home:o[1],away:o[2]}]}else if(l===2){if(n.length<2)return[];const i=[...o,n[0],n[1]].sort(Pe);return[{stage:"semi",home:i[0],away:i[3]},{stage:"semi",home:i[1],away:i[2]}]}return[]}function Xa({standings:s,teamsById:t}){const a=c.useMemo(()=>{const n={};for(const l of s||[]){const i=l.group_name||"-";n[i]||(n[i]=[]),n[i].push(l)}for(const l of Object.keys(n))n[l].sort((i,r)=>(i.rank??999)-(r.rank??999));return n},[s]),o=Object.keys(a).sort();return o.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:o.map(n=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",n]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"SV"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"SP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"PF"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"PC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:a[n].map(l=>{const i=t[l.team_id]||{id:l.team_id,name:l.team_name||"—"},r=Number(l.point_difference??(l.pf??0)-(l.pa??0));return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:l.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${i.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:{...i,logo_url:ns(i.logo_url)},size:20}),e.jsx("span",{className:"truncate",children:i.name})]})}),e.jsx("td",{className:"py-1 text-center",children:l.matches_played}),e.jsx("td",{className:"py-1 text-center",children:l.wins}),e.jsx("td",{className:"py-1 text-center",children:l.losses}),e.jsx("td",{className:"py-1 text-center",children:l.sv}),e.jsx("td",{className:"py-1 text-center",children:l.sp}),e.jsx("td",{className:"py-1 text-center",children:l.pf}),e.jsx("td",{className:"py-1 text-center",children:l.pa}),e.jsx("td",{className:"py-1 text-center",children:r}),e.jsx("td",{className:"py-1 text-center font-semibold",children:l.points})]},`${n}-${l.team_id}`)})})]}),e.jsxs("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:["Critérios/colunas: ",e.jsx("strong",{children:"#"})," (posição), ",e.jsx("strong",{children:"Time"}),", ",e.jsx("strong",{children:"P"})," (jogos), ",e.jsx("strong",{children:"V"})," (vitórias), ",e.jsx("strong",{children:"D"})," (derrotas), ",e.jsx("strong",{children:"SV"})," (sets vencidos), ",e.jsx("strong",{children:"SP"})," (sets perdidos), ",e.jsx("strong",{children:"PF"})," (pontos feitos), ",e.jsx("strong",{children:"PC"})," (pontos contra), ",e.jsx("strong",{children:"+/-"})," (saldo de pontos), ",e.jsx("strong",{children:"Pts"})," (pontos na tabela)."]})]},n))})}const it=s=>typeof s=="string"?s.trim().toLowerCase():"",Za=s=>{const t=it(s);return t==="semifinal"||t==="semi-final"||t==="semis"?"semi":t==="3º"||t==="3º lugar"||t==="terceiro"||t==="3-lugar"?"3lugar":t},Qa=s=>{const t=it(s);return t==="encerrado"||t==="finalizado"?"finished":t==="agendado"||t==="programado"?"scheduled":t||"scheduled"},de=s=>{if(!s)return"-";const t=String(s).normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toUpperCase();if(!t)return"-";const a=t.match(/^GRUPO\s+([A-Z0-9]+)$/);return a?a[1]:t};function Ns(s,t){const a=new Map,o=(u,w)=>`${u}::${w}`,n=(u,w)=>{const y=o(u,w);return a.has(y)||a.set(y,{group_name:u,team_id:w,team_name:t?.[w]?.name??"—",matches_played:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0,points:0}),a.get(y)},l=new Set;for(const u of s||[]){const w=de(u?.group_name)||"-",y=u?.home?.id,k=u?.away?.id;y&&(n(w,y),l.add(y)),k&&(n(w,k),l.add(k))}for(const u of s||[]){if(u?.status!=="finished")continue;const w=de(u?.group_name)||"-",y=u?.home?.id,k=u?.away?.id;if(!y||!k)continue;const C=n(w,y),$=n(w,k),T=Number(u?.meta?.home_sets??0),N=Number(u?.meta?.away_sets??0),R=Number(u?.home_score??0),P=Number(u?.away_score??0);let B=!1,M=!1;T!==N?(B=T>N,M=!B):R!==P&&(B=R>P,M=!B),C.matches_played++,$.matches_played++,C.sv+=T,C.sp+=N,C.pf+=R,C.pa+=P,$.sv+=N,$.sp+=T,$.pf+=P,$.pa+=R,B?(C.wins++,C.points+=3,$.losses++):M&&($.wins++,$.points+=3,C.losses++)}for(const u of Object.keys(t||{})){const w=Number(u);if(l.has(w)||l.has(u))continue;const y=de(t[u]?.group_name);y&&y!=="-"&&n(y,u)}const i={};for(const u of a.values())u.point_difference=Number(u.pf)-Number(u.pa),(i[u.group_name]||=[]).push(u);const r=[];for(const u of Object.keys(i).sort())i[u].sort(Pe),i[u].forEach((w,y)=>r.push({...w,rank:y+1}));return r}function Ya(){const[s,t]=c.useState(null),[a,o]=c.useState({}),n=c.useRef({});c.useEffect(()=>{n.current=a},[a]);const[l,i]=c.useState([]),[r,u]=c.useState([]),[w,y]=c.useState(!0),[k,C]=c.useState("todos"),[$,T]=c.useState("todos"),N=c.useRef(null),R=c.useRef(null),P=c.useCallback(async()=>{try{const{data:d,error:m}=await h.from("sports").select("id, name").in("name",Ae).limit(1);if(m)throw m;d&&d[0]?.id?t(d[0].id):(console.warn("⚠️ Esporte Vôlei não encontrado em 'sports' (nomes tentados:",Ae.join(", "),")"),t(null))}catch(d){console.error("Exceção loadSportId:",d),t(null)}},[]),B=c.useCallback(async d=>{try{if(d){const g=await h.from("teams").select("id, name, logo_url, color, group_name").eq("sport_id",d);if(!g.error&&Array.isArray(g.data)&&g.data.length>0){const v={};for(const I of g.data)v[I.id]={...I,name:String(I.name??"—"),logo_url:ns(I.logo_url)};o(v),n.current=v;return}}const m=await h.from("teams").select("id, name, logo_url, color, group_name, sport:sport_id!inner(name)").in("sport.name",Ae);if(m.error)throw m.error;const E={};for(const g of m.data||[])E[g.id]={...g,name:String(g.name??"—"),logo_url:ns(g.logo_url)};o(E),n.current=E}catch(m){console.error("Exceção loadTeams:",m),o({}),n.current={}}},[]),M=c.useCallback(async d=>{try{if(d){const g=await h.from("standings_volei_view").select("group_name, rank, team_id, team_name, matches_played, wins, losses, sv, sp, pf, pa, point_difference, points").eq("sport_id",d).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(!g.error&&Array.isArray(g.data)&&g.data.length>0){console.info("[Vôlei] standings via VIEW/sport_id:",g.data.length),i(g.data);return}}if(d){const g=await h.from("standings").select(`
            group_name, rank, team_id,
            matches_played, wins, losses,
            sv, sp, pf, pa, point_difference, points,
            team:teams!standings_team_id_fkey(name)
          `).eq("sport_id",d).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0}),v=(g.data||[]).map(I=>({...I,team_name:I.team?.name,sv:Number(I.sv??0),sp:Number(I.sp??0),pf:Number(I.pf??0),pa:Number(I.pa??0),point_difference:Number(I.point_difference??(I.pf??0)-(I.pa??0))}));if(!g.error&&v.length>0){console.info("[Vôlei] standings via TABLE/sport_id:",v.length),i(v);return}}const E=((await h.from("standings").select(`
          group_name, rank, team_id,
          matches_played, wins, losses,
          sv, sp, pf, pa, point_difference, points,
          team:teams!inner(name, id),
          sport:sport_id!inner(name, id)
        `).in("sport.name",Ae).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0})).data||[]).map(g=>({...g,team_name:g.team?.name,sv:Number(g.sv??0),sp:Number(g.sp??0),pf:Number(g.pf??0),pa:Number(g.pa??0),point_difference:Number(g.point_difference??(g.pf??0)-(g.pa??0))}));console.info("[Vôlei] standings via TABLE/join por nome:",E.length,"— esportes possíveis:",Ae),i(E)}catch(m){console.error("Exceção loadStandings (vôlei):",m),i([])}},[]),L=c.useCallback(async d=>{try{if(!d){u([]);return}const{data:m,error:E}=await h.from("matches").select(`
          id, sport_id,
          stage, round, group_name, starts_at, updated_at, venue, status, meta,
          home_team_id, away_team_id, home_score, away_score, order_idx
        `).eq("sport_id",d);if(E)throw E;const g=S=>S?{...n.current[S]||{},id:S,name:String(n.current[S]?.name??"A definir")}:null,v=(m||[]).map(S=>{const q=Number.isFinite(Number(S.order_idx))?Number(S.order_idx):null,U=Number.isFinite(Number(S.order_idx))?Number(S.order_idx):Number.isFinite(Number(S.round))?Number(S.round):Number.MAX_SAFE_INTEGER;return{id:S.id,sport_id:S.sport_id,order_idx:q,_sortKey:U,stage:Za(S.stage),round:S.round,group_name:S.group_name,starts_at:S.starts_at,updated_at:S.updated_at,venue:S.venue,status:Qa(S.status),meta:S.meta,home_score:S.home_score,away_score:S.away_score,home:g(S.home_team_id),away:g(S.away_team_id)}}),I={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6};v.sort((S,q)=>(I[S.stage]??99)-(I[q.stage]??99)||S._sortKey-q._sortKey||be(S.starts_at)-be(q.starts_at)||S.id-q.id),u(v),console.info("[Vôlei] matches carregados:",v.length)}catch(m){console.error("Exceção loadMatches (vôlei):",m),u([])}},[]),O=c.useCallback(async(d,{skeleton:m=!1}={})=>{m&&y(!0);try{await B(d),await Promise.all([M(d),L(d)])}finally{y(!1)}},[B,M,L]);c.useEffect(()=>{P()},[P]),c.useEffect(()=>{if(!s){y(!1);return}if(O(s,{skeleton:!0}),N.current){try{h.removeChannel(N.current)}catch{}N.current=null}const d=()=>{R.current&&clearTimeout(R.current),R.current=setTimeout(()=>O(s,{skeleton:!1}),1e3)},m=h.channel(`volei-hub-${s}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},d).on("postgres_changes",{event:"UPDATE",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},d).on("postgres_changes",{event:"DELETE",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},d).subscribe();return N.current=m,()=>{if(R.current&&(clearTimeout(R.current),R.current=null),N.current){try{h.removeChannel(N.current)}catch{}N.current=null}}},[s,O]),c.useEffect(()=>{if(!w){const d=Ns(r,n.current);d.length&&i(d)}},[w,r,a]),c.useEffect(()=>{if(!w&&l.length===0&&r.length>0){const d=Ns(r,n.current);d.length&&(console.info("[Vôlei] standings derivadas de matches:",d.length),i(d))}},[w,l.length,r]),c.useEffect(()=>{if(!l)return;const d=new Set(l.map(j=>String(j.team_id))),E=Object.keys(n.current||{}).filter(j=>!d.has(String(j)));if(E.length===0)return;const g=new Map;for(const j of r||[]){const G=de(j?.group_name);if(!G)continue;const V=H=>{if(!H)return;const Z=String(H),ne=g.get(Z)||{};ne[G]=(ne[G]||0)+1,g.set(Z,ne)};V(j?.home?.id),V(j?.away?.id)}const v=j=>{const G=g.get(String(j))||{},V=Object.entries(G).sort((H,Z)=>Z[1]-H[1])[0];return V?V[0]:"-"},I=E.map(j=>{const G=n.current[j]||{};return{group_name:(G.group_name?de(G.group_name):null)||v(j)||"-",team_id:isNaN(Number(j))?j:Number(j),team_name:G.name||"—",matches_played:0,wins:0,losses:0,sv:0,sp:0,pf:0,pa:0,point_difference:0,points:0}}),S=[...l,...I],q={};for(const j of S){const G=j.group_name||"-",V=Number(j.point_difference??(j.pf??0)-(j.pa??0));(q[G]||=[]).push({...j,point_difference:V})}const U=[];for(const j of Object.keys(q).sort())q[j].sort(Pe),q[j].forEach((G,V)=>U.push({...G,rank:V+1}));i(U)},[l,r,a]);const A=l.length>0,f=c.useMemo(()=>{const d=v=>(r||[]).filter(I=>I.stage===v).sort((I,S)=>(Number(I?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(S?.order_idx)||Number.MAX_SAFE_INTEGER)),m=d("semi"),E=d("final"),g=d("3lugar");return{semis:m,final:E[0],third:g[0]}},[r]),p=c.useMemo(()=>Ka(l),[l]),b=f.semis?.length?f.semis:p||[];c.useMemo(()=>{const d=new Set;return(r||[]).forEach(m=>{const E=de(m.group_name);E&&E!=="-"&&d.add(E)}),["todos",...Array.from(d).sort()]},[r]),c.useMemo(()=>{const d=new Set;(r||[]).forEach(g=>g.stage&&d.add(g.stage));const m=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(d).sort((g,v)=>m.indexOf(g)+100-(m.indexOf(v)+100))]},[r]);const _=c.useMemo(()=>{const d=(r||[]).some(E=>E.stage==="grupos"&&E.status!=="finished");let m=(r||[]).filter(E=>E.status==="scheduled"&&(d?E.stage==="grupos":!0));return k!=="todos"&&(m=m.filter(E=>de(E.group_name)===k)),$!=="todos"&&(m=m.filter(E=>E.stage===$)),m.sort((E,g)=>be(E.starts_at)-be(g.starts_at)||(E.order_idx??1)-(g.order_idx??1)),m},[r,k,$]),F=c.useMemo(()=>{const d=(r||[]).filter(m=>m.status==="finished");return d.sort((m,E)=>be(E.updated_at||E.starts_at||0)-be(m.updated_at||m.starts_at||0)),d.slice(0,12)},[r]);return e.jsx(Ha,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:Da}),e.jsx("h2",{className:"text-2xl font-bold",children:La})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Classificação por ",e.jsx("strong",{children:"sets"})," (3 pts por vitória). Empate em sets desempata por ",e.jsx("strong",{children:"pontos do placar"}),"."]})]}),w?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((d,m)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},m))})]}):e.jsxs(e.Fragment,{children:[A&&(()=>{const d=(l||[]).filter(m=>de(m.group_name)!=="-");return d.length?e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Xa,{standings:d,teamsById:a})]}):null})(),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(b.length,2)}).map((d,m)=>{const E=b[m],g=E?void 0:{home:"A definir",away:"A definir"};return e.jsx(qe,{match:E,placeholder:g},`s-${E?.id??m}`)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),f.final?e.jsx(qe,{match:f.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(qe,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]}),f.third?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"3º lugar"}),e.jsx(qe,{match:f.third})]}):null]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:k,onChange:d=>C(d.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:["todos",...new Set((r||[]).map(d=>d.group_name).filter(Boolean)).values()].map(d=>e.jsx("option",{value:d,children:d==="todos"?"Todos":`Grupo ${d}`},d))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:$,onChange:d=>T(d.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:["todos",...new Set((r||[]).map(d=>d.stage).filter(Boolean)).values()].map(d=>e.jsx("option",{value:d,children:d==="todos"?"Todas":at(d)},d))})]}),_.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:_.map((d,m)=>e.jsx(_s,{match:d},d.id??`sched-${m}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),F.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:F.map((d,m)=>e.jsx(_s,{match:d},d.id??`fin-${m}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas com ",e.jsx("strong",{children:"um set de 15 pontos"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Vitória:"})," é necessário ter ",e.jsx("strong",{children:"dois pontos de vantagem"})," para vencer a partida."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (3 grupos de 3 equipes) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo e o melhor 2º colocado avançam para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," confronto direto; se houver 3 empates, será utilizado o diferencial de pontos."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor do grupo A × Vencedor do grupo B; Vencedor do grupo C × Melhor 2º colocado."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Substituições:"})," ilimitadas."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Rodízio:"})," obrigatório."]})]})})]})]})]})})}const Wa="FIFA",er="🎮⚽",sr="team-logos",tr="America/Sao_Paulo",ar={r32:"Pré-oitavas",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar","1º":"1ª fase","2º":"2ª fase","3º":"3ª fase","4º":"4ª fase"},ws={r32:1,oitavas:2,quartas:3,semi:4,final:5,"3lugar":5},lt=s=>s?ar[s]||s:"",Ie=s=>ws[s]??ws[String(s||"").toLowerCase()]??99;function rr(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function nr(s){const t=rr(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:tr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const ct=s=>typeof s=="string"&&/^https?:\/\//i.test(s),or=s=>typeof s=="string"&&!ct(s)&&s.trim()!=="";function ir(s){if(!s)return null;if(ct(s))return s;if(or(s)){const{data:t}=h.storage.from(sr).getPublicUrl(s);return t?.publicUrl||null}return null}const Ge=s=>{const t=ir(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null},lr={17:[1,2],18:[3,4],19:[5,6],20:[7,8],21:[9,10],22:[11,12],23:[13,14],24:[15,16],25:[17,18],26:[19,20],27:[21,22],28:[23,24],29:[25,26],30:[27,28],31:[29,30]},cr={32:[29,30]},dr=(s,t)=>t==="3lugar"?cr[s]||null:lr[s]||null;function mr({order_idx:s,stage:t}){const a=[];return s!=null&&String(s).length&&a.push(`Jogo ${s}`),t&&a.push(lt(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:a.join(" • ")||"—"})}function ur({team:s,align:t="left",badge:a=28}){const o=(()=>{const i=s?.name;if(typeof i=="string")return i;if(i&&typeof i=="object"&&"name"in i)return String(i.name);try{return String(i??"A definir")}catch{return"A definir"}})(),n=!!s?.id,l=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:o},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:o,children:o}),t==="right"?e.jsx(se,{team:{...s||{},name:o},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:i=>i.stopPropagation(),title:o,children:l}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:l})}function gr({match:s,placeholders:t}){const a=s.home||(t?.home?{name:t.home}:null),o=s.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},l=o?.id?o:{name:o?.name||"A definir"},i=s?.status&&s.status!=="scheduled",r=Number(s?.home_score??0),u=Number(s?.away_score??0),w=({value:k})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:i?k:"-"})]}),y=({team:k,align:C,score:$})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${C==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(ur,{team:k,align:C})}),e.jsx(w,{value:$})]});return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(mr,{order_idx:s.order_idx,stage:s.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(y,{team:n,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(y,{team:l,align:"right",score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s.starts_at?nr(s.starts_at):s.venue||""}),i?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",u]}):null]})]})}function hr(){const[s,t]=c.useState(null),[a,o]=c.useState([]),[n,l]=c.useState(!0),i=c.useRef(null),r=c.useRef(!1),u=c.useCallback(async()=>{const{data:$,error:T}=await h.from("sports").select("id").eq("name","FIFA").maybeSingle();if(T){console.error("Erro ao carregar sport id:",T);return}$?.id&&t($.id)},[]),w=c.useCallback(async $=>{try{const{data:T,error:N}=await h.from("match_detail_view").select(`
          id, sport_id, order_idx,
          stage, round, group_name, starts_at, updated_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score
        `).eq("sport_id",$);let R=[];if(!N&&T?.length)R=T.map(P=>({id:P.id,sport_id:P.sport_id,order_idx:P.order_idx,stage:P.stage,round:P.round,group_name:P.group_name,starts_at:P.starts_at,updated_at:P.updated_at,venue:P.venue,status:P.status,home_score:P.home_score,away_score:P.away_score,home:P.home_team_id?{id:P.home_team_id,name:String(P.home_team_name??"A definir"),color:P.home_team_color,logo_url:Ge(P.home_team_logo)}:null,away:P.away_team_id?{id:P.away_team_id,name:String(P.away_team_name??"A definir"),color:P.away_team_color,logo_url:Ge(P.away_team_logo)}:null}));else{const{data:P,error:B}=await h.from("matches").select(`
            id, order_idx, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("sport_id",$);if(B)throw B;R=(P||[]).map(M=>({...M,home:M.home&&typeof M.home=="object"?{...M.home,name:String(M.home.name??"A definir"),logo_url:Ge(M.home.logo_url)}:M.home,away:M.away&&typeof M.away=="object"?{...M.away,name:String(M.away.name??"A definir"),logo_url:Ge(M.away.logo_url)}:M.away}))}R.sort((P,B)=>{const M=Ie(P.stage)-Ie(B.stage);return M!==0?M:(P.order_idx??9999)-(B.order_idx??9999)}),o(R)}catch(T){console.error("Exceção loadMatches:",T),o([])}},[]),y=c.useCallback(async $=>{if(!r.current){r.current=!0,l(!0);try{await w($)}finally{l(!1),r.current=!1}}},[w]);c.useEffect(()=>{u()},[u]),c.useEffect(()=>{if(!s)return;if(y(s),i.current){try{h.removeChannel(i.current)}catch{}i.current=null}const $=h.channel(`fifa-hub-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},()=>{y(s)}).subscribe();return i.current=$,()=>{if(i.current){try{h.removeChannel(i.current)}catch{}i.current=null}}},[s,y]);const k=c.useCallback(($,T)=>{const N=dr($,T);return T==="3lugar"&&N?{home:`Perdedor J${N[0]}`,away:`Perdedor J${N[1]}`}:N?{home:`Vencedor J${N[0]}`,away:`Vencedor J${N[1]}`}:null},[]),C=c.useMemo(()=>{const $={};for(const N of a){const R=N.stage||"—";$[R]||($[R]=[]),$[R].push(N)}return Object.keys($).sort((N,R)=>Ie(N)-Ie(R)).map(N=>({stage:N,items:$[N].sort((R,P)=>(R.order_idx??0)-(P.order_idx??0))}))},[a]);return e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:er}),e.jsx("h2",{className:"text-2xl font-bold",children:Wa})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"chaveamento"})," completo (com placeholders) → ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),n?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map(($,T)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},T))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),C.map(({stage:$,items:T})=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:lt($)||"Fase"}),T.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:T.map(N=>e.jsx(gr,{match:N,placeholders:k(Number(N.order_idx),N.stage)},N.id))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem confrontos nesta fase."})]},$))]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," torneio de ",e.jsx("strong",{children:"mata-mata"})," (eliminação simples)."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Estrutura:"})," fases iniciais → oitavas/quartas → semifinais → final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Partidas:"})," jogo único por confronto."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate:"})," prorrogação e/ou pênaltis conforme necessário."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Configurações do console:"})," duração, times e regras definidas pela organização."]})]})})]})]})]})}const He="Pebolim",pr="🎯",xr="team-logos",fr="America/Sao_Paulo",yr={r32:"Pré-oitavas",grupos:"Grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},dt=s=>s?yr[s]||s:"";function mt(s){if(!s)return null;if(s instanceof Date)return isNaN(s.getTime())?null:s;if(typeof s=="number")return new Date(s);if(typeof s=="string"){let t=s.trim();/^\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}(:\d{2})?$/.test(t)&&(t=t.replace(/\s+/,"T"));let a=new Date(t);if(!isNaN(a.getTime())||(a=new Date(`${t}Z`),!isNaN(a.getTime())))return a}return null}function is(s){const t=mt(s);if(!t)return"";try{return t.toLocaleString("pt-BR",{timeZone:fr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}const Oe=s=>{const t=mt(s);return t?t.getTime():Number.POSITIVE_INFINITY},ut=s=>typeof s=="string"&&/^https?:\/\//i.test(s),jr=s=>typeof s=="string"&&!ut(s)&&s.trim()!=="";function br(s){if(!s)return null;if(ut(s))return s;if(jr(s)){const{data:t}=h.storage.from(xr).getPublicUrl(s);return t?.publicUrl||null}return null}const ke=s=>{const t=br(s);return t?`${t}${t.includes("?")?"&":"?"}v=1`:null};function gt({order_idx:s,stage:t,group_name:a}){const o=[];return s!=null&&String(s).length&&o.push(`Jogo ${s}`),a?o.push(`Grupo ${a}`):t&&o.push(dt(t)),e.jsx("div",{className:"mb-1 text-sm font-semibold text-gray-900",children:o.join(" • ")||"—"})}function ls({team:s,align:t="left",badge:a=28}){const o=(()=>{const r=s?.name;if(typeof r=="string")return r;if(r&&typeof r=="object"&&"name"in r)return String(r.name);try{return String(r??"A definir")}catch{return"A definir"}})(),n=!!s?.id,l=!n&&o==="A definir",i=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:{...s||{},name:o},size:a}),e.jsxs("span",{className:`block truncate text-base sm:text-lg font-semibold ${n?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:o,children:[o,l?e.jsx(Xs,{className:"inline-block ml-1 w-4 h-4 text-gray-400"}):null]}),t==="right"?e.jsx(se,{team:{...s||{},name:o},size:a}):null]});return n?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-2 hover:underline ${t==="right"?"justify-end":""}`,onClick:r=>r.stopPropagation(),title:o,children:i}):e.jsx("div",{className:`min-w-0 flex items-center gap-2 ${t==="right"?"justify-end":""}`,children:i})}function vs({match:s}){const t=s?.status&&s.status!=="scheduled",a=Number(s?.home_score??0),o=Number(s?.away_score??0);return e.jsxs(X,{to:`/match/${s.id}`,className:"block rounded-xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(gt,{order_idx:s.order_idx,stage:s.stage,group_name:s.group_name}),e.jsxs("div",{className:"mt-1 grid grid-cols-3 items-center gap-2",children:[e.jsx(ls,{team:s.home}),e.jsx("div",{className:"text-center",children:t?e.jsxs("span",{className:"text-base font-bold tabular-nums",children:[a," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",o]}):e.jsx("span",{className:"text-xs text-gray-500",children:"—"})}),e.jsx(ls,{team:s.away,align:"right"})]}),e.jsxs("div",{className:"mt-1 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?is(s.starts_at):s?.venue||""}),s?.updated_at&&s?.status==="finished"?e.jsxs("span",{children:["Encerrado em ",is(s.updated_at)]}):null]})]})}function Ee({match:s,placeholder:t}){const a=s?.home||(t?.home?{name:t.home}:null),o=s?.away||(t?.away?{name:t.away}:null),n=a?.id?a:{name:a?.name||"A definir"},l=o?.id?o:{name:o?.name||"A definir"},i=s&&s.status!=="scheduled",r=Number(s?.home_score??0),u=Number(s?.away_score??0),w=({value:C})=>e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Gols"}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:i?C:"-"})]}),y=({team:C,align:$,score:T})=>e.jsxs("div",{className:"grid grid-cols-[minmax(0,1fr)_auto] items-center gap-3",children:[e.jsx("div",{className:`${$==="right"?"justify-self-end":"justify-self-start"} min-w-0`,children:e.jsx(ls,{team:C,align:$})}),e.jsx(w,{value:T})]}),k=e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm transition hover:bg-gray-50",children:[e.jsx(gt,{order_idx:s?.order_idx,stage:s?.stage}),e.jsxs("div",{className:"mt-2 rounded-xl border border-gray-100 bg-gray-50 px-3 py-3 space-y-3",children:[e.jsx(y,{team:n,align:"left",score:r}),e.jsx("div",{className:"h-px bg-gray-200"}),e.jsx(y,{team:l,align:"right",score:u})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{className:"truncate",children:s?.starts_at?is(s.starts_at):s?.venue||""}),i?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 bg-white px-2 py-0.5 font-semibold text-gray-600",children:[r," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",u]}):null]})]});return s?.id?e.jsx(X,{to:`/match/${s.id}`,className:"block",children:k}):k}const cs=s=>3*Number(s.wins??0)+Number(s.draws??0);function _r(s,t){const a=cs(s),o=cs(t);if(o!==a)return o-a;const n=Number(s.wins??0),l=Number(t.wins??0);if(l!==n)return l-n;const i=Number(s.goal_difference??Number(s.goals_for??0)-Number(s.goals_against??0)),r=Number(t.goal_difference??Number(t.goals_for??0)-Number(t.goals_against??0));if(r!==i)return r-i;const u=Number(s.goals_for??0),w=Number(t.goals_for??0);return w!==u?w-u:String(s.team_id).localeCompare(String(t.team_id))}function Nr({standings:s,teamsById:t,sportId:a}){const o=c.useMemo(()=>{const i=k=>String(k??"-").trim().toUpperCase(),r={},u=new Set;for(const k of s||[]){const C=i(k.group_name);r[C]||(r[C]=[]),r[C].push({...k,group_name:C}),u.add(String(k.team_id))}const w={};for(const k in t){const C=t[k];if(a&&C&&C.sport_id&&String(C.sport_id)!==String(a))continue;const $=i(C.group_name);w[$]||(w[$]=[]),w[$].push(C)}const y=Object.keys(r).length?Object.keys(r):Object.keys(w);for(const k of y){const C=r[k]||[],$=(w[k]||[]).filter(N=>!u.has(String(N.id))).map(N=>({group_name:k,team_id:N.id,team_name:N.name,matches_played:0,wins:0,draws:0,losses:0,goals_for:0,goals_against:0,goal_difference:0})),T=[...C,...$].sort(_r).map((N,R)=>({...N,rank:R+1}));r[k]=T}return r},[s,t,a]),n=c.useMemo(()=>{const i=new Map;(s||[]).forEach(u=>i.set(String(u.team_id),String(u.group_name??"-")));const r=[];return Object.values(t||{}).forEach(u=>{const w=i.get(String(u.id)),y=String(u.group_name??"-");w&&w!==y&&r.push({id:u.id,name:u.name,teamG:y,sidG:w})}),r},[s,t]),l=Object.keys(o).sort();return l.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Sem dados de classificação."}):e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[n.length?e.jsx("div",{className:"md:col-span-3",children:e.jsxs("div",{className:"rounded-md border border-amber-200 bg-amber-50 p-2 text-xs text-amber-800",children:[n.length," time(s) com grupo divergente entre ",e.jsx("em",{children:"teams"})," e ",e.jsx("em",{children:"standings"}),". A UI já ignora isso, mas vale ajustar no banco."]})}):null,l.map(i=>e.jsxs("div",{className:"overflow-hidden rounded-2xl border bg-white shadow-sm",children:[e.jsxs("div",{className:"border-b bg-gray-50 px-3 py-2 text-sm font-semibold",children:["Grupo ",i]}),e.jsxs("table",{className:"min-w-full text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b text-gray-600",children:[e.jsx("th",{className:"w-8 py-1 pl-3 text-left",children:"#"}),e.jsx("th",{className:"py-1 text-left",children:"Time"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"P"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"V"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"E"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"D"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GP"}),e.jsx("th",{className:"w-10 py-1 text-center",children:"GC"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"+/-"}),e.jsx("th",{className:"w-12 py-1 text-center",children:"Pts"})]})}),e.jsx("tbody",{children:o[i].map(r=>{const u=t[r.team_id]&&typeof t[r.team_id]=="object"?t[r.team_id]:{id:r.team_id,name:String(r.team_name??t[r.team_id]?.name??"—")},w={...u,name:typeof u.name=="string"?u.name:String(u.name??"—")};return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-1 pl-3",children:r.rank}),e.jsx("td",{className:"py-1",children:e.jsxs(X,{to:`/team/${w.id}`,className:"flex items-center gap-2 hover:underline",children:[e.jsx(se,{team:w,size:20}),e.jsx("span",{className:"truncate",children:w.name})]})}),e.jsx("td",{className:"py-1 text-center",children:r.matches_played}),e.jsx("td",{className:"py-1 text-center",children:r.wins}),e.jsx("td",{className:"py-1 text-center",children:r.draws}),e.jsx("td",{className:"py-1 text-center",children:r.losses}),e.jsx("td",{className:"py-1 text-center",children:r.goals_for}),e.jsx("td",{className:"py-1 text-center",children:r.goals_against}),e.jsx("td",{className:"py-1 text-center",children:r.goal_difference}),e.jsx("td",{className:"py-1 text-center font-semibold",children:cs(r)})]},`${i}-${r.team_id}`)})})]}),e.jsx("div",{className:"px-3 py-2 text-[10px] text-gray-500",children:"Critérios: Pontos, Vitórias, Saldo de Gols, Gols Pró."})]},i))]})}function wr(s){const t=r=>(s||[]).filter(u=>u.stage===r).sort((u,w)=>(Number(u?.order_idx)||Number.MAX_SAFE_INTEGER)-(Number(w?.order_idx)||Number.MAX_SAFE_INTEGER)),a=t("oitavas"),o=t("quartas"),n=t("semi"),l=t("final"),i=t("3lugar");return{oitavas:a,quartas:o,semis:n,final:l[0],third:i[0]}}function vr(s,t){if(!Array.isArray(s)||s.length===0){const i=(r,u)=>({home:{name:`1º Grupo ${r}`},away:{name:`1º Grupo ${u}`}});return{quarters:[i("A","B"),i("C","D"),i("E","F"),i("G","H")],semis:[{home:{name:"Vencedor Quartas 1"},away:{name:"Vencedor Quartas 2"}},{home:{name:"Vencedor Quartas 3"},away:{name:"Vencedor Quartas 4"}}]}}const a={};for(const i of"ABCDEFGH".split("")){const r=s.find(u=>u.group_name===i&&u.rank===1);r&&(a[i]={id:r.team_id,name:r.team_name||t[r.team_id]?.name||"—",logo_url:t[r.team_id]?.logo_url,color:t[r.team_id]?.color})}const o=(i,r)=>({home:a[i]||{name:`1º Grupo ${i}`},away:a[r]||{name:`1º Grupo ${r}`}});return{quarters:[o("A","B"),o("C","D"),o("E","F"),o("G","H")],semis:[{home:{name:"Vencedor Quartas 1"},away:{name:"Vencedor Quartas 2"}},{home:{name:"Vencedor Quartas 3"},away:{name:"Vencedor Quartas 4"}}]}}class Sr extends Ve.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){console.error("Pebolim ErrorBoundary:",t,a)}render(){return this.state.hasError?e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Algo quebrou ao renderizar esta página."}),e.jsx("div",{className:"font-mono text-xs whitespace-pre-wrap",children:String(this.state.error?.message||this.state.error)})]}):this.props.children}}const ht=s=>typeof s=="string"?s.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim().toLowerCase():"",Ss=s=>{const t=ht(s);return t==="semifinal"||t==="semi-final"||t==="semis"?"semi":t==="3º lugar"||t==="3lugar"||t==="3-lugar"||t==="terceiro"?"3lugar":t},$s=s=>{const t=ht(s);return t==="agendado"||t==="programado"||t==="scheduled"?"scheduled":t==="ao vivo"||t==="andamento"||t==="live"||t==="ongoing"?"ongoing":t==="pausado"||t==="paused"?"paused":t==="encerrado"||t==="finalizado"||t==="finished"?"finished":t||"scheduled"};function $r(){const[s,t]=c.useState(null),[a,o]=c.useState({}),n=c.useRef({});c.useEffect(()=>{n.current=a},[a]);const[l,i]=c.useState([]),[r,u]=c.useState([]),[w,y]=c.useState(!0),[k,C]=c.useState("todos"),[$,T]=c.useState("todos"),N=c.useRef(null),R=c.useRef(null),P=c.useCallback(async()=>{try{const{data:d,error:m}=await h.from("sports").select("id").eq("name",He).maybeSingle();m&&console.error("Erro ao carregar sport id:",m),t(d?.id??null)}catch(d){console.error("Exceção loadSportId:",d),t(null)}},[]),B=c.useCallback(async d=>{try{if(d){const m=await h.from("teams").select("id, name, logo_url, color, group_name, sport_id").eq("sport_id",d);if(!m.error&&Array.isArray(m.data)&&m.data.length){const E={};for(const g of m.data)E[g.id]={...g,name:String(g.name??"—"),logo_url:ke(g.logo_url),group_name:g.group_name??"-",sport_id:g.sport_id??d};o(E),n.current=E;return}}o({})}catch(m){console.error("Exceção loadTeams:",m),o({})}},[]),M=c.useCallback(async d=>{try{if(d){const{data:g,error:v}=await h.from("standings_view").select(`
            sport_id, group_name, rank, team_id, team_name,
            matches_played, wins, draws, losses,
            goals_for, goals_against, goal_difference, points
          `).eq("sport_id",d).order("group_name",{ascending:!0,nullsFirst:!0}).order("rank",{ascending:!0});if(v)throw v;if(Array.isArray(g)&&g.length>0){i(g);return}}const m=await h.from("standings_view").select(`
          sport_id, group_name, rank, team_id, team_name,
          matches_played, wins, draws, losses,
          goals_for, goals_against, goal_difference, points
        `);if(m.error)throw m.error;const E=Array.isArray(m.data)?m.data:[];i(d?E.filter(g=>String(g.sport_id)===String(d)):E)}catch(m){console.error("Exceção loadStandings:",m),i([])}},[]),L=c.useCallback(async d=>{try{let m=[];if(d){const{data:v,error:I}=await h.from("match_detail_view").select(`
            id, sport_id, order_idx,
            stage, round, group_name, starts_at, updated_at, venue, status,
            home_team_id, home_team_name, home_team_color, home_team_logo,
            away_team_id, away_team_name, away_team_color, away_team_logo,
            home_score, away_score
          `).eq("sport_id",d);!I&&Array.isArray(v)&&v.length&&(m=v.map(S=>({id:S.id,sport_id:S.sport_id,order_idx:S.order_idx,stage:Ss(S.stage),round:S.round,group_name:S.group_name,starts_at:S.starts_at,updated_at:S.updated_at,venue:S.venue,status:$s(S.status),home_score:S.home_score,away_score:S.away_score,home:S.home_team_id?{id:S.home_team_id,name:String(S.home_team_name??"A definir"),color:S.home_team_color,logo_url:ke(S.home_team_logo)}:null,away:S.away_team_id?{id:S.away_team_id,name:String(S.away_team_name??"A definir"),color:S.away_team_color,logo_url:ke(S.away_team_logo)}:null})))}if(!m.length){const{data:v,error:I}=await h.from("matches").select(`
            id, stage, round, group_name, starts_at, updated_at, venue, status,
            home_score, away_score, order_idx,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color ),
            sport:sport_id!inner(name)
          `).eq("sport.name",He);if(I)throw I;m=(v||[]).map(S=>({id:S.id,order_idx:Number.isFinite(Number(S.order_idx))?Number(S.order_idx):null,stage:Ss(S.stage),round:S.round,group_name:S.group_name,starts_at:S.starts_at,updated_at:S.updated_at,venue:S.venue,status:$s(S.status),home_score:S.home_score,away_score:S.away_score,home:S.home?{...S.home,name:String(S.home.name??"A definir"),logo_url:ke(S.home.logo_url)}:null,away:S.away?{...S.away,name:String(S.away.name??"A definir"),logo_url:ke(S.away.logo_url)}:null}))}const E={grupos:1,oitavas:2,quartas:3,semi:4,"3lugar":5,final:6},g=v=>Number.isFinite(Number(v?.order_idx))?Number(v.order_idx):Number.MAX_SAFE_INTEGER;m.sort((v,I)=>(E[v.stage]??99)-(E[I.stage]??99)||g(v)-g(I)),u(m)}catch(m){console.error("Exceção loadMatches (pebolim):",m),u([])}},[]),O=c.useCallback(async(d,{skeleton:m=!1}={})=>{m&&y(!0);try{await B(d),await Promise.all([M(d),L(d)])}finally{y(!1)}},[B,M,L]);c.useEffect(()=>{P()},[P]),c.useEffect(()=>{if(s){if(O(s,{skeleton:!0}),N.current){try{h.removeChannel(N.current)}catch{}N.current=null}if(s){const d=()=>{R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{Promise.all([M(s),L(s)]).catch(E=>console.error(E))},400)},m=h.channel(`pebolim-hub-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`sport_id=eq.${s}`},d).on("postgres_changes",{event:"*",schema:"public",table:"standings",filter:`sport_id=eq.${s}`},d).subscribe();N.current=m}return()=>{if(R.current&&(clearTimeout(R.current),R.current=null),N.current){try{h.removeChannel(N.current)}catch{}N.current=null}}}},[s,O]),c.useMemo(()=>!!(l?.length||(r||[]).some(d=>!!d.group_name)||Object.values(a||{}).some(d=>!!d.group_name)),[l,r,a]);const A=c.useMemo(()=>wr(r),[r]),f=c.useMemo(()=>vr(l,a),[l,a]),p=c.useMemo(()=>{const d=new Set;return(r||[]).forEach(m=>m.group_name&&d.add(m.group_name)),(l||[]).forEach(m=>m.group_name&&d.add(m.group_name)),Object.values(a||{}).forEach(m=>m.group_name&&d.add(m.group_name)),["todos",...Array.from(d).sort()]},[r,l,a]),b=c.useMemo(()=>{const d=new Set;(r||[]).forEach(g=>g.stage&&d.add(g.stage));const m=["r32","grupos","oitavas","quartas","semi","3lugar","final"];return["todos",...Array.from(d).sort((g,v)=>m.indexOf(g)+100-(m.indexOf(v)+100))]},[r]),_=c.useMemo(()=>{let d=(r||[]).filter(m=>m.status!=="scheduled"?!1:m.group_name?!0:m.home?.id&&m.away?.id);return k!=="todos"&&(d=d.filter(m=>m.group_name===k)),$!=="todos"&&(d=d.filter(m=>m.stage===$)),d.sort((m,E)=>{const g=Oe(m.starts_at),v=Oe(E.starts_at);return(Number.isFinite(g-v)?g-v:0)||Number(m.order_idx??Number.MAX_SAFE_INTEGER)-Number(E.order_idx??Number.MAX_SAFE_INTEGER)||m.id-E.id}),d},[r,k,$]),F=c.useMemo(()=>{const d=(r||[]).filter(m=>m.status==="finished");return d.sort((m,E)=>Oe(E.updated_at||E.starts_at||0)-Oe(m.updated_at||m.starts_at||0)),d.slice(0,12)},[r]);return e.jsx(Sr,{children:e.jsxs("div",{className:"space-y-10",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:pr}),e.jsx("h2",{className:"text-2xl font-bold",children:He})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Hub informativo: ",e.jsx("strong",{children:"classificação"})," (se houver grupos) → ",e.jsx("strong",{children:"chaveamento"})," →"," ",e.jsx("strong",{children:"jogos agendados"})," → ",e.jsx("strong",{children:"regulamento"}),"."]})]}),w?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-6 w-48 rounded bg-gray-100 animate-pulse"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:8}).map((d,m)=>e.jsx("div",{className:"h-20 rounded-xl bg-gray-100 animate-pulse"},m))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Tabela de classificação"}),e.jsx(Nr,{standings:l,teamsById:a,sportId:s})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Chaveamento"}),A.oitavas?.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Oitavas de final"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:A.oitavas.map((d,m)=>e.jsx(Ee,{match:d},`o-${d?.id??m}`))})]}):null,A.quartas?.length||f?.quarters?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Quartas de final"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(A.quartas?.length||0,f?.quarters?.length||0,4)}).map((d,m)=>{const E=A.quartas?.[m],g=f?.quarters?.[m];return e.jsx(Ee,{match:E,placeholder:g},`q-${E?.id??m}`)})})]}):null,A.semis?.length||f?.semis?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Semifinais"}),e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:Array.from({length:Math.max(A.semis?.length||0,f?.semis?.length||0,2)}).map((d,m)=>{const E=A.semis?.[m],g=f?.semis?.[m];return e.jsx(Ee,{match:E,placeholder:g},`s-${E?.id??m}`)})})]}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Final"}),A.final?e.jsx(Ee,{match:A.final}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:e.jsx(Ee,{placeholder:{home:"Vencedor Semifinal 1",away:"Vencedor Semifinal 2"}})})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Jogos agendados"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx("label",{className:"text-gray-600",children:"Grupo:"}),e.jsx("select",{value:k,onChange:d=>C(d.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:p.map(d=>e.jsx("option",{value:d,children:d==="todos"?"Todos":`Grupo ${d}`},d))}),e.jsx("label",{className:"text-gray-600",children:"Fase:"}),e.jsx("select",{value:$,onChange:d=>T(d.target.value),className:"rounded-md border border-gray-300 bg-white px-2 py-1",children:b.map(d=>e.jsx("option",{value:d,children:d==="todos"?"Todas":dt(d)},d))})]}),_.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:_.map((d,m)=>e.jsx(vs,{match:d},d.id??`sched-${m}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum jogo agendado no momento."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Encerrados (recentes)"}),F.length?e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:F.map((d,m)=>e.jsx(vs,{match:d},d.id??`fin-${m}`))}):e.jsx("div",{className:"text-xs text-gray-500",children:"Sem resultados recentes."})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Regulamento"}),e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 text-sm text-gray-700 shadow-sm",children:e.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Duração:"})," partidas em ",e.jsx("strong",{children:"1 rodada de 4 gols"}),"."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Formato:"})," fase de grupos (8 grupos de 3 duplas) e mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Classificação (grupos):"})," o 1º colocado de cada grupo avança para o mata-mata."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Desempate (grupos):"})," saldo de gols."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Mata-mata:"})," quatro quartas de final, duas semifinais e uma final."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Quartas de final:"})," Vencedor do grupo A × Vencedor do grupo B = Vencedor 1; Vencedor do grupo C × Vencedor do grupo D = Vencedor 2; Vencedor do grupo E × Vencedor do grupo F = Vencedor 3; Vencedor do grupo G × Vencedor do grupo H = Vencedor 4."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Semifinais:"})," Vencedor 1 × Vencedor 2; Vencedor 3 × Vencedor 4."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Duplas:"})," não podem ser substituídas durante o torneio."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"WO:"})," em caso de não comparecimento de um ou mais integrantes, a dupla perde por WO. Atrasos de até 3 minutos são tolerados."]})]})})]})]})]})})}const Cr="team-logos";function pt(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Ar(s){return typeof s=="string"&&!pt(s)&&s.trim()!==""}function Ke(s){if(!s)return null;if(pt(s))return s;if(Ar(s)){const{data:t}=h.storage.from(Cr).getPublicUrl(s);return t?.publicUrl||null}return null}const kr={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Er={grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Tr="America/Sao_Paulo";function Pr(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Tr,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function Fr(s){return s?Er[s]||s[0]?.toUpperCase()+s.slice(1):""}function Rr(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=new Date(s.starts_at),n=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(n<0)return"0:00";const l=Math.floor(n/1e3),i=Math.floor(l/60),r=l%60;return`${i}:${r.toString().padStart(2,"0")}`}function Mr({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Xe({match:s,currentTimestamp:t}){const a=(s?.sport?.name||"").toLowerCase().includes("vole"),o=Number(s?.meta?.home_sets??0),n=Number(s?.meta?.away_sets??0),l=o>0||n>0,i=a||l,r=s?.status&&s.status!=="scheduled",u=Number(s?.home_score??0),w=Number(s?.away_score??0),y=s?.status==="ongoing"||s?.status==="paused",k=y?s.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200";return e.jsxs(X,{to:`/match/${s.id}`,className:`block bg-white border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow relative overflow-hidden ${k}`,children:[e.jsx(Mr,{status:s.status}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.sport?.name}),s.group_name?` • Grupo ${s.group_name}`:"",s.stage?` • ${Fr(s.stage)}`:"",s.round?` • J${s.round}`:"",y&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",Rr(s,t)]})]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-[11px] font-medium ${s.status==="ongoing"?"bg-green-100 text-green-700":s.status==="paused"?"bg-yellow-100 text-yellow-700":s.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:kr[s.status]||s.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(se,{team:s.home||{name:"A definir"},size:24}),e.jsx("span",{className:"font-medium truncate text-sm",children:s.home?.name||"A definir"})]}),e.jsxs("div",{className:"text-center px-3",children:[i&&e.jsx("div",{className:"text-xs font-semibold tabular-nums mb-1",children:e.jsxs("span",{className:`${r?"":"text-gray-400"}`,children:["Sets: ",o," x ",n]})}),r?e.jsxs("div",{className:"text-lg font-bold tabular-nums",children:[u," x ",w]}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"})]}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 justify-end",children:[e.jsx("span",{className:"font-medium truncate text-sm text-right",children:s.away?.name||"A definir"}),e.jsx(se,{team:s.away||{name:"A definir"},size:24})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2 flex items-center justify-between",children:[e.jsx("span",{children:s.starts_at?Pr(s.starts_at):"Data a definir"}),s.venue&&e.jsx("span",{children:s.venue})]})]})}function Cs(){const{id:s}=zs(),[t,a]=c.useState(null),[o,n]=c.useState([]),[l,i]=c.useState([]),[r,u]=c.useState(!0),[w,y]=c.useState(Date.now()),k=c.useRef(null),C=c.useRef(null),$=async()=>{u(!0);try{const{data:N,error:R}=await h.from("teams").select("id, name, logo_url, color").eq("id",s).maybeSingle();if(R){console.error("Erro ao carregar time:",R);return}if(N){const O={...N,logo_url:(()=>{const A=Ke(N.logo_url);return A?`${A}${A.includes("?")?"&":"?"}v=1`:null})()};a(O)}const{data:P,error:B}=await h.from("players").select("id, name, number").eq("team_id",s).order("number",{ascending:!0,nullsFirst:!0}).order("name");!B&&P&&n(P);const{data:M,error:L}=await h.from("matches").select(`
          id, stage, round, group_name, starts_at, venue, status, 
          home_score, away_score, meta, updated_at,
          sport:sport_id ( id, name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `).or(`home_team_id.eq.${s},away_team_id.eq.${s}`).order("starts_at",{ascending:!1});if(!L&&M){const O=M.map(A=>{const f=A.home&&typeof A.home=="object"?{...A.home,logo_url:(()=>{const b=Ke(A.home.logo_url);return b?`${b}${b.includes("?")?"&":"?"}v=1`:null})()}:A.home,p=A.away&&typeof A.away=="object"?{...A.away,logo_url:(()=>{const b=Ke(A.away.logo_url);return b?`${b}${b.includes("?")?"&":"?"}v=1`:null})()}:A.away;return{...A,home:f,away:p}});i(O)}}finally{u(!1)}};c.useEffect(()=>{$(),C.current=setInterval(()=>{y(Date.now())},1e3),k.current&&(h.removeChannel(k.current),k.current=null);const N=h.channel(`team-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>$()).on("postgres_changes",{event:"*",schema:"public",table:"teams",filter:`id=eq.${s}`},()=>$()).on("postgres_changes",{event:"*",schema:"public",table:"players",filter:`team_id=eq.${s}`},()=>$()).subscribe();return k.current=N,()=>{C.current&&clearInterval(C.current),k.current&&h.removeChannel(k.current),k.current=null}},[s]);const T=c.useMemo(()=>{const N={ongoing:[],paused:[],scheduled:[],finished:[]};return l.forEach(R=>{N[R.status]?N[R.status].push(R):N.finished.push(R)}),N},[l]);return r?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-20 bg-gray-100 rounded animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded animate-pulse"})]})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(se,{team:t,size:64}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.name}),e.jsxs("p",{className:"text-gray-500",children:[l.length," partida",l.length!==1?"s":""," registrada",l.length!==1?"s":""]})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Convocação"}),o.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"space-y-2",children:o.map(N=>e.jsxs("li",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-0",children:[e.jsx("span",{className:"font-medium",children:N.name}),e.jsx("span",{className:"text-gray-500 text-sm tabular-nums",children:N.number?`#${N.number}`:"—"})]},N.id))})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Estatísticas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:T.ongoing.length+T.paused.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Ao vivo"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:T.scheduled.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Agendadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:T.finished.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Finalizadas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:o.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"Jogadores"})]})]})]})]}),e.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Partidas"}),l.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"Nenhuma partida registrada."}):e.jsxs("div",{className:"space-y-4",children:[(T.ongoing.length>0||T.paused.length>0)&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"🔴 Ao vivo"}),e.jsx("div",{className:"space-y-2",children:[...T.ongoing,...T.paused].map(N=>e.jsx(Xe,{match:N,currentTimestamp:w},N.id))})]}),T.scheduled.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"📅 Próximas partidas"}),e.jsx("div",{className:"space-y-2",children:T.scheduled.map(N=>e.jsx(Xe,{match:N,currentTimestamp:w},N.id))})]}),T.finished.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"✅ Finalizadas"}),e.jsx("div",{className:"space-y-2",children:T.finished.slice(0,5).map(N=>e.jsx(Xe,{match:N,currentTimestamp:w},N.id))}),T.finished.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["... e mais ",T.finished.length-5," partida",T.finished.length-5!==1?"s":""]})]})]})]}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-600",children:"Time não encontrado"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"O time solicitado não existe ou foi removido."})]})}const xt={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},qr={r32:"Pré-oitavas",grupos:"Fase de grupos",oitavas:"Oitavas",quartas:"Quartas",semi:"Semifinal",final:"Final","3lugar":"3º lugar"},Ir="team-logos";function ft(s){return typeof s=="string"&&/^https?:\/\//i.test(s)}function Gr(s){return typeof s=="string"&&!ft(s)&&s.trim()!==""}function Le(s){if(!s)return null;if(ft(s))return s;if(Gr(s)){const{data:t}=h.storage.from(Ir).getPublicUrl(s);return t?.publicUrl||null}return null}const Or="America/Sao_Paulo";function Se(s){if(!s)return"";try{return new Date(s).toLocaleString("pt-BR",{timeZone:Or,day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return s}}function yt(s){return s?qr[s]||s[0]?.toUpperCase()+s.slice(1):""}function Lr({order_idx:s,stage:t,group_name:a}){const o=[];return s&&o.push(`Jogo ${s}`),a&&o.push(`Grupo ${a}`),o.join(" • ")}function jt(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=s.starts_at?new Date(s.starts_at):null,o=s.status==="paused"?new Date(s.updated_at||Date.now()):new Date(t||Date.now());if(!a)return"0:00";const n=o-a;if(n<0)return"0:00";const l=Math.floor(n/1e3),i=Math.floor(l/60),r=l%60;return`${i}:${r.toString().padStart(2,"0")}`}function Dr({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-2xl`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}function Br({status:s,meta:t,starts_at:a,updated_at:o,currentTimestamp:n}){const l="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] font-semibold tracking-wide border",i=s==="ongoing"?"bg-green-50 text-green-700 border-green-200":s==="paused"?"bg-amber-50 text-amber-700 border-amber-200":s==="finished"?"bg-gray-100 text-gray-700 border-gray-200":"bg-blue-50 text-blue-700 border-blue-200",r=t?.clock||t?.time||t?.minute,u=s==="ongoing"||s==="paused",w=s==="scheduled"?a?` • ${Se(a)}`:"":s==="finished"?o?` • ${Se(o)}`:"":r?` • ${r}`:"";return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`${l} ${i}`,children:[xt[s]||s,w?e.jsx("span",{children:w}):null]}),u&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",jt({status:s,starts_at:a,updated_at:o},n)]})]})}function Vr({stage:s}){if(!s)return null;const t=yt(s);return e.jsx("span",{className:"inline-flex items-center rounded-full border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-semibold tracking-wide text-gray-700",children:t})}function As({team:s,align:t="left",badgeSize:a=48}){const o=!!s?.id,n=e.jsxs(e.Fragment,{children:[t==="right"?null:e.jsx(se,{team:s||{name:"A definir"},size:a}),e.jsx("span",{className:`block truncate text-base sm:text-lg font-semibold ${o?"text-gray-900":"text-gray-400"} ${t==="right"?"text-right":""}`,style:{fontSize:"1rem",lineHeight:"1.2",wordBreak:"keep-all",whiteSpace:"nowrap"},title:s?.name||"A definir",children:s?.name||"A definir"}),t==="right"?e.jsx(se,{team:s||{name:"A definir"},size:a}):null]});return o?e.jsx(X,{to:`/team/${s.id}`,className:`min-w-0 flex items-center gap-3 hover:underline ${t==="right"?"justify-end":""}`,onClick:l=>l.stopPropagation(),title:s?.name,children:n}):e.jsx("div",{className:`min-w-0 flex items-center gap-3 ${t==="right"?"justify-end":""}`,children:n})}function ks({title:s,players:t}){return e.jsxs("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:s}),t.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum jogador cadastrado."}):e.jsx("ul",{className:"text-sm divide-y",children:t.map(a=>e.jsxs("li",{className:"flex items-center justify-between py-1.5",children:[e.jsx("span",{className:"truncate",children:a.name}),e.jsx("span",{className:"inline-block w-8 text-right tabular-nums text-gray-500",children:a.number??""})]},a.id))})]})}function Es(){const{id:s}=zs(),[t,a]=c.useState(null),[o,n]=c.useState([]),[l,i]=c.useState([]),[r,u]=c.useState(!0),[w,y]=c.useState(null),[k,C]=c.useState(Date.now()),$=c.useRef(null),T=c.useRef(null),N=c.useRef(!1),R=c.useMemo(()=>(t?.sport?.name||"").toLowerCase().includes("volei"),[t?.sport?.name]),P=c.useCallback(async()=>{if(!(!s||N.current)){N.current=!0,u(!0),y(null);try{const{data:m,error:E}=await h.from("match_detail_view").select(`
          id, sport_id, sport_name, stage, round, group_name, starts_at, venue, status,
          home_team_id, home_team_name, home_team_color, home_team_logo,
          away_team_id, away_team_name, away_team_color, away_team_logo,
          home_score, away_score, order_idx, created_at, updated_at
        `).eq("id",s).maybeSingle();let g=null;if(!E&&m){g={id:m.id,sport:{id:m.sport_id,name:m.sport_name},stage:m.stage,round:m.round,group_name:m.group_name,starts_at:m.starts_at,updated_at:m.updated_at,venue:m.venue,status:m.status,order_idx:m.order_idx,meta:null,home_score:m.home_score,away_score:m.away_score,home:{id:m.home_team_id,name:m.home_team_name,color:m.home_team_color,logo_url:(()=>{const U=Le(m.home_team_logo);return U?`${U}${U.includes("?")?"&":"?"}v=1`:null})()},away:{id:m.away_team_id,name:m.away_team_name,color:m.away_team_color,logo_url:(()=>{const U=Le(m.away_team_logo);return U?`${U}${U.includes("?")?"&":"?"}v=1`:null})()}};const{data:q}=await h.from("matches").select("meta").eq("id",s).maybeSingle();q?.meta&&(g.meta=q.meta)}else{const{data:q,error:U}=await h.from("matches").select(`
            id,
            sport:sport_id ( id, name ),
            stage, round, group_name, starts_at, updated_at, venue, status, meta, order_idx,
            home_score, away_score,
            home:home_team_id ( id, name, logo_url, color ),
            away:away_team_id ( id, name, logo_url, color )
          `).eq("id",s).maybeSingle();if(U)throw U;q&&(g={...q,home:q.home&&typeof q.home=="object"?{...q.home,logo_url:(()=>{const j=Le(q.home.logo_url);return j?`${j}${j.includes("?")?"&":"?"}v=1`:null})()}:q.home,away:q.away&&typeof q.away=="object"?{...q.away,logo_url:(()=>{const j=Le(q.away.logo_url);return j?`${j}${j.includes("?")?"&":"?"}v=1`:null})()}:q.away})}if(!g)throw new Error("Partida não encontrada");a(g);const v=[];g?.home?.id?v.push(h.from("players").select("id, name, number").eq("team_id",g.home.id).order("number",{ascending:!0,nullsFirst:!0}).order("name")):v.push(Promise.resolve({data:[]})),g?.away?.id?v.push(h.from("players").select("id, name, number").eq("team_id",g.away.id).order("number",{ascending:!0,nullsFirst:!0}).order("name")):v.push(Promise.resolve({data:[]}));const[I,S]=await Promise.all(v);n(I.data||[]),i(S.data||[])}catch(m){console.error("Error loading match:",m),y(m.message||"Erro ao carregar partida")}finally{u(!1),N.current=!1}}},[s]);c.useEffect(()=>{if(!s)return;P(),T.current&&clearInterval(T.current),T.current=setInterval(()=>{C(Date.now())},1e3),$.current&&(h.removeChannel($.current),$.current=null);const m=h.channel(`match-${s}`).on("postgres_changes",{event:"*",schema:"public",table:"matches",filter:`id=eq.${s}`},()=>P()).on("postgres_changes",{event:"*",schema:"public",table:"match_events",filter:`match_id=eq.${s}`},()=>P()).subscribe();return $.current=m,()=>{T.current&&(clearInterval(T.current),T.current=null),$.current&&(h.removeChannel($.current),$.current=null)}},[s,P]);const B=c.useMemo(()=>t?Lr(t):"",[t]),M=t?.home,L=t?.away,O=Number(t?.meta?.home_sets??0),A=Number(t?.meta?.away_sets??0),f=O>0||A>0,p=R||f,b=t?.status&&t.status!=="scheduled",_=Number(t?.home_score??0),F=Number(t?.away_score??0),d=t?.status==="ongoing"||t?.status==="paused";return w?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-4xl mb-4",children:"⚠️"}),e.jsx("p",{className:"text-lg text-red-600 mb-2",children:"Erro ao carregar partida"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:w}),e.jsx("button",{onClick:()=>{y(null),P()},className:"bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700",children:"Tentar novamente"})]}):r||!t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-6 w-44 bg-gray-100 rounded animate-pulse"}),e.jsx("div",{className:"h-36 w-full bg-gray-100 rounded-2xl animate-pulse"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"h-56 bg-gray-100 rounded-2xl animate-pulse"}),e.jsx("div",{className:"h-56 bg-gray-100 rounded-2xl animate-pulse"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(Br,{status:t.status,meta:t.meta,starts_at:t.starts_at,updated_at:t.updated_at,currentTimestamp:k}),t.stage?e.jsx(Vr,{stage:t.stage}):null,B&&e.jsx("div",{className:"text-xs text-gray-600","aria-label":"Detalhes",children:B})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.starts_at?Se(t.starts_at):null,t.venue?e.jsx("span",{className:"ml-2",children:t.venue}):null]})]}),e.jsxs("div",{className:`relative overflow-hidden rounded-2xl border p-4 sm:p-5 shadow-sm ${d?t.status==="ongoing"?"border-blue-200":"border-amber-200":"border-gray-200"}`,children:[e.jsx(Dr,{status:t.status}),e.jsx("div",{className:"pointer-events-none absolute -top-24 -right-24 h-64 w-64 rounded-full bg-gradient-to-br from-blue-50 to-indigo-50 blur-3xl"}),e.jsx("div",{className:"pointer-events-none absolute -bottom-24 -left-24 h-64 w-64 rounded-full bg-gradient-to-tr from-pink-50 to-rose-50 blur-3xl"}),e.jsxs("div",{className:"relative grid grid-cols-1 items-center gap-4 sm:grid-cols-3",children:[e.jsx("div",{className:"min-w-0",children:e.jsx(As,{team:M,badgeSize:56})}),e.jsxs("div",{className:"text-center",children:[p?e.jsx("div",{className:"mb-1 flex items-center justify-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center rounded-full border border-gray-200 bg-white px-2 py-0.5 text-[11px] font-semibold text-gray-700",children:["Sets ",e.jsx("span",{className:"ml-1 tabular-nums",children:O}),e.jsx("span",{className:"mx-1 text-gray-400",children:"x"}),e.jsx("span",{className:"tabular-nums",children:A})]})}):null,b?e.jsxs("div",{className:"text-4xl font-extrabold tabular-nums leading-none sm:text-5xl",children:[_," ",e.jsx("span",{className:"text-gray-400",children:"x"})," ",F]}):e.jsx("div",{className:"text-sm text-gray-400",children:"—"}),e.jsxs("div",{className:"mt-1 text-[11px] text-gray-500",children:[xt[t.status]||t.status,d?e.jsxs("span",{className:"ml-2",children:["🕐 ",jt(t,k)]}):null,t.meta?.clock?e.jsx("span",{className:"ml-2",children:t.meta.clock}):null]})]}),e.jsx("div",{className:"min-w-0 sm:text-right",children:e.jsx(As,{team:L,align:"right",badgeSize:56})})]}),R?e.jsxs("div",{className:"relative mt-3 text-[11px] text-gray-500",children:["Vôlei: partidas em ",e.jsx("strong",{children:"um set de 15 pontos"})," (2 pontos de vantagem para vencer)."]}):null]}),e.jsxs("div",{className:"bg-white border rounded-2xl p-4 shadow-sm",children:[e.jsx("div",{className:"text-[11px] font-semibold text-gray-500 mb-2",children:"Detalhes"}),e.jsxs("ul",{className:"text-sm grid sm:grid-cols-2 gap-x-6 gap-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Modalidade:"})," ",e.jsx("span",{className:"font-medium",children:t?.sport?.name||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Fase:"})," ",e.jsx("span",{className:"font-medium",children:yt(t.stage)||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Grupo:"})," ",e.jsx("span",{className:"font-medium",children:t.group_name||"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Jogo nº:"})," ",e.jsx("span",{className:"font-medium",children:t.order_idx??"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Início:"})," ",e.jsx("span",{className:"font-medium",children:t.starts_at?Se(t.starts_at):"—"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"text-gray-500",children:"Local:"})," ",e.jsx("span",{className:"font-medium",children:t.venue||"—"})]}),t.updated_at&&e.jsxs("li",{className:"sm:col-span-2",children:[e.jsx("span",{className:"text-gray-500",children:"Última atualização:"})," ",e.jsx("span",{className:"font-medium",children:Se(t.updated_at)})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(ks,{title:`Convocação — ${M?.name||"A definir"}`,players:o}),e.jsx(ks,{title:`Convocação — ${L?.name||"A definir"}`,players:l})]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.status==="finished"&&t.updated_at?`Encerrado em ${Se(t.updated_at)}`:null}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% { transform: translateX(-100%); }
          50% { transform: translateX(200%); }
          100% { transform: translateX(-100%); }
        }
      `})]})}function Ts(){const s=me(),{user:t,setNeedsPasswordSetup:a}=ds(),[o,n]=c.useState(""),[l,i]=c.useState(""),[r,u]=c.useState(!1),[w,y]=c.useState(null),[k,C]=c.useState(null);c.useEffect(()=>{console.log("SetPassword mounted, user:",t)},[t]);const $=async T=>{if(T.preventDefault(),console.log("🔥 FORM SUBMITTED - START"),!r){if(u(!0),C(null),y(null),!o||o.length<8){C("A senha deve ter pelo menos 8 caracteres."),u(!1);return}if(o!==l){C("As senhas não coincidem."),u(!1);return}try{console.log("🚀 Starting password update...");const{error:N}=await h.auth.updateUser({password:o,data:{password_set:!0}});if(N){console.error("Password update error:",N),C(`Erro ao atualizar senha: ${N.message}`),u(!1);return}console.log("✅ Password updated successfully"),console.log("🔍 Checking if admin profile exists...");let R=!1,P=0;const B=5;for(;!R&&P<B;){P++,console.log(`Attempt ${P}/${B} to check profile...`);const{data:O,error:A}=await h.from("profiles").select("role").eq("user_id",t.id).single();!A&&O?.role==="admin"?(R=!0,console.log("✅ Admin profile found!")):(console.log("⏳ Profile not found yet, waiting..."),await new Promise(f=>setTimeout(f,1e3)))}if(!R){console.log("🔧 Creating profile manually as fallback...");const{error:O}=await h.from("profiles").insert({user_id:t.id,name:t.email.split("@")[0],role:"admin"});if(O&&!O.message.includes("duplicate key")){console.error("Manual profile creation error:",O),C("Erro ao criar perfil de administrador."),u(!1);return}}const{data:M,error:L}=await h.rpc("is_admin");console.log("🔍 Final admin check:",M,L),y("Senha definida e perfil configurado com sucesso!"),a(!1),setTimeout(()=>{console.log("🎯 Navigating to admin"),u(!1),s("/admin",{replace:!0})},1500)}catch(N){console.error("Unexpected error:",N),C(`Erro inesperado: ${N.message}`),u(!1)}}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"max-w-md w-full mx-auto bg-white p-6 rounded-lg shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Bem-vindo!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Defina sua senha para continuar"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["User ID: ",t?.id?.slice(0,8),"... | Email: ",t?.email]})]}),w&&e.jsx("p",{className:"mb-3 text-green-700 text-center",children:w}),k&&e.jsx("p",{className:"mb-3 text-red-700 text-center",children:k}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nova senha"}),e.jsx("input",{type:"password",placeholder:"Mínimo 8 caracteres",className:"w-full p-3 border border-gray-300 rounded-md",value:o,onChange:T=>n(T.target.value),required:!0,disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirme a senha"}),e.jsx("input",{type:"password",placeholder:"Digite a senha novamente",className:"w-full p-3 border border-gray-300 rounded-md",value:l,onChange:T=>i(T.target.value),required:!0,disabled:r})]}),e.jsx("button",{type:"submit",disabled:r,className:"w-full bg-blue-600 text-white py-3 rounded-md font-medium hover:bg-blue-700 disabled:opacity-50",children:r?"Configurando perfil...":"Definir senha"})]})]})})}function zr(){const s=me(),t=a=>{s(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Painel do Administrador"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecione uma área para gerenciar."})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("button",{onClick:()=>t("/admin/elencos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"👥"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Elencos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Criar time, editar elenco (jogadores) e logo."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]}),e.jsxs("button",{onClick:()=>t("/admin/campeonatos"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"🏆"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Campeonatos"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Configurar modalidades, grupos e fases."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]}),e.jsxs("button",{onClick:()=>t("/admin/partidas"),className:"group block rounded-xl border p-5 shadow-sm hover:shadow-md hover:border-primary/50 transition text-left w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 grid place-items-center rounded-lg bg-primary/10",children:e.jsx("span",{className:"text-2xl",children:"⏱️"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Partidas"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Iniciar/encerrar jogos e atualizar placar em tempo real."})]})]}),e.jsx("div",{className:"mt-3 text-primary text-sm font-medium group-hover:underline",children:"Abrir →"})]})]})]})}function Ur(){const s=me(),[t]=$t(),a=t.get("redirect")||"/",o=t.get("reason"),[n,l]=c.useState(""),[i,r]=c.useState(""),[u,w]=c.useState(!1),[y,k]=c.useState(null);c.useEffect(()=>{o==="forbidden"&&k("Faça login para acessar a página solicitada.")},[o]);async function C($){if($.preventDefault(),!u){w(!0),k(null);try{const{error:T}=await h.auth.signInWithPassword({email:n.trim(),password:i});if(T){k("Email ou senha incorretos."),w(!1);return}s(a,{replace:!0})}catch(T){console.error("Login error:",T),k("Erro inesperado durante o login."),w(!1)}}}return e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Login"}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Email"}),e.jsx("input",{type:"email",placeholder:"Email",className:"w-full p-2 border rounded",value:n,onChange:$=>l($.target.value),autoComplete:"email",required:!0})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Senha"}),e.jsx("input",{type:"password",placeholder:"Senha",className:"w-full p-2 border rounded",value:i,onChange:$=>r($.target.value),autoComplete:"current-password",required:!0})]}),y&&e.jsx("p",{className:"text-red-600 text-sm",children:y}),e.jsx("button",{type:"submit",disabled:u,className:"w-full bg-blue-600 text-white py-2 rounded disabled:opacity-50 hover:bg-blue-700 transition-colors",children:u?"Entrando...":"Entrar"})]})]})}const Te="team-logos",Ps=5,Ze=["image/png","image/jpeg","image/webp"],Jr=["oitavas","quartas","semi","final","3lugar"];function Hr(){const[s,t]=c.useState([]),[a,o]=c.useState({}),[n,l]=c.useState([]),[i,r]=c.useState(!1),[u,w]=c.useState({name:"",sport_id:""}),[y,k]=c.useState(null),[C,$]=c.useState([]),[T,N]=c.useState(0),[R,P]=c.useState([]),[B,M]=c.useState({}),[L,O]=c.useState({}),A=async()=>{const{data:j}=await h.from("sports").select("id,name").order("name");t(j||[]);const G={};(j||[]).forEach(V=>G[V.id]=V.name),o(G),!u.sport_id&&j?.length&&w(V=>({...V,sport_id:j[0].id}))},f=async()=>{let j=h.from("teams").select("id,name,group_name,sport_id,logo_url").order("name");R.length>0&&(j=j.in("sport_id",R));const{data:G}=await j;l(G||[]);const V=(G||[]).map(H=>H.id);V.length?await Promise.all([p(V),b(G)]):(M({}),O({}))},p=async j=>{if(!j?.length)return;const{data:G}=await h.from("players").select("id, team_id").in("team_id",j),V={};(G||[]).forEach(H=>{V[H.team_id]=(V[H.team_id]||0)+1}),j.forEach(H=>{H in V||(V[H]=0)}),M(V)},b=async j=>{const G=Array.from(new Set((j||[]).map(Z=>Z.sport_id)));if(G.length===0){O({});return}const{data:V}=await h.from("matches").select("sport_id, stage, home_team_id, away_team_id").in("sport_id",G).in("stage",Jr),H={};(V||[]).forEach(Z=>{Z.home_team_id&&Z.away_team_id&&(H[Z.sport_id]=!0)}),G.forEach(Z=>{Z in H||(H[Z]=!1)}),O(H)},_=async j=>{const{data:G}=await h.from("players").select("id,name,number").eq("team_id",j).order("name");$(G||[]),M(V=>({...V,[j]:(G||[]).length}))};c.useEffect(()=>{A()},[]),c.useEffect(()=>{f()},[R]);const F=j=>{const{data:G}=h.storage.from(Te).getPublicUrl(j);return G?.publicUrl||""},d=j=>{if(!j)return null;const G=j.indexOf(`/storage/v1/object/public/${Te}/`);return G===-1?null:j.substring(G+`/storage/v1/object/public/${Te}/`.length)},m=async j=>{if(j.preventDefault(),!u.name||!u.sport_id)return;r(!0);const{error:G}=await h.from("teams").insert({name:u.name.trim(),sport_id:u.sport_id});r(!1),G?alert("Erro ao criar time: "+G.message):(w({name:"",sport_id:u.sport_id}),f())},E=async j=>{if(confirm(`⚠️ Atenção!

Se você remover o time "${j.name}", TODO o campeonato da modalidade será resetado e o histórico de jogos será apagado.

Deseja realmente continuar?`)){r(!0);try{const V=d(j.logo_url);V&&await h.storage.from(Te).remove([V]).catch(()=>{});const{error:H}=await h.rpc("reset_sport",{p_sport_id:j.sport_id});if(H)throw H;const{error:Z}=await h.from("teams").delete().eq("id",j.id);if(Z)throw Z;y?.id===j.id&&(k(null),$([])),await f(),alert(`Time "${j.name}" removido.

O campeonato da modalidade foi resetado. Configure novamente os grupos e partidas antes de prosseguir.`)}catch(V){alert("Erro ao remover: "+V.message)}finally{r(!1)}}},g=async j=>{if(!y?.id||!j)return;r(!0);const{error:G}=await h.from("players").insert({team_id:y.id,name:j.trim()});r(!1),G?alert("Erro ao adicionar jogador: "+G.message):_(y.id)},v=async j=>{if(!y?.id)return;r(!0);const{error:G}=await h.from("players").delete().eq("id",j);r(!1),G?alert("Erro ao remover jogador: "+G.message):_(y.id)},I=async(j,G)=>{if(!(!j?.id||!G)){if(!Ze.includes(G.type)){alert("Formato inválido. Use PNG, JPG ou WEBP.");return}if(G.size>Ps*1024*1024){alert(`Arquivo grande demais. Máximo ${Ps} MB.`);return}r(!0);try{const V=G.type==="image/png"?"png":G.type==="image/webp"?"webp":"jpg",H=`teams/${j.id}.${V}`,{error:Z}=await h.storage.from(Te).upload(H,G,{upsert:!0,cacheControl:"3600",contentType:G.type});if(Z)throw Z;const ne=F(H),{error:he}=await h.from("teams").update({logo_url:ne}).eq("id",j.id);if(he)throw he;if(await f(),y?.id===j.id){const ie=(await h.from("teams").select("id,name,logo_url").eq("id",j.id).maybeSingle()).data;ie&&k(ze=>({...ze,...ie}))}N(ie=>ie+1)}catch(V){alert("Erro ao enviar logo: "+V.message)}finally{r(!1)}}},S=R.length===0||R.length===s.length,q=()=>{P(j=>S?[]:s.map(G=>G.id))},U=e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{onClick:q,className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${S?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:"Todos"}),s.map(j=>{const G=R.length===0?!0:R.includes(j.id);return e.jsx("button",{onClick:()=>P(V=>V.length===0?[j.id]:V.includes(j.id)?V.filter(H=>H!==j.id):[...V,j.id]),className:`px-3 py-2 rounded-lg border text-sm font-medium transition-colors ${G?"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"}`,children:j.name},j.id)})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold",children:"Elencos"}),U,y&&e.jsxs("section",{className:"rounded-lg border bg-white shadow-sm",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fs,{src:y.logo_url,alt:y.name,size:40,version:T}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:y.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a[y.sport_id]," • ",C.length," jogadores"]})]})]}),e.jsx("button",{onClick:()=>{k(null),$([])},className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-200 rounded-lg transition-colors",title:"Fechar",children:"✕"})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 cursor-pointer text-sm font-medium transition-colors",children:["📷 Atualizar Logo",e.jsx("input",{type:"file",accept:Ze.join(","),className:"hidden",onChange:j=>{const G=j.target.files?.[0];G&&I(y,G),j.target.value=""},disabled:i})]})}),e.jsx(Kr,{disabled:i,onAdd:g}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Jogadores"}),C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:"Nenhum jogador no elenco"}),e.jsx("p",{className:"text-xs mt-1",children:"Adicione jogadores usando o formulário acima"})]}):e.jsx("div",{className:"grid gap-2",children:C.map(j=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-gray-50",children:[e.jsx("span",{className:"font-medium",children:j.name}),e.jsx("button",{className:"px-3 py-1 text-sm rounded-lg border border-red-300 text-red-600 hover:bg-red-50 transition-colors",onClick:()=>v(j.id),disabled:i,children:"Remover"})]},j.id))})]})]})]}),e.jsxs("section",{className:"rounded-lg border bg-white shadow-sm",children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsx("h3",{className:"font-semibold text-lg",children:"Novo Time"})}),e.jsxs("form",{onSubmit:m,className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome do time"}),e.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:u.name,onChange:j=>w(G=>({...G,name:j.target.value})),placeholder:"Ex.: A1 — Águias",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Esporte"}),e.jsx("select",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:u.sport_id,onChange:j=>w(G=>({...G,sport_id:j.target.value})),children:s.map(j=>e.jsx("option",{value:j.id,children:j.name},j.id))})]})]}),e.jsx("button",{type:"submit",disabled:i,className:"w-full bg-blue-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:i?"Salvando…":"Criar Time"})]})]}),e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Times Cadastrados (",n.length,")"]}),n.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 border rounded-lg",children:[e.jsx("p",{className:"text-sm",children:"Nenhum time cadastrado"}),e.jsx("p",{className:"text-xs mt-1",children:"Crie seu primeiro time usando o formulário acima"})]}):e.jsx("div",{className:"grid gap-3",children:n.map(j=>{const G=a[j.sport_id]||"—",V=B[j.id]??0,H=V>0,Z=!!L[j.sport_id],ne=j.group_name?`Grupo ${j.group_name}`:Z?"Sem grupo (não aplicável)":"Sem grupo";return e.jsx("div",{className:"border rounded-lg bg-white shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx(Fs,{src:j.logo_url,alt:j.name,size:48,version:T}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-lg truncate",children:j.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-blue-100 text-blue-800 text-xs font-medium",children:G}),e.jsxs("span",{className:"text-sm text-gray-600",children:["• ",ne]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[Z&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-800 text-xs font-medium",children:"Chaveamento configurado"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Elenco: "," ",e.jsxs("span",{className:H?"text-gray-900 font-medium":"text-red-600 font-medium",children:[V," ",V===1?"jogador":"jogadores"]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("label",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-gray-300 hover:bg-gray-50 cursor-pointer text-sm font-medium transition-colors",children:["📷 Logo",e.jsx("input",{type:"file",accept:Ze.join(","),className:"hidden",onChange:he=>{const ie=he.target.files?.[0];ie&&I(j,ie),he.target.value=""},disabled:i})]}),e.jsx("button",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-blue-300 text-blue-600 hover:bg-blue-50 font-medium transition-colors text-sm",onClick:()=>{k(j),_(j.id),window.scrollTo({top:0,behavior:"smooth"})},children:"👥 Elenco"}),e.jsx("button",{className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg border border-red-300 text-red-600 hover:bg-red-50 font-medium transition-colors text-sm",onClick:()=>E(j),disabled:i,children:"🗑️ Remover"})]})]})},j.id)})})]})]})}function Kr({disabled:s,onAdd:t}){const[a,o]=c.useState("");return e.jsxs("form",{onSubmit:n=>{n.preventDefault(),t(a),o("")},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Adicionar Jogador"}),e.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nome do jogador",value:a,onChange:n=>o(n.target.value),required:!0})]}),e.jsx("button",{type:"submit",disabled:s,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg font-medium hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?"Adicionando...":"Adicionar Jogador"})]})}function Xr(s){if(!s)return"?";const t=s.trim().split(" ");return t.length===1?t[0][0]?.toUpperCase():(t[0][0]+t[t.length-1][0]).toUpperCase()}function Zr(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function Fs({src:s,alt:t,size:a=32,version:o=0}){const[n,l]=c.useState(!1),i=c.useMemo(()=>{if(!s)return null;const r=s.includes("?")?"&":"?";return`${s}${r}v=${o}`},[s,o]);return e.jsxs("div",{className:"relative rounded-lg overflow-hidden border border-gray-200 bg-white flex items-center justify-center flex-shrink-0",style:{width:a,height:a},children:[i?e.jsx("img",{src:i,alt:t||"logo",className:`w-full h-full object-cover ${n?"opacity-100":"opacity-0"} transition-opacity duration-200`,loading:"lazy",onLoad:()=>l(!0),onError:()=>l(!1)}):null,!i||!n?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-white font-bold uppercase",style:{backgroundColor:Zr(t||"T"),fontSize:a*.35},children:Xr(t)}):null]})}const Rs={scheduled:"Agendado",ongoing:"Em andamento",paused:"Pausado",finished:"Encerrado"},Ms={ongoing:1,paused:2,scheduled:3,finished:4},Qr="team-logos",bt=s=>typeof s=="string"&&/^https?:\/\//i.test(s),Yr=s=>typeof s=="string"&&!bt(s)&&s.trim()!=="",qs=s=>{if(!s)return null;if(bt(s))return s;if(Yr(s)){const{data:t}=h.storage.from(Qr).getPublicUrl(s);return t?.publicUrl||null}return null},De=(s="")=>s.toString().trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase();function Wr(s,t){if(!s||s.status==="scheduled"||s.status==="finished")return"0:00";const a=s.starts_at?new Date(s.starts_at):new Date,n=(s.status==="paused"?new Date(s.updated_at):new Date(t||Date.now()))-a;if(!Number.isFinite(n)||n<0)return"0:00";const l=Math.floor(n/1e3),i=Math.floor(l/60),r=l%60;return`${i}:${r.toString().padStart(2,"0")}`}function en({status:s}){if(s!=="ongoing"&&s!=="paused")return null;const t=s==="ongoing",a=t?"bg-blue-500":"bg-orange-500",o=t?"bg-blue-100":"bg-orange-100";return e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${o} overflow-hidden rounded-t-lg`,children:e.jsx("div",{className:`h-full ${a}`,style:{animation:t?"slideProgress 3s ease-in-out infinite":"none",width:"100%"}})})}const _e=s=>Number.isFinite(Number(s?.order_idx))?Number(s.order_idx):Number.isFinite(Number(s?.round))?Number(s.round):Number(s?.id??Number.MAX_SAFE_INTEGER),sn=s=>s.status==="scheduled"&&!!(s.home?.id&&s.away?.id);function tn(){const[s,t]=c.useState([]),[a,o]=c.useState([]),[n,l]=c.useState(null),[i,r]=c.useState(null),[u,w]=c.useState(!0),[y,k]=c.useState({}),[C,$]=c.useState(null),[T,N]=c.useState(null),[R,P]=c.useState(Date.now()),[B,M]=c.useState(typeof navigator<"u"?navigator.onLine:!0),[L,O]=c.useState(!1),[A,f]=c.useState(null),p=c.useRef(null),b=c.useRef(!0),_=c.useRef(null);c.useEffect(()=>{if(!T)return;const x=setTimeout(()=>N(null),8e3);return()=>clearTimeout(x)},[T]),c.useEffect(()=>{const x=()=>M(!0),z=()=>M(!1);return window.addEventListener("online",x),window.addEventListener("offline",z),()=>{window.removeEventListener("online",x),window.removeEventListener("offline",z)}},[]);const F=(x,z)=>k(D=>({...D,[x]:z})),d=async()=>{const{data:x,error:z}=await h.auth.getSession();return z?(console.error("getSession error:",z),N(z.message||"Falha ao obter sessão de usuário."),null):x?.session||null},m=async()=>{try{await h.auth.getUser();const{data:x,error:z}=await h.rpc("is_admin");if(z)throw z;$(!!x)}catch(x){console.error("is_admin() error:",x),$(!1)}},E=async()=>{const{data:x,error:z}=await h.from("sports").select("name").order("name");if(z){console.error("loadSports error:",z);return}const D=Array.from(new Set((x||[]).map(J=>J.name).filter(Boolean)));o(D.map(J=>({key:De(J),name:J})))},g=async({showSkeleton:x=!1}={})=>{if(b.current){x&&w(!0);try{let z=h.from("matches").select(`
          id, stage, round, group_name, order_idx, starts_at, venue, created_at, updated_at,
          status, home_score, away_score, meta,
          sport_id,
          home_team_id, away_team_id,
          sport:sport_id ( name ),
          home:home_team_id ( id, name, logo_url, color ),
          away:away_team_id ( id, name, logo_url, color )
        `);i&&(z=z.eq("status",i)),z=z.or(["group_name.not.is.null","stage.eq.r32","and(home_team_id.not.is.null,away_team_id.not.is.null)"].join(","));const{data:D,error:J}=await z;if(J)console.error("loadMatches error:",J),b.current&&N(J.message||"Falha ao carregar partidas.");else{let Q=(D||[]).map(K=>{const Y=K.home&&typeof K.home=="object"?{...K.home,logo_url:(()=>{const oe=qs(K.home.logo_url);return oe?`${oe}${oe.includes("?")?"&":"?"}v=1`:null})()}:K.home,le=K.away&&typeof K.away=="object"?{...K.away,logo_url:(()=>{const oe=qs(K.away.logo_url);return oe?`${oe}${oe.includes("?")?"&":"?"}v=1`:null})()}:K.away,pe=K?.sport?.name||"";return{...K,home:Y,away:le,_sportKey:De(pe)}});n&&(Q=Q.filter(K=>K._sportKey===n));const W=Q.sort((K,Y)=>{const le=Ms[K.status]||999,pe=Ms[Y.status]||999;return le!==pe?le-pe:_e(K)-_e(Y)});b.current&&t(W)}}finally{b.current&&x&&w(!1)}}};c.useEffect(()=>{b.current=!0,(async()=>{await d(),await m(),await E(),await g({showSkeleton:!0})})(),_.current=setInterval(()=>{b.current&&P(Date.now())},1e3);const{data:z}=h.auth.onAuthStateChange(async(D,J)=>{b.current&&($(null),await m(),J?(await E(),await g({showSkeleton:!0})):t([]))});return()=>{b.current=!1,_.current&&clearInterval(_.current),z?.subscription?.unsubscribe?.(),p.current&&(h.removeChannel(p.current),p.current=null)}},[]),c.useEffect(()=>{if(!b.current)return;g({showSkeleton:!1}),p.current&&(h.removeChannel(p.current),p.current=null);const x=h.channel("admin-matches").on("postgres_changes",{event:"*",schema:"public",table:"matches"},()=>{setTimeout(()=>{b.current&&g({showSkeleton:!1})},200)}).subscribe();return p.current=x,()=>{p.current&&(h.removeChannel(p.current),p.current=null)}},[n,i]);const v=c.useMemo(()=>{const x=new Map;for(const D of s){const J=D?.sport_id?String(D.sport_id):"unknown";x.has(J)||x.set(J,[]),x.get(J).push(D)}const z=new Set;for(const[D,J]of x.entries()){if(D==="unknown"||J.some(K=>K.status==="ongoing"||K.status==="paused"))continue;const W=J.filter(sn);W.length&&(W.sort((K,Y)=>_e(K)-_e(Y)),z.add(W[0].id))}return z},[s]),I=async(x,z)=>{F(x,!0),N(null);const D=s;t(J=>J.map(Q=>Q.id===x?{...Q,...z}:Q));try{const{error:J}=await h.from("matches").update(z).eq("id",x);if(J)throw new Error(`Falha ao atualizar: ${J.message}`);return setTimeout(()=>{b.current&&g({showSkeleton:!1})},600),!0}catch(J){return t(D),N(J.message||"Erro ao atualizar partida."),!1}finally{F(x,!1)}},S=async(x,z,D)=>{if(x.status==="scheduled")return;const Q=De(x?.sport?.name||"").includes("volei"),W=x.meta||{},K=Q?`${z}_points_set`:`${z}_score`;let Y=Math.max(0,Number((Q?W[K]:x[K])||0));D==="inc"&&(Y+=1),D==="dec"&&(Y=Math.max(0,Y-1)),D==="reset"&&(Y=0),Q?await I(x.id,{meta:{...W,[K]:Y}}):await I(x.id,{[K]:Y})},q=(x,z)=>Math.max(0,Number(x?.meta?.[`${z}_points_set`]||0)),U=(x,z)=>{const D=x.meta||{};return Math.max(0,Number(D[z==="home"?"home_sets":"away_sets"]||0))},j=x=>{const z=Number(x?.meta?.rules?.points_to_win_set??15),D=Number(x?.meta?.rules?.win_by??2),J=q(x,"home"),Q=q(x,"away"),W=Math.max(J,Q),K=Math.abs(J-Q);return W>=z&&K>=D},G=async(x,{force:z=!1}={})=>{if(x.status==="scheduled")return;const D=x.meta||{},J=q(x,"home"),Q=q(x,"away"),W=Array.isArray(D.sets)?D.sets:[];if(!z&&!j(x)){N("Para finalizar o set: mínimo 15 pontos e 2 de vantagem (ajustável em meta.rules). Clique novamente para forçar.");return}const K=J>Q?!0:Q>J?!1:null,Y={...D,sets:[...W,{h:J,a:Q,at:new Date().toISOString()}],home_sets:U(x,"home")+(K===!0?1:0),away_sets:U(x,"away")+(K===!1?1:0),home_points_set:0,away_points_set:0};await I(x.id,{meta:Y,home_score:Math.max(0,Number(x.home_score||0))+J,away_score:Math.max(0,Number(x.away_score||0))+Q,updated_at:new Date().toISOString()})},V=async(x,z,D)=>{if(x.status==="scheduled")return;const J=x.meta||{},Q=z==="home"?"home_sets":"away_sets";let W=Math.max(0,Number(J[Q]||0));D==="inc"&&(W+=1),D==="dec"&&(W=Math.max(0,W-1)),D==="reset"&&(W=0),await I(x.id,{meta:{...J,[Q]:W}})},H=async(x,z)=>{const D=new Date().toISOString(),J={status:z,updated_at:D};return z==="ongoing"&&x.status==="scheduled"&&!x.starts_at&&(J.starts_at=D),await I(x.id,J)},Z=async x=>{const z=q(x,"home"),D=q(x,"away");if(z>0||D>0){const J=x.meta||{};await I(x.id,{meta:{...J,home_points_set:0,away_points_set:0},home_score:Math.max(0,Number(x.home_score||0))+z,away_score:Math.max(0,Number(x.away_score||0))+D})}return await H(x,"finished")},ne=async x=>{N(null);const z=x?.sport_id?String(x.sport_id):null;if(!z){N("Partida sem modalidade válida (sport_id ausente).");return}try{const{data:D,error:J}=await h.from("matches").select("id,status,group_name,order_idx,round,home_team_id,away_team_id,sport_id").eq("sport_id",z);if(J)throw J;if(!D)throw new Error("Falha ao validar ordem.");if(D.some(Y=>Y.status==="ongoing"||Y.status==="paused"))throw new Error("Já existe uma partida em andamento/pausada nesta modalidade. Encerre-a antes de iniciar outra.");const W=D.filter(Y=>Y.status==="scheduled"&&!!(Y.home_team_id&&Y.away_team_id));if(!W.length)throw new Error("Não há partidas elegíveis para iniciar.");if(W.sort((Y,le)=>_e(Y)-_e(le)),W[0].id!==x.id)throw new Error("Você só pode iniciar o próximo jogo da fila.");await H(x,"ongoing")}catch(D){console.error("tryStartMatch error:",D),N(D.message||"Não foi possível iniciar a partida (ordem restrita).")}},he=async x=>await ne(x),ie=async x=>await H(x,"paused"),ze=async x=>await H(x,"ongoing");return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Gerenciar Partidas"}),!B&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-2 rounded mb-4",children:"⚠️ Você está offline. As alterações serão sincronizadas quando a conexão for restaurada."}),C===!1&&e.jsxs("div",{className:"text-sm p-3 rounded bg-red-50 border border-red-200 text-red-700",children:["Você não está autenticado como ",e.jsx("strong",{children:"admin"}),". As ações podem ser bloqueadas."]}),T&&e.jsxs("div",{className:"text-sm p-3 rounded bg-yellow-50 border border-yellow-200 text-yellow-800 flex items-start gap-3",children:[e.jsx("div",{className:"flex-1 whitespace-pre-wrap",children:String(T)}),e.jsx("button",{onClick:()=>N(null),className:"text-xs px-2 py-1 rounded border border-yellow-300 hover:bg-yellow-100",children:"Fechar"})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Modalidade:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>l(null),className:`px-2 py-1 rounded text-xs ${n?"bg-gray-100 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:"Todas"}),a.map(x=>e.jsx("button",{onClick:()=>l(x.key),className:`px-2 py-1 rounded text-xs ${n===x.key?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:x.name},x.key))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>r(null),className:`px-2 py-1 rounded text-xs ${i?"bg-gray-100 hover:bg-gray-200":"bg-blue-600 text-white"}`,children:"Todos"}),Object.entries(Rs).map(([x,z])=>e.jsx("button",{onClick:()=>r(x),className:`px-2 py-1 rounded text-xs ${i===x?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-200"}`,children:z},x))]})]})]}),u?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((x,z)=>e.jsx("div",{className:"h-32 bg-gray-100 rounded animate-pulse"},z))}):s.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhuma partida encontrada."}):e.jsx("ul",{className:"space-y-4",children:s.map(x=>{const D=De(x?.sport?.name||"").includes("volei"),J=D?U(x,"home"):0,Q=D?U(x,"away"):0,W=D?q(x,"home"):null,K=D?q(x,"away"):null,Y=!x.group_name,le=!!(x.home?.id&&x.away?.id),pe=le,oe=x.status==="ongoing"||x.status==="paused",_t=oe?x.status==="ongoing"?"border-blue-200":"border-orange-200":"border-gray-200",Ue=v.has(x.id);return e.jsxs("li",{className:`border rounded-lg p-3 sm:p-4 flex flex-col gap-3 bg-white shadow-sm relative overflow-hidden ${_t}`,children:[e.jsx(en,{status:x.status}),e.jsxs("div",{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-500 flex flex-wrap items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-medium",children:x.sport?.name}),x.group_name&&e.jsxs("span",{children:["· Grupo ",x.group_name]}),x.stage&&e.jsxs("span",{children:["· ",x.stage==="semi"?"Semifinal":x.stage==="3lugar"?"3º lugar":x.stage==="r32"?"Pré-oitavas":x.stage]}),x.round&&e.jsxs("span",{children:["· J",x.round]}),oe&&e.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] font-medium text-gray-600",children:["🕐 ",Wr(x,R)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x.status==="scheduled"&&Ue&&e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded bg-indigo-100 text-indigo-700 uppercase tracking-wide",children:"Próximo na ordem"}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded self-start sm:self-auto ${x.status==="ongoing"?"bg-green-100 text-green-700":x.status==="paused"?"bg-yellow-100 text-yellow-700":x.status==="finished"?"bg-gray-200 text-gray-600":"bg-blue-100 text-blue-700"}`,children:Rs[x.status]||x.status})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-4",children:[e.jsx(Is,{align:"left",team:x.home,score:x.home_score,onInc:()=>S(x,"home","inc"),onDec:()=>S(x,"home","dec"),onReset:()=>S(x,"home","reset"),sets:D?J:null,setPoints:D?W:null,onSetInc:D&&L?()=>V(x,"home","inc"):void 0,onSetDec:D&&L?()=>V(x,"home","dec"):void 0,onSetReset:D&&L?()=>V(x,"home","reset"):void 0,disabled:y[x.id]||x.status==="scheduled"}),e.jsx(Is,{align:"right",team:x.away,score:x.away_score,onInc:()=>S(x,"away","inc"),onDec:()=>S(x,"away","dec"),onReset:()=>S(x,"away","reset"),sets:D?Q:null,setPoints:D?K:null,onSetInc:D&&L?()=>V(x,"away","inc"):void 0,onSetDec:D&&L?()=>V(x,"away","dec"):void 0,onSetReset:D&&L?()=>V(x,"away","reset"):void 0,disabled:y[x.id]||x.status==="scheduled"})]}),D&&e.jsx("button",{onClick:()=>O(fe=>!fe),className:"text-[10px] px-2 py-0.5 rounded border border-gray-300 hover:bg-gray-50 self-start",children:L?"Fechar edição de sets":"Editar sets manualmente"}),D&&(W>0||K>0)&&e.jsx("button",{onClick:async()=>{if(A===x.id){const fe=j(x);f(null),await G(x,{force:!fe})}else f(x.id),setTimeout(()=>f(fe=>fe===x.id?null:fe),3e3)},disabled:y[x.id]||x.status==="scheduled",className:`px-3 py-1 text-xs rounded ${A===x.id?"bg-red-600":"bg-purple-600"} text-white hover:opacity-90 disabled:opacity-50`,title:"Soma os pontos do set aos totais (PF/PA) e incrementa o set do vencedor.",children:A===x.id?"Confirmar finalizar set":"Finalizar set"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[x.status==="scheduled"&&e.jsx("button",{onClick:()=>he(x),disabled:y[x.id]||!pe||!Ue,className:"px-3 py-1 text-xs rounded bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",title:pe?Ue?"Iniciar próximo jogo da ordem.":"Aguarde: apenas o próximo jogo da ordem pode iniciar.":"Defina as duas equipes antes de iniciar.",children:"Iniciar"}),x.status==="ongoing"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ie(x),disabled:y[x.id],className:"px-3 py-1 text-xs rounded bg-yellow-500 text-white hover:bg-yellow-600 disabled:opacity-50",children:"Pausar"}),e.jsx("button",{onClick:()=>Z(x),disabled:y[x.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),x.status==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ze(x),disabled:y[x.id],className:"px-3 py-1 text-xs rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:"Retomar"}),e.jsx("button",{onClick:()=>Z(x),disabled:y[x.id],className:"px-3 py-1 text-xs rounded bg-red-600 text-white hover:bg-red-700 disabled:opacity-50",children:"Encerrar"})]}),x.status==="finished"&&e.jsx("span",{className:"text-xs text-gray-500 self-center",children:"Partida encerrada (resultado editável)."})]})]},x.id)})}),e.jsx("style",{jsx:!0,global:!0,children:`
        @keyframes slideProgress {
          0% {
            transform: translateX(-100%);
          }
          50% {
            transform: translateX(200%);
          }
          100% {
            transform: translateX(-100%);
          }
        }
      `})]})}function Is({team:s,score:t,onInc:a,onDec:o,onReset:n,sets:l,setPoints:i,onSetInc:r,onSetDec:u,onSetReset:w,disabled:y,align:k="left"}){const C=k==="right",$=typeof i=="number"?"Pontos do set":"Pontos",T=Number(typeof i=="number"?i||0:t||0),N=!!(r||u||w),R=({label:M,value:L})=>{const O=Number.isFinite(L)?L:"-";return e.jsxs("div",{className:"flex min-w-[70px] flex-col items-center justify-center rounded-lg border border-gray-200 bg-white px-2.5 py-1 shadow-inner",children:[e.jsx("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:M}),e.jsx("span",{className:"text-lg font-bold leading-none text-gray-900 tabular-nums",children:O})]})},P=C?"justify-end":"justify-start",B=C?"text-right":"text-left";return e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-gray-50/80 p-3 shadow-sm space-y-4",children:[e.jsxs("div",{className:`flex flex-wrap items-center justify-between gap-3 ${C?"flex-row-reverse":""}`,children:[e.jsxs("div",{className:`flex min-w-0 items-center gap-2 ${C?"flex-row-reverse text-right":""}`,children:[e.jsx(se,{team:s||{name:"A definir"},size:28}),e.jsx("span",{className:"text-sm font-medium truncate",children:s?.name||"A definir"})]}),e.jsxs("div",{className:`flex items-center gap-2 ${C?"flex-row-reverse":""}`,children:[typeof l=="number"?e.jsx(R,{label:"Sets",value:Number(l||0)}):null,e.jsx(R,{label:$,value:T})]})]}),typeof l=="number"?e.jsxs("div",{className:`space-y-2 ${B}`,children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:"Controle de sets"}),e.jsxs("div",{className:`flex flex-wrap gap-2 ${P}`,children:[e.jsx("button",{type:"button",onClick:u,disabled:y||!N,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"-"}),e.jsx("button",{type:"button",onClick:r,disabled:y||!N,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"+"}),e.jsx("button",{type:"button",onClick:w,disabled:y||!N,className:"flex items-center justify-center rounded-lg bg-red-500 px-3 py-1 text-xs font-semibold text-white transition hover:bg-red-600 disabled:opacity-40",title:"Zerar sets",children:"Zerar"})]})]}):null,e.jsxs("div",{className:`space-y-2 ${B}`,children:[e.jsx("span",{className:"text-[11px] font-semibold uppercase tracking-wide text-gray-500",children:$}),e.jsxs("div",{className:`flex flex-wrap gap-2 ${P}`,children:[e.jsx("button",{type:"button",onClick:o,disabled:y,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"-"}),e.jsx("button",{type:"button",onClick:a,disabled:y,className:"flex h-9 w-9 items-center justify-center rounded-lg border border-gray-300 text-base font-semibold text-gray-700 transition hover:bg-gray-100 disabled:opacity-40",children:"+"}),e.jsx("button",{type:"button",onClick:n,disabled:y,className:"flex items-center justify-center rounded-lg bg-red-500 px-3 py-1 text-xs font-semibold text-white transition hover:bg-red-600 disabled:opacity-40",title:typeof i=="number"?"Zerar pontos do set":"Zerar pontos",children:"Zerar"})]})]})]})}const xe={pebolim:{name:"Pebolim",required:24,path:"/admin/campeonatos/pebolim",variant:"1v3_1v2_3v2"},fifa:{name:"FIFA",required:32,path:"/admin/campeonatos/fifa"},futsal:{name:"Futsal",required:9,path:"/admin/campeonatos/futsal",variant:"1v3_1v2_3v2"},volei:{name:"Vôlei",required:9,path:"/admin/campeonatos/volei",variant:"1v2_1v3_2v3"}},an={Pebolim:"pebolim",FIFA:"fifa",Futsal:"futsal",Volei:"volei",Vôlei:"volei"},rn=(s="")=>s.trim().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase(),Gs=({children:s,tone:t="gray"})=>e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium border ${t==="green"?"bg-green-50 text-green-700 border-green-200":t==="amber"?"bg-amber-50 text-amber-700 border-amber-200":t==="red"?"bg-red-50 text-red-700 border-red-200":t==="blue"?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:s}),Os=({children:s,className:t=""})=>e.jsx("div",{className:`rounded-2xl border border-gray-200 bg-white shadow-sm ${t}`,children:s}),nn=({title:s,subtitle:t,right:a})=>e.jsxs("div",{className:"flex items-start justify-between gap-3 p-4 sm:p-5",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold leading-tight",children:s}),t&&e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t})]}),a]}),Qe=({children:s,className:t="",...a})=>e.jsx("button",{className:`inline-flex w-full items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-gray-200 disabled:text-gray-500 ${t}`,...a,children:s}),Ne=({children:s,className:t="",...a})=>e.jsx("button",{className:`inline-flex w-full items-center justify-center gap-2 rounded-xl border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60 ${t}`,...a,children:s});function on(){const s=me(),[t,a]=c.useState(!0),[o,n]=c.useState(null),[l,i]=c.useState([]),[r,u]=c.useState({}),[w,y]=c.useState({}),[k,C]=c.useState(null),[$,T]=c.useState(null),N=async()=>{a(!0),n(null);try{const{data:p,error:b}=await h.from("sports").select("id,name").order("name",{ascending:!0});if(b)throw b;const _=p.map(d=>({id:d.id,name:d.name,key:an[d.name?.trim()]||rn(d.name)}));i(_);const F=await Promise.all(_.map(async d=>{const[m,E,g,v]=await Promise.all([h.from("teams").select("id",{count:"exact",head:!0}).eq("sport_id",d.id),h.from("teams").select("id, name, group_name, seed_in_group").eq("sport_id",d.id).not("group_name","is",null),h.from("matches").select("id",{count:"exact",head:!0}).eq("sport_id",d.id),h.from("standings").select("id",{count:"exact",head:!0}).eq("sport_id",d.id)]),I=m?.count??0,S=g?.count??0,q=v?.count??0,U=ln(E?.data||[]),{data:j}=await h.from("v_queue_slots").select("slot, order_idx, match_id, stage, group_name").eq("sport_id",d.id);let G={};const V=(j||[]).map(H=>H.match_id).filter(Boolean);if(V.length){const{data:H}=await h.from("match_detail_view").select("id, home_team_name, away_team_name").in("id",V);G=Object.fromEntries((H||[]).map(Z=>[Z.id,Z]))}return[d.key,{sportId:d.id,sportName:d.name,teamCount:I,groupsMeta:U,matchesCount:S,standingsCount:q,hasAny:(S||q||U.total||0)>0,queueSlots:j||[],queueDetails:G}]}));u(Object.fromEntries(F))}catch(p){n(`Falha ao carregar: ${p.message||p}`)}finally{a(!1)}};c.useEffect(()=>{N();const p=h.channel("tournaments-queue").on("postgres_changes",{event:"*",schema:"public",table:"matches"},N).subscribe();return()=>h.removeChannel(p)},[]);const R=p=>{const b=r[p];if(!b)return!1;if(p==="fifa")return b.teamCount===xe.fifa.required;const _=p==="pebolim"?8:3,F=Object.values(b.groupsMeta.byGroup||{}),d=F.length===_&&F.every(E=>E.members.length===3),m=F.every(E=>dn(E.members.map(g=>g.seed_in_group),[1,2,3]));return d&&m},P=(p,b)=>y(_=>({..._,[p]:b})),B=p=>T({key:p,name:xe[p].name}),M=async p=>{const b=r[p];if(!b)return;const _=b.sportId;P(p,!0),n(null),T(null);try{const{data:F}=await h.from("matches").select("id").eq("sport_id",_),d=(F||[]).map(m=>m.id);if(d.length&&await h.from("match_events").delete().in("match_id",d),await h.from("matches").delete().eq("sport_id",_),await h.from("standings").delete().eq("sport_id",_),p==="fifa"){const{error:m}=await h.rpc("admin_generate_fifa_oitavas32",{p_sport_id:_});if(m)throw m}else{const m=xe[p]?.variant||"1v3_1v2_3v2",{error:E}=await h.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:_,p_variant:m});if(E)throw E}n(`Campeonato de ${xe[p].name} gerado com sucesso (ordem fixa).`),await N()}catch(F){n(`Falha ao gerar partidas: ${F.message||F}`)}finally{P(p,!1)}},L=p=>C({key:p,name:xe[p].name}),O=async p=>{const b=r[p];if(b){P(p,!0);try{const{data:_}=await h.from("matches").select("id").eq("sport_id",b.sportId),F=(_||[]).map(d=>d.id);F.length&&await h.from("match_events").delete().in("match_id",F),await h.from("matches").delete().eq("sport_id",b.sportId),await h.from("standings").delete().eq("sport_id",b.sportId),await h.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",b.sportId),n(`Campeonato de ${xe[p].name} foi reiniciado.`),C(null),await N()}catch(_){n(`Falha ao reiniciar: ${_.message||_}`)}finally{P(p,!1)}}},A=async p=>{await h.rpc("admin_start_first_if_idle",{p_sport_id:p})},f=async p=>{await h.rpc("admin_finish_live_and_start_next",{p_sport_id:p})};return e.jsxs("div",{className:"mx-auto max-w-6xl px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zs,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Gerenciar Campeonatos"})]}),e.jsxs("p",{className:"mt-1 text-sm text-gray-600",children:["Configure grupos, gere as partidas na ordem definida e opere os cartões: ",e.jsx("strong",{children:"Ao vivo"}),", ",e.jsx("strong",{children:"⚠️ Compareçam"})," e ",e.jsx("strong",{children:"Próximo jogo"}),"."]})]}),o&&e.jsx("div",{className:"mb-4 rounded-xl border border-blue-200 bg-blue-50 px-3 py-2 text-sm text-blue-800",children:o}),t?e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:Array.from({length:4}).map((p,b)=>e.jsxs(Os,{className:"p-4",children:[e.jsx("div",{className:"h-6 w-32 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"mt-3 h-4 w-56 animate-pulse rounded bg-gray-100"}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"h-9 animate-pulse rounded bg-gray-100"}),e.jsx("div",{className:"h-9 animate-pulse rounded bg-gray-100"})]})]},b))}):e.jsx("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2",children:l.map(p=>{const b=p.key,_=xe[b];if(!_)return null;const F=r[b]||{},d=F.teamCount===_.required,m=!!F.hasAny,E=R(b);return e.jsxs(Os,{children:[e.jsx(nn,{title:_.name,subtitle:`Times: ${F.teamCount??0} / ${_.required}`,right:m?e.jsx(Gs,{tone:"amber",children:"Existe"}):e.jsx(Gs,{tone:d?"green":"gray",children:d?"Pronto":"Aguardando times"})}),e.jsx("div",{className:"px-4 sm:px-5",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Qt,{className:"h-4 w-4"})," Partidas: ",e.jsx("strong",{className:"ml-1",children:F.matchesCount??0})]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(ps,{className:"h-4 w-4"})," Grupos definidos: ",e.jsx("strong",{className:"ml-1",children:F.groupsMeta.countGroups||0})]}),b!=="fifa"&&e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(la,{className:"h-4 w-4"})," Seeds válidos: ",e.jsx("strong",{className:"ml-1",children:F.groupsMeta.seedsOk?"Sim":"Não"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-4 sm:grid-cols-2 sm:p-5",children:[e.jsxs(Qe,{disabled:!d||m,onClick:()=>s(_.path),children:[e.jsx(ps,{className:"h-4 w-4"})," Configurar & Agrupar"]}),e.jsxs(Ne,{className:"text-red-600 border-red-600 hover:bg-red-50",disabled:w[b]||b!=="fifa"&&!E,onClick:()=>B(b),children:[w[b]?e.jsx(Wt,{className:"h-4 w-4 animate-spin"}):e.jsx(na,{className:"h-4 w-4"}),"Gerar Partidas (ordem fixa)"]}),m&&e.jsxs(Ne,{onClick:()=>A(F.sportId),children:[e.jsx(Ks,{className:"h-4 w-4"})," Iniciar primeiro (se parado)"]}),m&&e.jsxs(Ne,{onClick:()=>f(F.sportId),children:[e.jsx(Xt,{className:"h-4 w-4"})," Finalizar ao vivo e iniciar próximo"]}),e.jsxs(Ne,{className:"sm:col-span-2",onClick:()=>L(b),disabled:!m,children:[e.jsx(da,{className:"h-4 w-4"})," Apagar & Reiniciar"]})]}),e.jsx("div",{className:"px-4 pb-4 sm:px-5 sm:pb-5",children:e.jsx("div",{className:"rounded-xl border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 divide-y sm:grid-cols-3 sm:divide-x sm:divide-y-0",children:[Ye(F,"live"),Ye(F,"call"),Ye(F,"next")]})})})]},b)})}),k&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>C(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Reiniciar ",k.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Isso apagará ",e.jsx("strong",{children:"todas"})," as partidas, eventos e a classificação, e limpará os grupos."]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-2",children:[e.jsx(Ne,{onClick:()=>C(null),children:"Cancelar"}),e.jsx(Qe,{onClick:()=>O(k.key),children:"Confirmar"})]})]})]}),$&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>T(null)}),e.jsxs("div",{className:"relative z-10 w-full max-w-md rounded-2xl bg-white p-5 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Gerar Partidas para ",$.name,"?"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Isso apagará ",e.jsx("strong",{children:"todas"})," as partidas, eventos e a classificação, e limpará os grupos antes de gerar novas partidas."]}),e.jsxs("div",{className:"mt-5 grid grid-cols-2 gap-2",children:[e.jsx(Ne,{onClick:()=>T(null),children:"Cancelar"}),e.jsx(Qe,{onClick:()=>M($.key),children:"Confirmar"})]})]})]})]})}function ln(s){const t={};for(const l of s)t[l.group_name]||(t[l.group_name]={members:[]}),t[l.group_name].members.push({id:l.id,name:l.name,seed_in_group:l.seed_in_group});const a=Object.keys(t).sort(cn),o=a.length;let n=!0;for(const l of a){const i=new Set(t[l].members.map(u=>u.seed_in_group));i.has(1)&&i.has(2)&&i.has(3)&&i.size===3||(n=!1)}return{byGroup:t,groups:a,countGroups:o,total:s.length,seedsOk:n}}function cn(s,t){const a=s&&s[s.length-1]||"z",o=t&&t[t.length-1]||"z";return a<o?-1:a>o?1:0}function dn(s=[],t=[]){const a=new Set(s),o=new Set(t);if(a.size!==o.size)return!1;for(const n of a)if(!o.has(n))return!1;return!0}function Ye(s,t){const a=t==="live"?"Ao vivo":t==="call"?"⚠️ Compareçam":"Próximo jogo",o=t==="live"?"bg-red-50 border-red-200":t==="call"?"bg-amber-50 border-amber-200":"bg-emerald-50 border-emerald-200",n=(s.queueSlots||[]).find(i=>i.slot===t),l=n?.match_id?s.queueDetails?.[n.match_id]:null;return e.jsx("div",{className:"p-3 sm:p-4",children:e.jsxs("div",{className:`rounded-xl border p-3 sm:p-4 ${o}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[e.jsx("span",{className:"font-medium",children:a}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Hs,{className:"h-3.5 w-3.5"}),"#",n?.order_idx??"–"]})]}),e.jsxs("div",{className:"mt-2 text-sm",children:[l?e.jsxs("div",{className:"font-medium text-gray-900",children:[l.home_team_name," ",e.jsx("span",{className:"text-gray-500",children:"x"})," ",l.away_team_name]}):e.jsx("div",{className:"text-gray-500",children:"Aguardando…"}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:[n?.stage?e.jsx("span",{className:"mr-2",children:n.stage}):null,n?.group_name?e.jsxs("span",{children:["Grupo ",n.group_name]}):null]})]})]})})}const ce=["A","B","C"],we=3;function mn(){const[s,t]=c.useState([]),[a,o]=c.useState({A:[],B:[],C:[]}),[n,l]=c.useState(new Set),[i,r]=c.useState(!0),[u,w]=c.useState(!1),[y,k]=c.useState(null),C=c.useRef(!1),$=c.useRef(!0),T=me(),N=c.useMemo(()=>{const p=new Map;return s.forEach(b=>p.set(b.id,b)),p},[s]),R=async()=>{if(!C.current){C.current=!0,r(!0);try{const{data:p,error:b}=await h.from("sports").select("id").eq("name","Futsal").maybeSingle();if(b||!p?.id){alert("Erro ao buscar a modalidade Futsal.");return}k(p.id);const{data:_,error:F}=await h.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",p.id).order("name");if(F){alert("Erro ao carregar times de Futsal.");return}t(_||[]);const d={A:[],B:[],C:[]},m=(_||[]).reduce((E,g)=>(ce.includes(g.group_name)&&(E[g.group_name]=E[g.group_name]||[]).push(g),E),{});ce.forEach(E=>{const g=(m[E]||[]).sort((v,I)=>{const S=v.seed_in_group??999,q=I.seed_in_group??999;return S!==q?S-q:v.name.localeCompare(I.name)});d[E]=g.map(v=>v.id)}),o(d)}finally{r(!1),C.current=!1}}};c.useEffect(()=>{$.current=!0,R();const p=h.channel("futsal-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{$.current&&!C.current&&R()}).subscribe();return()=>{$.current=!1,h.removeChannel(p)}},[]);const P=c.useMemo(()=>new Set(ce.flatMap(p=>a[p])),[a]),B=c.useMemo(()=>s.filter(p=>!P.has(p.id)),[s,P]),M=p=>{l(b=>{const _=new Set(b);return _.has(p)?_.delete(p):_.add(p),_})},L=p=>{const b=Array.from(n);if(!b.length){alert("Selecione ao menos 1 time.");return}if(a[p].length+b.length>we){alert(`O grupo ${p} não pode ter mais de ${we} times.`),l(new Set);return}o(_=>{const F={..._};for(const d of b){for(const m of ce)F[m]=F[m].filter(E=>E!==d);F[p]=[...F[p],d]}return F}),l(new Set)},O=p=>{o(b=>{const _={...b};for(const F of ce)_[F]=_[F].filter(d=>d!==p);return _})},A=ce.every(p=>a[p].length===we),f=async()=>{if(!A){alert("Complete todos os grupos antes de confirmar!");return}if(!y){alert("Modalidade Futsal não encontrada.");return}try{w(!0),await h.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",y);for(const b of ce){const _=a[b];if(_.length){await h.from("teams").update({group_name:b}).in("id",_);for(let F=0;F<_.length;F++)await h.from("teams").update({seed_in_group:F+1}).eq("id",_[F])}}await h.rpc("seed_initial_standings",{p_sport_name:"Futsal",p_reset:!0}),await h.rpc("rebuild_standings",{p_sport_name:"Futsal"});const{error:p}=await h.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:y,p_variant:"1v3_1v2_3v2"});if(p){alert("Erro ao gerar jogos de grupos: "+p.message);return}await h.rpc("maybe_create_knockout",{p_sport_name:"Futsal"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>T("/admin/campeonatos"),1200)}catch(p){alert("Erro ao salvar: "+(p?.message||String(p)))}finally{w(!1)}};return i?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Futsal"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. Ao confirmar, os grupos são salvos com"," ",e.jsx("strong",{children:"seed_in_group = 1,2,3"}),", e os jogos são gerados via RPC na"," ",e.jsx("strong",{children:"ordem exata"})," (fila global por ",e.jsx("code",{children:"order_idx"}),"). Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:R,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),B.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:B.map(p=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(p.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>M(p.id),title:p.name,children:[e.jsx(Ls,{team:p}),e.jsx("span",{className:"truncate",children:p.name})]},p.id))})]}),ce.map(p=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",p]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[p].length===we?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[p].length,"/",we]})]}),e.jsx("button",{onClick:()=>L(p),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[p].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[p].map((b,_)=>{const F=N.get(b);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>O(b),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:_+1}),e.jsx(Ls,{team:F}),e.jsx("span",{className:"truncate",title:F?.name,children:F?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},b)})})})]},p))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:ce.map(p=>`${p}(${a[p].length}/${we})`).join(", ")}),e.jsx("button",{onClick:f,disabled:!A||u,className:`px-6 py-2 rounded font-semibold transition ${A&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Ls({team:s}){const t=un(s?.name),a=s?.color||gn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function un(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function gn(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const ae=["A","B","C"],ge=3;function hn(){const[s,t]=c.useState([]),[a,o]=c.useState({A:[],B:[],C:[]}),[n,l]=c.useState(new Set),[i,r]=c.useState(!0),[u,w]=c.useState(!1),[y,k]=c.useState(null),C=c.useRef(!1),$=c.useRef(!0),T=me(),N=async()=>{if(!C.current){C.current=!0,r(!0);try{const{data:f,error:p}=await h.from("sports").select("id").eq("name","Volei").maybeSingle();if(p||!f?.id){alert("Erro ao buscar a modalidade Vôlei.");return}k(f.id);const{data:b,error:_}=await h.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",f.id).order("name");if(_){alert("Erro ao carregar times de Vôlei.");return}t(b||[]);const F={A:[],B:[],C:[]},d={A:[],B:[],C:[]};(b||[]).forEach(m=>{m.group_name&&ae.includes(m.group_name)&&d[m.group_name].push(m)}),ae.forEach(m=>{const E=(d[m]||[]).sort((g,v)=>{const I=g.seed_in_group??999,S=v.seed_in_group??999;return I!==S?I-S:g.name.localeCompare(v.name)});F[m]=E.map(g=>g.id)}),o(F)}finally{r(!1),C.current=!1}}};c.useEffect(()=>{$.current=!0,N();const f=h.channel("volei-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{$.current&&!C.current&&N()}).subscribe();return()=>{$.current=!1,h.removeChannel(f)}},[]);const R=c.useMemo(()=>new Set(ae.flatMap(f=>a[f])),[a]),P=c.useMemo(()=>s.filter(f=>!R.has(f.id)),[s,R]),B=f=>{l(p=>{const b=new Set(p);return b.has(f)?b.delete(f):b.add(f),b})},M=f=>{const p=Array.from(n);if(!p.length){alert("Selecione ao menos 1 time.");return}if(a[f].length+p.length>ge){alert(`O grupo ${f} não pode ter mais de ${ge} times.`),l(new Set);return}o(b=>{const _={...b};for(const F of p){for(const d of ae)_[d]=_[d].filter(m=>m!==F);_[f]=[..._[f],F]}return _}),l(new Set)},L=f=>{o(p=>{const b={...p};for(const _ of ae)b[_]=b[_].filter(F=>F!==f);return b})},O=ae.every(f=>a[f].length===ge),A=async()=>{if(!O){alert("Complete todos os grupos antes de confirmar!");return}if(!y){alert("Modalidade Vôlei não encontrada.");return}try{w(!0),await h.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",y);for(const p of ae){const b=a[p];if(b.length){await h.from("teams").update({group_name:p}).in("id",b);for(let _=0;_<b.length;_++)await h.from("teams").update({seed_in_group:_+1}).eq("id",b[_])}}await h.rpc("seed_initial_standings",{p_sport_name:"Volei",p_reset:!0}),await h.rpc("rebuild_standings",{p_sport_name:"Volei"});const{error:f}=await h.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:y,p_variant:"1v2_1v3_2v3"});if(f){alert("Erro ao gerar jogos de grupos: "+f.message);return}await h.rpc("maybe_create_knockout",{p_sport_name:"Volei"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>T("/admin/campeonatos"),1200)}catch(f){alert("Erro ao salvar: "+(f?.message||String(f)))}finally{w(!1)}};return i?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Vôlei"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 9 times em 3 grupos de 3. Ao confirmar, salvamos"," ",e.jsx("strong",{children:"group_name"})," e ",e.jsx("strong",{children:"seed_in_group = 1,2,3"})," conforme a ordem e geramos os jogos via RPC na ",e.jsx("strong",{children:"ordem exata"}),". Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:N,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),P.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:P.map(f=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(f.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>B(f.id),title:f.name,children:[e.jsx(Ds,{team:f}),e.jsx("span",{className:"truncate",children:f.name})]},f.id))})]}),ae.map(f=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",f]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[f].length===ge?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[f].length,"/",ge]})]}),e.jsx("button",{onClick:()=>M(f),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[f].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[f].map((p,b)=>{const _=s.find(F=>F.id===p);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>L(p),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:b+1}),e.jsx(Ds,{team:_}),e.jsx("span",{className:"truncate",title:_?.name,children:_?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},p)})})})]},f))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:ae.map(f=>`${f}(${a[f].length}/${ge})`).join(", ")}),e.jsx("button",{onClick:A,disabled:!ae.every(f=>a[f].length===ge)||u,className:`px-6 py-2 rounded font-semibold transition ${ae.every(f=>a[f].length===ge)&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Ds({team:s}){const t=pn(s?.name),a=s?.color||xn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-[10px] font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function pn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function xn(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const We=16;function fn(){const[s,t]=c.useState([]),[a,o]=c.useState(Array.from({length:We},()=>({home:null,away:null}))),[n,l]=c.useState(new Set),[i,r]=c.useState(!0),[u,w]=c.useState(!1),[y,k]=c.useState(null),C=me(),$=async()=>{r(!0);try{const{data:A,error:f}=await h.from("sports").select("id").eq("name","FIFA").maybeSingle();if(f||!A?.id){alert("Erro ao localizar a modalidade FIFA."),r(!1);return}k(A.id);const{data:p,error:b}=await h.from("teams").select("id, name, logo_url, color").eq("sport_id",A.id).order("name");b?alert("Erro ao carregar times do FIFA."):t(p||[])}finally{r(!1)}};c.useEffect(()=>{$()},[]);const T=c.useMemo(()=>new Set(a.flatMap(A=>[A.home,A.away]).filter(Boolean)),[a]),N=c.useMemo(()=>s.filter(A=>!T.has(A.id)),[s,T]),R=A=>{l(f=>{const p=new Set(f);return p.has(A)?p.delete(A):p.add(A),p})},P=(A,f)=>{const p=Array.from(n);if(p.length===0){alert("Selecione um time para alocar.");return}if(p.length>1){alert("Selecione apenas 1 time por vez."),l(new Set);return}const b=p[0];o(_=>{const F=_[A];if(F[f])return alert(`O slot ${f==="home"?"A":"B"} do Jogo ${A+1} já está ocupado.`),_;const d=[..._];return d[A]={...F,[f]:b},d}),l(new Set)},B=(A,f)=>{o(p=>{const b=[...p];return b[A]={...b[A],[f]:null},b})},M=a.length===We&&a.every(A=>A.home&&A.away),L=async()=>{if(!M){alert("Todos os confrontos precisam ter 2 times.");return}if(!y){alert("Modalidade FIFA não encontrada.");return}try{w(!0);const{count:A}=await h.from("matches").select("*",{count:"exact",head:!0}).eq("sport_id",y);if((A??0)>0){if(!window.confirm("Já existe um campeonato de FIFA. Criar um novo vai apagar jogos e classificação existentes. Deseja continuar?"))return;const{data:_}=await h.from("matches").select("id").eq("sport_id",y),F=(_||[]).map(d=>d.id);F.length&&await h.from("match_events").delete().in("match_id",F),await h.from("matches").delete().eq("sport_id",y),await h.from("standings").delete().eq("sport_id",y)}await h.from("teams").update({group_name:null}).eq("sport_id",y);const f=a.map((b,_)=>({sport_id:y,stage:"r32",round:_+1,order_idx:_+1,status:"scheduled",home_team_id:b.home,away_team_id:b.away,venue:"Console FIFA"})),{error:p}=await h.from("matches").insert(f);if(p){alert("Erro ao criar os jogos: "+p.message);return}await h.from("matches").insert(Array.from({length:8}).map((b,_)=>({sport_id:y,stage:"oitavas",round:_+1,order_idx:16+(_+1),status:"scheduled"}))),await h.from("matches").insert(Array.from({length:4}).map((b,_)=>({sport_id:y,stage:"quartas",round:_+1,order_idx:24+(_+1),status:"scheduled"}))),await h.from("matches").insert([{sport_id:y,stage:"semi",round:1,order_idx:29,status:"scheduled"},{sport_id:y,stage:"semi",round:2,order_idx:30,status:"scheduled"},{sport_id:y,stage:"final",round:1,order_idx:31,status:"scheduled"},{sport_id:y,stage:"3lugar",round:1,order_idx:32,status:"scheduled"}]),await h.rpc("seed_initial_standings",{p_sport_name:"FIFA",p_reset:!0}),alert(`✅ Chaveamento criado com sucesso!

Voltando para a tela de campeonatos…`),setTimeout(()=>C("/admin/campeonatos"),1200)}catch(A){alert("Erro ao salvar: "+(A?.message||String(A)))}finally{w(!1)}},O=async()=>{if(!y){alert("Modalidade FIFA não encontrada.");return}if(s.length!==32){alert("É necessário ter exatamente 32 times cadastrados no FIFA para gerar automaticamente.");return}try{w(!0);const{error:A}=await h.rpc("fifa_seed_32_bracket",{p_sport_name:"FIFA",p_reset:!1});if(A)throw A;alert(`✅ Partidas do FIFA geradas com sucesso!

Voltando para a tela de campeonatos…`),setTimeout(()=>C("/admin/campeonatos"),1200)}catch(A){console.error("Erro ao gerar partidas FIFA:",A),alert("Erro ao gerar partidas: "+(A?.message||String(A)))}finally{w(!1)}};return i?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de FIFA"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Monte as pré-oitavas (16 jogos). Ao confirmar, os jogos entram como ",e.jsx("strong",{children:"scheduled"})," com"," ",e.jsx("strong",{children:"order_idx"})," fixo: assim, o Jogo 1 aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:O,disabled:u||!y,title:"Gera automaticamente J1..J16, placeholders J17..J28",className:`text-xs px-3 py-1 rounded border transition ${u?"opacity-60 cursor-not-allowed":"hover:bg-gray-50"}`,children:"Gerar automaticamente (RPC)"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),N.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"grid grid-cols-2 gap-2",children:N.map(A=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(A.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>R(A.id),title:A.name,children:[e.jsx(es,{team:A}),e.jsx("span",{className:"truncate",children:A.name})]},A.id))})]}),e.jsxs("div",{className:"border rounded p-4 overflow-y-auto max-h-[32rem]",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Confrontos (pré-oitavas)"}),e.jsx("ul",{className:"space-y-4",children:a.map((A,f)=>{const p=s.find(_=>_.id===A.home),b=s.find(_=>_.id===A.away);return e.jsxs("li",{className:"flex flex-col gap-1 border rounded p-2 bg-gray-50",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-600",children:["Jogo ",f+1]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"flex items-center gap-2 flex-1",children:p?e.jsxs(e.Fragment,{children:[e.jsx(es,{team:p}),e.jsx("span",{className:"truncate",title:p.name,children:p.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>B(f,"home"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>P(f,"home"),children:"Adicionar time A"})}),e.jsx("span",{className:"font-bold",children:"vs"}),e.jsx("div",{className:"flex items-center gap-2 flex-1",children:b?e.jsxs(e.Fragment,{children:[e.jsx(es,{team:b}),e.jsx("span",{className:"truncate",title:b.name,children:b.name}),e.jsx("button",{className:"text-xs text-red-600",onClick:()=>B(f,"away"),children:"Remover"})]}):e.jsx("button",{className:"text-xs px-3 py-1 rounded border hover:bg-gray-100",onClick:()=>P(f,"away"),children:"Adicionar time B"})})]})]},f)})})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:M?e.jsxs("span",{className:"text-green-700",children:["Todos os ",We," confrontos estão prontos!"]}):e.jsxs("span",{children:["Restam ",32-T.size," times para alocar."]})}),e.jsx("button",{onClick:L,disabled:!M||u,className:`px-6 py-3 rounded font-semibold transition ${M&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar chaveamento"})]})]})}function es({team:s}){const t=yn(s?.name),a=s?.color||jn(s?.name||"T");return e.jsx("div",{className:"w-7 h-7 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function yn(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function jn(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}const re=["A","B","C","D","E","F","G","H"],ve=3;function bn(){const[s,t]=c.useState([]),[a,o]=c.useState(re.reduce((f,p)=>({...f,[p]:[]}),{})),[n,l]=c.useState(new Set),[i,r]=c.useState(!0),[u,w]=c.useState(!1),[y,k]=c.useState(null),C=c.useRef(!1),$=c.useRef(!0),T=me(),N=async()=>{if(!C.current){C.current=!0,r(!0);try{const{data:f,error:p}=await h.from("sports").select("id").eq("name","Pebolim").maybeSingle();if(p||!f?.id){alert("Erro ao buscar a modalidade Pebolim.");return}k(f.id);const{data:b,error:_}=await h.from("teams").select("id,name,logo_url,color,group_name,seed_in_group").eq("sport_id",f.id).order("name");if(_){alert("Erro ao carregar times de Pebolim.");return}t(b||[]);const F=re.reduce((m,E)=>({...m,[E]:[]}),{}),d=(b||[]).reduce((m,E)=>(re.includes(E.group_name)&&(m[E.group_name]=m[E.group_name]||[]).push(E),m),{});re.forEach(m=>{const E=(d[m]||[]).sort((g,v)=>{const I=g.seed_in_group??999,S=v.seed_in_group??999;return I!==S?I-S:g.name.localeCompare(v.name)});F[m]=E.map(g=>g.id)}),o(F)}finally{r(!1),C.current=!1}}};c.useEffect(()=>{$.current=!0,N();const f=h.channel("pebolim-admin").on("postgres_changes",{event:"*",schema:"public",table:"teams"},()=>{$.current&&!C.current&&N()}).subscribe();return()=>{$.current=!1,h.removeChannel(f)}},[]);const R=c.useMemo(()=>new Set(re.flatMap(f=>a[f])),[a]),P=c.useMemo(()=>s.filter(f=>!R.has(f.id)),[s,R]),B=f=>{l(p=>{const b=new Set(p);return b.has(f)?b.delete(f):b.add(f),b})},M=f=>{const p=Array.from(n);if(!p.length){alert("Selecione ao menos 1 time.");return}if(a[f].length+p.length>ve){alert(`O grupo ${f} não pode ter mais de ${ve} times.`),l(new Set);return}o(b=>{const _={...b};for(const F of p){for(const d of re)_[d]=_[d].filter(m=>m!==F);_[f]=[..._[f],F]}return _}),l(new Set)},L=f=>{o(p=>{const b={...p};for(const _ of re)b[_]=b[_].filter(F=>F!==f);return b})},O=re.every(f=>a[f].length===ve),A=async()=>{if(!O){alert("Complete todos os grupos antes de confirmar!");return}if(!y){alert("Modalidade Pebolim não encontrada.");return}try{w(!0),await h.from("teams").update({group_name:null,seed_in_group:null}).eq("sport_id",y);for(const p of re){const b=a[p];if(b.length){await h.from("teams").update({group_name:p}).in("id",b);for(let _=0;_<b.length;_++)await h.from("teams").update({seed_in_group:_+1}).eq("id",b[_])}}await h.rpc("seed_initial_standings",{p_sport_name:"Pebolim",p_reset:!0}),await h.rpc("rebuild_standings",{p_sport_name:"Pebolim"});const{error:f}=await h.rpc("admin_generate_group_fixtures_3x3",{p_sport_id:y,p_variant:"1v3_1v2_3v2"});if(f){alert("Erro ao gerar jogos de grupos: "+f.message);return}await h.rpc("maybe_create_knockout",{p_sport_name:"Pebolim"}),alert(`✅ Grupos confirmados e jogos gerados!

Voltando para a tela de campeonatos...`),setTimeout(()=>T("/admin/campeonatos"),1200)}catch(f){alert("Erro ao salvar: "+(f?.message||String(f)))}finally{w(!1)}};return i?e.jsx("p",{children:"Carregando times..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configuração do Campeonato de Pebolim"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Organize os 24 times em 8 grupos de 3. Ao confirmar, salvamos"," ",e.jsx("strong",{children:"group_name"})," e ",e.jsx("strong",{children:"seed_in_group = 1,2,3"})," conforme a ordem e geramos os jogos via RPC na ",e.jsx("strong",{children:"ordem exata"}),". Assim, o Jogo 1 já aparece em ",e.jsx("em",{children:"⚠️ Compareçam"})," e o Jogo 2 como ",e.jsx("em",{children:"Próximo"}),"."]})]}),e.jsx("button",{onClick:N,className:"text-xs px-3 py-1 rounded border hover:bg-gray-50",title:"Recarregar dados",children:"Recarregar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Times disponíveis"}),P.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time disponível."}):e.jsx("ul",{className:"flex-1 overflow-y-auto space-y-1",children:P.map(f=>e.jsxs("li",{className:`flex items-center gap-2 p-2 rounded cursor-pointer border ${n.has(f.id)?"bg-blue-600 text-white":"bg-gray-50 hover:bg-gray-100"}`,onClick:()=>B(f.id),title:f.name,children:[e.jsx(Bs,{team:f}),e.jsx("span",{className:"truncate",children:f.name})]},f.id))})]}),re.map(f=>e.jsxs("div",{className:"border rounded p-4 h-72 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:"font-semibold text-sm",children:["Grupo ",f]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded ${a[f].length===ve?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[a[f].length,"/",ve]})]}),e.jsx("button",{onClick:()=>M(f),className:"mb-1 text-xs px-2 py-1 border rounded hover:bg-gray-100",children:"Adicionar selecionados"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:a[f].length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Nenhum time."}):e.jsx("ul",{className:"space-y-1",children:a[f].map((p,b)=>{const _=s.find(F=>F.id===p);return e.jsxs("li",{className:"flex items-center justify-between bg-gray-50 p-1 rounded cursor-pointer",onClick:()=>L(p),title:"Clique para remover do grupo",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] w-4 text-gray-500",children:b+1}),e.jsx(Bs,{team:_}),e.jsx("span",{className:"truncate",title:_?.name,children:_?.name})]}),e.jsx("span",{className:"text-xs text-red-500",children:"Remover"})]},p)})})})]},f))]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"text-xs text-gray-600",children:re.map(f=>`${f}(${a[f].length}/${ve})`).join(", ")}),e.jsx("button",{onClick:A,disabled:!O||u,className:`px-6 py-2 rounded font-semibold transition ${O&&!u?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:u?"Processando...":"Confirmar grupos e gerar jogos"})]})]})}function Bs({team:s}){const t=_n(s?.name),a=s?.color||Nn(s?.name||"T");return e.jsx("div",{className:"w-6 h-6 rounded flex items-center justify-center text-white text-xs font-bold uppercase",style:{backgroundColor:a},title:s?.name,children:t})}function _n(s){if(!s)return"?";const t=s.trim().split(/\s+/);return t.length===1?t[0][0]?.toUpperCase()||"?":`${t[0][0]}${t[t.length-1][0]}`.toUpperCase()}function Nn(s){let t=0;for(let o=0;o<s.length;o++)t=s.charCodeAt(o)+((t<<5)-t);return`#${((t>>>0)%16777215).toString(16).padStart(6,"0")}`}function wn(){return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})})}function vn(){const{session:s,isAdmin:t,ready:a,signOut:o,needsPasswordSetup:n}=ds();Vs();const l=me();if(!a)return e.jsx(wn,{});if(n)return e.jsx(Ts,{});const i=async()=>{try{await o(),l("/",{replace:!0})}catch(r){console.error("Error during signout:",r)}};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"bg-blue-600 text-white sticky top-0 z-50 shadow-md",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx(X,{to:"/",className:"hover:opacity-90 transition-opacity",children:e.jsx("img",{src:"/logo-copa-influence.png",alt:"Copa Influence",className:"h-12 md:h-16 w-auto"})}),e.jsx("div",{className:"text-sm",children:s?e.jsxs("div",{className:"flex items-center gap-2",children:[s.user?.email&&e.jsx("span",{className:"text-white/80 text-xs hidden sm:inline",children:s.user.email}),e.jsx("button",{onClick:i,className:"hover:underline transition-colors hover:text-white/80 text-xs sm:text-sm",children:"Sair"})]}):e.jsx(X,{to:"/login",className:"hover:underline transition-colors hover:text-white/80 text-xs sm:text-sm",children:"Entrar"})})]}),e.jsx("div",{className:"border-t border-white/20 py-2",children:e.jsxs("nav",{className:"flex items-center justify-center gap-1 sm:gap-3 text-xs sm:text-sm overflow-x-auto",children:[e.jsx(X,{to:"/",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Home"}),e.jsx(X,{to:"/futsal",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Futsal"}),e.jsx(X,{to:"/volei",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Vôlei"}),e.jsx(X,{to:"/fifa",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"FIFA"}),e.jsx(X,{to:"/pebolim",className:"hover:underline transition-colors whitespace-nowrap px-1 sm:px-2",children:"Pebolim"}),t&&e.jsx(X,{to:"/admin",className:"bg-white/15 hover:bg-white/25 transition-colors px-2 py-1 rounded text-xs whitespace-nowrap ml-1 sm:ml-2",children:"Admin"})]})})]})}),e.jsx("main",{className:"flex-1 container mx-auto p-4",children:e.jsxs(Ct,{children:[e.jsx(ee,{path:"/",element:e.jsx(ja,{})}),e.jsx(ee,{path:"/futsal",element:e.jsx(Oa,{})}),e.jsx(ee,{path:"/volei",element:e.jsx(Ya,{})}),e.jsx(ee,{path:"/fifa",element:e.jsx(hr,{})}),e.jsx(ee,{path:"/pebolim",element:e.jsx($r,{})}),e.jsx(ee,{path:"/team/:id",element:e.jsx(Cs,{})}),e.jsx(ee,{path:"/times/:id",element:e.jsx(Cs,{})}),e.jsx(ee,{path:"/match/:id",element:e.jsx(Es,{})}),e.jsx(ee,{path:"/partida/:id",element:e.jsx(Es,{})}),e.jsx(ee,{path:"/set-password",element:e.jsx(Ts,{})}),e.jsx(ee,{path:"/login",element:e.jsx(Ur,{})}),e.jsx(ee,{path:"/admin",element:e.jsx(ue,{children:e.jsx(zr,{})})}),e.jsx(ee,{path:"/admin/elencos",element:e.jsx(ue,{children:e.jsx(Hr,{})})}),e.jsx(ee,{path:"/admin/partidas",element:e.jsx(ue,{children:e.jsx(tn,{})})}),e.jsx(ee,{path:"/admin/campeonatos",element:e.jsx(ue,{children:e.jsx(on,{})})}),e.jsx(ee,{path:"/admin/campeonatos/futsal",element:e.jsx(ue,{children:e.jsx(mn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/volei",element:e.jsx(ue,{children:e.jsx(hn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/fifa",element:e.jsx(ue,{children:e.jsx(fn,{})})}),e.jsx(ee,{path:"/admin/campeonatos/pebolim",element:e.jsx(ue,{children:e.jsx(bn,{})})}),e.jsx(ee,{path:"*",element:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"404 - Página não encontrada"}),e.jsx(X,{to:"/",className:"text-blue-600 hover:underline",children:"Voltar ao início"})]})})]})}),e.jsx("footer",{className:"bg-gray-200 p-4 text-center text-xs text-gray-700 mt-auto",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("p",{children:["© ",new Date().getFullYear()," Copa Influence"]}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Desenvolvido para a comunidade da igreja"})]})})]})}Rt.createRoot(document.getElementById("root")).render(e.jsx(Ve.StrictMode,{children:e.jsx(At,{children:e.jsx(It,{children:e.jsx(vn,{})})})}));
